import{b3 as Uy,b4 as Xr,aZ as Xy,h as $y,u as Hy,P as Yy,b5 as Ky}from"./obLiwMeQ.js";import{aq as Ar,W as na,E as ie,ar as Hm,l as me,as as Ym,u as Ue,a7 as eu,at as _i,au as $r,av as Km,aw as qy,a4 as Tr,ax as Jy,ay as Cd,az as sa,aA as Qy,T as To,N as ra,aB as t1,aC as iu,aD as e1,aE as qm,aF as Jm,aG as Qm,K as i1,Y as Ql,aH as n1,aI as Ro,_ as Pe,aJ as tp,aK as ep,aL as pr,aM as Mo,aN as ip,aO as s1,aP as xd,aQ as r1,aR as zt,aS as Sd,aT as Dh,aU as Ni,aV as o1,aW as a1,aX as np,a9 as Ii,ae as Po,aY as sp,aZ as nu,a_ as Ns,a$ as h1,b0 as rp,b1 as Hn,b2 as op,b3 as l1,b4 as Es,b5 as c1,b6 as u1,b7 as es,ai as _s,a0 as d1,b8 as Hi,O as f1,b9 as xi,ba as bd,bb as Ad,bc as su,bd as eh,g as g1,be as ap,bf as m1,bg as hp,bh as Go,bi as p1,bj as Ci,S as _1,k as ru,b as y1,bk as w1,bl as v1,bm as M1,v as oo,bn as lp,bo as I1,x as E1,Z as C1,j as x1,bp as S1,bq as b1,H as A1,a8 as T1,br as Lo,bs as hr,bt as R1,bu as P1,p as G1,c as tc,bv as L1,bw as O1,bx as er,by as F1,bz as cp,a1 as ec,bA as ih,a as Yi,bB as N1,bC as D1,o as Td,F as Rd,bD as k1,a3 as ou,bE as j1,r as B1,bF as V1,bG as W1,bH as z1,bI as Z1,X as U1,bJ as X1,bK as $1,bL as Pd,bM as H1,a2 as Y1,bN as K1,bO as Gd,bP as q1}from"./iPpcYJ_L.js";function tF(e,t,i=t){var n=new WeakSet;Uy(e,"input",async s=>{var r=s?e.defaultValue:e.value;if(r=ll(e)?cl(r):r,i(r),Xr!==null&&n.add(Xr),await Xy(),r!==(r=t())){var o=e.selectionStart,a=e.selectionEnd,h=e.value.length;if(e.value=r??"",a!==null){var c=e.value.length;o===a&&a===h&&c>h?(e.selectionStart=c,e.selectionEnd=c):(e.selectionStart=o,e.selectionEnd=Math.min(a,c))}}}),($y&&e.defaultValue!==e.value||Hy(t)==null&&e.value)&&(i(ll(e)?cl(e.value):e.value),Xr!==null&&n.add(Xr)),Yy(()=>{var s=t();if(e===document.activeElement){var r=Ky??Xr;if(n.has(r))return}ll(e)&&s===cl(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function ll(e){var t=e.type;return t==="number"||t==="range"}function cl(e){return e===""?null:+e}const ri={ADD:"add",REMOVE:"remove"},Ld={LENGTH:"length"};class xa extends na{constructor(t,i,n){super(t),this.element=i,this.index=n}}class qi extends Ar{constructor(t,i){if(super(),this.on,this.once,this.un,i=i||{},this.unique_=!!i.unique,this.array_=t||[],this.unique_)for(let n=0,s=this.array_.length;n<s;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let i=0,n=t.length;i<n;++i)this.push(t[i]);return this}forEach(t){const i=this.array_;for(let n=0,s=i.length;n<s;++n)t(i[n],n,i)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Ld.LENGTH)}insertAt(t,i){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(i),this.array_.splice(t,0,i),this.updateLength_(),this.dispatchEvent(new xa(ri.ADD,i,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const i=this.getLength();return this.insertAt(i,t),this.getLength()}remove(t){const i=this.array_;for(let n=0,s=i.length;n<s;++n)if(i[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const i=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new xa(ri.REMOVE,i,t)),i}setAt(t,i){const n=this.getLength();if(t>=n){this.insertAt(t,i);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(i,t);const s=this.array_[t];this.array_[t]=i,this.dispatchEvent(new xa(ri.REMOVE,s,t)),this.dispatchEvent(new xa(ri.ADD,i,t))}updateLength_(){this.set(Ld.LENGTH,this.array_.length)}assertUnique_(t,i){for(let n=0,s=this.array_.length;n<s;++n)if(this.array_[n]===t&&n!==i)throw new Error("Duplicate item added to a unique collection")}}class Ys extends na{constructor(t,i,n){super(t),this.map=i,this.frameState=n!==void 0?n:null}}class Zn extends Ys{constructor(t,i,n,s,r,o){super(t,i,r),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Me={SINGLECLICK:"singleclick",CLICK:ie.CLICK,DBLCLICK:ie.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},ic={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class J1 extends Hm{constructor(t,i){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=i===void 0?1:i,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=me(n,ic.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=me(n,ic.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ie.TOUCHMOVE,this.boundHandleTouchMove_,Ym?{passive:!1}:!1)}emulateClick_(t){let i=new Zn(Me.CLICK,this.map_,t);this.dispatchEvent(i),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,i=new Zn(Me.DBLCLICK,this.map_,t),this.dispatchEvent(i)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Zn(Me.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){const i=t,n=i.pointerId;if(i.type==Me.POINTERUP||i.type==Me.POINTERCANCEL){delete this.trackedTouches_[n];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==i.target){delete this.trackedTouches_[s];break}}else(i.type==Me.POINTERDOWN||i.type==Me.POINTERMOVE)&&(this.trackedTouches_[n]=i);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const i=new Zn(Me.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(i),this.emulateClicks_&&!i.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Ue),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const i=new Zn(Me.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(i),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(me(n,Me.POINTERMOVE,this.handlePointerMove_,this),me(n,Me.POINTERUP,this.handlePointerUp_,this),me(this.element_,Me.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(me(this.element_.getRootNode(),Me.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const i=new Zn(Me.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(i)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const i=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Zn(Me.POINTERMOVE,this.map_,t,i))}handleTouchMove_(t){const i=this.originalPointerMoveEvent_;(!i||i.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Ue(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ie.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Ue(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Ue),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Un={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},ze={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},nh=1/0;class Q1{constructor(t,i){this.priorityFunction_=t,this.keyFunction_=i,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,eu(this.queuedElements_)}dequeue(){const t=this.elements_,i=this.priorities_,n=t[0];t.length==1?(t.length=0,i.length=0):(t[0]=t.pop(),i[0]=i.pop(),this.siftUp_(0));const s=this.keyFunction_(n);return delete this.queuedElements_[s],n}enqueue(t){_i(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const i=this.priorityFunction_(t);return i!=nh?(this.elements_.push(t),this.priorities_.push(i),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const i=this.elements_,n=this.priorities_,s=i.length,r=i[t],o=n[t],a=t;for(;t<s>>1;){const h=this.getLeftChildIndex_(t),c=this.getRightChildIndex_(t),u=c<s&&n[c]<n[h]?c:h;i[t]=i[u],n[t]=n[u],t=u}i[t]=r,n[t]=o,this.siftDown_(a,t)}siftDown_(t,i){const n=this.elements_,s=this.priorities_,r=n[i],o=s[i];for(;i>t;){const a=this.getParentIndex_(i);if(s[a]>o)n[i]=n[a],s[i]=s[a],i=a;else break}n[i]=r,s[i]=o}reprioritize(){const t=this.priorityFunction_,i=this.elements_,n=this.priorities_;let s=0;const r=i.length;let o,a,h;for(a=0;a<r;++a)o=i[a],h=t(o),h==nh?delete this.queuedElements_[this.keyFunction_(o)]:(n[s]=h,i[s++]=o);i.length=s,n.length=s,this.heapify_()}}class tw extends Q1{constructor(t,i){super(n=>t.apply(null,n),n=>n[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=i,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const i=super.enqueue(t);return i&&t[0].addEventListener(ie.CHANGE,this.boundHandleTileChange_),i}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const i=t.target,n=i.getState();if(n===$r.LOADED||n===$r.ERROR||n===$r.EMPTY){n!==$r.ERROR&&i.removeEventListener(ie.CHANGE,this.boundHandleTileChange_);const s=i.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,i){let n=0;for(;this.tilesLoading_<t&&n<i&&this.getCount()>0;){const s=this.dequeue()[0],r=s.getKey();s.getState()===$r.IDLE&&!(r in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++n,s.load())}}}function ew(e,t,i,n,s){if(!e||!(i in e.wantedTiles)||!e.wantedTiles[i][t.getKey()])return nh;const r=e.viewState.center,o=n[0]-r[0],a=n[1]-r[1];return 65536*Math.log(s)+Math.sqrt(o*o+a*a)/s}const Sa="ol-hidden",oa="ol-unselectable",au="ol-control",Od="ol-collapsed",iw=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),Fd=["style","variant","weight","size","lineHeight","family"],nc={normal:400,bold:700},sc=function(e){const t=e.match(iw);if(!t)return null;const i={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let n=0,s=Fd.length;n<s;++n){const r=t[n+1];r!==void 0&&(i[Fd[n]]=typeof r=="string"?r.trim():r)}return isNaN(Number(i.weight))&&i.weight in nc&&(i.weight=nc[i.weight]),i.families=i.family.split(/,\s?/).map(n=>n.trim().replace(/^['"]|['"]$/g,"")),i};class kh extends Ar{constructor(t){super();const i=t.element;i&&!t.target&&!i.style.pointerEvents&&(i.style.pointerEvents="auto"),this.element=i||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&this.element?.remove();for(let i=0,n=this.listenerKeys.length;i<n;++i)Ue(this.listenerKeys[i]);if(this.listenerKeys.length=0,this.map_=t,t){const i=this.target_??t.getOverlayContainerStopEvent();this.element&&i.appendChild(this.element),this.render!==Km&&this.listenerKeys.push(me(t,Un.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class nw extends kh{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;const i=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",s=t.expandClassName!==void 0?t.expandClassName:i+"-expand",r=t.collapseLabel!==void 0?t.collapseLabel:"›",o=t.collapseClassName!==void 0?t.collapseClassName:i+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=s):this.label_=a;const h=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(h),this.toggleButton_.addEventListener(ie.CLICK,this.handleClick_.bind(this),!1);const c=i+" "+oa+" "+au+(this.collapsed_&&this.collapsible_?" "+Od:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const i=this.getMap().getAllLayers(),n=new Set(i.flatMap(s=>s.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(s=>n.add(s)):n.add(this.attributions_)),!this.overrideCollapsible_){const s=!i.some(r=>r.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(s)}return Array.from(n)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const i=await Promise.all(this.collectSourceAttributions_(t).map(s=>qy(()=>s))),n=i.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Tr(i,this.renderedAttributions_)){Jy(this.ulElement_);for(let s=0,r=i.length;s<r;++s){const o=document.createElement("li");o.innerHTML=i[s],this.ulElement_.appendChild(o)}this.renderedAttributions_=i}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Od),this.collapsed_?Cd(this.collapseLabel_,this.label_):Cd(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class sw extends kh{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const i=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"⇧",s=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(s));const r=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=i+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(ie.CLICK,this.handleClick_.bind(this),!1);const a=i+" "+oa+" "+au,h=this.element;h.className=a,h.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Sa)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const i=this.getMap().getView();if(!i)return;const n=i.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?i.animate({rotation:0,duration:this.duration_,easing:sa}):i.setRotation(0))}render(t){const i=t.frameState;if(!i)return;const n=i.viewState.rotation;if(n!=this.rotation_){const s="rotate("+n+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Sa);!r&&n===0?this.element.classList.add(Sa):r&&n!==0&&this.element.classList.remove(Sa)}this.label_.style.transform=s}this.rotation_=n}}class rw extends kh{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const i=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,s=t.zoomInClassName!==void 0?t.zoomInClassName:i+"-in",r=t.zoomOutClassName!==void 0?t.zoomOutClassName:i+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",h=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",c=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof o=="string"?document.createTextNode(o):o),u.addEventListener(ie.CLICK,this.handleClick_.bind(this,n),!1);const m=document.createElement("button");m.className=r,m.setAttribute("type","button"),m.title=c,m.appendChild(typeof a=="string"?document.createTextNode(a):a),m.addEventListener(ie.CLICK,this.handleClick_.bind(this,-n),!1);const p=i+" "+oa+" "+au,y=this.element;y.className=p,y.appendChild(u),y.appendChild(m),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,i){i.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const n=this.getMap().getView();if(!n)return;const s=n.getZoom();if(s!==void 0){const r=n.getConstrainedZoom(s+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:r,duration:this.duration_,easing:sa})):n.setZoom(r)}}}function ow(e){e=e||{};const t=new qi;return(e.zoom!==void 0?e.zoom:!0)&&t.push(new rw(e.zoomOptions)),(e.rotate!==void 0?e.rotate:!0)&&t.push(new sw(e.rotateOptions)),(e.attribution!==void 0?e.attribution:!0)&&t.push(new nw(e.attributionOptions)),t}class aw{constructor(t,i,n){this.decay_=t,this.minVelocity_=i,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,i){this.points_.push(t,i,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,i=this.points_.length-3;if(this.points_[i+2]<t)return!1;let n=i-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const s=this.points_[i+2]-this.points_[n+2];if(s<1e3/60)return!1;const r=this.points_[i]-this.points_[n],o=this.points_[i+1]-this.points_[n+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Nd={ACTIVE:"active"};class aa extends Ar{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Nd.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Nd.ACTIVE,t)}setMap(t){this.map_=t}}function hw(e,t,i){const n=e.getCenterInternal();if(n){const s=[n[0]+t[0],n[1]+t[1]];e.animateInternal({duration:i!==void 0?i:250,easing:Qy,center:e.getConstrainedCenter(s)})}}function hu(e,t,i,n){const s=e.getZoom();if(s===void 0)return;const r=e.getConstrainedZoom(s+t),o=e.getResolutionForZoom(r);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:o,anchor:i,duration:n!==void 0?n:250,easing:sa})}class lw extends aa{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let i=!1;if(t.type==Me.DBLCLICK){const n=t.originalEvent,s=t.map,r=t.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=s.getView();hu(a,o,r,this.duration_),n.preventDefault(),i=!0}return!i}}function rc(e){const t=arguments;return function(i){let n=!0;for(let s=0,r=t.length;s<r&&(n=n&&t[s](i),!!n);++s);return n}}const eF=function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},cw=function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},uw=function(e){const t=e.map.getTargetElement(),i=t.getRootNode(),n=e.map.getOwnerDocument().activeElement;return i instanceof ShadowRoot?i.host.contains(n):t.contains(n)},up=function(e){const t=e.map.getTargetElement(),i=t.getRootNode();return(i instanceof ShadowRoot?i.host:t).hasAttribute("tabindex")?uw(e):!0},dw=To,iF=function(e){return e.type==Me.CLICK},dp=function(e){const t=e.originalEvent;return"pointerId"in t&&t.button==0&&!(t1&&iu&&t.ctrlKey)},nF=ra,sF=function(e){return e.type==Me.SINGLECLICK},fp=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},rF=function(e){const t=e.originalEvent;return!t.altKey&&(iu?t.metaKey:t.ctrlKey)&&!t.shiftKey},fw=function(e){const t=e.originalEvent;return iu?t.metaKey:t.ctrlKey},gw=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},gp=function(e){const t=e.originalEvent,i=t.target.tagName;return i!=="INPUT"&&i!=="SELECT"&&i!=="TEXTAREA"&&!t.target.isContentEditable},ul=function(e){const t=e.originalEvent;return"pointerId"in t&&t.pointerType=="mouse"},mw=function(e){const t=e.originalEvent;return"pointerId"in t&&t.isPrimary&&t.button===0};class ha extends aa{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let i=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Me.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Me.POINTERUP){const n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==Me.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,i=this.stopDown(n)}else t.type==Me.POINTERMOVE&&this.handleMoveEvent(t);return!i}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function lu(e){const t=e.length;let i=0,n=0;for(let s=0;s<t;s++)i+=e[s].clientX,n+=e[s].clientY;return{clientX:i/t,clientY:n/t}}class pw extends ha{constructor(t){super({stopDown:ra}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const i=t.condition?t.condition:rc(fp,mw);this.condition_=t.onFocusOnly?rc(up,i):i,this.noKinetic_=!1}handleDragEvent(t){const i=t.map;this.panning_||(this.panning_=!0,i.getView().beginInteraction());const n=this.targetPointers,s=i.getEventPixel(lu(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],a=t.map.getView();e1(r,a.getResolution()),qm(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){const i=t.map,n=i.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=i.getPixelFromCoordinateInternal(o),h=i.getCoordinateFromPixelInternal([a[0]-s*Math.cos(r),a[1]-s*Math.sin(r)]);n.animateInternal({center:n.getConstrainedCenter(h),duration:500,easing:sa})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class _w extends ha{constructor(t){t=t||{},super({stopDown:ra}),this.condition_=t.condition?t.condition:cw,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!ul(t))return;const i=t.map,n=i.getView();if(n.getConstraints().rotation===Jm)return;const s=i.getSize(),r=t.pixel,o=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return ul(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return ul(t)&&dp(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class yw extends Qm{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,i=this.endPixel_,n="px",s=this.element_.style;s.left=Math.min(t[0],i[0])+n,s.top=Math.min(t[1],i[1])+n,s.width=Math.abs(i[0]-t[0])+n,s.height=Math.abs(i[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const i=this.element_.style;i.left="inherit",i.top="inherit",i.width="inherit",i.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,i){this.startPixel_=t,this.endPixel_=i,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,i=this.endPixel_,s=[t,[t[0],i[1]],i,[i[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new i1([s])}getGeometry(){return this.geometry_}}const Vs={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Hr extends na{constructor(t,i,n){super(t),this.coordinate=i,this.mapBrowserEvent=n}}class ww extends ha{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new yw(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??dp,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,i,n){const s=n[0]-i[0],r=n[1]-i[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Hr(Vs.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;const i=this.boxEndCondition_(t,this.startPixel_,t.pixel);return i&&this.onBoxEnd(t),this.dispatchEvent(new Hr(i?Vs.BOXEND:Vs.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Hr(Vs.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Hr(Vs.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Hr(Vs.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}}class vw extends ww{constructor(t){t=t||{};const i=t.condition?t.condition:gw;super({condition:i,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const n=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=n.rotatedExtentForGeometry(s),o=n.getResolutionForExtentInternal(r),a=n.getResolution()/o;s=s.clone(),s.scale(a*a)}n.fitInternal(s,{duration:this.duration_,easing:sa})}}const cs={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class Mw extends aa{constructor(t){super(),t=t||{},this.defaultCondition_=function(i){return fp(i)&&gp(i)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let i=!1;if(t.type==ie.KEYDOWN){const n=t.originalEvent,s=n.key;if(this.condition_(t)&&(s==cs.DOWN||s==cs.LEFT||s==cs.RIGHT||s==cs.UP)){const o=t.map.getView(),a=o.getResolution()*this.pixelDelta_;let h=0,c=0;s==cs.DOWN?c=-a:s==cs.LEFT?h=-a:s==cs.RIGHT?h=a:c=a;const u=[h,c];qm(u,o.getRotation()),hw(o,u,this.duration_),n.preventDefault(),i=!0}}return!i}}class Iw extends aa{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(i){return!fw(i)&&gp(i)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let i=!1;if(t.type==ie.KEYDOWN||t.type==ie.KEYPRESS){const n=t.originalEvent,s=n.key;if(this.condition_(t)&&(s==="+"||s==="-")){const r=t.map,o=s==="+"?this.delta_:-this.delta_,a=r.getView();hu(a,o,void 0,this.duration_),n.preventDefault(),i=!0}}return!i}}const Ew=40,Cw=300;class xw extends aa{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const i=t.condition?t.condition:dw;this.condition_=t.onFocusOnly?rc(up,i):i,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==ie.WHEEL)return!0;const n=t.map,s=t.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let r=s.deltaY;switch(s.deltaMode){case WheelEvent.DOM_DELTA_LINE:r*=Ew;break;case WheelEvent.DOM_DELTA_PAGE:r*=Cw;break}if(r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?n.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=o,!1;this.totalDelta_+=r;const h=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),h),!1}handleWheelZoom_(t){const i=t.getView();i.getAnimating()&&i.cancelAnimations();let n=-Ql(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(i.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),hu(i,n,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class Sw extends ha{constructor(t){t=t||{};const i=t;i.stopDown||(i.stopDown=ra),super(i),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let i=0;const n=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-n.clientY,s.clientX-n.clientX);if(this.lastAngle_!==void 0){const h=r-this.lastAngle_;this.rotationDelta_+=h,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),i=h}this.lastAngle_=r;const o=t.map,a=o.getView();a.getConstraints().rotation!==Jm&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(lu(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(i,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const i=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||i.getView().beginInteraction(),!0}return!1}}class bw extends ha{constructor(t){t=t||{};const i=t;i.stopDown||(i.stopDown=ra),super(i),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let i=1;const n=this.targetPointers[0],s=this.targetPointers[1],r=n.clientX-s.clientX,o=n.clientY-s.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(i=this.lastDistance_/a),this.lastDistance_=a;const h=t.map,c=h.getView();i!=1&&(this.lastScaleDelta_=i),this.anchor_=h.getCoordinateFromPixelInternal(h.getEventPixel(lu(this.targetPointers))),h.render(),c.adjustResolutionInternal(i,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const n=t.map.getView(),s=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const i=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||i.getView().beginInteraction(),!0}return!1}}function Aw(e){e=e||{};const t=new qi,i=new aw(-.005,.05,100);return(e.altShiftDragRotate!==void 0?e.altShiftDragRotate:!0)&&t.push(new _w),(e.doubleClickZoom!==void 0?e.doubleClickZoom:!0)&&t.push(new lw({delta:e.zoomDelta,duration:e.zoomDuration})),(e.dragPan!==void 0?e.dragPan:!0)&&t.push(new pw({onFocusOnly:e.onFocusOnly,kinetic:i})),(e.pinchRotate!==void 0?e.pinchRotate:!0)&&t.push(new Sw),(e.pinchZoom!==void 0?e.pinchZoom:!0)&&t.push(new bw({duration:e.zoomDuration})),(e.keyboard!==void 0?e.keyboard:!0)&&(t.push(new Mw),t.push(new Iw({delta:e.zoomDelta,duration:e.zoomDuration}))),(e.mouseWheelZoom!==void 0?e.mouseWheelZoom:!0)&&t.push(new xw({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(e.shiftDragZoom!==void 0?e.shiftDragZoom:!0)&&t.push(new vw({duration:e.zoomDuration})),t}class Xn extends na{constructor(t,i){super(t),this.layer=i}}const dl={LAYERS:"layers"};class Rr extends n1{constructor(t){t=t||{};const i=Object.assign({},t);delete i.layers;let n=t.layers;super(i),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(dl.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new qi(n.slice(),{unique:!0}):_i(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new qi(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Ue),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(me(t,ri.ADD,this.handleLayersAdd_,this),me(t,ri.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(Ue);eu(this.listenerKeys_);const i=t.getArray();for(let n=0,s=i.length;n<s;n++){const r=i[n];this.registerLayerListeners_(r),this.dispatchEvent(new Xn("addlayer",r))}this.changed()}registerLayerListeners_(t){const i=[me(t,Ro.PROPERTYCHANGE,this.handleLayerChange_,this),me(t,ie.CHANGE,this.handleLayerChange_,this)];t instanceof Rr&&i.push(me(t,"addlayer",this.handleLayerGroupAdd_,this),me(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Pe(t)]=i}handleLayerGroupAdd_(t){this.dispatchEvent(new Xn("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Xn("removelayer",t.layer))}handleLayersAdd_(t){const i=t.element;this.registerLayerListeners_(i),this.dispatchEvent(new Xn("addlayer",i)),this.changed()}handleLayersRemove_(t){const i=t.element,n=Pe(i);this.listenerKeys_[n].forEach(Ue),delete this.listenerKeys_[n],this.dispatchEvent(new Xn("removelayer",i)),this.changed()}getLayers(){return this.get(dl.LAYERS)}setLayers(t){const i=this.getLayers();if(i){const n=i.getArray();for(let s=0,r=n.length;s<r;++s)this.dispatchEvent(new Xn("removelayer",n[s]))}this.set(dl.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(i){i.getLayersArray(t)}),t}getLayerStatesArray(t){const i=t!==void 0?t:[],n=i.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(i)});const s=this.getLayerState();let r=s.zIndex;!t&&s.zIndex===void 0&&(r=0);for(let o=n,a=i.length;o<a;o++){const h=i[o];h.opacity*=s.opacity,h.visible=h.visible&&s.visible,h.maxResolution=Math.min(h.maxResolution,s.maxResolution),h.minResolution=Math.max(h.minResolution,s.minResolution),h.minZoom=Math.max(h.minZoom,s.minZoom),h.maxZoom=Math.min(h.maxZoom,s.maxZoom),s.extent!==void 0&&(h.extent!==void 0?h.extent=tp(h.extent,s.extent):h.extent=s.extent),h.zIndex===void 0&&(h.zIndex=r)}return i}getSourceState(){return"ready"}}function mp(e,t,i=0,n=e.length-1,s=Tw){for(;n>i;){if(n-i>600){const h=n-i+1,c=t-i+1,u=Math.log(h),m=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*m*(h-m)/h)*(c-h/2<0?-1:1),y=Math.max(i,Math.floor(t-c*m/h+p)),w=Math.min(n,Math.floor(t+(h-c)*m/h+p));mp(e,t,y,w,s)}const r=e[t];let o=i,a=n;for(Yr(e,i,t),s(e[n],r)>0&&Yr(e,i,n);o<a;){for(Yr(e,o,a),o++,a--;s(e[o],r)<0;)o++;for(;s(e[a],r)>0;)a--}s(e[i],r)===0?Yr(e,i,a):(a++,Yr(e,a,n)),a<=t&&(i=a+1),t<=a&&(n=a-1)}}function Yr(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function Tw(e,t){return e<t?-1:e>t?1:0}let jh=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let i=this.data;const n=[];if(!Aa(t,i))return n;const s=this.toBBox,r=[];for(;i;){for(let o=0;o<i.children.length;o++){const a=i.children[o],h=i.leaf?s(a):a;Aa(t,h)&&(i.leaf?n.push(a):gl(t,h)?this._all(a,n):r.push(a))}i=r.pop()}return n}collides(t){let i=this.data;if(!Aa(t,i))return!1;const n=[];for(;i;){for(let s=0;s<i.children.length;s++){const r=i.children[s],o=i.leaf?this.toBBox(r):r;if(Aa(t,o)){if(i.leaf||gl(t,o))return!0;n.push(r)}}i=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let i=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=i;else if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){const n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Ks([]),this}remove(t,i){if(!t)return this;let n=this.data;const s=this.toBBox(t),r=[],o=[];let a,h,c;for(;n||r.length;){if(n||(n=r.pop(),h=r[r.length-1],a=o.pop(),c=!0),n.leaf){const u=Rw(t,n.children,i);if(u!==-1)return n.children.splice(u,1),r.push(n),this._condense(r),this}!c&&!n.leaf&&gl(n,s)?(r.push(n),o.push(a),a=0,h=n,n=n.children[0]):h?(a++,n=h.children[a],c=!1):n=null}return this}toBBox(t){return t}compareMinX(t,i){return t.minX-i.minX}compareMinY(t,i){return t.minY-i.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,i){const n=[];for(;t;)t.leaf?i.push(...t.children):n.push(...t.children),t=n.pop();return i}_build(t,i,n,s){const r=n-i+1;let o=this._maxEntries,a;if(r<=o)return a=Ks(t.slice(i,n+1)),Ws(a,this.toBBox),a;s||(s=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,s-1))),a=Ks([]),a.leaf=!1,a.height=s;const h=Math.ceil(r/o),c=h*Math.ceil(Math.sqrt(o));Dd(t,i,n,c,this.compareMinX);for(let u=i;u<=n;u+=c){const m=Math.min(u+c-1,n);Dd(t,u,m,h,this.compareMinY);for(let p=u;p<=m;p+=h){const y=Math.min(p+h-1,m);a.children.push(this._build(t,p,y,s-1))}}return Ws(a,this.toBBox),a}_chooseSubtree(t,i,n,s){for(;s.push(i),!(i.leaf||s.length-1===n);){let r=1/0,o=1/0,a;for(let h=0;h<i.children.length;h++){const c=i.children[h],u=fl(c),m=Lw(t,c)-u;m<o?(o=m,r=u<r?u:r,a=c):m===o&&u<r&&(r=u,a=c)}i=a||i.children[0]}return i}_insert(t,i,n){const s=n?t:this.toBBox(t),r=[],o=this._chooseSubtree(s,this.data,i,r);for(o.children.push(t),ho(o,s);i>=0&&r[i].children.length>this._maxEntries;)this._split(r,i),i--;this._adjustParentBBoxes(s,r,i)}_split(t,i){const n=t[i],s=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,s);const o=this._chooseSplitIndex(n,r,s),a=Ks(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,Ws(n,this.toBBox),Ws(a,this.toBBox),i?t[i-1].children.push(a):this._splitRoot(n,a)}_splitRoot(t,i){this.data=Ks([t,i]),this.data.height=t.height+1,this.data.leaf=!1,Ws(this.data,this.toBBox)}_chooseSplitIndex(t,i,n){let s,r=1/0,o=1/0;for(let a=i;a<=n-i;a++){const h=ao(t,0,a,this.toBBox),c=ao(t,a,n,this.toBBox),u=Ow(h,c),m=fl(h)+fl(c);u<r?(r=u,s=a,o=m<o?m:o):u===r&&m<o&&(o=m,s=a)}return s||n-i}_chooseSplitAxis(t,i,n){const s=t.leaf?this.compareMinX:Pw,r=t.leaf?this.compareMinY:Gw,o=this._allDistMargin(t,i,n,s),a=this._allDistMargin(t,i,n,r);o<a&&t.children.sort(s)}_allDistMargin(t,i,n,s){t.children.sort(s);const r=this.toBBox,o=ao(t,0,i,r),a=ao(t,n-i,n,r);let h=ba(o)+ba(a);for(let c=i;c<n-i;c++){const u=t.children[c];ho(o,t.leaf?r(u):u),h+=ba(o)}for(let c=n-i-1;c>=i;c--){const u=t.children[c];ho(a,t.leaf?r(u):u),h+=ba(a)}return h}_adjustParentBBoxes(t,i,n){for(let s=n;s>=0;s--)ho(i[s],t)}_condense(t){for(let i=t.length-1,n;i>=0;i--)t[i].children.length===0?i>0?(n=t[i-1].children,n.splice(n.indexOf(t[i]),1)):this.clear():Ws(t[i],this.toBBox)}};function Rw(e,t,i){if(!i)return t.indexOf(e);for(let n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function Ws(e,t){ao(e,0,e.children.length,t,e)}function ao(e,t,i,n,s){s||(s=Ks(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=t;r<i;r++){const o=e.children[r];ho(s,e.leaf?n(o):o)}return s}function ho(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Pw(e,t){return e.minX-t.minX}function Gw(e,t){return e.minY-t.minY}function fl(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function ba(e){return e.maxX-e.minX+(e.maxY-e.minY)}function Lw(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function Ow(e,t){const i=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),s=Math.min(e.maxX,t.maxX),r=Math.min(e.maxY,t.maxY);return Math.max(0,s-i)*Math.max(0,r-n)}function gl(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function Aa(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Ks(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Dd(e,t,i,n,s){const r=[t,i];for(;r.length;){if(i=r.pop(),t=r.pop(),i-t<=n)continue;const o=t+Math.ceil((i-t)/n/2)*n;mp(e,o,t,i,s),r.push(t,o,o,i)}}let Ds=0;const Je=1<<Ds++,Jt=1<<Ds++,oi=1<<Ds++,Li=1<<Ds++,Ss=1<<Ds++,lo=1<<Ds++,Ta=Math.pow(2,Ds)-1,cu={[Je]:"boolean",[Jt]:"number",[oi]:"string",[Li]:"color",[Ss]:"number[]",[lo]:"size"},Fw=Object.keys(cu).map(Number).sort(Mo);function Nw(e){return e in cu}function co(e){const t=[];for(const i of Fw)uo(e,i)&&t.push(cu[i]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function uo(e,t){return(e&t)===t}function On(e,t){return e===t}class Oe{constructor(t,i){if(!Nw(t))throw new Error(`literal expressions must have a specific type, got ${co(t)}`);this.type=t,this.value=i}}class Dw{constructor(t,i,...n){this.type=t,this.operator=i,this.args=n}}function pp(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Ve(e,t,i){switch(typeof e){case"boolean":{if(On(t,oi))return new Oe(oi,e?"true":"false");if(!uo(t,Je))throw new Error(`got a boolean, but expected ${co(t)}`);return new Oe(Je,e)}case"number":{if(On(t,lo))return new Oe(lo,pr(e));if(On(t,Je))return new Oe(Je,!!e);if(On(t,oi))return new Oe(oi,e.toString());if(!uo(t,Jt))throw new Error(`got a number, but expected ${co(t)}`);return new Oe(Jt,e)}case"string":{if(On(t,Li))return new Oe(Li,ep(e));if(On(t,Je))return new Oe(Je,!!e);if(!uo(t,oi))throw new Error(`got a string, but expected ${co(t)}`);return new Oe(oi,e)}}if(!Array.isArray(e))throw new Error("expression must be an array or a primitive value");if(e.length===0)throw new Error("empty expression");if(typeof e[0]=="string")return Hw(e,t,i);for(const n of e)if(typeof n!="number")throw new Error("expected an array of numbers");if(On(t,lo)){if(e.length!==2)throw new Error(`expected an array of two values for a size, got ${e.length}`);return new Oe(lo,e)}if(On(t,Li)){if(e.length===3)return new Oe(Li,[...e,1]);if(e.length===4)return new Oe(Li,e);throw new Error(`expected an array of 3 or 4 values for a color, got ${e.length}`)}if(!uo(t,Ss))throw new Error(`got an array of numbers, but expected ${co(t)}`);return new Oe(Ss,e)}const K={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},kw={[K.Get]:Dt(Ut(1,1/0),kd),[K.Var]:Dt(Ut(1,1),jw),[K.Has]:Dt(Ut(1,1/0),kd),[K.Id]:Dt(Bw,zs),[K.Concat]:Dt(Ut(2,1/0),se(oi)),[K.GeometryType]:Dt(Vw,zs),[K.LineMetric]:Dt(zs),[K.Resolution]:Dt(ml,zs),[K.Zoom]:Dt(ml,zs),[K.Time]:Dt(ml,zs),[K.Any]:Dt(Ut(2,1/0),se(Je)),[K.All]:Dt(Ut(2,1/0),se(Je)),[K.Not]:Dt(Ut(1,1),se(Je)),[K.Equal]:Dt(Ut(2,2),se(Ta)),[K.NotEqual]:Dt(Ut(2,2),se(Ta)),[K.GreaterThan]:Dt(Ut(2,2),se(Jt)),[K.GreaterThanOrEqualTo]:Dt(Ut(2,2),se(Jt)),[K.LessThan]:Dt(Ut(2,2),se(Jt)),[K.LessThanOrEqualTo]:Dt(Ut(2,2),se(Jt)),[K.Multiply]:Dt(Ut(2,1/0),jd),[K.Coalesce]:Dt(Ut(2,1/0),jd),[K.Divide]:Dt(Ut(2,2),se(Jt)),[K.Add]:Dt(Ut(2,1/0),se(Jt)),[K.Subtract]:Dt(Ut(2,2),se(Jt)),[K.Clamp]:Dt(Ut(3,3),se(Jt)),[K.Mod]:Dt(Ut(2,2),se(Jt)),[K.Pow]:Dt(Ut(2,2),se(Jt)),[K.Abs]:Dt(Ut(1,1),se(Jt)),[K.Floor]:Dt(Ut(1,1),se(Jt)),[K.Ceil]:Dt(Ut(1,1),se(Jt)),[K.Round]:Dt(Ut(1,1),se(Jt)),[K.Sin]:Dt(Ut(1,1),se(Jt)),[K.Cos]:Dt(Ut(1,1),se(Jt)),[K.Atan]:Dt(Ut(1,2),se(Jt)),[K.Sqrt]:Dt(Ut(1,1),se(Jt)),[K.Match]:Dt(Ut(4,1/0),Bd,zw),[K.Between]:Dt(Ut(3,3),se(Jt)),[K.Interpolate]:Dt(Ut(6,1/0),Bd,Zw),[K.Case]:Dt(Ut(3,1/0),Ww,Uw),[K.In]:Dt(Ut(2,2),Xw),[K.Number]:Dt(Ut(1,1/0),se(Ta)),[K.String]:Dt(Ut(1,1/0),se(Ta)),[K.Array]:Dt(Ut(1,1/0),se(Jt)),[K.Color]:Dt(Ut(1,4),se(Jt)),[K.Band]:Dt(Ut(1,3),se(Jt)),[K.Palette]:Dt(Ut(2,2),$w),[K.ToString]:Dt(Ut(1,1),se(Je|Jt|oi|Li))};function kd(e,t,i){const n=e.length-1,s=new Array(n);for(let r=0;r<n;++r){const o=e[r+1];switch(typeof o){case"number":{s[r]=new Oe(Jt,o);break}case"string":{s[r]=new Oe(oi,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}r===0&&i.properties.add(String(o))}return s}function jw(e,t,i){const n=e[1];if(typeof n!="string")throw new Error("expected a string argument for var operation");return i.variables.add(n),[new Oe(oi,n)]}function Bw(e,t,i){i.featureId=!0}function Vw(e,t,i){i.geometryType=!0}function ml(e,t,i){i.mapState=!0}function zs(e,t,i){const n=e[0];if(e.length!==1)throw new Error(`expected no arguments for ${n} operation`);return[]}function Ut(e,t){return function(i,n,s){const r=i[0],o=i.length-1;if(e===t){if(o!==e){const a=e===1?"":"s";throw new Error(`expected ${e} argument${a} for ${r}, got ${o}`)}}else if(o<e||o>t){const a=t===1/0?`${e} or more`:`${e} to ${t}`;throw new Error(`expected ${a} arguments for ${r}, got ${o}`)}}}function jd(e,t,i){const n=e.length-1,s=new Array(n);for(let r=0;r<n;++r){const o=Ve(e[r+1],t,i);s[r]=o}return s}function se(e){return function(t,i,n){const s=t.length-1,r=new Array(s);for(let o=0;o<s;++o){const a=Ve(t[o+1],e,n);r[o]=a}return r}}function Ww(e,t,i){const n=e[0],s=e.length-1;if(s%2===0)throw new Error(`expected an odd number of arguments for ${n}, got ${s} instead`)}function Bd(e,t,i){const n=e[0],s=e.length-1;if(s%2===1)throw new Error(`expected an even number of arguments for operation ${n}, got ${s} instead`)}function zw(e,t,i){const n=e.length-1,s=oi|Jt|Je,r=Ve(e[1],s,i),o=Ve(e[e.length-1],t,i),a=new Array(n-2);for(let h=0;h<n-2;h+=2){try{const c=Ve(e[h+2],r.type,i);a[h]=c}catch(c){throw new Error(`failed to parse argument ${h+1} of match expression: ${c.message}`)}try{const c=Ve(e[h+3],o.type,i);a[h+1]=c}catch(c){throw new Error(`failed to parse argument ${h+2} of match expression: ${c.message}`)}}return[r,...a,o]}function Zw(e,t,i){const n=e[1];let s;switch(n[0]){case"linear":s=1;break;case"exponential":const h=n[1];if(typeof h!="number"||h<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(h)} instead`);s=h;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(n)}`)}const r=new Oe(Jt,s);let o;try{o=Ve(e[2],Jt,i)}catch(h){throw new Error(`failed to parse argument 1 in interpolate expression: ${h.message}`)}const a=new Array(e.length-3);for(let h=0;h<a.length;h+=2){try{const c=Ve(e[h+3],Jt,i);a[h]=c}catch(c){throw new Error(`failed to parse argument ${h+2} for interpolate expression: ${c.message}`)}try{const c=Ve(e[h+4],t,i);a[h+1]=c}catch(c){throw new Error(`failed to parse argument ${h+3} for interpolate expression: ${c.message}`)}}return[r,o,...a]}function Uw(e,t,i){const n=Ve(e[e.length-1],t,i),s=new Array(e.length-1);for(let r=0;r<s.length-1;r+=2){try{const o=Ve(e[r+1],Je,i);s[r]=o}catch(o){throw new Error(`failed to parse argument ${r} of case expression: ${o.message}`)}try{const o=Ve(e[r+2],n.type,i);s[r+1]=o}catch(o){throw new Error(`failed to parse argument ${r+1} of case expression: ${o.message}`)}}return s[s.length-1]=n,s}function Xw(e,t,i){let n=e[2];if(!Array.isArray(n))throw new Error('the second argument for the "in" operator must be an array');let s;if(typeof n[0]=="string"){if(n[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(n[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');n=n[1],s=oi}else s=Jt;const r=new Array(n.length);for(let a=0;a<r.length;a++)try{const h=Ve(n[a],s,i);r[a]=h}catch(h){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${h.message}`)}return[Ve(e[1],s,i),...r]}function $w(e,t,i){let n;try{n=Ve(e[1],Jt,i)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const s=e[2];if(!Array.isArray(s))throw new Error("the second argument of palette must be an array");const r=new Array(s.length);for(let o=0;o<r.length;o++){let a;try{a=Ve(s[o],Li,i)}catch(h){throw new Error(`failed to parse color at index ${o} in palette expression: ${h.message}`)}if(!(a instanceof Oe))throw new Error(`the palette color at index ${o} must be a literal value`);r[o]=a}return[n,...r]}function Dt(...e){return function(t,i,n){const s=t[0];let r;for(let o=0;o<e.length;o++){const a=e[o](t,i,n);if(o==e.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");r=a}}return new Dw(i,s,...r)}}function Hw(e,t,i){const n=e[0],s=kw[n];if(!s)throw new Error(`unknown operator: ${n}`);return s(e,t,i)}function _p(e){if(!e)return"";const t=e.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return _p(e.getGeometries()[0]);default:return""}}function yp(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function bn(e,t,i){const n=Ve(e,t,i);return ji(n)}function ji(e,t){if(e instanceof Oe){if(e.type===Li&&typeof e.value=="string"){const n=ep(e.value);return function(){return n}}return function(){return e.value}}const i=e.operator;switch(i){case K.Number:case K.String:case K.Coalesce:return Yw(e);case K.Get:case K.Var:case K.Has:return Kw(e);case K.Id:return n=>n.featureId;case K.GeometryType:return n=>n.geometryType;case K.Concat:{const n=e.args.map(s=>ji(s));return s=>"".concat(...n.map(r=>r(s).toString()))}case K.Resolution:return n=>n.resolution;case K.Any:case K.All:case K.Between:case K.In:case K.Not:return Jw(e);case K.Equal:case K.NotEqual:case K.LessThan:case K.LessThanOrEqualTo:case K.GreaterThan:case K.GreaterThanOrEqualTo:return qw(e);case K.Multiply:case K.Divide:case K.Add:case K.Subtract:case K.Clamp:case K.Mod:case K.Pow:case K.Abs:case K.Floor:case K.Ceil:case K.Round:case K.Sin:case K.Cos:case K.Atan:case K.Sqrt:return Qw(e);case K.Case:return tv(e);case K.Match:return ev(e);case K.Interpolate:return iv(e);case K.ToString:return nv(e);default:throw new Error(`Unsupported operator ${i}`)}}function Yw(e,t){const i=e.operator,n=e.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=ji(e.args[r]);switch(i){case K.Coalesce:return r=>{for(let o=0;o<n;++o){const a=s[o](r);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case K.Number:case K.String:return r=>{for(let o=0;o<n;++o){const a=s[o](r);if(typeof a===i)return a}throw new Error(`Expected one of the values to be a ${i}`)};default:throw new Error(`Unsupported assertion operator ${i}`)}}function Kw(e,t){const n=e.args[0].value;switch(e.operator){case K.Get:return s=>{const r=e.args;let o=s.properties[n];for(let a=1,h=r.length;a<h;++a){const u=r[a].value;o=o[u]}return o};case K.Var:return s=>s.variables[n];case K.Has:return s=>{const r=e.args;if(!(n in s.properties))return!1;let o=s.properties[n];for(let a=1,h=r.length;a<h;++a){const u=r[a].value;if(!o||!Object.hasOwn(o,u))return!1;o=o[u]}return!0};default:throw new Error(`Unsupported accessor operator ${e.operator}`)}}function qw(e,t){const i=e.operator,n=ji(e.args[0]),s=ji(e.args[1]);switch(i){case K.Equal:return r=>n(r)===s(r);case K.NotEqual:return r=>n(r)!==s(r);case K.LessThan:return r=>n(r)<s(r);case K.LessThanOrEqualTo:return r=>n(r)<=s(r);case K.GreaterThan:return r=>n(r)>s(r);case K.GreaterThanOrEqualTo:return r=>n(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${i}`)}}function Jw(e,t){const i=e.operator,n=e.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=ji(e.args[r]);switch(i){case K.Any:return r=>{for(let o=0;o<n;++o)if(s[o](r))return!0;return!1};case K.All:return r=>{for(let o=0;o<n;++o)if(!s[o](r))return!1;return!0};case K.Between:return r=>{const o=s[0](r),a=s[1](r),h=s[2](r);return o>=a&&o<=h};case K.In:return r=>{const o=s[0](r);for(let a=1;a<n;++a)if(o===s[a](r))return!0;return!1};case K.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${i}`)}}function Qw(e,t){const i=e.operator,n=e.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=ji(e.args[r]);switch(i){case K.Multiply:return r=>{let o=1;for(let a=0;a<n;++a)o*=s[a](r);return o};case K.Divide:return r=>s[0](r)/s[1](r);case K.Add:return r=>{let o=0;for(let a=0;a<n;++a)o+=s[a](r);return o};case K.Subtract:return r=>s[0](r)-s[1](r);case K.Clamp:return r=>{const o=s[0](r),a=s[1](r);if(o<a)return a;const h=s[2](r);return o>h?h:o};case K.Mod:return r=>s[0](r)%s[1](r);case K.Pow:return r=>Math.pow(s[0](r),s[1](r));case K.Abs:return r=>Math.abs(s[0](r));case K.Floor:return r=>Math.floor(s[0](r));case K.Ceil:return r=>Math.ceil(s[0](r));case K.Round:return r=>Math.round(s[0](r));case K.Sin:return r=>Math.sin(s[0](r));case K.Cos:return r=>Math.cos(s[0](r));case K.Atan:return n===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case K.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${i}`)}}function tv(e,t){const i=e.args.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=ji(e.args[s]);return s=>{for(let r=0;r<i-1;r+=2)if(n[r](s))return n[r+1](s);return n[i-1](s)}}function ev(e,t){const i=e.args.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=ji(e.args[s]);return s=>{const r=n[0](s);for(let o=1;o<i-1;o+=2)if(r===n[o](s))return n[o+1](s);return n[i-1](s)}}function iv(e,t){const i=e.args.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=ji(e.args[s]);return s=>{const r=n[0](s),o=n[1](s);let a,h;for(let c=2;c<i;c+=2){const u=n[c](s);let m=n[c+1](s);const p=Array.isArray(m);if(p&&(m=s1(m)),u>=o)return c===2?m:p?sv(r,o,a,h,u,m):fo(r,o,a,h,u,m);a=u,h=m}return h}}function nv(e,t){const i=e.operator,n=e.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=ji(e.args[r]);switch(i){case K.ToString:return r=>{const o=s[0](r);return e.args[0].type===Li?ip(o):o.toString()};default:throw new Error(`Unsupported convert operator ${i}`)}}function fo(e,t,i,n,s,r){const o=s-i;if(o===0)return n;const a=t-i,h=e===1?a/o:(Math.pow(e,a)-1)/(Math.pow(e,o)-1);return n+h*(r-n)}function sv(e,t,i,n,s,r){if(s-i===0)return n;const a=xd(n),h=xd(r);let c=h[2]-a[2];c>180?c-=360:c<-180&&(c+=360);const u=[fo(e,t,i,a[0],s,h[0]),fo(e,t,i,a[1],s,h[1]),a[2]+fo(e,t,i,0,s,c),fo(e,t,i,n[3],s,r[3])];return r1(u)}class rv{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const i in this.cache_){const n=this.cache_[i];(t++&3)===0&&!n.hasListener()&&(delete this.cache_[i],delete this.patternCache_[i],--this.cacheSize_)}}}get(t,i,n){const s=pl(t,i,n);return s in this.cache_?this.cache_[s]:null}getPattern(t,i,n){const s=pl(t,i,n);return s in this.patternCache_?this.patternCache_[s]:null}set(t,i,n,s,r){const o=pl(t,i,n),a=o in this.cache_;this.cache_[o]=s,r&&(s.getImageState()===zt.IDLE&&s.load(),s.getImageState()===zt.LOADING?s.ready().then(()=>{this.patternCache_[o]=Sd().createPattern(s.getImage(1),"repeat")}):this.patternCache_[o]=Sd().createPattern(s.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function pl(e,t,i){const n=i?Dh(i):"null";return t+":"+e+":"+n}const Si=new rv;let Kr=null;class wp extends Hm{constructor(t,i,n,s,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=r,this.imageState_=s===void 0?zt.IDLE:s,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=i,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===zt.LOADED){Kr||(Kr=Ni(1,1,void 0,{willReadFrequently:!0})),Kr.drawImage(this.image_,0,0);try{Kr.getImageData(0,0,1,1),this.tainted_=!1}catch{Kr=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(ie.CHANGE)}handleImageError_(){this.imageState_=zt.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=zt.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],i=this.size_[1],n=Ni(t,i);n.fillRect(0,0,t,i),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===zt.IDLE){this.image_||this.initializeImage_(),this.imageState_=zt.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&o1(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==zt.LOADED)return;const i=this.image_,n=Ni(Math.ceil(i.width*t),Math.ceil(i.height*t)),s=n.canvas;n.scale(t,t),n.drawImage(i,0,0),n.globalCompositeOperation="multiply",n.fillStyle=a1(this.color_),n.fillRect(0,0,s.width/t,s.height/t),n.globalCompositeOperation="destination-in",n.drawImage(i,0,0),this.canvas_[t]=s}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===zt.LOADED||this.imageState_===zt.ERROR)t();else{const i=()=>{(this.imageState_===zt.LOADED||this.imageState_===zt.ERROR)&&(this.removeEventListener(ie.CHANGE,i),t())};this.addEventListener(ie.CHANGE,i)}})),this.ready_}}function uu(e,t,i,n,s,r){let o=t===void 0?void 0:Si.get(t,i,s);return o||(o=new wp(e,e&&"src"in e?e.src||void 0:t,i,n,s),Si.set(t,i,s,o,r)),r&&o&&!Si.getPattern(t,i,s)&&Si.set(t,i,s,o,r),o}function Ji(e){return e?Array.isArray(e)?ip(e):typeof e=="object"&&"src"in e?ov(e):e:null}function ov(e){if(!e.offset||!e.size)return Si.getPattern(e.src,"anonymous",e.color);const t=e.src+":"+e.offset,i=Si.getPattern(t,void 0,e.color);if(i)return i;const n=Si.get(e.src,"anonymous",null);if(n.getImageState()!==zt.LOADED)return null;const s=Ni(e.size[0],e.size[1]);return s.drawImage(n.getImage(1),e.offset[0],e.offset[1],e.size[0],e.size[1],0,0,e.size[0],e.size[1]),uu(s.canvas,t,void 0,zt.LOADED,e.color,!0),Si.getPattern(t,void 0,e.color)}const vp="10px sans-serif",ai="#000",_r="round",Mn=[],In=0,yr="round",Oo=10,Fo="#000",No="center",sh="middle",vs=[0,0,0,0],Do=1,qs=new Ar;let qr=null,Vd;const oc={},av=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function hv(e,t,i){return`${e} ${t} 16px "${i}"`}const lv=(function(){let t,i;async function n(r){await i.ready;const o=await i.load(r);if(o.length===0)return!1;const a=sc(r),h=a.families[0].toLowerCase(),c=a.weight;return o.some(u=>{const m=u.family.replace(/^['"]|['"]$/g,"").toLowerCase(),p=nc[u.weight]||u.weight;return m===h&&u.style===a.style&&p==c})}async function s(){await i.ready;let r=!0;const o=qs.getProperties(),a=Object.keys(o).filter(h=>o[h]<100);for(let h=a.length-1;h>=0;--h){const c=a[h];let u=o[c];u<100&&(await n(c)?(eu(oc),qs.set(c,100)):(u+=10,qs.set(c,u,!0),u<100&&(r=!1)))}t=void 0,r||(t=setTimeout(s,100))}return async function(r){i||(i=np?self.fonts:document.fonts);const o=sc(r);if(!o)return;const a=o.families;let h=!1;for(const c of a){if(av.has(c))continue;const u=hv(o.style,o.weight,c);qs.get(u)===void 0&&(qs.set(u,0,!0),h=!0)}h&&(clearTimeout(t),t=setTimeout(s,100))}})(),cv=(function(){let e;return function(t){let i=oc[t];if(i==null){if(np){const n=sc(t),s=Mp(t,"Žg");i=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else e||(e=document.createElement("div"),e.innerHTML="M",e.style.minHeight="0",e.style.maxHeight="none",e.style.height="auto",e.style.padding="0",e.style.border="none",e.style.position="absolute",e.style.display="block",e.style.left="-99999px"),e.style.font=t,document.body.appendChild(e),i=e.offsetHeight,document.body.removeChild(e);oc[t]=i}return i}})();function Mp(e,t){return qr||(qr=Ni(1,1)),e!=Vd&&(qr.font=e,Vd=qr.font),qr.measureText(t)}function Ip(e,t){return Mp(e,t).width}function Wd(e,t,i){if(t in i)return i[t];const n=t.split(`
`).reduce((s,r)=>Math.max(s,Ip(e,r)),0);return i[t]=n,n}function uv(e,t){const i=[],n=[],s=[];let r=0,o=0,a=0,h=0;for(let c=0,u=t.length;c<=u;c+=2){const m=t[c];if(m===`
`||c===u){r=Math.max(r,o),s.push(o),o=0,a+=h,h=0;continue}const p=t[c+1]||e.font,y=Ip(p,m);i.push(y),o+=y;const w=cv(p);n.push(w),h=Math.max(h,w)}return{width:r,height:a,widths:i,heights:n,lineWidths:s}}function dv(e,t,i,n,s,r,o,a,h,c,u){e.save(),i!==1&&(e.globalAlpha===void 0?e.globalAlpha=m=>m.globalAlpha*=i:e.globalAlpha*=i),t&&e.transform.apply(e,t),n.contextInstructions?(e.translate(h,c),e.scale(u[0],u[1]),fv(n,e)):u[0]<0||u[1]<0?(e.translate(h,c),e.scale(u[0],u[1]),e.drawImage(n,s,r,o,a,0,0,o,a)):e.drawImage(n,s,r,o,a,h,c,o*u[0],a*u[1]),e.restore()}function fv(e,t){const i=e.contextInstructions;for(let n=0,s=i.length;n<s;n+=2)Array.isArray(i[n+1])?t[i[n]].apply(t,i[n+1]):t[i[n]]=i[n+1]}class Bh{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=pr(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Bh({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Ii()}getImage(t){return Ii()}getHitDetectionImage(){return Ii()}getPixelRatio(t){return 1}getImageState(){return Ii()}getImageSize(){return Ii()}getOrigin(){return Ii()}getSize(){return Ii()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=pr(t)}listenImageChange(t){Ii()}load(){Ii()}unlistenImageChange(t){Ii()}ready(){return Promise.resolve()}}class Vh extends Bh{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?zt.LOADING:zt.LOADED,this.imageState_===zt.LOADING&&this.ready().then(()=>this.imageState_=zt.LOADED),this.render()}clone(){const t=this.getScale(),i=new Vh({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return i.setOpacity(this.getOpacity()),i}getAnchor(){const t=this.size_,i=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-i[0]/n[0],t[1]/2+i[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){const i=this.fill_?.getKey(),n=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${i}`+Object.values(this.renderOptions_).join(",");let s=Si.get(n,null,null)?.getImage(1);if(!s){const r=this.renderOptions_,o=Math.ceil(r.size*t),a=Ni(o,o);this.draw_(r,a,t),s=a.canvas,Si.set(n,null,null,new wp(s,void 0,null,zt.LOADED,null))}return s}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,i,n){if(i===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return i;let s=this.radius,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const O=s;s=r,r=O}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,h=r*Math.sin(a),c=Math.sqrt(r*r-h*h),u=s-c,m=Math.sqrt(h*h+u*u),p=m/h;if(t==="miter"&&p<=n)return p*i;const y=i/2/p,w=i/2*(u/m),I=Math.sqrt((s+y)*(s+y)+w*w)-s;if(this.radius2_===void 0||t==="bevel")return I*2;const b=s*Math.sin(a),T=Math.sqrt(s*s-b*b),P=r-T,k=Math.sqrt(b*b+P*P)/b;if(k<=n){const O=k*i/2-r-s;return 2*Math.max(I,O)}return I*2}createRenderOptions(){let t=_r,i=yr,n=0,s=null,r=0,o,a=0;this.stroke_&&(o=Ji(this.stroke_.getColor()??Fo),a=this.stroke_.getWidth()??Do,s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,i=this.stroke_.getLineJoin()??yr,t=this.stroke_.getLineCap()??_r,n=this.stroke_.getMiterLimit()??Oo);const h=this.calculateLineJoinSize_(i,a,n),c=Math.max(this.radius,this.radius2_||0),u=Math.ceil(2*c+h);return{strokeStyle:o,strokeWidth:a,size:u,lineCap:t,lineDash:s,lineDashOffset:r,lineJoin:i,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,i,n){if(i.scale(n,n),i.translate(t.size/2,t.size/2),this.createPath_(i),this.fill_){let s=this.fill_.getColor();s===null&&(s=ai),i.fillStyle=Ji(s),i.fill()}t.strokeStyle&&(i.strokeStyle=t.strokeStyle,i.lineWidth=t.strokeWidth,t.lineDash&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.lineCap=t.lineCap,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit,i.stroke())}createHitDetectionCanvas_(t){let i;if(this.fill_){let n=this.fill_.getColor(),s=0;typeof n=="string"&&(n=Dh(n)),n===null?s=1:Array.isArray(n)&&(s=n.length===4?n[3]:1),s===0&&(i=Ni(t.size,t.size),this.drawHitDetectionCanvas_(t,i))}return i?i.canvas:this.getImage(1)}createPath_(t){let i=this.points_;const n=this.radius;if(i===1/0)t.arc(0,0,n,0,2*Math.PI);else{const s=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(i*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/i;for(let a=0;a<i;a++){const h=r+a*o,c=a%2===0?n:s;t.lineTo(c*Math.cos(h),c*Math.sin(h))}t.closePath()}}drawHitDetectionCanvas_(t,i){i.translate(t.size/2,t.size/2),this.createPath_(i),i.fillStyle=ai,i.fill(),t.strokeStyle&&(i.strokeStyle=t.strokeStyle,i.lineWidth=t.strokeWidth,t.lineDash&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit,i.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class la extends Vh{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),i=new la({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return i.setOpacity(this.getOpacity()),i}setRadius(t){this.radius=t,this.render()}}class bs{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new bs({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const i=uu(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));i.ready().then(()=>{this.patternImage_=null}),i.getImageState()===zt.IDLE&&i.load(),i.getImageState()===zt.LOADING&&(this.patternImage_=i)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?Pe(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:Dh(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function zd(e,t,i,n){return i!==void 0&&n!==void 0?[i/e,n/t]:i!==void 0?i/e:n!==void 0?n/t:1}class Wh extends Bh{constructor(t){t=t||{};const i=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,r=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:i,rotation:n,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:r,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;_i(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||Pe(o)),_i(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),_i(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let h;if(t.src!==void 0?h=zt.IDLE:o!==void 0&&("complete"in o?o.complete?h=o.src?zt.LOADED:zt.IDLE:h=zt.LOADING:h=zt.LOADED),this.color_=t.color!==void 0?Dh(t.color):null,this.iconImage_=uu(o,a,this.crossOrigin_,h,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let c,u;if(t.size)[c,u]=t.size;else{const m=this.getImage(1);if(m.width&&m.height)c=m.width,u=m.height;else if(m instanceof HTMLImageElement){this.initialOptions_=t;const p=()=>{if(this.unlistenImageChange(p),!this.initialOptions_)return;const y=this.iconImage_.getSize();this.setScale(zd(y[0],y[1],t.width,t.height))};this.listenImageChange(p);return}}c!==void 0&&this.setScale(zd(c,u,t.width,t.height))}}clone(){let t,i,n;return this.initialOptions_?(i=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Wh({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:i,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const i=this.getDisplacement(),n=this.getScaleArray();return[t[0]-i[0]/n[0],t[1]+i[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const i=this.getSize(),n=this.iconImage_.getSize();if(!i||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-i[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-i[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==zt.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==zt.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(ie.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(ie.CHANGE,t)}ready(){return this.iconImage_.ready()}}class Cs{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Cs({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class Oi{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Zd,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Oi({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(i){return i.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Zd,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function gv(e){let t;if(typeof e=="function")t=e;else{let i;Array.isArray(e)?i=e:(_i(typeof e.getZIndex=="function","Expected an `Style` or an array of `Style`"),i=[e]),t=function(){return i}}return t}let _l=null;function Ep(e,t){if(!_l){const i=new bs({color:"rgba(255,255,255,0.4)"}),n=new Cs({color:"#3399CC",width:1.25});_l=[new Oi({image:new la({fill:i,stroke:n,radius:5}),fill:i,stroke:n})]}return _l}function aF(){const e={},t=[255,255,255,1],i=[0,153,255,1],n=3;return e.Polygon=[new Oi({fill:new bs({color:[255,255,255,.5]})})],e.MultiPolygon=e.Polygon,e.LineString=[new Oi({stroke:new Cs({color:t,width:n+2})}),new Oi({stroke:new Cs({color:i,width:n})})],e.MultiLineString=e.LineString,e.Circle=e.Polygon.concat(e.LineString),e.Point=[new Oi({image:new la({radius:n*2,fill:new bs({color:i}),stroke:new Cs({color:t,width:n/2})}),zIndex:1/0})],e.MultiPoint=e.Point,e.GeometryCollection=e.Polygon.concat(e.LineString,e.Point),e}function Zd(e){return e.getGeometry()}const mv="#333";class du{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=pr(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new bs({color:mv}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new du({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=pr(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function pv(e){return!0}function _v(e){const t=pp(),i=yv(e,t),n=yp();return function(s,r){if(n.properties=s.getPropertiesInternal(),n.resolution=r,t.featureId){const o=s.getId();o!==void 0?n.featureId=o:n.featureId=null}return t.geometryType&&(n.geometryType=_p(s.getGeometry())),i(n)}}function Ud(e){const t=pp(),i=e.length,n=new Array(i);for(let o=0;o<i;++o)n[o]=ac(e[o],t);const s=yp(),r=new Array(i);return function(o,a){if(s.properties=o.getPropertiesInternal(),s.resolution=a,t.featureId){const c=o.getId();c!==void 0?s.featureId=c:s.featureId=null}let h=0;for(let c=0;c<i;++c){const u=n[c](s);u&&(r[h]=u,h+=1)}return r.length=h,r}}function yv(e,t){const i=e.length,n=new Array(i);for(let s=0;s<i;++s){const r=e[s],o="filter"in r?bn(r.filter,Je,t):pv;let a;if(Array.isArray(r.style)){const h=r.style.length;a=new Array(h);for(let c=0;c<h;++c)a[c]=ac(r.style[c],t)}else a=[ac(r.style,t)];n[s]={filter:o,styles:a}}return function(s){const r=[];let o=!1;for(let a=0;a<i;++a){const h=n[a].filter;if(h(s)&&!(e[a].else&&o)){o=!0;for(const c of n[a].styles){const u=c(s);u&&r.push(u)}}}return r}}function ac(e,t){const i=ko(e,"",t),n=jo(e,"",t),s=wv(e,t),r=vv(e,t),o=hi(e,"z-index",t);if(!i&&!n&&!s&&!r&&!Po(e))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(e));const a=new Oi;return function(h){let c=!0;if(i){const u=i(h);u&&(c=!1),a.setFill(u)}if(n){const u=n(h);u&&(c=!1),a.setStroke(u)}if(s){const u=s(h);u&&(c=!1),a.setText(u)}if(r){const u=r(h);u&&(c=!1),a.setImage(u)}return o&&a.setZIndex(o(h)),c?null:a}}function ko(e,t,i){let n;if(t+"fill-pattern-src"in e)n=Cv(e,t+"fill-",i);else{if(e[t+"fill-color"]==="none")return r=>null;n=fu(e,t+"fill-color",i)}if(!n)return null;const s=new bs;return function(r){const o=n(r);return o===sp?null:(s.setColor(o),s)}}function jo(e,t,i){const n=hi(e,t+"stroke-width",i),s=fu(e,t+"stroke-color",i);if(!n&&!s)return null;const r=wn(e,t+"stroke-line-cap",i),o=wn(e,t+"stroke-line-join",i),a=Cp(e,t+"stroke-line-dash",i),h=hi(e,t+"stroke-line-dash-offset",i),c=hi(e,t+"stroke-miter-limit",i),u=new Cs;return function(m){if(s){const p=s(m);if(p===sp)return null;u.setColor(p)}if(n&&u.setWidth(n(m)),r){const p=r(m);if(p!=="butt"&&p!=="round"&&p!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(p)}if(o){const p=o(m);if(p!=="bevel"&&p!=="round"&&p!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(p)}return a&&u.setLineDash(a(m)),h&&u.setLineDashOffset(h(m)),c&&u.setMiterLimit(c(m)),u}}function wv(e,t){const i="text-",n=wn(e,i+"value",t);if(!n)return null;const s=ko(e,i,t),r=ko(e,i+"background-",t),o=jo(e,i,t),a=jo(e,i+"background-",t),h=wn(e,i+"font",t),c=hi(e,i+"max-angle",t),u=hi(e,i+"offset-x",t),m=hi(e,i+"offset-y",t),p=lr(e,i+"overflow",t),y=wn(e,i+"placement",t),w=hi(e,i+"repeat",t),v=zh(e,i+"scale",t),I=lr(e,i+"rotate-with-view",t),b=hi(e,i+"rotation",t),T=wn(e,i+"align",t),P=wn(e,i+"justify",t),G=wn(e,i+"baseline",t),k=lr(e,i+"keep-upright",t),O=Cp(e,i+"padding",t),U=Zh(e,i+"declutter-mode"),Y=new du({declutterMode:U});return function(W){if(Y.setText(n(W)),s&&Y.setFill(s(W)),r&&Y.setBackgroundFill(r(W)),o&&Y.setStroke(o(W)),a&&Y.setBackgroundStroke(a(W)),h&&Y.setFont(h(W)),c&&Y.setMaxAngle(c(W)),u&&Y.setOffsetX(u(W)),m&&Y.setOffsetY(m(W)),p&&Y.setOverflow(p(W)),y){const Q=y(W);if(Q!=="point"&&Q!=="line")throw new Error("Expected point or line for text-placement");Y.setPlacement(Q)}if(w&&Y.setRepeat(w(W)),v&&Y.setScale(v(W)),I&&Y.setRotateWithView(I(W)),b&&Y.setRotation(b(W)),T){const Q=T(W);if(Q!=="left"&&Q!=="center"&&Q!=="right"&&Q!=="end"&&Q!=="start")throw new Error("Expected left, right, center, start, or end for text-align");Y.setTextAlign(Q)}if(P){const Q=P(W);if(Q!=="left"&&Q!=="right"&&Q!=="center")throw new Error("Expected left, right, or center for text-justify");Y.setJustify(Q)}if(G){const Q=G(W);if(Q!=="bottom"&&Q!=="top"&&Q!=="middle"&&Q!=="alphabetic"&&Q!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");Y.setTextBaseline(Q)}return O&&Y.setPadding(O(W)),k&&Y.setKeepUpright(k(W)),Y}}function vv(e,t){return"icon-src"in e?Mv(e,t):"shape-points"in e?Iv(e,t):"circle-radius"in e?Ev(e,t):null}function Mv(e,t){const i="icon-",n=i+"src",s=xp(e[n],n),r=rh(e,i+"anchor",t),o=zh(e,i+"scale",t),a=hi(e,i+"opacity",t),h=rh(e,i+"displacement",t),c=hi(e,i+"rotation",t),u=lr(e,i+"rotate-with-view",t),m=$d(e,i+"anchor-origin"),p=Hd(e,i+"anchor-x-units"),y=Hd(e,i+"anchor-y-units"),w=Av(e,i+"color"),v=Sv(e,i+"cross-origin"),I=bv(e,i+"offset"),b=$d(e,i+"offset-origin"),T=oh(e,i+"width"),P=oh(e,i+"height"),G=xv(e,i+"size"),k=Zh(e,i+"declutter-mode"),O=new Wh({src:s,anchorOrigin:m,anchorXUnits:p,anchorYUnits:y,color:w,crossOrigin:v,offset:I,offsetOrigin:b,height:P,width:T,size:G,declutterMode:k});return function(U){return a&&O.setOpacity(a(U)),h&&O.setDisplacement(h(U)),c&&O.setRotation(c(U)),u&&O.setRotateWithView(u(U)),o&&O.setScale(o(U)),r&&O.setAnchor(r(U)),O}}function Iv(e,t){const i="shape-",n=i+"points",s=i+"radius",r=hc(e[n],n),o=hc(e[s],s),a=ko(e,i,t),h=jo(e,i,t),c=zh(e,i+"scale",t),u=rh(e,i+"displacement",t),m=hi(e,i+"rotation",t),p=lr(e,i+"rotate-with-view",t),y=oh(e,i+"radius2"),w=oh(e,i+"angle"),v=Zh(e,i+"declutter-mode"),I=new Vh({points:r,radius:o,radius2:y,angle:w,declutterMode:v});return function(b){return a&&I.setFill(a(b)),h&&I.setStroke(h(b)),u&&I.setDisplacement(u(b)),m&&I.setRotation(m(b)),p&&I.setRotateWithView(p(b)),c&&I.setScale(c(b)),I}}function Ev(e,t){const i="circle-",n=ko(e,i,t),s=jo(e,i,t),r=hi(e,i+"radius",t),o=zh(e,i+"scale",t),a=rh(e,i+"displacement",t),h=hi(e,i+"rotation",t),c=lr(e,i+"rotate-with-view",t),u=Zh(e,i+"declutter-mode"),m=new la({radius:5,declutterMode:u});return function(p){return r&&m.setRadius(r(p)),n&&m.setFill(n(p)),s&&m.setStroke(s(p)),a&&m.setDisplacement(a(p)),h&&m.setRotation(h(p)),c&&m.setRotateWithView(c(p)),o&&m.setScale(o(p)),m}}function hi(e,t,i){if(!(t in e))return;const n=bn(e[t],Jt,i);return function(s){return hc(n(s),t)}}function wn(e,t,i){if(!(t in e))return null;const n=bn(e[t],oi,i);return function(s){return xp(n(s),t)}}function Cv(e,t,i){const n=wn(e,t+"pattern-src",i),s=Xd(e,t+"pattern-offset",i),r=Xd(e,t+"pattern-size",i),o=fu(e,t+"color",i);return function(a){return{src:n(a),offset:s&&s(a),size:r&&r(a),color:o&&o(a)}}}function lr(e,t,i){if(!(t in e))return null;const n=bn(e[t],Je,i);return function(s){const r=n(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${t}`);return r}}function fu(e,t,i){if(!(t in e))return null;const n=bn(e[t],Li,i);return function(s){return Sp(n(s),t)}}function Cp(e,t,i){if(!(t in e))return null;const n=bn(e[t],Ss,i);return function(s){return ca(n(s),t)}}function rh(e,t,i){if(!(t in e))return null;const n=bn(e[t],Ss,i);return function(s){const r=ca(n(s),t);if(r.length!==2)throw new Error(`Expected two numbers for ${t}`);return r}}function Xd(e,t,i){if(!(t in e))return null;const n=bn(e[t],Ss,i);return function(s){return bp(n(s),t)}}function zh(e,t,i){if(!(t in e))return null;const n=bn(e[t],Ss|Jt,i);return function(s){return Tv(n(s),t)}}function oh(e,t){const i=e[t];if(i!==void 0){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}}function xv(e,t){const i=e[t];if(i!==void 0){if(typeof i=="number")return pr(i);if(!Array.isArray(i))throw new Error(`Expected a number or size array for ${t}`);if(i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return i}}function Sv(e,t){const i=e[t];if(i!==void 0){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);return i}}function $d(e,t){const i=e[t];if(i!==void 0){if(i!=="bottom-left"&&i!=="bottom-right"&&i!=="top-left"&&i!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return i}}function Hd(e,t){const i=e[t];if(i!==void 0){if(i!=="pixels"&&i!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return i}}function bv(e,t){const i=e[t];if(i!==void 0)return ca(i,t)}function Zh(e,t){const i=e[t];if(i!==void 0){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);if(i!=="declutter"&&i!=="obstacle"&&i!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return i}}function Av(e,t){const i=e[t];if(i!==void 0)return Sp(i,t)}function ca(e,t){if(!Array.isArray(e))throw new Error(`Expected an array for ${t}`);const i=e.length;for(let n=0;n<i;++n)if(typeof e[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return e}function xp(e,t){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}function hc(e,t){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}function Sp(e,t){if(typeof e=="string")return e;const i=ca(e,t),n=i.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return i}function bp(e,t){const i=ca(e,t);if(i.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return i}function Tv(e,t){return typeof e=="number"?e:bp(e,t)}const Yd={RENDER_ORDER:"renderOrder"};class Ap extends nu{constructor(t){t=t||{};const i=Object.assign({},t);delete i.style,delete i.renderBuffer,delete i.updateWhileAnimating,delete i.updateWhileInteracting,super(i),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Yd.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,i){const n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new jh(9)),this.getRenderer().renderDeclutter(t,i)}setRenderOrder(t){this.set(Yd.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?Ep:t;const i=Rv(t);this.styleFunction_=t===null?void 0:gv(i),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}}function Rv(e){if(e===void 0)return Ep;if(!e)return null;if(typeof e=="function"||e instanceof Oi)return e;if(!Array.isArray(e))return Ud([e]);if(e.length===0)return[];const t=e.length,i=e[0];if(i instanceof Oi){const s=new Array(t);for(let r=0;r<t;++r){const o=e[r];if(!(o instanceof Oi))throw new Error("Expected a list of style instances");s[r]=o}return s}if("style"in i){const s=new Array(t);for(let r=0;r<t;++r){const o=e[r];if(!("style"in o))throw new Error("Expected a list of rules with a style property");s[r]=o}return _v(s)}return Ud(e)}class Pv extends Qm{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,i){Ii()}calculateMatrices2D(t){const i=t.viewState,n=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;Ns(n,t.size[0]/2,t.size[1]/2,1/i.resolution,-1/i.resolution,-i.rotation,-i.center[0],-i.center[1]),h1(s,n)}forEachFeatureAtCoordinate(t,i,n,s,r,o,a,h){let c;const u=i.viewState;function m(G,k,O,U){return r.call(o,k,G?O:null,U)}const p=u.projection,y=rp(t.slice(),p),w=[[0,0]];if(p.canWrapX()&&s){const G=p.getExtent(),k=Hn(G);w.push([-k,0],[k,0])}const v=i.layerStatesArray,I=v.length,b=[],T=[];for(let G=0;G<w.length;G++)for(let k=I-1;k>=0;--k){const O=v[k],U=O.layer;if(U.hasRenderer()&&op(O,u)&&a.call(h,U)){const Y=U.getRenderer(),W=U.getSource();if(Y&&W){const Q=W.getWrapX()?y:t,ot=m.bind(null,O.managed);T[0]=Q[0]+w[G][0],T[1]=Q[1]+w[G][1],c=Y.forEachFeatureAtCoordinate(T,i,n,ot,b)}if(c)return c}}if(b.length===0)return;const P=1/b.length;return b.forEach((G,k)=>G.distanceSq+=k*P),b.sort((G,k)=>G.distanceSq-k.distanceSq),b.some(G=>c=G.callback(G.feature,G.layer,G.geometry)),c}hasFeatureAtCoordinate(t,i,n,s,r,o){return this.forEachFeatureAtCoordinate(t,i,n,s,To,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(t){Ii()}scheduleExpireIconCache(t){Si.canExpireCache()&&t.postRenderFunctions.push(Gv)}}function Gv(e,t){Si.expire()}class Lv extends Pv{constructor(t){super(t),this.fontChangeListenerKey_=me(qs,Ro.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");const i=this.element_.style;i.position="absolute",i.width="100%",i.height="100%",i.zIndex="0",this.element_.className=oa+" ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,i){const n=this.getMap();if(n.hasListener(t)){const s=new l1(t,void 0,i);n.dispatchEvent(s)}}disposeInternal(){Ue(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Es.PRECOMPOSE,t);const i=t.layerStatesArray.sort((a,h)=>a.zIndex-h.zIndex);i.some(a=>a.layer instanceof Ap&&a.layer.getDeclutter())&&(t.declutter={});const s=t.viewState;this.children_.length=0;const r=[];let o=null;for(let a=0,h=i.length;a<h;++a){const c=i[a];t.layerIndex=a;const u=c.layer,m=u.getSourceState();if(!op(c,s)||m!="ready"&&m!="undefined"){u.unrender();continue}const p=u.render(t,o);p&&(p!==o&&(this.children_.push(p),o=p),r.push(c))}this.declutter(t,r),c1(this.element_,this.children_),this.dispatchRenderEvent(Es.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,i){if(t.declutter){for(let n=i.length-1;n>=0;--n){const s=i[n],r=s.layer;r.getDeclutter()&&r.renderDeclutter(t,s)}i.forEach(n=>n.layer.renderDeferred(t))}}}function Tp(e){if(e instanceof nu){e.setMapInternal(null);return}e instanceof Rr&&e.getLayers().forEach(Tp)}function Rp(e,t){if(e instanceof nu){e.setMapInternal(t);return}if(e instanceof Rr){const i=e.getLayers().getArray();for(let n=0,s=i.length;n<s;++n)Rp(i[n],t)}}let hF=class extends Ar{constructor(t){super(),t=t||{},this.on,this.once,this.un;const i=Ov(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:u1,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=es(),this.pixelToCoordinateTransform_=es(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=i.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=i.controls||ow(),this.interactions=i.interactions||Aw({onFocusOnly:!0}),this.overlays_=i.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new tw(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(ze.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(ze.VIEW,this.handleViewChanged_),this.addChangeListener(ze.SIZE,this.handleSizeChanged_),this.addChangeListener(ze.TARGET,this.handleTargetChanged_),this.setProperties(i.values);const n=this;t.view&&!(t.view instanceof _s)&&t.view.then(function(s){n.setView(new _s(s))}),this.controls.addEventListener(ri.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(ri.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(ri.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(ri.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(ri.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(ri.REMOVE,s=>{const r=s.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){Rp(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const i=t.getId();i!==void 0&&(this.overlayIdIndex_[i.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,i,n){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};const r=n.hitTolerance!==void 0?n.hitTolerance:0,o=n.layerFilter!==void 0?n.layerFilter:To,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,r,a,i,null,o,null)}getFeaturesAtPixel(t,i){const n=[];return this.forEachFeatureAtPixel(t,function(s){n.push(s)},i),n}getAllLayers(){const t=[];function i(n){n.forEach(function(s){s instanceof Rr?i(s.getLayers()):t.push(s)})}return i(this.getLayers()),t}hasFeatureAtPixel(t,i){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(t);i=i!==void 0?i:{};const s=i.layerFilter!==void 0?i.layerFilter:To,r=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,r,o,s,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const n=this.viewport_.getBoundingClientRect(),s=this.getSize(),r=n.width/s[0],o=n.height/s[1],a="changedTouches"in t?t.changedTouches[0]:t;return[(a.clientX-n.left)/r,(a.clientY-n.top)/o]}getTarget(){return this.get(ze.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return d1(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const i=this.frameState_;return i?Hi(i.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const i=this.overlayIdIndex_[t.toString()];return i!==void 0?i:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(ze.LAYERGROUP)}setLayers(t){const i=this.getLayerGroup();if(t instanceof qi){i.setLayers(t);return}const n=i.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let i=0,n=t.length;i<n;++i){const s=t[i];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const o=s.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){const i=f1(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(i)}getPixelFromCoordinateInternal(t){const i=this.frameState_;return i?Hi(i.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(ze.SIZE)}getView(){return this.get(ze.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,i,n,s){return ew(this.frameState_,t,i,n,s)}handleBrowserEvent(t,i){i=i||t.type;const n=new Zn(i,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;const i=t.originalEvent,n=i.type;if(n===ic.POINTERDOWN||n===ie.WHEEL||n===ie.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,o=i.target,a=r instanceof ShadowRoot?r.host===o?r.host.ownerDocument:r:r===s?s.documentElement:r;if(this.overlayContainerStopEvent_.contains(o)||!a.contains(o))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const o=s[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,i=this.tileQueue_;if(!i.isEmpty()){let s=this.maxTilesLoading_,r=s;if(t){const o=t.viewHints;if(o[xi.ANIMATING]||o[xi.INTERACTING]){const a=Date.now()-t.time>8;s=a?0:8,r=a?0:2}}i.getTilesLoading()<s&&(i.reprioritize(),i.loadMoreTiles(s,r))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(Es.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Es.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Ys(Un.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Ys(Un.LOADSTART,this,t))));const n=this.postRenderFunctions_;if(t)for(let s=0,r=n.length;s<r;++s)n[s](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,s=this.targetChangeHandlerKeys_.length;n<s;++n)Ue(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ie.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ie.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const t=this.getTarget(),i=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=i,!i)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{i.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Lv(this)),this.mapBrowserEventHandler_=new J1(this,this.moveTolerance_);for(const r in Me)this.mapBrowserEventHandler_.addEventListener(Me[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ie.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ie.WHEEL,this.boundHandleBrowserEvent_,Ym?{passive:!1}:!1);let n;if(this.keyboardEventTarget_)n=this.keyboardEventTarget_;else{const r=i.getRootNode();n=r instanceof ShadowRoot?r.host:i}this.targetChangeHandlerKeys_=[me(n,ie.KEYDOWN,this.handleBrowserEvent,this),me(n,ie.KEYPRESS,this.handleBrowserEvent,this)];const s=i.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(i)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Ue(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Ue(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=me(t,Ro.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=me(t,ie.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Ue),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Xn("addlayer",t)),this.layerGroupPropertyListenerKeys_=[me(t,Ro.PROPERTYCHANGE,this.render,this),me(t,ie.CHANGE,this.render,this),me(t,"addlayer",this.handleLayerAdd_,this),me(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const t=this.frameState_.layerStatesArray;for(let i=0,n=t.length;i<n;++i){const s=t[i].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){Tp(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const i=this.getSize(),n=this.getView(),s=this.frameState_;let r=null;if(i!==void 0&&bd(i)&&n&&n.isDef()){const o=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Ad(a.center,a.resolution,a.rotation,i),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:i,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:Pe(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const h=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=Ad(a.nextCenter,a.nextResolution,h,i)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!su(this.previousExtent_)&&!eh(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Ys(Un.MOVESTART,this,s)),this.previousExtent_=g1(this.previousExtent_)),this.previousExtent_&&!r.viewHints[xi.ANIMATING]&&!r.viewHints[xi.INTERACTING]&&!eh(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Ys(Un.MOVEEND,this,r)),ap(r.extent,this.previousExtent_))),this.dispatchEvent(new Ys(Un.POSTRENDER,this,r)),this.renderComplete_=(this.hasListener(Un.LOADSTART)||this.hasListener(Un.LOADEND)||this.hasListener(Es.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const i=this.getLayerGroup();i&&this.handleLayerRemove_(new Xn("removelayer",i)),this.set(ze.LAYERGROUP,t)}setSize(t){this.set(ze.SIZE,t)}setTarget(t){this.set(ze.TARGET,t)}setView(t){if(!t||t instanceof _s){this.set(ze.VIEW,t);return}this.set(ze.VIEW,new _s);const i=this;t.then(function(n){i.setView(new _s(n))})}updateSize(){const t=this.getTargetElement();let i;if(t){const s=getComputedStyle(t),r=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(i=[Math.max(0,r),Math.max(0,o)],!bd(i)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&m1("No map visible because the map container's width or height are 0."))}const n=this.getSize();i&&(!n||!Tr(i,n))&&(this.setSize(i),this.updateViewportSize_(i))}updateViewportSize_(t){const i=this.getView();i&&i.setViewportSize(t)}};function Ov(e){let t=null;e.keyboardEventTarget!==void 0&&(t=typeof e.keyboardEventTarget=="string"?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);const i={},n=e.layers&&typeof e.layers.getLayers=="function"?e.layers:new Rr({layers:e.layers});i[ze.LAYERGROUP]=n,i[ze.TARGET]=e.target,i[ze.VIEW]=e.view instanceof _s?e.view:new _s;let s;e.controls!==void 0&&(Array.isArray(e.controls)?s=new qi(e.controls.slice()):(_i(typeof e.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=e.controls));let r;e.interactions!==void 0&&(Array.isArray(e.interactions)?r=new qi(e.interactions.slice()):(_i(typeof e.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=e.interactions));let o;return e.overlays!==void 0?Array.isArray(e.overlays)?o=new qi(e.overlays.slice()):(_i(typeof e.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=e.overlays):o=new qi,{controls:s,interactions:r,keyboardEventTarget:t,overlays:o,values:i}}let Fv=!1;function Nv(e,t,i,n,s,r,o){const a=new XMLHttpRequest;a.open("GET",typeof e=="function"?e(i,n,s):e,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=Fv,a.onload=function(h){if(!a.status||a.status>=200&&a.status<300){const c=t.getType();try{let u;c=="text"||c=="json"?u=a.responseText:c=="xml"?u=a.responseXML||a.responseText:c=="arraybuffer"&&(u=a.response),u?r(t.readFeatures(u,{extent:i,featureProjection:s}),t.readProjection(u)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function Kd(e,t){return function(i,n,s,r,o){Nv(e,t,i,n,s,(a,h)=>{this.addFeatures(a),r!==void 0&&r(a)},()=>{this.changed(),o!==void 0&&o()})}}function Dv(e,t){return[[-1/0,-1/0,1/0,1/0]]}class Pp extends Ar{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const i=t;this.setGeometry(i)}else{const i=t;this.setProperties(i)}}clone(){const t=new Pp(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const i=this.getGeometry();i&&t.setGeometry(i.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Ue(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=me(t,ie.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?kv(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function kv(e){if(typeof e=="function")return e;let t;return Array.isArray(e)?t=e:(_i(typeof e.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[e]),function(){return t}}function jv(e,t,i,n){const s=[];let r=Go();for(let o=0,a=i.length;o<a;++o){const h=i[o];r=hp(e,t,h[0],n),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),t=h[h.length-1]}return s}function lc(e,t,i,n,s,r,o){let a,h;const c=(i-t)/n;if(c===1)a=t;else if(c===2)a=t,h=s;else if(c!==0){let u=e[t],m=e[t+1],p=0;const y=[0];for(let I=t+n;I<i;I+=n){const b=e[I],T=e[I+1];p+=Math.sqrt((b-u)*(b-u)+(T-m)*(T-m)),y.push(p),u=b,m=T}const w=s*p,v=p1(y,w);v<0?(h=(w-y[-v-2])/(y[-v-1]-y[-v-2]),a=t+(-v-2)*n):a=t+v*n}o=o>1?o:2,r=r||new Array(o);for(let u=0;u<o;++u)r[u]=a===void 0?NaN:h===void 0?e[a+u]:Ci(e[a+u],e[a+n+u],h);return r}function cc(e,t,i,n,s,r){if(i==t)return null;let o;if(s<e[t+n-1])return r?(o=e.slice(t,t+n),o[n-1]=s,o):null;if(e[i-1]<s)return r?(o=e.slice(i-n,i),o[n-1]=s,o):null;if(s==e[t+n-1])return e.slice(t,t+n);let a=t/n,h=i/n;for(;a<h;){const p=a+h>>1;s<e[(p+1)*n-1]?h=p:a=p+1}const c=e[a*n-1];if(s==c)return e.slice((a-1)*n,(a-1)*n+n);const u=e[(a+1)*n-1],m=(s-c)/(u-c);o=[];for(let p=0;p<n-1;++p)o.push(Ci(e[(a-1)*n+p],e[a*n+p],m));return o.push(s),o}function cF(e,t,i,n,s,r,o){if(o)return cc(e,t,i[i.length-1],n,s,r);let a;if(s<e[n-1])return r?(a=e.slice(0,n),a[n-1]=s,a):null;if(e[e.length-1]<s)return r?(a=e.slice(e.length-n),a[n-1]=s,a):null;for(let h=0,c=i.length;h<c;++h){const u=i[h];if(t!=u){if(s<e[t+n-1])return null;if(s<=e[u-1])return cc(e,t,u,n,s,!1);t=u}}return null}function Gp(e,t,i,n){let s=e[t],r=e[t+1],o=0;for(let a=t+n;a<i;a+=n){const h=e[a],c=e[a+1];o+=Math.sqrt((h-s)*(h-s)+(c-r)*(c-r)),s=h,r=c}return o}class uc extends _1{constructor(t,i){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,i!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(i,t):this.setCoordinates(t,i)}appendCoordinate(t){ru(this.flatCoordinates,t),this.changed()}clone(){const t=new uc(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,i,n,s){return s<y1(this.getExtent(),t,i)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(w1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),v1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,i,n,s))}forEachSegment(t){return M1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,i){return this.layout!="XYM"&&this.layout!="XYZM"?null:(i=i!==void 0?i:!1,cc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i))}getCoordinates(){return oo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,i){return lc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,this.stride)}getLength(){return Gp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const i=[];return i.length=lp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new uc(i,"XY")}getType(){return"LineString"}intersectsExtent(t){return I1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=E1(this.flatCoordinates,0,t,this.stride),this.changed()}}const qd=es();class Gi{constructor(t,i,n,s,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=i,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=r,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?C1(this.flatCoordinates_):hp(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=x1(this.getExtent());this.flatInteriorPoints_=S1(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=b1(this.flatCoordinates_,this.ends_),i=jv(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=A1(this.flatCoordinates_,0,t,2,i)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=lc(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let i=0;const n=this.ends_;for(let s=0,r=n.length;s<r;++s){const o=n[s],a=lc(t,i,o,2,.5);ru(this.flatMidpoints_,a),i=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,i){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=T1(t);const i=t.getExtent(),n=t.getWorldExtent();if(i&&n){const s=Lo(n)/Lo(i);Ns(qd,n[0],n[3],s,-s,0,0,0),hr(this.flatCoordinates_,0,this.flatCoordinates_.length,2,qd,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new Gi(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=R1((t,i)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),i&&this.simplifiedGeometry_.applyTransform(i);const n=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":n.length=lp(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),s=[n.length];break;case"MultiLineString":s=[],n.length=G1(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,s);break;case"Polygon":s=[],n.length=P1(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,s);break}return s&&(this.simplifiedGeometry_=new Gi(this.type_,n,s,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}Gi.prototype.getFlatCoordinates=Gi.prototype.getOrientedFlatCoordinates;class Jd{constructor(t){this.rbush_=new jh(t),this.items_={}}insert(t,i){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:i};this.rbush_.insert(n),this.items_[Pe(i)]=n}load(t,i){const n=new Array(i.length);for(let s=0,r=i.length;s<r;s++){const o=t[s],a=i[s],h={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};n[s]=h,this.items_[Pe(a)]=h}this.rbush_.load(n)}remove(t){const i=Pe(t),n=this.items_[i];return delete this.items_[i],this.rbush_.remove(n)!==null}update(t,i){const n=this.items_[Pe(i)],s=[n.minX,n.minY,n.maxX,n.maxY];eh(s,t)||(this.remove(i),this.insert(t,i))}getAll(){return this.rbush_.all().map(function(i){return i.value})}getInExtent(t){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(i).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,i){return this.forEach_(this.getInExtent(t),i)}forEach_(t,i){let n;for(let s=0,r=t.length;s<r;s++)if(n=i(t[s]),n)return n;return n}isEmpty(){return Po(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const i=this.rbush_.toJSON();return tc(i.minX,i.minY,i.maxX,i.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const i in t.items_)this.items_[i]=t.items_[i]}}const wi={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class Fn extends na{constructor(t,i,n){super(t),this.feature=i,this.features=n}}class uF extends L1{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Km,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(_i(this.format_,"`format` must be set when `url` is set"),this.loader_=Kd(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:Dv;const i=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=i?new Jd:null,this.loadedExtentsRtree_=new Jd,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,s;Array.isArray(t.features)?s=t.features:t.features&&(n=t.features,s=n.getArray()),!i&&n===void 0&&(n=new qi(s)),s!==void 0&&this.addFeaturesInternal(s),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const i=Pe(t);if(!this.addToIndex_(i,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(i,t);const n=t.getGeometry();if(n){const s=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[i]=t;this.dispatchEvent(new Fn(wi.ADDFEATURE,t))}setupChangeEvents_(t,i){i instanceof Gi||(this.featureChangeKeys_[t]=[me(i,ie.CHANGE,this.handleFeatureChange_,this),me(i,Ro.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,i){let n=!0;if(i.getId()!==void 0){const s=String(i.getId());if(!(s in this.idIndex_))this.idIndex_[s]=i;else if(i instanceof Gi){const r=this.idIndex_[s];r instanceof Gi?Array.isArray(r)?r.push(i):this.idIndex_[s]=[r,i]:n=!1}else n=!1}return n&&(_i(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=i),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const i=[],n=[],s=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],h=Pe(a);this.addToIndex_(h,a)&&n.push(a)}for(let r=0,o=n.length;r<o;r++){const a=n[r],h=Pe(a);this.setupChangeEvents_(h,a);const c=a.getGeometry();if(c){const u=c.getExtent();i.push(u),s.push(a)}else this.nullGeometryFeatures_[h]=a}if(this.featuresRtree_&&this.featuresRtree_.load(i,s),this.hasListener(wi.ADDFEATURE))for(let r=0,o=n.length;r<o;r++)this.dispatchEvent(new Fn(wi.ADDFEATURE,n[r]))}bindFeaturesCollection_(t){let i=!1;this.addEventListener(wi.ADDFEATURE,function(n){i||(i=!0,t.push(n.feature),i=!1)}),this.addEventListener(wi.REMOVEFEATURE,function(n){i||(i=!0,t.remove(n.feature),i=!1)}),t.addEventListener(ri.ADD,n=>{i||(i=!0,this.addFeature(n.element),i=!1)}),t.addEventListener(ri.REMOVE,n=>{i||(i=!0,this.removeFeature(n.element),i=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(Ue);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(n=>{this.removeFeatureInternal(n)});for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const i=new Fn(wi.CLEAR);this.dispatchEvent(i),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,i){const n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(s){const r=s.getGeometry();if(r instanceof Gi||r.intersectsCoordinate(t))return i(s)})}forEachFeatureInExtent(t,i){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,i);this.featuresCollection_&&this.featuresCollection_.forEach(i)}forEachFeatureIntersectingExtent(t,i){return this.forEachFeatureInExtent(t,function(n){const s=n.getGeometry();if(s instanceof Gi||s.intersectsExtent(t)){const r=i(n);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Po(this.nullGeometryFeatures_)||ru(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const i=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){i.push(n)}),i}getFeaturesInExtent(t,i){if(this.featuresRtree_){if(!(i&&i.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=O1(t,i);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,i){const n=t[0],s=t[1];let r=null;const o=[NaN,NaN];let a=1/0;const h=[-1/0,-1/0,1/0,1/0];return i=i||To,this.featuresRtree_.forEachInExtent(h,function(c){if(i(c)){const u=c.getGeometry(),m=a;if(a=u instanceof Gi?0:u.closestPointXY(n,s,o,a),a<m){r=c;const p=Math.sqrt(a);h[0]=n-p,h[1]=s-p,h[2]=n+p,h[3]=s+p}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const i=this.idIndex_[t.toString()];return i!==void 0?i:null}getFeatureByUid(t){const i=this.uidIndex_[t];return i!==void 0?i:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const i=t.target,n=Pe(i),s=i.getGeometry();if(!s)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(i),this.nullGeometryFeatures_[n]=i);else{const o=s.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,i)):this.featuresRtree_&&this.featuresRtree_.update(o,i)}const r=i.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==i&&(this.removeFromIdIndex_(i),this.idIndex_[o]=i)}else this.removeFromIdIndex_(i),this.uidIndex_[n]=i;this.changed(),this.dispatchEvent(new Fn(wi.CHANGEFEATURE,i))}hasFeature(t){const i=t.getId();return i!==void 0?i in this.idIndex_:Pe(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Po(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,i,n){const s=this.loadedExtentsRtree_,r=this.strategy_(t,i,n);for(let o=0,a=r.length;o<a;++o){const h=r[o];s.forEachInExtent(h,function(u){return er(u.extent,h)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Fn(wi.FEATURESLOADSTART)),this.loader_.call(this,h,i,n,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new Fn(wi.FEATURESLOADEND,void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Fn(wi.FEATURESLOADERROR))}),s.insert(h,{extent:h.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const i=this.loadedExtentsRtree_,n=i.forEachInExtent(t,function(s){if(eh(s.extent,t))return s});n&&i.remove(n)}removeFeatures(t){let i=!1;for(let n=0,s=t.length;n<s;++n)i=this.removeFeatureInternal(t[n])||i;i&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const i=Pe(t);if(!(i in this.uidIndex_))return!1;i in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[i]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[i]?.forEach(Ue),delete this.featureChangeKeys_[i];const s=t.getId();if(s!==void 0){const r=s.toString(),o=this.idIndex_[r];o===t?delete this.idIndex_[r]:Array.isArray(o)&&(o.splice(o.indexOf(t),1),o.length===1&&(this.idIndex_[r]=o[0]))}return delete this.uidIndex_[i],this.hasListener(wi.REMOVEFEATURE)&&this.dispatchEvent(new Fn(wi.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i];break}}setLoader(t){this.loader_=t}setUrl(t){_i(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(Kd(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}class Bv extends F1{constructor(t,i,n,s,r){const o=r!==void 0?zt.IDLE:zt.LOADED;super(t,i,n,o),this.loader_=r!==void 0?r:null,this.canvas_=s,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=zt.ERROR):this.state=zt.LOADED,this.changed()}load(){this.state==zt.IDLE&&(this.state=zt.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}function Vv(e){return Array.isArray(e)?Math.min(...e):e}class Wv extends cp{constructor(t){super(t),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(t){const i=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,s=t.viewState,r=s.resolution,o=this.getLayer().getSource(),a=t.viewHints;let h=t.extent;if(i.extent!==void 0&&(h=tp(h,ec(i.extent,s.projection))),!a[xi.ANIMATING]&&!a[xi.INTERACTING]&&!su(h))if(o){const c=s.projection,u=o.getImage(h,r,n,c);u&&(this.loadImage(u)?this.image=u:u.getState()===zt.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(t){const i=this.frameState;if(!i)return null;const n=this.getLayer(),s=Hi(i.pixelToCoordinateTransform,t.slice()),r=n.getExtent();if(r&&!ih(r,s))return null;const o=this.image.getExtent(),a=this.image.getImage(),h=Hn(o),c=Math.floor(a.width*((s[0]-o[0])/h));if(c<0||c>=a.width)return null;const u=Lo(o),m=Math.floor(a.height*((o[3]-s[1])/u));return m<0||m>=a.height?null:this.getImageData(a,c,m)}renderFrame(t,i){const n=this.image,s=n.getExtent(),r=n.getResolution(),[o,a]=Array.isArray(r)?r:[r,r],h=n.getPixelRatio(),c=t.layerStatesArray[t.layerIndex],u=t.pixelRatio,m=t.viewState,p=m.center,y=m.resolution,w=u*o/(y*h),v=u*a/(y*h);this.prepareContainer(t,i);const I=this.context.canvas.width,b=this.context.canvas.height,T=this.getRenderContext(t);let P=!1,G=!0;if(c.extent){const W=ec(c.extent,m.projection);G=Yi(W,t.extent),P=G&&!er(W,t.extent),P&&this.clipUnrotated(T,t,W)}const k=n.getImage(),O=Ns(this.tempTransform,I/2,b/2,w,v,0,h*(s[0]-p[0])/o,h*(p[1]-s[3])/a);this.renderedResolution=a*u/h;const U=k.width*O[0],Y=k.height*O[3];if(this.getLayer().getSource().getInterpolate()||(T.imageSmoothingEnabled=!1),this.preRender(T,t),G&&U>=.5&&Y>=.5){const W=O[4],Q=O[5],ot=c.opacity;ot!==1&&(T.save(),T.globalAlpha=ot),T.drawImage(k,0,0,+k.width,+k.height,W,Q,U,Y),ot!==1&&T.restore()}return this.postRender(this.context,t),P&&T.restore(),T.imageSmoothingEnabled=!0,this.container}}class Lp{drawCustom(t,i,n,s,r){}drawGeometry(t){}setStyle(t){}drawCircle(t,i,n){}drawFeature(t,i,n){}drawGeometryCollection(t,i,n){}drawLineString(t,i,n){}drawMultiLineString(t,i,n){}drawMultiPoint(t,i,n){}drawMultiPolygon(t,i,n){}drawPoint(t,i,n){}drawPolygon(t,i,n){}drawText(t,i,n){}setFillStrokeStyle(t,i){}setImageStyle(t,i){}setTextStyle(t,i){}}const Pt={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Ra=[Pt.FILL],Kn=[Pt.STROKE],Ms=[Pt.BEGIN_PATH],Qd=[Pt.CLOSE_PATH];class ua extends Lp{constructor(t,i,n,s){super(),this.tolerance=t,this.maxExtent=i,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const i=this.pixelRatio;return i==1?t:t.map(function(n){return n*i})}appendFlatPointCoordinates(t,i){const n=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,h=t.length;a<h;a+=i)s[0]=t[a],s[1]=t[a+1],ih(n,s)&&(r[o++]=s[0],r[o++]=s[1]);return o}appendFlatLineCoordinates(t,i,n,s,r,o){const a=this.coordinates;let h=a.length;const c=this.getBufferedMaxExtent();o&&(i+=s);let u=t[i],m=t[i+1];const p=this.tmpCoordinate_;let y=!0,w,v,I;for(w=i+s;w<n;w+=s)p[0]=t[w],p[1]=t[w+1],I=N1(c,p),I!==v?(y&&(a[h++]=u,a[h++]=m,y=!1),a[h++]=p[0],a[h++]=p[1]):I===D1.INTERSECTING?(a[h++]=p[0],a[h++]=p[1],y=!1):y=!0,u=p[0],m=p[1],v=I;return(r&&y||w===i+s)&&(a[h++]=u,a[h++]=m),h}drawCustomCoordinates_(t,i,n,s,r){for(let o=0,a=n.length;o<a;++o){const h=n[o],c=this.appendFlatLineCoordinates(t,i,h,s,!1,!1);r.push(c),i=h}return i}drawCustom(t,i,n,s,r){this.beginGeometry(t,i,r);const o=t.getType(),a=t.getStride(),h=this.coordinates.length;let c,u,m,p,y;switch(o){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),p=[];const w=t.getEndss();y=0;for(let v=0,I=w.length;v<I;++v){const b=[];y=this.drawCustomCoordinates_(c,y,w[v],a,b),p.push(b)}this.instructions.push([Pt.CUSTOM,h,p,t,n,Rd,r]),this.hitDetectionInstructions.push([Pt.CUSTOM,h,p,t,s||n,Rd,r]);break;case"Polygon":case"MultiLineString":m=[],c=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),y=this.drawCustomCoordinates_(c,0,t.getEnds(),a,m),this.instructions.push([Pt.CUSTOM,h,m,t,n,Td,r]),this.hitDetectionInstructions.push([Pt.CUSTOM,h,m,t,s||n,Td,r]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(c,0,c.length,a,!1,!1),this.instructions.push([Pt.CUSTOM,h,u,t,n,oo,r]),this.hitDetectionInstructions.push([Pt.CUSTOM,h,u,t,s||n,oo,r]);break;case"MultiPoint":c=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(c,a),u>h&&(this.instructions.push([Pt.CUSTOM,h,u,t,n,oo,r]),this.hitDetectionInstructions.push([Pt.CUSTOM,h,u,t,s||n,oo,r]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),u=this.coordinates.length,this.instructions.push([Pt.CUSTOM,h,u,t,n,void 0,r]),this.hitDetectionInstructions.push([Pt.CUSTOM,h,u,t,s||n,void 0,r]);break}this.endGeometry(i)}beginGeometry(t,i,n){this.beginGeometryInstruction1_=[Pt.BEGIN_GEOMETRY,i,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Pt.BEGIN_GEOMETRY,i,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let i;const n=t.length;let s,r,o=-1;for(i=0;i<n;++i)s=t[i],r=s[0],r==Pt.END_GEOMETRY?o=i:r==Pt.BEGIN_GEOMETRY&&(s[2]=i,k1(this.hitDetectionInstructions,o,i),o=-1)}fillStyleToState(t,i={}){if(t){const n=t.getColor();i.fillPatternScale=n&&typeof n=="object"&&"src"in n?this.pixelRatio:1,i.fillStyle=Ji(n||ai)}else i.fillStyle=void 0;return i}strokeStyleToState(t,i={}){if(t){const n=t.getColor();i.strokeStyle=Ji(n||Fo);const s=t.getLineCap();i.lineCap=s!==void 0?s:_r;const r=t.getLineDash();i.lineDash=r?r.slice():Mn;const o=t.getLineDashOffset();i.lineDashOffset=o||In;const a=t.getLineJoin();i.lineJoin=a!==void 0?a:yr;const h=t.getWidth();i.lineWidth=h!==void 0?h:Do;const c=t.getMiterLimit();i.miterLimit=c!==void 0?c:Oo,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0;return i}setFillStrokeStyle(t,i){const n=this.state;this.fillStyleToState(t,n),this.strokeStyleToState(i,n)}createFill(t){const i=t.fillStyle,n=[Pt.SET_FILL_STYLE,i];return typeof i!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[Pt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,i){const n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(this.instructions.push(i.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,i){const n=t.strokeStyle,s=t.lineCap,r=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,h=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=s||r!=t.currentLineDash&&!Tr(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=h||t.currentMiterLimit!=c)&&(i.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=s,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=h,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const i=[Pt.END_GEOMETRY,t];this.instructions.push(i),this.hitDetectionInstructions.push(i)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=ap(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;ou(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class zv extends ua{constructor(t,i,n,s){super(t,i,n,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,i,n){if(!this.image_||this.maxExtent&&!ih(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,i,n);const s=t.getFlatCoordinates(),r=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,r);this.instructions.push([Pt.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Pt.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(i)}drawMultiPoint(t,i,n){if(!this.image_)return;this.beginGeometry(t,i,n);const s=t.getFlatCoordinates(),r=[];for(let h=0,c=s.length;h<c;h+=t.getStride())(!this.maxExtent||ih(this.maxExtent,s.slice(h,h+2)))&&r.push(s[h],s[h+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,2);this.instructions.push([Pt.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Pt.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(i)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,i){const n=t.getAnchor(),s=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=i}}class Zv extends ua{constructor(t,i,n,s){super(t,i,n,s)}drawFlatCoordinates_(t,i,n,s){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(t,i,n,s,!1,!1),a=[Pt.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(t,i,n){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,i,n),this.hitDetectionInstructions.push([Pt.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Mn,In],Ms);const a=t.getFlatCoordinates(),h=t.getStride();this.drawFlatCoordinates_(a,0,a.length,h),this.hitDetectionInstructions.push(Kn),this.endGeometry(i)}drawMultiLineString(t,i,n){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,i,n),this.hitDetectionInstructions.push([Pt.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Mn,In],Ms);const a=t.getEnds(),h=t.getFlatCoordinates(),c=t.getStride();let u=0;for(let m=0,p=a.length;m<p;++m)u=this.drawFlatCoordinates_(h,u,a[m],c);this.hitDetectionInstructions.push(Kn),this.endGeometry(i)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Kn),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Kn),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Ms)}}class tf extends ua{constructor(t,i,n,s){super(t,i,n,s)}drawFlatCoordinatess_(t,i,n,s){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,h=n.length;this.instructions.push(Ms),this.hitDetectionInstructions.push(Ms);for(let c=0;c<h;++c){const u=n[c],m=this.coordinates.length,p=this.appendFlatLineCoordinates(t,i,u,s,!0,!a),y=[Pt.MOVE_TO_LINE_TO,m,p];this.instructions.push(y),this.hitDetectionInstructions.push(y),a&&(this.instructions.push(Qd),this.hitDetectionInstructions.push(Qd)),i=u}return o&&(this.instructions.push(Ra),this.hitDetectionInstructions.push(Ra)),a&&(this.instructions.push(Kn),this.hitDetectionInstructions.push(Kn)),i}drawCircle(t,i,n){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,i,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([Pt.SET_FILL_STYLE,ai]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Pt.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Mn,In]);const a=t.getFlatCoordinates(),h=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,h,!1,!1);const u=[Pt.CIRCLE,c];this.instructions.push(Ms,u),this.hitDetectionInstructions.push(Ms,u),s.fillStyle!==void 0&&(this.instructions.push(Ra),this.hitDetectionInstructions.push(Ra)),s.strokeStyle!==void 0&&(this.instructions.push(Kn),this.hitDetectionInstructions.push(Kn)),this.endGeometry(i)}drawPolygon(t,i,n){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,i,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([Pt.SET_FILL_STYLE,ai]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Pt.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Mn,In]);const a=t.getEnds(),h=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(h,0,a,c),this.endGeometry(i)}drawMultiPolygon(t,i,n){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,i,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([Pt.SET_FILL_STYLE,ai]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Pt.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Mn,In]);const a=t.getEndss(),h=t.getOrientedFlatCoordinates(),c=t.getStride();let u=0;for(let m=0,p=a.length;m<p;++m)u=this.drawFlatCoordinatess_(h,u,a[m],c);this.endGeometry(i)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const i=this.coordinates;for(let n=0,s=i.length;n<s;++n)i[n]=j1(i[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;this.updateFillStyle(t,this.createFill),this.updateStrokeStyle(t,this.applyStroke)}}function Uv(e,t,i,n,s){const r=[];let o=i,a=0,h=t.slice(i,2);for(;a<e&&o+s<n;){const[c,u]=h.slice(-2),m=t[o+s],p=t[o+s+1],y=Math.sqrt((m-c)*(m-c)+(p-u)*(p-u));if(a+=y,a>=e){const w=(e-a+y)/y,v=Ci(c,m,w),I=Ci(u,p,w);h.push(v,I),r.push(h),h=[v,I],a==e&&(o+=s),a=0}else if(a<e)h.push(t[o+s],t[o+s+1]),o+=s;else{const w=y-a,v=Ci(c,m,w/y),I=Ci(u,p,w/y);h.push(v,I),r.push(h),h=[v,I],a=0,o+=s}}return a>0&&r.push(h),r}function Xv(e,t,i,n,s){let r=i,o=i,a=0,h=0,c=i,u,m,p,y,w,v,I,b,T,P;for(m=i;m<n;m+=s){const G=t[m],k=t[m+1];w!==void 0&&(T=G-w,P=k-v,y=Math.sqrt(T*T+P*P),I!==void 0&&(h+=p,u=Math.acos((I*T+b*P)/(p*y)),u>e&&(h>a&&(a=h,r=c,o=m),h=0,c=m-s)),p=y,I=T,b=P),w=G,v=k}return h+=y,h>a?[c,m]:[r,o]}const ah={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class $v extends ua{constructor(t,i,n,s){super(t,i,n,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[ai]={fillStyle:ai},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,i,n){const s=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!s&&!r)return;const a=this.coordinates;let h=a.length;const c=t.getType();let u=null,m=t.getStride();if(o.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!Yi(this.maxExtent,t.getExtent()))return;let p;if(u=t.getFlatCoordinates(),c=="LineString")p=[u.length];else if(c=="MultiLineString")p=t.getEnds();else if(c=="Polygon")p=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){const I=t.getEndss();p=[];for(let b=0,T=I.length;b<T;++b)p.push(I[b][0])}this.beginGeometry(t,i,n);const y=o.repeat,w=y?void 0:o.textAlign;let v=0;for(let I=0,b=p.length;I<b;++I){let T;y?T=Uv(y*this.resolution,u,v,p[I],m):T=[u.slice(v,p[I])];for(let P=0,G=T.length;P<G;++P){const k=T[P];let O=0,U=k.length;if(w==null){const W=Xv(o.maxAngle,k,0,k.length,2);O=W[0],U=W[1]}for(let W=O;W<U;W+=m)a.push(k[W],k[W+1]);const Y=a.length;v=p[I],this.drawChars_(h,Y),h=Y}}this.endGeometry(i)}else{let p=o.overflow?null:[];switch(c){case"Point":case"MultiPoint":u=t.getFlatCoordinates();break;case"LineString":u=t.getFlatMidpoint();break;case"Circle":u=t.getCenter();break;case"MultiLineString":u=t.getFlatMidpoints(),m=2;break;case"Polygon":u=t.getFlatInteriorPoint(),o.overflow||p.push(u[2]/this.resolution),m=3;break;case"MultiPolygon":const G=t.getFlatInteriorPoints();u=[];for(let k=0,O=G.length;k<O;k+=3)o.overflow||p.push(G[k+2]/this.resolution),u.push(G[k],G[k+1]);if(u.length===0)return;m=2;break}const y=this.appendFlatPointCoordinates(u,m);if(y===h)return;if(p&&(y-h)/2!==u.length/m){let G=h/2;p=p.filter((k,O)=>{const U=a[(G+O)*2]===u[O*m]&&a[(G+O)*2+1]===u[O*m+1];return U||--G,U})}this.saveTextStates_();const w=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,v=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(t,i,n);let I=o.padding;if(I!=vs&&(o.scale[0]<0||o.scale[1]<0)){let G=o.padding[0],k=o.padding[1],O=o.padding[2],U=o.padding[3];o.scale[0]<0&&(k=-k,U=-U),o.scale[1]<0&&(G=-G,O=-O),I=[G,k,O,U]}const b=this.pixelRatio;this.instructions.push([Pt.DRAW_IMAGE,h,y,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,I==vs?vs:I.map(function(G){return G*b}),w,v,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,p]);const T=1/b,P=w?w.slice(0):null;P&&(P[1]=ai),this.hitDetectionInstructions.push([Pt.DRAW_IMAGE,h,y,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[T,T],NaN,this.declutterMode_,this.declutterImageWithText_,I,P,v,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?ai:this.fillKey_,this.textOffsetX_,this.textOffsetY_,p]),this.endGeometry(i)}}saveTextStates_(){const t=this.textStrokeState_,i=this.textState_,n=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:i.font,textAlign:i.textAlign||No,justify:i.justify,textBaseline:i.textBaseline||sh,scale:i.scale});const o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))}drawChars_(t,i){const n=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const h=this.pixelRatio,c=ah[s.textBaseline],u=this.textOffsetY_*h,m=this.text_,p=n?n.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([Pt.DRAW_CHARS,t,i,c,s.overflow,a,s.maxAngle,h,u,r,p*h,m,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([Pt.DRAW_CHARS,t,i,c,s.overflow,a&&ai,s.maxAngle,h,u,r,p*h,m,o,1/h,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,i){let n,s,r;if(!t)this.text_="";else{const o=t.getFill();o?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=Ji(o.getColor()||ai)):(s=null,this.textFillState_=s);const a=t.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const v=a.getLineDash(),I=a.getLineDashOffset(),b=a.getWidth(),T=a.getMiterLimit();r.lineCap=a.getLineCap()||_r,r.lineDash=v?v.slice():Mn,r.lineDashOffset=I===void 0?In:I,r.lineJoin=a.getLineJoin()||yr,r.lineWidth=b===void 0?Do:b,r.miterLimit=T===void 0?Oo:T,r.strokeStyle=Ji(a.getColor()||Fo)}n=this.textState_;const h=t.getFont()||vp;lv(h);const c=t.getScaleArray();n.overflow=t.getOverflow(),n.font=h,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||sh,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||vs,n.scale=c===void 0?[1,1]:c;const u=t.getOffsetX(),m=t.getOffsetY(),p=t.getRotateWithView(),y=t.getKeepUpright(),w=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=m===void 0?0:m,this.textRotateWithView_=p===void 0?!1:p,this.textKeepUpright_=y===void 0?!0:y,this.textRotation_=w===void 0?0:w,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:Pe(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+Pe(s.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=i}}const Hv={Circle:tf,Default:ua,Image:zv,LineString:Zv,Polygon:tf,Text:$v};class Yv{constructor(t,i,n,s){this.tolerance_=t,this.maxExtent_=i,this.pixelRatio_=s,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const i in this.buildersByZIndex_){t[i]=t[i]||{};const n=this.buildersByZIndex_[i];for(const s in n){const r=n[s].finish();t[i][s]=r}}return t}getBuilder(t,i){const n=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[n];s===void 0&&(s={},this.buildersByZIndex_[n]=s);let r=s[i];if(r===void 0){const o=Hv[i];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[i]=r}return r}}function Kv(e,t,i,n,s,r,o,a,h,c,u,m,p=!0){let y=e[t],w=e[t+1],v=0,I=0,b=0,T=0;function P(){v=y,I=w,t+=n,y=e[t],w=e[t+1],T+=b,b=Math.sqrt((y-v)*(y-v)+(w-I)*(w-I))}do P();while(t<i-n&&T+b<r);let G=b===0?0:(r-T)/b;const k=Ci(v,y,G),O=Ci(I,w,G),U=t-n,Y=T,W=r+a*h(c,s,u);for(;t<i-n&&T+b<W;)P();G=b===0?0:(W-T)/b;const Q=Ci(v,y,G),ot=Ci(I,w,G);let ut=!1;if(p)if(m){const Z=[k,O,Q,ot];B1(Z,0,4,2,m,Z,Z),ut=Z[0]>Z[2]}else ut=k>Q;const vt=Math.PI,A=[],D=U+n===t;t=U,b=0,T=Y,y=e[t],w=e[t+1];let F;if(D){P(),F=Math.atan2(w-I,y-v),ut&&(F+=F>0?-vt:vt);const Z=(Q+k)/2,H=(ot+O)/2;return A[0]=[Z,H,(W-r)/2,F,s],A}s=s.replace(/\n/g," ");for(let Z=0,H=s.length;Z<H;){P();let tt=Math.atan2(w-I,y-v);if(ut&&(tt+=tt>0?-vt:vt),F!==void 0){let z=tt-F;if(z+=z>vt?-2*vt:z<-vt?2*vt:0,Math.abs(z)>o)return null}F=tt;const V=Z;let J=0;for(;Z<H;++Z){const z=ut?H-Z-1:Z,bt=a*h(c,s[z],u);if(t+n<i&&T+b<r+J+bt/2)break;J+=bt}if(Z===V)continue;const B=ut?s.substring(H-V,H-Z):s.substring(V,Z);G=b===0?0:(r+J/2-T)/b;const dt=Ci(v,y,G),It=Ci(I,w,G);A.push([dt,It,J/2,tt,B]),r+=J}return A}const Zs=Go(),Nn=[],gn=[],mn=[],Dn=[];function ef(e){return e[3].declutterBox}const nf=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function yl(e,t){return t==="start"?t=nf.test(e)?"right":"left":t==="end"&&(t=nf.test(e)?"left":"right"),ah[t]}function qv(e,t,i){return i>0&&e.push(`
`,""),e.push(t,""),e}function Jv(e,t,i){return i%2===0&&(e+=t),e}class Qv{constructor(t,i,n,s,r){this.overlaps=n,this.pixelRatio=i,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=es(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new V1:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,i,n,s){const r=t+i+n+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,a=n?this.fillStates[n]:null,h=this.textStates[i],c=this.pixelRatio,u=[h.scale[0]*c,h.scale[1]*c],m=h.justify?ah[h.justify]:yl(Array.isArray(t)?t[0]:t,h.textAlign||No),p=s&&o.lineWidth?o.lineWidth:0,y=Array.isArray(t)?t:String(t).split(`
`).reduce(qv,[]),{width:w,height:v,widths:I,heights:b,lineWidths:T}=uv(h,y),P=w+p,G=[],k=(P+2)*u[0],O=(v+p)*u[1],U={width:k<0?Math.floor(k):Math.ceil(k),height:O<0?Math.floor(O):Math.ceil(O),contextInstructions:G};(u[0]!=1||u[1]!=1)&&G.push("scale",u),s&&(G.push("strokeStyle",o.strokeStyle),G.push("lineWidth",p),G.push("lineCap",o.lineCap),G.push("lineJoin",o.lineJoin),G.push("miterLimit",o.miterLimit),G.push("setLineDash",[o.lineDash]),G.push("lineDashOffset",o.lineDashOffset)),n&&G.push("fillStyle",a.fillStyle),G.push("textBaseline","middle"),G.push("textAlign","center");const Y=.5-m;let W=m*P+Y*p;const Q=[],ot=[];let ut=0,vt=0,A=0,D=0,F;for(let Z=0,H=y.length;Z<H;Z+=2){const tt=y[Z];if(tt===`
`){vt+=ut,ut=0,W=m*P+Y*p,++D;continue}const V=y[Z+1]||h.font;V!==F&&(s&&Q.push("font",V),n&&ot.push("font",V),F=V),ut=Math.max(ut,b[A]);const J=[tt,W+Y*I[A]+m*(I[A]-T[D]),.5*(p+ut)+vt];W+=I[A],s&&Q.push("strokeText",J),n&&ot.push("fillText",J),++A}return Array.prototype.push.apply(G,Q),Array.prototype.push.apply(G,ot),this.labels_[r]=U,U}replayTextBackground_(t,i,n,s,r,o,a){t.beginPath(),t.moveTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,r),t.lineTo.apply(t,i),o&&(this.alignAndScaleFill_=o[2],t.fillStyle=o[1],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,i,n,s,r,o,a,h,c,u,m,p,y,w,v,I){a*=p[0],h*=p[1];let b=n-a,T=s-h;const P=r+c>t?t-c:r,G=o+u>i?i-u:o,k=w[3]+P*p[0]+w[1],O=w[0]+G*p[1]+w[2],U=b-w[3],Y=T-w[0];(v||m!==0)&&(Nn[0]=U,Dn[0]=U,Nn[1]=Y,gn[1]=Y,gn[0]=U+k,mn[0]=gn[0],mn[1]=Y+O,Dn[1]=mn[1]);let W;return m!==0?(W=Ns(es(),n,s,1,1,m,-n,-s),Hi(W,Nn),Hi(W,gn),Hi(W,mn),Hi(W,Dn),tc(Math.min(Nn[0],gn[0],mn[0],Dn[0]),Math.min(Nn[1],gn[1],mn[1],Dn[1]),Math.max(Nn[0],gn[0],mn[0],Dn[0]),Math.max(Nn[1],gn[1],mn[1],Dn[1]),Zs)):tc(Math.min(U,U+k),Math.min(Y,Y+O),Math.max(U,U+k),Math.max(Y,Y+O),Zs),y&&(b=Math.round(b),T=Math.round(T)),{drawImageX:b,drawImageY:T,drawImageW:P,drawImageH:G,originX:c,originY:u,declutterBox:{minX:Zs[0],minY:Zs[1],maxX:Zs[2],maxY:Zs[3],value:I},canvasTransform:W,scale:p}}replayImageOrLabel_(t,i,n,s,r,o,a){const h=!!(o||a),c=s.declutterBox,u=a?a[2]*s.scale[0]/2:0;return c.minX-u<=i[0]&&c.maxX+u>=0&&c.minY-u<=i[1]&&c.maxY+u>=0&&(h&&this.replayTextBackground_(t,Nn,gn,mn,Dn,o,a),dv(t,s.canvasTransform,r,n,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){const i=this.alignAndScaleFill_;if(i){const n=Hi(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(n[0]%s,n[1]%s),i!==1&&t.scale(i,i),t.rotate(this.viewRotation_)}t.fill(),i&&t.restore()}setStrokeStyle_(t,i){t.strokeStyle=i[1],i[1]&&(t.lineWidth=i[2],t.lineCap=i[3],t.lineJoin=i[4],t.miterLimit=i[5],t.lineDashOffset=i[7],t.setLineDash(i[6]))}drawLabelWithPointPlacement_(t,i,n,s){const r=this.textStates[i],o=this.createLabel(t,i,s,n),a=this.strokeStates[n],h=this.pixelRatio,c=yl(Array.isArray(t)?t[0]:t,r.textAlign||No),u=ah[r.textBaseline||sh],m=a&&a.lineWidth?a.lineWidth:0,p=o.width/h-2*r.scale[0],y=c*p+2*(.5-c)*m,w=u*o.height/h+2*(.5-u)*m;return{label:o,anchorX:y,anchorY:w}}execute_(t,i,n,s,r,o,a,h){const c=this.zIndexContext_;let u;this.pixelCoordinates_&&Tr(n,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=hr(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),W1(this.renderedTransform_,n));let m=0;const p=s.length;let y=0,w,v,I,b,T,P,G,k,O,U,Y,W,Q,ot=0,ut=0;const vt=this.coordinateCache_,A=this.viewRotation_,D=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,F={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:A},Z=this.instructions!=s||this.overlaps?0:200;let H,tt,V,J;for(;m<p;){const B=s[m];switch(B[0]){case Pt.BEGIN_GEOMETRY:H=B[1],J=B[3],H.getGeometry()?a!==void 0&&!Yi(a,J.getExtent())?m=B[2]+1:++m:m=B[2],c&&(c.zIndex=B[4]);break;case Pt.BEGIN_PATH:ot>Z&&(this.fill_(t),ot=0),ut>Z&&(t.stroke(),ut=0),!ot&&!ut&&(t.beginPath(),T=NaN,P=NaN),++m;break;case Pt.CIRCLE:y=B[1];const It=u[y],z=u[y+1],bt=u[y+2],Et=u[y+3],Ot=bt-It,Vt=Et-z,Wt=Math.sqrt(Ot*Ot+Vt*Vt);t.moveTo(It+Wt,z),t.arc(It,z,Wt,0,2*Math.PI,!0),++m;break;case Pt.CLOSE_PATH:t.closePath(),++m;break;case Pt.CUSTOM:y=B[1],w=B[2];const Kt=B[3],Zt=B[4],Ht=B[5];F.geometry=Kt,F.feature=H,m in vt||(vt[m]=[]);const Ne=vt[m];Ht?Ht(u,y,w,2,Ne):(Ne[0]=u[y],Ne[1]=u[y+1],Ne.length=2),c&&(c.zIndex=B[6]),Zt(Ne,F),++m;break;case Pt.DRAW_IMAGE:y=B[1],w=B[2],O=B[3],v=B[4],I=B[5];let ei=B[6];const xe=B[7],Se=B[8],va=B[9],We=B[10];let Vr=B[11];const Bs=B[12];let ii=B[13];b=B[14]||"declutter";const un=B[15];if(!O&&B.length>=20){U=B[19],Y=B[20],W=B[21],Q=B[22];const l=this.drawLabelWithPointPlacement_(U,Y,W,Q);O=l.label,B[3]=O;const g=B[23];v=(l.anchorX-g)*this.pixelRatio,B[4]=v;const _=B[24];I=(l.anchorY-_)*this.pixelRatio,B[5]=I,ei=O.height,B[6]=ei,ii=O.width,B[13]=ii}let Wi;B.length>25&&(Wi=B[25]);let Wr,ls,dn;B.length>17?(Wr=B[16],ls=B[17],dn=B[18]):(Wr=vs,ls=null,dn=null),We&&D?Vr+=A:!We&&!D&&(Vr-=A);let rl=0;for(;y<w;y+=2){if(Wi&&Wi[rl++]<ii/this.pixelRatio)continue;const l=this.calculateImageOrLabelDimensions_(O.width,O.height,u[y],u[y+1],ii,ei,v,I,Se,va,Vr,Bs,r,Wr,!!ls||!!dn,H),g=[t,i,O,l,xe,ls,dn];if(h){let _,C,E;if(un){const N=w-y;if(!un[N]){un[N]={args:g,declutterMode:b};continue}const R=un[N];_=R.args,C=R.declutterMode,delete un[N],E=ef(_)}let x,S;if(_&&(C!=="declutter"||!h.collides(E))&&(x=!0),(b!=="declutter"||!h.collides(l.declutterBox))&&(S=!0),C==="declutter"&&b==="declutter"){const N=x&&S;x=N,S=N}x&&(C!=="none"&&h.insert(E),this.replayImageOrLabel_.apply(this,_)),S&&(b!=="none"&&h.insert(l.declutterBox),this.replayImageOrLabel_.apply(this,g))}else this.replayImageOrLabel_.apply(this,g)}++m;break;case Pt.DRAW_CHARS:const Ma=B[1],Ia=B[2],zr=B[3],ol=B[4];Q=B[5];const al=B[6],Zr=B[7],Ea=B[8];W=B[9];const Ur=B[10];U=B[11],Array.isArray(U)&&(U=U.reduce(Jv,"")),Y=B[12];const Ca=[B[13],B[13]];b=B[14]||"declutter";const hl=B[15],Pn=this.textStates[Y],Gn=Pn.font,Ln=[Pn.scale[0]*Zr,Pn.scale[1]*Zr];let M;Gn in this.widths_?M=this.widths_[Gn]:(M={},this.widths_[Gn]=M);const d=Gp(u,Ma,Ia,2),f=Math.abs(Ln[0])*Wd(Gn,U,M);if(ol||f<=d){const l=this.textStates[Y].textAlign,g=(d-f)*yl(U,l),_=Kv(u,Ma,Ia,2,U,g,al,Math.abs(Ln[0]),Wd,Gn,M,D?0:this.viewRotation_,hl);t:if(_){const C=[];let E,x,S,N,R;if(W)for(E=0,x=_.length;E<x;++E){R=_[E],S=R[4],N=this.createLabel(S,Y,"",W),v=R[2]+(Ln[0]<0?-Ur:Ur),I=zr*N.height+(.5-zr)*2*Ur*Ln[1]/Ln[0]-Ea;const $=this.calculateImageOrLabelDimensions_(N.width,N.height,R[0],R[1],N.width,N.height,v,I,0,0,R[3],Ca,!1,vs,!1,H);if(h&&b==="declutter"&&h.collides($.declutterBox))break t;C.push([t,i,N,$,1,null,null])}if(Q)for(E=0,x=_.length;E<x;++E){R=_[E],S=R[4],N=this.createLabel(S,Y,Q,""),v=R[2],I=zr*N.height-Ea;const $=this.calculateImageOrLabelDimensions_(N.width,N.height,R[0],R[1],N.width,N.height,v,I,0,0,R[3],Ca,!1,vs,!1,H);if(h&&b==="declutter"&&h.collides($.declutterBox))break t;C.push([t,i,N,$,1,null,null])}h&&b!=="none"&&h.load(C.map(ef));for(let $=0,at=C.length;$<at;++$)this.replayImageOrLabel_.apply(this,C[$])}}++m;break;case Pt.END_GEOMETRY:if(o!==void 0){H=B[1];const l=o(H,J,b);if(l)return l}++m;break;case Pt.FILL:Z?ot++:this.fill_(t),++m;break;case Pt.MOVE_TO_LINE_TO:for(y=B[1],w=B[2],tt=u[y],V=u[y+1],t.moveTo(tt,V),T=tt+.5|0,P=V+.5|0,y+=2;y<w;y+=2)tt=u[y],V=u[y+1],G=tt+.5|0,k=V+.5|0,(y==w-2||G!==T||k!==P)&&(t.lineTo(tt,V),T=G,P=k);++m;break;case Pt.SET_FILL_STYLE:this.alignAndScaleFill_=B[2],ot&&(this.fill_(t),ot=0,ut&&(t.stroke(),ut=0)),t.fillStyle=B[1],++m;break;case Pt.SET_STROKE_STYLE:ut&&(t.stroke(),ut=0),this.setStrokeStyle_(t,B),++m;break;case Pt.STROKE:Z?ut++:t.stroke(),++m;break;default:++m;break}}ot&&this.fill_(t),ut&&t.stroke()}execute(t,i,n,s,r,o){this.viewRotation_=s,this.execute_(t,i,n,this.instructions,r,void 0,void 0,o)}executeHitDetection(t,i,n,s,r){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],i,this.hitDetectionInstructions,!0,s,r)}}const ys=["Polygon","Circle","LineString","Image","Text","Default"],Op=["Image","Text"],t2=ys.filter(e=>!Op.includes(e));class e2{constructor(t,i,n,s,r,o,a){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=n,this.resolution_=i,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=es(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,a)}clip(t,i){const n=this.getClipCoords(i);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,i){for(const n in t){let s=this.executorsByZIndex_[n];s===void 0&&(s={},this.executorsByZIndex_[n]=s);const r=t[n];for(const o in r){const a=r[o];s[o]=new Qv(this.resolution_,this.pixelRatio_,this.overlaps_,a,i)}}}hasExecutors(t){for(const i in this.executorsByZIndex_){const n=this.executorsByZIndex_[i];for(let s=0,r=t.length;s<r;++s)if(t[s]in n)return!0}return!1}forEachFeatureAtCoordinate(t,i,n,s,r,o){s=Math.round(s);const a=s*2+1,h=Ns(this.hitDetectionTransform_,s+.5,s+.5,1/i,-1/i,-n,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=Ni(a,a));const u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):c||u.clearRect(0,0,a,a);let m;this.renderBuffer_!==void 0&&(m=Go(),z1(m,t),ou(m,i*(this.renderBuffer_+s),m));const p=i2(s);let y;function w(k,O,U){const Y=u.getImageData(0,0,a,a).data;for(let W=0,Q=p.length;W<Q;W++)if(Y[p[W]]>0){if(!o||U==="none"||y!=="Image"&&y!=="Text"||o.includes(k)){const ot=(p[W]-3)/4,ut=s-ot%a,vt=s-(ot/a|0),A=r(k,O,ut*ut+vt*vt);if(A)return A}u.clearRect(0,0,a,a);break}}const v=Object.keys(this.executorsByZIndex_).map(Number);v.sort(Mo);let I,b,T,P,G;for(I=v.length-1;I>=0;--I){const k=v[I].toString();for(T=this.executorsByZIndex_[k],b=ys.length-1;b>=0;--b)if(y=ys[b],P=T[y],P!==void 0&&(G=P.executeHitDetection(u,h,n,w,m),G))return G}}getClipCoords(t){const i=this.maxExtent_;if(!i)return null;const n=i[0],s=i[1],r=i[2],o=i[3],a=[n,s,n,o,r,o,r,s];return hr(a,0,8,2,t,a),a}isEmpty(){return Po(this.executorsByZIndex_)}execute(t,i,n,s,r,o,a){const h=Object.keys(this.executorsByZIndex_).map(Number);h.sort(a?Z1:Mo),o=o||ys;const c=ys.length;for(let u=0,m=h.length;u<m;++u){const p=h[u].toString(),y=this.executorsByZIndex_[p];for(let w=0,v=o.length;w<v;++w){const I=o[w],b=y[I];if(b!==void 0){const T=a===null?void 0:b.getZIndexContext(),P=T?T.getContext():t,G=this.maxExtent_&&I!=="Image"&&I!=="Text";if(G&&(P.save(),this.clip(P,n)),!T||I==="Text"||I==="Image"?b.execute(P,i,n,s,r,a):T.pushFunction(k=>b.execute(k,i,n,s,r,a)),G&&P.restore(),T){T.offset();const k=h[u]*c+ys.indexOf(I);this.deferredZIndexContexts_[k]||(this.deferredZIndexContexts_[k]=[]),this.deferredZIndexContexts_[k].push(T)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,i=Object.keys(t).map(Number).sort(Mo);for(let n=0,s=i.length;n<s;++n)t[i[n]].forEach(r=>{r.draw(this.renderedContext_),r.clear()}),t[i[n]].length=0}}const wl={};function i2(e){if(wl[e]!==void 0)return wl[e];const t=e*2+1,i=e*e,n=new Array(i+1);for(let r=0;r<=e;++r)for(let o=0;o<=e;++o){const a=r*r+o*o;if(a>i)break;let h=n[a];h||(h=[],n[a]=h),h.push(((e+r)*t+(e+o))*4+3),r>0&&h.push(((e-r)*t+(e+o))*4+3),o>0&&(h.push(((e+r)*t+(e-o))*4+3),r>0&&h.push(((e-r)*t+(e-o))*4+3))}const s=[];for(let r=0,o=n.length;r<o;++r)n[r]&&s.push(...n[r]);return wl[e]=s,s}class n2 extends Lp{constructor(t,i,n,s,r,o,a){super(),this.context_=t,this.pixelRatio_=i,this.extent_=n,this.transform_=s,this.transformRotation_=s?U1(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=es()}drawImages_(t,i,n,s){if(!this.image_)return;const r=hr(t,i,n,s,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,h=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=h*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let u=0,m=r.length;u<m;u+=2){const p=r[u]-this.imageAnchorX_,y=r[u+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const w=p+this.imageAnchorX_,v=y+this.imageAnchorY_;Ns(a,w,v,1,1,c,-w,-v),o.save(),o.transform.apply(o,a),o.translate(w,v),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,p,y,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=h)}drawText_(t,i,n,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=hr(t,i,n,s,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);i<n;i+=s){const h=r[i]+this.textOffsetX_,c=r[i+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(h-this.textOffsetX_,c-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,h,c),this.textFillState_&&o.fillText(this.text_,h,c))}}moveToLineTo_(t,i,n,s,r){const o=this.context_,a=hr(t,i,n,s,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let h=a.length;r&&(h-=2);for(let c=2;c<h;c+=2)o.lineTo(a[c],a[c+1]);return r&&o.closePath(),n}drawRings_(t,i,n,s){for(let r=0,o=n.length;r<o;++r)i=this.moveToLineTo_(t,i,n[r],s,!0);return i}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Yi(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=X1(t,this.transform_,this.pixelCoordinates_),n=i[2]-i[0],s=i[3]-i[1],r=Math.sqrt(n*n+s*s),o=this.context_;o.beginPath(),o.arc(i[0],i[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,i){const n=i.getGeometryFunction()(t);n&&(this.setStyle(i),this.drawGeometry(n))}drawGeometryCollection(t){const i=t.getGeometriesArray();for(let n=0,s=i.length;n<s;++n)this.drawGeometry(i[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(i,0,i.length,n),this.text_!==""&&this.drawText_(i,0,i.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(i,0,i.length,n),this.text_!==""&&this.drawText_(i,0,i.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Yi(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getFlatCoordinates();i.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoint();this.drawText_(i,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const i=t.getExtent();if(Yi(this.extent_,i)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,s=t.getFlatCoordinates();let r=0;const o=t.getEnds(),a=t.getStride();n.beginPath();for(let h=0,c=o.length;h<c;++h)r=this.moveToLineTo_(s,r,o[h],a,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Yi(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=this.context_;i.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){const i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Yi(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getOrientedFlatCoordinates();let s=0;const r=t.getEndss(),o=t.getStride();i.beginPath();for(let a=0,h=r.length;a<h;++a){const c=r[a];s=this.drawRings_(n,s,c,o)}this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){const i=t.getFlatInteriorPoints();this.drawText_(i,0,i.length,2)}}}setContextFillState_(t){const i=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,i.fillStyle=t.fillStyle):(i.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const i=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,i.lineCap=t.lineCap),Tr(n.lineDash,t.lineDash)||i.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,i.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,i.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,i.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,i.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,i.strokeStyle=t.strokeStyle)):(i.lineCap=t.lineCap,i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset,i.lineJoin=t.lineJoin,i.lineWidth=t.lineWidth,i.miterLimit=t.miterLimit,i.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const i=this.context_,n=this.contextTextState_,s=t.textAlign?t.textAlign:No;n?(n.font!=t.font&&(n.font=t.font,i.font=t.font),n.textAlign!=s&&(n.textAlign=s,i.textAlign=s),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,i.textBaseline=t.textBaseline)):(i.font=t.font,i.textAlign=s,i.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,i){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:Ji(n||ai)}}if(!i)this.strokeState_=null;else{const n=i.getColor(),s=i.getLineCap(),r=i.getLineDash(),o=i.getLineDashOffset(),a=i.getLineJoin(),h=i.getWidth(),c=i.getMiterLimit(),u=r||Mn;this.strokeState_={lineCap:s!==void 0?s:_r,lineDash:this.pixelRatio_===1?u:u.map(m=>m*this.pixelRatio_),lineDashOffset:(o||In)*this.pixelRatio_,lineJoin:a!==void 0?a:yr,lineWidth:(h!==void 0?h:Do)*this.pixelRatio_,miterLimit:c!==void 0?c:Oo,strokeStyle:Ji(n||Fo)}}}setImageStyle(t){let i;if(!t||!(i=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*n,this.imageAnchorY_=s[1]*n,this.imageHeight_=i[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=i[0]*n}setTextStyle(t){if(!t)this.text_="";else{const i=t.getFill();if(!i)this.textFillState_=null;else{const y=i.getColor();this.textFillState_={fillStyle:Ji(y||ai)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const y=n.getColor(),w=n.getLineCap(),v=n.getLineDash(),I=n.getLineDashOffset(),b=n.getLineJoin(),T=n.getWidth(),P=n.getMiterLimit();this.textStrokeState_={lineCap:w!==void 0?w:_r,lineDash:v||Mn,lineDashOffset:I||In,lineJoin:b!==void 0?b:yr,lineWidth:T!==void 0?T:Do,miterLimit:P!==void 0?P:Oo,strokeStyle:Ji(y||Fo)}}const s=t.getFont(),r=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),h=t.getRotation(),c=t.getScaleArray(),u=t.getText(),m=t.getTextAlign(),p=t.getTextBaseline();this.textState_={font:s!==void 0?s:vp,textAlign:m!==void 0?m:No,textBaseline:p!==void 0?p:sh},this.text_=u!==void 0?Array.isArray(u)?u.reduce((y,w,v)=>y+=v%2?" ":w,""):u:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=h!==void 0?h:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}const Ki=.5;function s2(e,t,i,n,s,r,o,a,h){const c=s,u=e[0]*Ki,m=e[1]*Ki,p=Ni(u,m);p.imageSmoothingEnabled=!1;const y=p.canvas,w=new n2(p,Ki,s,null,o,a,null),v=i.length,I=Math.floor((256*256*256-1)/v),b={};for(let P=1;P<=v;++P){const G=i[P-1],k=G.getStyleFunction()||n;if(!k)continue;let O=k(G,r);if(!O)continue;Array.isArray(O)||(O=[O]);const Y=(P*I).toString(16).padStart(7,"#00000");for(let W=0,Q=O.length;W<Q;++W){const ot=O[W],ut=ot.getGeometryFunction()(G);if(!ut||!Yi(c,ut.getExtent()))continue;const vt=ot.clone(),A=vt.getFill();A&&A.setColor(Y);const D=vt.getStroke();D&&(D.setColor(Y),D.setLineDash(null)),vt.setText(void 0);const F=ot.getImage();if(F){const V=F.getImageSize();if(!V)continue;const J=Ni(V[0],V[1],void 0,{alpha:!1}),B=J.canvas;J.fillStyle=Y,J.fillRect(0,0,B.width,B.height),vt.setImage(new Wh({img:B,anchor:F.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:F.getOrigin(),opacity:1,size:F.getSize(),scale:F.getScale(),rotation:F.getRotation(),rotateWithView:F.getRotateWithView()}))}const Z=vt.getZIndex()||0;let H=b[Z];H||(H={},b[Z]=H,H.Polygon=[],H.Circle=[],H.LineString=[],H.Point=[]);const tt=ut.getType();if(tt==="GeometryCollection"){const V=ut.getGeometriesArrayRecursive();for(let J=0,B=V.length;J<B;++J){const dt=V[J];H[dt.getType().replace("Multi","")].push(dt,vt)}}else H[tt.replace("Multi","")].push(ut,vt)}}const T=Object.keys(b).map(Number).sort(Mo);for(let P=0,G=T.length;P<G;++P){const k=b[T[P]];for(const O in k){const U=k[O];for(let Y=0,W=U.length;Y<W;Y+=2){w.setStyle(U[Y+1]);for(let Q=0,ot=t.length;Q<ot;++Q)w.setTransform(t[Q]),w.drawGeometry(U[Y])}}}return p.getImageData(0,0,y.width,y.height)}function r2(e,t,i){const n=[];if(i){const s=Math.floor(Math.round(e[0])*Ki),r=Math.floor(Math.round(e[1])*Ki),o=(Ql(s,0,i.width-1)+Ql(r,0,i.height-1)*i.width)*4,a=i.data[o],h=i.data[o+1],u=i.data[o+2]+256*(h+256*a),m=Math.floor((256*256*256-1)/t.length);u&&u%m===0&&n.push(t[u/m-1])}return n}const o2=.5,Fp={Point:g2,LineString:u2,Polygon:p2,MultiPoint:m2,MultiLineString:d2,MultiPolygon:f2,GeometryCollection:c2,Circle:h2};function a2(e,t){return parseInt(Pe(e),10)-parseInt(Pe(t),10)}function sf(e,t){const i=Np(e,t);return i*i}function Np(e,t){return o2*e/t}function h2(e,t,i,n,s){const r=i.getFill(),o=i.getStroke();if(r||o){const h=e.getBuilder(i.getZIndex(),"Circle");h.setFillStrokeStyle(r,o),h.drawCircle(t,n,s)}const a=i.getText();if(a&&a.getText()){const h=e.getBuilder(i.getZIndex(),"Text");h.setTextStyle(a),h.drawText(t,n)}}function rf(e,t,i,n,s,r,o,a){const h=[],c=i.getImage();if(c){let p=!0;const y=c.getImageState();y==zt.LOADED||y==zt.ERROR?p=!1:y==zt.IDLE&&c.load(),p&&h.push(c.ready())}const u=i.getFill();u&&u.loading()&&h.push(u.ready());const m=h.length>0;return m&&Promise.all(h).then(()=>s(null)),l2(e,t,i,n,r,o,a),m}function l2(e,t,i,n,s,r,o){const a=i.getGeometryFunction()(t);if(!a)return;const h=a.simplifyTransformed(n,s);if(i.getRenderer())Dp(e,h,i,t,o);else{const u=Fp[h.getType()];u(e,h,i,t,o,r)}}function Dp(e,t,i,n,s){if(t.getType()=="GeometryCollection"){const o=t.getGeometries();for(let a=0,h=o.length;a<h;++a)Dp(e,o[a],i,n,s);return}e.getBuilder(i.getZIndex(),"Default").drawCustom(t,n,i.getRenderer(),i.getHitDetectionRenderer(),s)}function c2(e,t,i,n,s,r){const o=t.getGeometriesArray();let a,h;for(a=0,h=o.length;a<h;++a){const c=Fp[o[a].getType()];c(e,o[a],i,n,s,r)}}function u2(e,t,i,n,s){const r=i.getStroke();if(r){const a=e.getBuilder(i.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(t,n,s)}const o=i.getText();if(o&&o.getText()){const a=e.getBuilder(i.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n,s)}}function d2(e,t,i,n,s){const r=i.getStroke();if(r){const a=e.getBuilder(i.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(t,n,s)}const o=i.getText();if(o&&o.getText()){const a=e.getBuilder(i.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n,s)}}function f2(e,t,i,n,s){const r=i.getFill(),o=i.getStroke();if(o||r){const h=e.getBuilder(i.getZIndex(),"Polygon");h.setFillStrokeStyle(r,o),h.drawMultiPolygon(t,n,s)}const a=i.getText();if(a&&a.getText()){const h=e.getBuilder(i.getZIndex(),"Text");h.setTextStyle(a),h.drawText(t,n,s)}}function g2(e,t,i,n,s,r){const o=i.getImage(),a=i.getText(),h=a&&a.getText(),c=r&&o&&h?{}:void 0;if(o){if(o.getImageState()!=zt.LOADED)return;const u=e.getBuilder(i.getZIndex(),"Image");u.setImageStyle(o,c),u.drawPoint(t,n,s)}if(h){const u=e.getBuilder(i.getZIndex(),"Text");u.setTextStyle(a,c),u.drawText(t,n,s)}}function m2(e,t,i,n,s,r){const o=i.getImage(),a=o&&o.getOpacity()!==0,h=i.getText(),c=h&&h.getText(),u=r&&a&&c?{}:void 0;if(a){if(o.getImageState()!=zt.LOADED)return;const m=e.getBuilder(i.getZIndex(),"Image");m.setImageStyle(o,u),m.drawMultiPoint(t,n,s)}if(c){const m=e.getBuilder(i.getZIndex(),"Text");m.setTextStyle(h,u),m.drawText(t,n,s)}}function p2(e,t,i,n,s){const r=i.getFill(),o=i.getStroke();if(r||o){const h=e.getBuilder(i.getZIndex(),"Polygon");h.setFillStrokeStyle(r,o),h.drawPolygon(t,n,s)}const a=i.getText();if(a&&a.getText()){const h=e.getBuilder(i.getZIndex(),"Text");h.setTextStyle(a),h.drawText(t,n,s)}}class _2 extends cp{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Go(),this.wrappedRenderedExtent_=Go(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,i,n){const s=i.extent,r=i.viewState,o=r.center,a=r.resolution,h=r.projection,c=r.rotation,u=h.getExtent(),m=this.getLayer().getSource(),p=this.getLayer().getDeclutter(),y=i.pixelRatio,w=i.viewHints,v=!(w[xi.ANIMATING]||w[xi.INTERACTING]),I=this.context,b=Math.round(Hn(s)/a*y),T=Math.round(Lo(s)/a*y),P=m.getWrapX()&&h.canWrapX(),G=P?Hn(u):null,k=P?Math.ceil((s[2]-u[2])/G)+1:1;let O=P?Math.floor((s[0]-u[0])/G):0;do{let U=this.getRenderTransform(o,a,0,y,b,T,O*G);i.declutter&&(U=U.slice(0)),t.execute(I,[I.canvas.width,I.canvas.height],U,c,v,n===void 0?ys:n?Op:t2,n?p&&i.declutter[p]:void 0)}while(++O<k)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Ni(this.context.canvas.width,this.context.canvas.height,Pd))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,$1(this.context),Pd.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,i){const n=t.layerStatesArray[t.layerIndex];this.opacity_=n.opacity;const s=t.viewState;this.prepareContainer(t,i);const r=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(Es.PRERENDER)||this.getLayer().hasListener(Es.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(r,t),s.projection,this.clipped_=!1,a&&n.extent&&this.clipping){const h=ec(n.extent);a=Yi(h,t.extent),this.clipped_=a&&!er(h,t.extent),this.clipped_&&this.clipUnrotated(r,t,h)}return a&&this.renderWorlds(o,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&r.restore(),this.postRender(r,t),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(i=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=this.frameState.size.slice(),s=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,h=this.wrappedRenderedExtent_,c=this.getLayer(),u=[],m=n[0]*Ki,p=n[1]*Ki;u.push(this.getRenderTransform(s,r,o,Ki,m,p,0).slice());const y=c.getSource(),w=a.getExtent();if(y.getWrapX()&&a.canWrapX()&&!er(w,h)){let v=h[0];const I=Hn(w);let b=0,T;for(;v<w[0];)--b,T=I*b,u.push(this.getRenderTransform(s,r,o,Ki,m,p,T).slice()),v+=I;for(b=0,v=h[2];v>w[2];)++b,T=I*b,u.push(this.getRenderTransform(s,r,o,Ki,m,p,T).slice()),v-=I}this.hitDetectionImageData_=s2(n,u,this.renderedFeatures_,c.getStyleFunction(),h,r,o,sf(r,this.renderedPixelRatio_))}i(r2(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,i,n,s,r){if(!this.replayGroup_)return;const o=i.viewState.resolution,a=i.viewState.rotation,h=this.getLayer(),c={},u=function(p,y,w){const v=Pe(p),I=c[v];if(I){if(I!==!0&&w<I.distanceSq){if(w===0)return c[v]=!0,r.splice(r.lastIndexOf(I),1),s(p,h,y);I.geometry=y,I.distanceSq=w}}else{if(w===0)return c[v]=!0,s(p,h,y);r.push(c[v]={feature:p,layer:h,geometry:y,distanceSq:w,callback:s})}},m=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,o,a,n,u,m?i.declutter?.[m]?.all().map(p=>p.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const i=this.getLayer(),n=i.getSource();if(!n)return!1;const s=t.viewHints[xi.ANIMATING],r=t.viewHints[xi.INTERACTING],o=i.getUpdateWhileAnimating(),a=i.getUpdateWhileInteracting();if(this.ready&&!o&&s||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const h=t.extent,c=t.viewState,u=c.projection,m=c.resolution,p=t.pixelRatio,y=i.getRevision(),w=i.getRenderBuffer();let v=i.getRenderOrder();v===void 0&&(v=a2);const I=c.center.slice(),b=ou(h,w*m),T=b.slice(),P=[b.slice()],G=u.getExtent();if(n.getWrapX()&&u.canWrapX()&&!er(G,t.extent)){const A=Hn(G),D=Math.max(Hn(b)/2,A);b[0]=G[0]-D,b[2]=G[2]+D,rp(I,u);const F=H1(P[0],u);F[0]<G[0]&&F[2]<G[2]?P.push([F[0]+A,F[1],F[2]+A,F[3]]):F[0]>G[0]&&F[2]>G[2]&&P.push([F[0]-A,F[1],F[2]-A,F[3]])}if(this.ready&&this.renderedResolution_==m&&this.renderedRevision_==y&&this.renderedRenderOrder_==v&&this.renderedFrameDeclutter_===!!t.declutter&&er(this.wrappedRenderedExtent_,b))return Tr(this.renderedExtent_,T)||(this.hitDetectionImageData_=null,this.renderedExtent_=T),this.renderedCenter_=I,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const k=new Yv(Np(m,p),b,m,p);let O;for(let A=0,D=P.length;A<D;++A)n.loadFeatures(P[A],m,u);const U=sf(m,p);let Y=!0;const W=(A,D)=>{let F;const Z=A.getStyleFunction()||i.getStyleFunction();if(Z&&(F=Z(A,m)),F){const H=this.renderFeature(A,U,F,k,O,this.getLayer().getDeclutter(),D);Y=Y&&!H}},Q=Y1(b),ot=n.getFeaturesInExtent(Q);v&&ot.sort(v);for(let A=0,D=ot.length;A<D;++A)W(ot[A],A);this.renderedFeatures_=ot,this.ready=Y;const ut=k.finish(),vt=new e2(b,m,p,n.getOverlaps(),ut,i.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=m,this.renderedRevision_=y,this.renderedRenderOrder_=v,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=T,this.wrappedRenderedExtent_=b,this.renderedCenter_=I,this.renderedProjection_=u,this.renderedPixelRatio_=p,this.replayGroup_=vt,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,i,n,s,r,o,a){if(!n)return!1;let h=!1;if(Array.isArray(n))for(let c=0,u=n.length;c<u;++c)h=rf(s,t,n[c],i,this.boundHandleStyleImageChange_,r,o,a)||h;else h=rf(s,t,n,i,this.boundHandleStyleImageChange_,r,o,a);return h}}class y2 extends Wv{constructor(t){super(t),this.vectorRenderer_=new _2(t),this.layerImageRatio_=t.getImageRatio(),this.coordinateToVectorPixelTransform_=es(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(t){if(!this.vectorRenderer_)return Promise.resolve([]);const i=Hi(this.coordinateToVectorPixelTransform_,Hi(this.renderedPixelToCoordinateTransform_,t.slice()));return this.vectorRenderer_.getFeatures(i)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(t){const i=t.pixelRatio,n=t.viewState,s=n.resolution,r=t.viewHints,o=this.vectorRenderer_;let a=t.extent;this.layerImageRatio_!==1&&(a=a.slice(0),K1(a,this.layerImageRatio_));const h=Hn(a)/s,c=Lo(a)/s;if(!r[xi.ANIMATING]&&!r[xi.INTERACTING]&&!su(a)){o.useContainer(null,null);const u=o.context,m=t.layerStatesArray[t.layerIndex],p=Object.assign({},m,{opacity:1}),y=Object.assign({},t,{extent:a,size:[h,c],viewState:Object.assign({},t.viewState,{rotation:0}),layerStatesArray:[p],layerIndex:0,declutter:null}),w=this.getLayer().getDeclutter();w&&(y.declutter={[w]:new jh(9)});const v=new Bv(a,s,i,u.canvas,function(I){o.prepareFrame(y)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(y,null),o.renderDeclutter(y),o.renderDeferred(y),I())});v.addEventListener(ie.CHANGE,()=>{if(v.getState()!==zt.LOADED)return;this.image=v;const I=v.getPixelRatio(),b=Vv(v.getResolution())*i/I;this.renderedResolution=b,this.coordinateToVectorPixelTransform_=Ns(this.coordinateToVectorPixelTransform_,h/2,c/2,1/b,-1/b,0,-n.center[0],-n.center[1])}),v.load()}return this.image&&(this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice()),!this.getLayer().getSource()?.loading&&!!this.image}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(t,i,n,s,r){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,i,n,s,r):super.forEachFeatureAtCoordinate(t,i,n,s,r)}}class dF extends Ap{constructor(t){t=t||{};const i=Object.assign({},t);delete i.imageRatio,super(i),this.imageRatio_=t.imageRatio!==void 0?t.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new y2(this)}}const vl="units",w2=[1,2,5],Jr=25.4/.28;class fF extends kh{constructor(t){t=t||{};const i=document.createElement("div");i.style.pointerEvents="none",super({element:i,render:t.render,target:t.target}),this.on,this.once,this.un;const n=t.className!==void 0?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+oa,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth!==void 0?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(vl,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get(vl)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set(vl,t)}setDpi(t){this.dpi_=t}updateElement_(){const t=this.viewState_;if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const i=t.center,n=t.projection,s=this.getUnits(),r=s=="degrees"?"degrees":"m";let o=Gd(n,t.resolution,i,r);const a=this.minWidth_*(this.dpi_||Jr)/Jr,h=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||Jr)/Jr:void 0;let c=a*o,u="";if(s=="degrees"){const P=q1.degrees;c*=P,c<P/60?(u="″",o*=3600):c<P?(u="′",o*=60):u="°"}else if(s=="imperial")c<.9144?(u="in",o/=.0254):c<1609.344?(u="ft",o/=.3048):(u="mi",o/=1609.344);else if(s=="nautical")o/=1852,u="NM";else if(s=="metric")c<1e-6?(u="nm",o*=1e9):c<.001?(u="μm",o*=1e6):c<1?(u="mm",o*=1e3):c<1e3?u="m":(u="km",o/=1e3);else if(s=="us")c<.9144?(u="in",o*=39.37):c<1609.344?(u="ft",o/=.30480061):(u="mi",o/=1609.3472);else throw new Error("Invalid units");let m=3*Math.floor(Math.log(a*o)/Math.log(10)),p,y,w,v=0,I,b;for(;;){w=Math.floor(m/3);const P=Math.pow(10,w);if(p=w2[(m%3+3)%3]*P,y=Math.round(p/o),isNaN(y)){this.element.style.display="none",this.renderedVisible_=!1;return}if(h!==void 0&&y>=h){p=v,y=I,w=b;break}else if(y>=a)break;v=p,I=y,b=w,++m}const T=this.scaleBar_?this.createScaleBar(y,p,u):p.toFixed(w<0?-w:0)+" "+u;this.renderedHTML_!=T&&(this.innerElement_.innerHTML=T,this.renderedHTML_=T),this.renderedWidth_!=y&&(this.innerElement_.style.width=y+"px",this.renderedWidth_=y),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,i,n){const s=this.getScaleForResolution(),r=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),o=this.scaleBarSteps_,a=t/o,h=[this.createMarker("absolute")];for(let u=0;u<o;++u){const m=u%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";h.push(`<div><div class="ol-scale-singlebar ${m}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(u%2===0||o===2?this.createStepText(u,t,!1,i,n):"")+"</div>")}return h.push(this.createStepText(o,t,!0,i,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+r+"</div>":"")+h.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${t==="absolute"?3:-10}px;"></div>`}createStepText(t,i,n,s,r){const a=(t===0?0:Math.round(s/this.scaleBarSteps_*t*100)/100)+(t===0?"":" "+r),h=t===0?-3:i/this.scaleBarSteps_*-1,c=t===0?0:i/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${h}px;text-align: ${t===0?"left":"center"};min-width: ${c}px;left: ${n?i+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const t=Gd(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),i=this.dpi_||Jr,n=1e3/25.4;return t*n*i}render(t){const i=t.frameState;i?this.viewState_=i.viewState:this.viewState_=null,this.updateElement_()}}class gu{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const v2={PROPERTYCHANGE:"propertychange"};class M2{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function I2(e,t){return e>t?1:e<t?-1:0}function kp(e,t,i){if(e[0]<=t)return 0;const n=e.length;if(t<=e[n-1])return n-1;if(typeof i=="function"){for(let s=1;s<n;++s){const r=e[s];if(r===t)return s;if(r<t)return i(t,e[s-1],r)>0?s-1:s}return n-1}if(i>0){for(let s=1;s<n;++s)if(e[s]<t)return s-1;return n-1}if(i<0){for(let s=1;s<n;++s)if(e[s]<=t)return s;return n-1}for(let s=1;s<n;++s){if(e[s]==t)return s;if(e[s]<t)return e[s-1]-t<t-e[s]?s-1:s}return n-1}function E2(e,t){const i=Array.isArray(t)?t:[t],n=i.length;for(let s=0;s<n;s++)e[e.length]=i[s]}function C2(e,t){const i=e.length;if(i!==t.length)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}function dc(){}function x2(e){let t=!1,i,n,s;return function(){const r=Array.prototype.slice.call(arguments);return(!t||this!==s||!C2(r,n))&&(t=!0,s=this,n=r,i=e.apply(this,arguments)),i}}function jp(e){for(const t in e)delete e[t]}function S2(e){let t;for(t in e)return!1;return!t}class b2 extends M2{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,i){if(!t||!i)return;const n=this.listeners_||(this.listeners_={}),s=n[t]||(n[t]=[]);s.includes(i)||s.push(i)}dispatchEvent(t){const i=typeof t=="string",n=i?t:t.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const r=i?new gu(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let h;for(let c=0,u=s.length;c<u;++c)if("handleEvent"in s[c]?h=s[c].handleEvent(r):h=s[c].call(this,r),h===!1||r.propagationStopped){h=!1;break}if(--o[n]===0){let c=a[n];for(delete a[n];c--;)this.removeEventListener(n,dc);delete o[n]}return h}disposeInternal(){this.listeners_&&jp(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,i){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const s=n.indexOf(i);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[s]=dc,++this.pendingRemovals_[t]):(n.splice(s,1),n.length===0&&delete this.listeners_[t]))}}const fc={CHANGE:"change"};function cr(e,t,i,n,s){if(n&&n!==e&&(i=i.bind(n)),s){const o=i;i=function(){e.removeEventListener(t,i),o.apply(this,arguments)}}const r={target:e,type:t,listener:i};return e.addEventListener(t,i),r}function of(e,t,i,n){return cr(e,t,i,n,!0)}function Io(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),jp(e))}class A2 extends b2{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(fc.CHANGE)}getRevision(){return this.revision_}onInternal(t,i){if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=cr(this,t[r],i);return s}return cr(this,t,i)}onceInternal(t,i){let n;if(Array.isArray(t)){const s=t.length;n=new Array(s);for(let r=0;r<s;++r)n[r]=of(this,t[r],i)}else n=of(this,t,i);return i.ol_key=n,n}unInternal(t,i){const n=i.ol_key;if(n)T2(n);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],i);else this.removeEventListener(t,i)}}function T2(e){if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)Io(e[t]);else Io(e)}function Ke(){throw new Error("Unimplemented abstract method.")}let R2=0;function P2(e){return e.ol_uid||(e.ol_uid=String(++R2))}class af extends gu{constructor(t,i,n){super(t),this.key=i,this.oldValue=n}}class mu extends A2{constructor(t){super(),this.on,this.once,this.un,P2(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let i;return this.values_&&this.values_.hasOwnProperty(t)&&(i=this.values_[t]),i}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,i){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new af(n,t,i)),n=v2.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new af(n,t,i))}addChangeListener(t,i){this.addEventListener(`change:${t}`,i)}removeChangeListener(t,i){this.removeEventListener(`change:${t}`,i)}set(t,i,n){const s=this.values_||(this.values_={});if(n)s[t]=i;else{const r=s[t];s[t]=i,r!==i&&this.notify(t,r)}}setProperties(t,i){for(const n in t)this.set(n,t[n],i)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,i){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],S2(this.values_)&&(this.values_=null),i||this.notify(t,n)}}}const ce={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};function Yn(e,t){if(!e)throw new Error(t)}function on(e,t,i){return Math.min(Math.max(e,t),i)}function G2(e,t,i,n,s,r){const o=s-i,a=r-n;if(o!==0||a!==0){const h=((e-i)*o+(t-n)*a)/(o*o+a*a);h>1?(i=s,n=r):h>0&&(i+=o*h,n+=a*h)}return ur(e,t,i,n)}function ur(e,t,i,n){const s=i-e,r=n-t;return s*s+r*r}function L2(e){return e*Math.PI/180}function hf(e,t){const i=e%t;return i*t<0?i+t:i}function O2(e,t,i){return e+i*(t-e)}class F2 extends mu{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const i=Object.assign({},t);typeof t.properties=="object"&&(delete i.properties,Object.assign(i,t.properties)),i[ce.OPACITY]=t.opacity!==void 0?t.opacity:1,Yn(typeof i[ce.OPACITY]=="number","Layer opacity must be a number"),i[ce.VISIBLE]=t.visible!==void 0?t.visible:!0,i[ce.Z_INDEX]=t.zIndex,i[ce.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,i[ce.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,i[ce.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,i[ce.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=i.className!==void 0?i.className:"ol-layer",delete i.className,this.setProperties(i),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const i=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return i.opacity=on(Math.round(this.getOpacity()*100)/100,0,1),i.visible=this.getVisible(),i.extent=this.getExtent(),i.zIndex=n===void 0&&!i.managed?1/0:n,i.maxResolution=this.getMaxResolution(),i.minResolution=Math.max(this.getMinResolution(),0),i.minZoom=this.getMinZoom(),i.maxZoom=this.getMaxZoom(),this.state_=i,i}getLayersArray(t){return Ke()}getLayerStatesArray(t){return Ke()}getExtent(){return this.get(ce.EXTENT)}getMaxResolution(){return this.get(ce.MAX_RESOLUTION)}getMinResolution(){return this.get(ce.MIN_RESOLUTION)}getMinZoom(){return this.get(ce.MIN_ZOOM)}getMaxZoom(){return this.get(ce.MAX_ZOOM)}getOpacity(){return this.get(ce.OPACITY)}getSourceState(){return Ke()}getVisible(){return this.get(ce.VISIBLE)}getZIndex(){return this.get(ce.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(ce.EXTENT,t)}setMaxResolution(t){this.set(ce.MAX_RESOLUTION,t)}setMinResolution(t){this.set(ce.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(ce.MAX_ZOOM,t)}setMinZoom(t){this.set(ce.MIN_ZOOM,t)}setOpacity(t){Yn(typeof t=="number","Layer opacity must be a number"),this.set(ce.OPACITY,t)}setVisible(t){this.set(ce.VISIBLE,t)}setZIndex(t){this.set(ce.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const N2={PRECOMPOSE:"precompose"},kn={ANIMATING:0,INTERACTING:1},Ri={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},D2=256,Bp={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let Vp=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Bp[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const da=6378137,ir=Math.PI*da,k2=[-ir,-ir,ir,ir],j2=[-180,-85,180,85],Pa=da*Math.log(Math.tan(Math.PI/2));class Us extends Vp{constructor(t){super({code:t,units:"m",extent:k2,global:!0,worldExtent:j2,getPointResolution:function(i,n){return i/Math.cosh(n[1]/da)}})}}const lf=[new Us("EPSG:3857"),new Us("EPSG:102100"),new Us("EPSG:102113"),new Us("EPSG:900913"),new Us("http://www.opengis.net/def/crs/EPSG/0/3857"),new Us("http://www.opengis.net/gml/srs/epsg.xml#3857")];function B2(e,t,i){const n=e.length;i=i>1?i:2,t===void 0&&(i>2?t=e.slice():t=new Array(n));for(let s=0;s<n;s+=i){t[s]=ir*e[s]/180;let r=da*Math.log(Math.tan(Math.PI*(+e[s+1]+90)/360));r>Pa?r=Pa:r<-Pa&&(r=-Pa),t[s+1]=r}return t}function V2(e,t,i){const n=e.length;i=i>1?i:2,t===void 0&&(i>2?t=e.slice():t=new Array(n));for(let s=0;s<n;s+=i)t[s]=180*e[s]/ir,t[s+1]=360*Math.atan(Math.exp(e[s+1]/da))/Math.PI-90;return t}const W2=6378137,cf=[-180,-90,180,90],z2=Math.PI*W2/180;class us extends Vp{constructor(t,i){super({code:t,units:"degrees",extent:cf,axisOrientation:i,global:!0,metersPerUnit:z2,worldExtent:cf})}}const uf=[new us("CRS:84"),new us("EPSG:4326","neu"),new us("urn:ogc:def:crs:OGC:1.3:CRS84"),new us("urn:ogc:def:crs:OGC:2:84"),new us("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new us("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new us("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let gc={};function Z2(e){return gc[e]||gc[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function U2(e,t){gc[e]=t}let dr={};function hh(e,t,i){const n=e.getCode(),s=t.getCode();n in dr||(dr[n]={}),dr[n][s]=i}function X2(e,t){let i;return e in dr&&t in dr[e]&&(i=dr[e][t]),i}const Be={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Wp(e,t,i){let n,s;return t<e[0]?n=e[0]-t:e[2]<t?n=t-e[2]:n=0,i<e[1]?s=e[1]-i:e[3]<i?s=i-e[3]:s=0,n*n+s*s}function $2(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function H2(e,t,i){return e[0]<=t&&t<=e[2]&&e[1]<=i&&i<=e[3]}function df(e,t){const i=e[0],n=e[1],s=e[2],r=e[3],o=t[0],a=t[1];let h=Be.UNKNOWN;return o<i?h=h|Be.LEFT:o>s&&(h=h|Be.RIGHT),a<n?h=h|Be.BELOW:a>r&&(h=h|Be.ABOVE),h===Be.UNKNOWN&&(h=Be.INTERSECTING),h}function zp(){return[1/0,1/0,-1/0,-1/0]}function pu(e,t,i,n,s){return s?(s[0]=e,s[1]=t,s[2]=i,s[3]=n,s):[e,t,i,n]}function Zp(e){return pu(1/0,1/0,-1/0,-1/0,e)}function Y2(e,t){const i=e[0],n=e[1];return pu(i,n,i,n,t)}function K2(e,t,i,n,s){const r=Zp(s);return Up(r,e,t,i,n)}function Up(e,t,i,n,s){for(;i<n;i+=s)q2(e,t[i],t[i+1]);return e}function q2(e,t,i){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],i),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],i)}function J2(e,t){let i;return i=t(Q2(e)),i||(i=t(tM(e)),i)||(i=t(sM(e)),i)||(i=t(nM(e)),i)?i:!1}function Q2(e){return[e[0],e[1]]}function tM(e){return[e[2],e[1]]}function lh(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function eM(e,t,i,n,s){const[r,o,a,h,c,u,m,p]=iM(e,t,i,n);return pu(Math.min(r,a,c,m),Math.min(o,h,u,p),Math.max(r,a,c,m),Math.max(o,h,u,p),s)}function iM(e,t,i,n){const s=t*n[0]/2,r=t*n[1]/2,o=Math.cos(i),a=Math.sin(i),h=s*o,c=s*a,u=r*o,m=r*a,p=e[0],y=e[1];return[p-h+m,y-c-u,p-h-m,y-c+u,p+h-m,y+c+u,p+h+m,y+c-u,p-h+m,y-c-u]}function Bo(e){return e[3]-e[1]}function nM(e){return[e[0],e[3]]}function sM(e){return[e[2],e[3]]}function _u(e){return e[2]-e[0]}function Xp(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function $p(e){return e[2]<e[0]||e[3]<e[1]}function rM(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}function oM(e,t,i){let n=!1;const s=df(e,t),r=df(e,i);if(s===Be.INTERSECTING||r===Be.INTERSECTING)n=!0;else{const o=e[0],a=e[1],h=e[2],c=e[3],u=t[0],m=t[1],p=i[0],y=i[1],w=(y-m)/(p-u);let v,I;r&Be.ABOVE&&!(s&Be.ABOVE)&&(v=p-(y-c)/w,n=v>=o&&v<=h),!n&&r&Be.RIGHT&&!(s&Be.RIGHT)&&(I=y-(p-h)*w,n=I>=a&&I<=c),!n&&r&Be.BELOW&&!(s&Be.BELOW)&&(v=p-(y-a)/w,n=v>=o&&v<=h),!n&&r&Be.LEFT&&!(s&Be.LEFT)&&(I=y-(p-o)*w,n=I>=a&&I<=c)}return n}function aM(e,t){return e[0]+=+t[0],e[1]+=+t[1],e}function ch(e,t){let i=!0;for(let n=e.length-1;n>=0;--n)if(e[n]!=t[n]){i=!1;break}return i}function hM(e,t){const i=Math.cos(t),n=Math.sin(t),s=e[0]*i-e[1]*n,r=e[1]*i+e[0]*n;return e[0]=s,e[1]=r,e}function lM(...e){console.warn(...e)}let mc=!0;function cM(e){mc=!1}function Hp(e,t){if(t!==void 0){for(let i=0,n=e.length;i<n;++i)t[i]=e[i];t=t}else t=e.slice();return t}function uM(e,t){if(t!==void 0&&e!==t){for(let i=0,n=e.length;i<n;++i)t[i]=e[i];e=t}return e}function dM(e){U2(e.getCode(),e),hh(e,e,Hp)}function fM(e){e.forEach(dM)}function Vo(e){return typeof e=="string"?Z2(e):e||null}function ff(e){fM(e),e.forEach(function(t){e.forEach(function(i){t!==i&&hh(t,i,Hp)})})}function gM(e,t,i,n){e.forEach(function(s){t.forEach(function(r){hh(s,r,i),hh(r,s,n)})})}function yu(e,t){return e?typeof e=="string"?Vo(e):e:Vo(t)}function mM(e,t){const i=e.getCode(),n=t.getCode();let s=X2(i,n);return s||(s=uM),s}function gf(e,t){const i=Vo(e),n=Vo(t);return mM(i,n)}function mf(e,t){return e}function jn(e,t){return mc&&!ch(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90&&(mc=!1,lM("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),e}function pM(e,t){return e}function Ga(e,t){return e}function _M(){ff(lf),ff(uf),gM(uf,lf,B2,V2)}_M();function pf(e,t,i){return(function(n,s,r,o,a){if(!n)return;if(!s&&!t)return n;const h=t?0:r[0]*s,c=t?0:r[1]*s,u=a?a[0]:0,m=a?a[1]:0;let p=e[0]+h/2+u,y=e[2]-h/2+u,w=e[1]+c/2+m,v=e[3]-c/2+m;p>y&&(p=(y+p)/2,y=p),w>v&&(w=(v+w)/2,v=w);let I=on(n[0],p,y),b=on(n[1],w,v);if(o&&i&&s){const T=30*s;I+=-T*Math.log(1+Math.max(0,p-n[0])/T)+T*Math.log(1+Math.max(0,n[0]-y)/T),b+=-T*Math.log(1+Math.max(0,w-n[1])/T)+T*Math.log(1+Math.max(0,n[1]-v)/T)}return[I,b]})}function yM(e){return e}function wu(e,t,i,n){const s=_u(t)/i[0],r=Bo(t)/i[1];return n?Math.min(e,Math.max(s,r)):Math.min(e,Math.min(s,r))}function vu(e,t,i){let n=Math.min(e,t);const s=50;return n*=Math.log(1+s*Math.max(0,e/t-1))/s+1,i&&(n=Math.max(n,i),n/=Math.log(1+s*Math.max(0,i/e-1))/s+1),on(n,i/2,t*2)}function wM(e,t,i,n){return t=t!==void 0?t:!0,(function(s,r,o,a){if(s!==void 0){const h=e[0],c=e[e.length-1],u=i?wu(h,i,o,n):h;if(a)return t?vu(s,u,c):on(s,c,u);const m=Math.min(u,s),p=Math.floor(kp(e,m,r));return e[p]>u&&p<e.length-1?e[p+1]:e[p]}})}function vM(e,t,i,n,s,r){return n=n!==void 0?n:!0,i=i!==void 0?i:0,(function(o,a,h,c){if(o!==void 0){const u=s?wu(t,s,h,r):t;if(c)return n?vu(o,u,i):on(o,i,u);const m=1e-9,p=Math.ceil(Math.log(t/u)/Math.log(e)-m),y=-a*(.5-m)+.5,w=Math.min(u,o),v=Math.floor(Math.log(t/w)/Math.log(e)+y),I=Math.max(p,v),b=t/Math.pow(e,I);return on(b,i,u)}})}function _f(e,t,i,n,s){return i=i!==void 0?i:!0,(function(r,o,a,h){if(r!==void 0){const c=n?wu(e,n,a,s):e;return!i||!h?on(r,t,c):vu(r,c,t)}})}function MM(e){if(e!==void 0)return 0}function yf(e){if(e!==void 0)return e}function IM(e){const t=2*Math.PI/e;return(function(i,n){if(n)return i;if(i!==void 0)return i=Math.floor(i/t+.5)*t,i})}function EM(e){const t=L2(5);return(function(i,n){return n||i===void 0?i:Math.abs(i)<=t?0:i})}function CM(e){return Math.pow(e,3)}function xM(e){return 1-CM(1-e)}function SM(e){return 3*e*e-2*e*e*e}new Array(6);function bM(){return[1,0,0,1,0,0]}function AM(e,t,i,n,s,r,o,a){const h=Math.sin(r),c=Math.cos(r);return e[0]=n*c,e[1]=s*h,e[2]=-n*h,e[3]=s*c,e[4]=o*n*c-a*n*h+t,e[5]=o*s*h+a*s*c+i,e}function TM(e,t,i,n,s,r){r=r||[];let o=0;for(let a=t;a<i;a+=n){const h=e[a],c=e[a+1];r[o++]=s[0]*h+s[2]*c+s[4],r[o++]=s[1]*h+s[3]*c+s[5]}return r&&r.length!=o&&(r.length=o),r}function RM(e,t,i,n,s,r,o){o=o||[];const a=Math.cos(s),h=Math.sin(s),c=r[0],u=r[1];let m=0;for(let p=t;p<i;p+=n){const y=e[p]-c,w=e[p+1]-u;o[m++]=c+y*a-w*h,o[m++]=u+y*h+w*a;for(let v=p+2;v<p+n;++v)o[m++]=e[v]}return o&&o.length!=m&&(o.length=m),o}function PM(e,t,i,n,s,r,o,a){a=a||[];const h=o[0],c=o[1];let u=0;for(let m=t;m<i;m+=n){const p=e[m]-h,y=e[m+1]-c;a[u++]=h+s*p,a[u++]=c+r*y;for(let w=m+2;w<m+n;++w)a[u++]=e[w]}return a&&a.length!=u&&(a.length=u),a}function GM(e,t,i,n,s,r,o){o=o||[];let a=0;for(let h=t;h<i;h+=n){o[a++]=e[h]+s,o[a++]=e[h+1]+r;for(let c=h+2;c<h+n;++c)o[a++]=e[c]}return o&&o.length!=a&&(o.length=a),o}const wf=bM();class LM extends mu{constructor(){super(),this.extent_=zp(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=x2((t,i,n)=>{if(!n)return this.getSimplifiedGeometry(i);const s=this.clone();return s.applyTransform(n),s.getSimplifiedGeometry(i)})}simplifyTransformed(t,i){return this.simplifyTransformedInternal(this.getRevision(),t,i)}clone(){return Ke()}closestPointXY(t,i,n,s){return Ke()}containsXY(t,i){const n=this.getClosestPoint([t,i]);return n[0]===t&&n[1]===i}getClosestPoint(t,i){return i=i||[NaN,NaN],this.closestPointXY(t[0],t[1],i,1/0),i}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return Ke()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const i=this.computeExtent(this.extent_);(isNaN(i[0])||isNaN(i[1]))&&Zp(i),this.extentRevision_=this.getRevision()}return rM(this.extent_,t)}rotate(t,i){Ke()}scale(t,i,n){Ke()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return Ke()}getType(){return Ke()}applyTransform(t){Ke()}intersectsExtent(t){return Ke()}translate(t,i){Ke()}transform(t,i){const n=Vo(t),s=n.getUnits()=="tile-pixels"?function(r,o,a){const h=n.getExtent(),c=n.getWorldExtent(),u=Bo(c)/Bo(h);return AM(wf,c[0],c[3],u,-u,0,0,0),TM(r,0,r.length,a,wf,o),gf(n,i)(r,o,a)}:gf(n,i);return this.applyTransform(s),this}}class Mu extends LM{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return K2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return Ke()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const i=this.getSimplifiedGeometryInternal(t);return i.getFlatCoordinates().length<this.flatCoordinates.length?i:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,i){this.stride=vf(t),this.layout=t,this.flatCoordinates=i}setCoordinates(t,i){Ke()}setLayout(t,i,n){let s;if(t)s=vf(t);else{for(let r=0;r<n;++r){if(i.length===0){this.layout="XY",this.stride=2;return}i=i[0]}s=i.length,t=OM(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,i){const n=this.getFlatCoordinates();if(n){const s=this.getStride();RM(n,0,n.length,s,t,i,n),this.changed()}}scale(t,i,n){i===void 0&&(i=t),n||(n=lh(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();PM(s,0,s.length,r,t,i,n,s),this.changed()}}translate(t,i){const n=this.getFlatCoordinates();if(n){const s=this.getStride();GM(n,0,n.length,s,t,i,n),this.changed()}}}function OM(e){let t;return e==2?t="XY":e==3?t="XYZ":e==4&&(t="XYZM"),t}function vf(e){let t;return e=="XY"?t=2:e=="XYZ"||e=="XYM"?t=3:e=="XYZM"&&(t=4),t}function Mf(e,t,i,n,s,r,o){const a=e[t],h=e[t+1],c=e[i]-a,u=e[i+1]-h;let m;if(c===0&&u===0)m=t;else{const p=((s-a)*c+(r-h)*u)/(c*c+u*u);if(p>1)m=i;else if(p>0){for(let y=0;y<n;++y)o[y]=O2(e[t+y],e[i+y],p);o.length=n;return}else m=t}for(let p=0;p<n;++p)o[p]=e[m+p];o.length=n}function Yp(e,t,i,n,s){let r=e[t],o=e[t+1];for(t+=n;t<i;t+=n){const a=e[t],h=e[t+1],c=ur(r,o,a,h);c>s&&(s=c),r=a,o=h}return s}function FM(e,t,i,n,s){for(let r=0,o=i.length;r<o;++r){const a=i[r];s=Yp(e,t,a,n,s),t=a}return s}function Kp(e,t,i,n,s,r,o,a,h,c,u){if(t==i)return c;let m,p;if(s===0){if(p=ur(o,a,e[t],e[t+1]),p<c){for(m=0;m<n;++m)h[m]=e[t+m];return h.length=n,p}return c}u=u||[NaN,NaN];let y=t+n;for(;y<i;)if(Mf(e,y-n,y,n,o,a,u),p=ur(o,a,u[0],u[1]),p<c){for(c=p,m=0;m<n;++m)h[m]=u[m];h.length=n,y+=n}else y+=n*Math.max((Math.sqrt(p)-Math.sqrt(c))/s|0,1);if(Mf(e,i-n,t,n,o,a,u),p=ur(o,a,u[0],u[1]),p<c){for(c=p,m=0;m<n;++m)h[m]=u[m];h.length=n}return c}function NM(e,t,i,n,s,r,o,a,h,c,u){u=u||[NaN,NaN];for(let m=0,p=i.length;m<p;++m){const y=i[m];c=Kp(e,t,y,n,s,r,o,a,h,c,u),t=y}return c}function DM(e,t,i,n){for(let s=0,r=i.length;s<r;++s)e[t++]=i[s];return t}function qp(e,t,i,n){for(let s=0,r=i.length;s<r;++s){const o=i[s];for(let a=0;a<n;++a)e[t++]=o[a]}return t}function kM(e,t,i,n,s){s=s||[];let r=0;for(let o=0,a=i.length;o<a;++o){const h=qp(e,t,i[o],n);s[r++]=h,t=h}return s.length=r,s}function jM(e,t,i,n,s,r,o){const a=(i-t)/n;if(a<3){for(;t<i;t+=n)r[o++]=e[t],r[o++]=e[t+1];return o}const h=new Array(a);h[0]=1,h[a-1]=1;const c=[t,i-n];let u=0;for(;c.length>0;){const m=c.pop(),p=c.pop();let y=0;const w=e[p],v=e[p+1],I=e[m],b=e[m+1];for(let T=p+n;T<m;T+=n){const P=e[T],G=e[T+1],k=G2(P,G,w,v,I,b);k>y&&(u=T,y=k)}y>s&&(h[(u-t)/n]=1,p+n<u&&c.push(p,u),u+n<m&&c.push(u,m))}for(let m=0;m<a;++m)h[m]&&(r[o++]=e[t+m*n],r[o++]=e[t+m*n+1]);return o}function Xs(e,t){return t*Math.round(e/t)}function BM(e,t,i,n,s,r,o){if(t==i)return o;let a=Xs(e[t],s),h=Xs(e[t+1],s);t+=n,r[o++]=a,r[o++]=h;let c,u;do if(c=Xs(e[t],s),u=Xs(e[t+1],s),t+=n,t==i)return r[o++]=c,r[o++]=u,o;while(c==a&&u==h);for(;t<i;){const m=Xs(e[t],s),p=Xs(e[t+1],s);if(t+=n,m==c&&p==u)continue;const y=c-a,w=u-h,v=m-a,I=p-h;if(y*I==w*v&&(y<0&&v<y||y==v||y>0&&v>y)&&(w<0&&I<w||w==I||w>0&&I>w)){c=m,u=p;continue}r[o++]=c,r[o++]=u,a=c,h=u,c=m,u=p}return r[o++]=c,r[o++]=u,o}function VM(e,t,i,n,s,r,o,a){for(let h=0,c=i.length;h<c;++h){const u=i[h];o=BM(e,t,u,n,s,r,o),a.push(o),t=u}return o}function Jp(e,t,i,n,s){s=s!==void 0?s:[];let r=0;for(let o=t;o<i;o+=n)s[r++]=e.slice(o,o+n);return s.length=r,s}function WM(e,t,i,n,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=i.length;o<a;++o){const h=i[o];s[r++]=Jp(e,t,h,n,s[r]),t=h}return s.length=r,s}function Qp(e,t,i,n){let s=0,r=e[i-n],o=e[i-n+1];for(;t<i;t+=n){const a=e[t],h=e[t+1];s+=o*a-r*h,r=a,o=h}return s/2}function zM(e,t,i,n){let s=0;for(let r=0,o=i.length;r<o;++r){const a=i[r];s+=Qp(e,t,a,n),t=a}return s}class Wo extends Mu{constructor(t,i){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,i!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(i,t):this.setCoordinates(t,i)}clone(){return new Wo(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,i,n,s){return s<Wp(this.getExtent(),t,i)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Yp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Kp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,i,n,s))}getArea(){return Qp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Jp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const i=[];return i.length=jM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new Wo(i,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=qp(this.flatCoordinates,0,t,this.stride),this.changed()}}let ZM=class t0 extends Mu{constructor(t,i){super(),this.setCoordinates(t,i)}clone(){const t=new t0(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,i,n,s){const r=this.flatCoordinates,o=ur(t,i,r[0],r[1]);if(o<s){const a=this.stride;for(let h=0;h<a;++h)n[h]=r[h];return n.length=a,o}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Y2(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return H2(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=DM(this.flatCoordinates,0,t,this.stride),this.changed()}};function UM(e,t,i,n,s){return!J2(s,function(o){return!Is(e,t,i,n,o[0],o[1])})}function Is(e,t,i,n,s,r){let o=0,a=e[i-n],h=e[i-n+1];for(;t<i;t+=n){const c=e[t],u=e[t+1];h<=r?u>r&&(c-a)*(r-h)-(s-a)*(u-h)>0&&o++:u<=r&&(c-a)*(r-h)-(s-a)*(u-h)<0&&o--,a=c,h=u}return o!==0}function e0(e,t,i,n,s,r){if(i.length===0||!Is(e,t,i[0],n,s,r))return!1;for(let o=1,a=i.length;o<a;++o)if(Is(e,i[o-1],i[o],n,s,r))return!1;return!0}function XM(e,t,i,n,s,r,o){let a,h,c,u,m,p,y;const w=s[r+1],v=[];for(let T=0,P=i.length;T<P;++T){const G=i[T];for(u=e[G-n],p=e[G-n+1],a=t;a<G;a+=n)m=e[a],y=e[a+1],(w<=p&&y<=w||p<=w&&w<=y)&&(c=(w-p)/(y-p)*(m-u)+u,v.push(c)),u=m,p=y}let I=NaN,b=-1/0;for(v.sort(I2),u=v[0],a=1,h=v.length;a<h;++a){m=v[a];const T=Math.abs(m-u);T>b&&(c=(u+m)/2,e0(e,t,i,n,c,w)&&(I=c,b=T)),u=m}return isNaN(I)&&(I=s[r]),[I,w,b]}function $M(e,t,i,n,s){let r;for(t+=n;t<i;t+=n)if(r=s(e.slice(t-n,t),e.slice(t,t+n)),r)return r;return!1}function i0(e,t,i,n,s){const r=Up(zp(),e,t,i,n);return Xp(s,r)?$2(s,r)||r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:$M(e,t,i,n,function(o,a){return oM(s,o,a)}):!1}function HM(e,t,i,n,s){return!!(i0(e,t,i,n,s)||Is(e,t,i,n,s[0],s[1])||Is(e,t,i,n,s[0],s[3])||Is(e,t,i,n,s[2],s[1])||Is(e,t,i,n,s[2],s[3]))}function YM(e,t,i,n,s){if(!HM(e,t,i[0],n,s))return!1;if(i.length===1)return!0;for(let r=1,o=i.length;r<o;++r)if(UM(e,i[r-1],i[r],n,s)&&!i0(e,i[r-1],i[r],n,s))return!1;return!0}function KM(e,t,i,n){for(;t<i-n;){for(let s=0;s<n;++s){const r=e[t+s];e[t+s]=e[i-n+s],e[i-n+s]=r}t+=n,i-=n}}function n0(e,t,i,n){let s=0,r=e[i-n],o=e[i-n+1];for(;t<i;t+=n){const a=e[t],h=e[t+1];s+=(a-r)*(h+o),r=a,o=h}return s===0?void 0:s>0}function qM(e,t,i,n,s){s=s!==void 0?s:!1;for(let r=0,o=i.length;r<o;++r){const a=i[r],h=n0(e,t,a,n);if(r===0){if(s&&h||!s&&!h)return!1}else if(s&&!h||!s&&h)return!1;t=a}return!0}function If(e,t,i,n,s){s=s!==void 0?s:!1;for(let r=0,o=i.length;r<o;++r){const a=i[r],h=n0(e,t,a,n);(r===0?s&&h||!s&&!h:s&&!h||!s&&h)&&KM(e,t,a,n),t=a}return t}class uh extends Mu{constructor(t,i,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,i!==void 0&&n?(this.setFlatCoordinates(i,t),this.ends_=n):this.setCoordinates(t,i)}appendLinearRing(t){this.flatCoordinates?E2(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new uh(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,i,n,s){return s<Wp(this.getExtent(),t,i)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(FM(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),NM(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,i,n,s))}containsXY(t,i){return e0(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,i)}getArea(){return zM(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let i;return t!==void 0?(i=this.getOrientedFlatCoordinates().slice(),If(i,0,this.ends_,this.stride,t)):i=this.flatCoordinates,WM(i,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=lh(this.getExtent());this.flatInteriorPoint_=XM(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new ZM(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Wo(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,i=this.flatCoordinates,n=this.ends_,s=[];let r=0;for(let o=0,a=n.length;o<a;++o){const h=n[o],c=new Wo(i.slice(r,h),t);s.push(c),r=h}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;qM(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=If(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const i=[],n=[];return i.length=VM(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),i,0,n),new uh(i,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return YM(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=kM(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Ef(e){if($p(e))throw new Error("Cannot create polygon from empty extent");const t=e[0],i=e[1],n=e[2],s=e[3],r=[t,i,t,s,n,s,n,i,t,i];return new uh(r,"XY",[r.length])}const Ml=0;class Cf extends mu{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=yu(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&cM(),t.center&&(t.center=jn(t.center,this.projection_)),t.extent&&(t.extent=Ga(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const i=Object.assign({},t);for(const a in Ri)delete i[a];this.setProperties(i,!0);const n=QM(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const s=JM(t),r=n.constraint,o=tI(t);this.constraints_={center:s,resolution:r,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let i=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const s=t||[0,0,0,0];i=i||[0,0,0,0];const r=this.getResolution(),o=r/2*(s[3]-i[3]+i[1]-s[1]),a=r/2*(s[0]-i[0]+i[2]-s[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(t){const i=this.getProperties();return i.resolution!==void 0?i.resolution=this.getResolution():i.zoom=this.getZoom(),i.center=this.getCenterInternal(),i.rotation=this.getRotation(),Object.assign({},i,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const i=new Array(arguments.length);for(let n=0;n<i.length;++n){let s=arguments[n];s.center&&(s=Object.assign({},s),s.center=jn(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=jn(s.anchor,this.getProjection())),i[n]=s}this.animateInternal.apply(this,i)}animateInternal(t){let i=arguments.length,n;i>1&&typeof arguments[i-1]=="function"&&(n=arguments[i-1],--i);let s=0;for(;s<i&&!this.isDef();++s){const u=arguments[s];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(s===i){n&&La(n,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,h=this.targetRotation_;const c=[];for(;s<i;++s){const u=arguments[s],m={start:r,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||SM,callback:n};if(u.center&&(m.sourceCenter=o,m.targetCenter=u.center.slice(),o=m.targetCenter),u.zoom!==void 0?(m.sourceResolution=a,m.targetResolution=this.getResolutionForZoom(u.zoom),a=m.targetResolution):u.resolution&&(m.sourceResolution=a,m.targetResolution=u.resolution,a=m.targetResolution),u.rotation!==void 0){m.sourceRotation=h;const p=hf(u.rotation-h+Math.PI,2*Math.PI)-Math.PI;m.targetRotation=h+p,h=m.targetRotation}eI(m)?m.complete=!0:r+=m.duration,c.push(m)}this.animations_.push(c),this.setHint(kn.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[kn.ANIMATING]>0}getInteracting(){return this.hints_[kn.INTERACTING]>0}cancelAnimations(){this.setHint(kn.ANIMATING,-this.hints_[kn.ANIMATING]);let t;for(let i=0,n=this.animations_.length;i<n;++i){const s=this.animations_[i];if(s[0].callback&&La(s[0].callback,!1),!t)for(let r=0,o=s.length;r<o;++r){const a=s[r];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let i=!1;for(let n=this.animations_.length-1;n>=0;--n){const s=this.animations_[n];let r=!0;for(let o=0,a=s.length;o<a;++o){const h=s[o];if(h.complete)continue;const c=t-h.start;let u=h.duration>0?c/h.duration:1;u>=1?(h.complete=!0,u=1):r=!1;const m=h.easing(u);if(h.sourceCenter){const p=h.sourceCenter[0],y=h.sourceCenter[1],w=h.targetCenter[0],v=h.targetCenter[1];this.nextCenter_=h.targetCenter;const I=p+m*(w-p),b=y+m*(v-y);this.targetCenter_=[I,b]}if(h.sourceResolution&&h.targetResolution){const p=m===1?h.targetResolution:h.sourceResolution+m*(h.targetResolution-h.sourceResolution);if(h.anchor){const y=this.getViewportSize_(this.getRotation()),w=this.constraints_.resolution(p,0,y,!0);this.targetCenter_=this.calculateCenterZoom(w,h.anchor)}this.nextResolution_=h.targetResolution,this.targetResolution_=p,this.applyTargetState_(!0)}if(h.sourceRotation!==void 0&&h.targetRotation!==void 0){const p=m===1?hf(h.targetRotation+Math.PI,2*Math.PI)-Math.PI:h.sourceRotation+m*(h.targetRotation-h.sourceRotation);if(h.anchor){const y=this.constraints_.rotation(p,!0);this.targetCenter_=this.calculateCenterRotate(y,h.anchor)}this.nextRotation_=h.targetRotation,this.targetRotation_=p}if(this.applyTargetState_(!0),i=!0,!h.complete)break}if(r){this.animations_[n]=null,this.setHint(kn.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=s[0].callback;o&&La(o,!0)}}this.animations_=this.animations_.filter(Boolean),i&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,i){let n;const s=this.getCenterInternal();return s!==void 0&&(n=[s[0]-i[0],s[1]-i[1]],hM(n,t-this.getRotation()),aM(n,i)),n}calculateCenterZoom(t,i){let n;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const o=i[0]-t*(i[0]-s[0])/r,a=i[1]-t*(i[1]-s[1])/r;n=[o,a]}return n}getViewportSize_(t){const i=this.viewportSize_;if(t){const n=i[0],s=i[1];return[Math.abs(n*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(s*Math.cos(t))]}return i}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&mf(t,this.getProjection())}getCenterInternal(){return this.get(Ri.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const i=this.calculateExtentInternal(t);return pM(i,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const i=this.getCenterInternal();Yn(i,"The view center is not defined");const n=this.getResolution();Yn(n!==void 0,"The view resolution is not defined");const s=this.getRotation();return Yn(s!==void 0,"The view rotation is not defined"),eM(i,n,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Ri.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,i){return this.getResolutionForExtentInternal(Ga(t,this.getProjection()),i)}getResolutionForExtentInternal(t,i){i=i||this.getViewportSizeMinusPadding_();const n=_u(t)/i[0],s=Bo(t)/i[1];return Math.max(n,s)}getResolutionForValueFunction(t){t=t||2;const i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(i/n)/Math.log(t);return(function(r){return i/Math.pow(t,r*s)})}getRotation(){return this.get(Ri.ROTATION)}getValueForResolutionFunction(t){const i=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(n/s)/i;return(function(o){return Math.log(n/o)/i/r})}getViewportSizeMinusPadding_(t){let i=this.getViewportSize_(t);const n=this.padding_;return n&&(i=[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]),i}getState(){const t=this.getProjection(),i=this.getResolution(),n=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();s=Il(s,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],i,n)}return{center:s.slice(0),projection:t!==void 0?t:null,resolution:i,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const i=this.getResolution();return i!==void 0&&(t=this.getZoomForResolution(i)),t}getZoomForResolution(t){let i=this.minZoom_||0,n,s;if(this.resolutions_){const r=kp(this.resolutions_,t,1);i=r,n=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=n/this.resolutions_[r+1]}else n=this.maxResolution_,s=this.zoomFactor_;return i+Math.log(n/t)/Math.log(s)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const i=on(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(n,on(t-i,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,i){let n;if(Yn(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Yn(!$p(t),"Cannot fit empty extent provided as `geometry`");const s=Ga(t,this.getProjection());n=Ef(s)}else if(t.getType()==="Circle"){const s=Ga(t.getExtent(),this.getProjection());n=Ef(s),n.rotate(this.getRotation(),lh(s))}else n=t;this.fitInternal(n,i)}rotatedExtentForGeometry(t){const i=this.getRotation(),n=Math.cos(i),s=Math.sin(-i),r=t.getFlatCoordinates(),o=t.getStride();let a=1/0,h=1/0,c=-1/0,u=-1/0;for(let m=0,p=r.length;m<p;m+=o){const y=r[m]*n-r[m+1]*s,w=r[m]*s+r[m+1]*n;a=Math.min(a,y),h=Math.min(h,w),c=Math.max(c,y),u=Math.max(u,w)}return[a,h,c,u]}fitInternal(t,i){i=i||{};let n=i.size;n||(n=this.getViewportSizeMinusPadding_());const s=i.padding!==void 0?i.padding:[0,0,0,0],r=i.nearest!==void 0?i.nearest:!1;let o;i.minResolution!==void 0?o=i.minResolution:i.maxZoom!==void 0?o=this.getResolutionForZoom(i.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let h=this.getResolutionForExtentInternal(a,[n[0]-s[1]-s[3],n[1]-s[0]-s[2]]);h=isNaN(h)?o:Math.max(h,o),h=this.getConstrainedResolution(h,r?0:1);const c=this.getRotation(),u=Math.sin(c),m=Math.cos(c),p=lh(a);p[0]+=(s[1]-s[3])/2*h,p[1]+=(s[0]-s[2])/2*h;const y=p[0]*m-p[1]*u,w=p[1]*m+p[0]*u,v=this.getConstrainedCenter([y,w],h),I=i.callback?i.callback:dc;i.duration!==void 0?this.animateInternal({resolution:h,center:v,duration:i.duration,easing:i.easing},I):(this.targetResolution_=h,this.targetCenter_=v,this.applyTargetState_(!1,!0),La(I,!0))}centerOn(t,i,n){this.centerOnInternal(jn(t,this.getProjection()),i,n)}centerOnInternal(t,i,n){this.setCenterInternal(Il(t,i,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,i,n,s){let r;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-n),h=Il(t,s,[a[0]/2+o[3],a[1]/2+o[0]],i,n);r=[t[0]-h[0],t[1]-h[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const i=mf(this.targetCenter_,this.getProjection());this.setCenter([i[0]+t[0],i[1]+t[1]])}adjustCenterInternal(t){const i=this.targetCenter_;this.setCenterInternal([i[0]+t[0],i[1]+t[1]])}adjustResolution(t,i){i=i&&jn(i,this.getProjection()),this.adjustResolutionInternal(t,i)}adjustResolutionInternal(t,i){const n=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,s,n);i&&(this.targetCenter_=this.calculateCenterZoom(r,i)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,i){this.adjustResolution(Math.pow(this.zoomFactor_,-t),i)}adjustRotation(t,i){i&&(i=jn(i,this.getProjection())),this.adjustRotationInternal(t,i)}adjustRotationInternal(t,i){const n=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,n);i&&(this.targetCenter_=this.calculateCenterRotate(s,i)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&jn(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,i){return this.hints_[t]+=i,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,i){const n=this.getAnimating()||this.getInteracting()||i,s=this.constraints_.rotation(this.targetRotation_,n),r=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,0,r,n),a=this.constraints_.center(this.targetCenter_,o,r,n,this.calculateCenterShift(this.targetCenter_,o,s,r));this.get(Ri.ROTATION)!==s&&this.set(Ri.ROTATION,s),this.get(Ri.RESOLUTION)!==o&&(this.set(Ri.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Ri.CENTER)||!ch(this.get(Ri.CENTER),a))&&this.set(Ri.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,i,n){t=t!==void 0?t:200;const s=i||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,s,o),h=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=h,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!ch(this.getCenterInternal(),h))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:h,resolution:a,duration:t,easing:xM,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(kn.INTERACTING,1)}endInteraction(t,i,n){n=n&&jn(n,this.getProjection()),this.endInteractionInternal(t,i,n)}endInteractionInternal(t,i,n){this.getInteracting()&&(this.setHint(kn.INTERACTING,-1),this.resolveConstraints(t,i,n))}getConstrainedCenter(t,i){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,i||this.getResolution(),n)}getConstrainedZoom(t,i){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,i))}getConstrainedResolution(t,i){i=i||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,i,n)}}function La(e,t){setTimeout(function(){e(t)},0)}function JM(e){if(e.extent!==void 0){const i=e.smoothExtentConstraint!==void 0?e.smoothExtentConstraint:!0;return pf(e.extent,e.constrainOnlyCenter,i)}const t=yu(e.projection,"EPSG:3857");if(e.multiWorld!==!0&&t.isGlobal()){const i=t.getExtent().slice();return i[0]=-1/0,i[2]=1/0,pf(i,!1,!1)}return yM}function QM(e){let t,i,n,o=e.minZoom!==void 0?e.minZoom:Ml,a=e.maxZoom!==void 0?e.maxZoom:28;const h=e.zoomFactor!==void 0?e.zoomFactor:2,c=e.multiWorld!==void 0?e.multiWorld:!1,u=e.smoothResolutionConstraint!==void 0?e.smoothResolutionConstraint:!0,m=e.showFullExtent!==void 0?e.showFullExtent:!1,p=yu(e.projection,"EPSG:3857"),y=p.getExtent();let w=e.constrainOnlyCenter,v=e.extent;if(!c&&!v&&p.isGlobal()&&(w=!1,v=y),e.resolutions!==void 0){const I=e.resolutions;i=I[o],n=I[a]!==void 0?I[a]:I[I.length-1],e.constrainResolution?t=wM(I,u,!w&&v,m):t=_f(i,n,u,!w&&v,m)}else{const b=(y?Math.max(_u(y),Bo(y)):360*Bp.degrees/p.getMetersPerUnit())/D2/Math.pow(2,Ml),T=b/Math.pow(2,28-Ml);i=e.maxResolution,i!==void 0?o=0:i=b/Math.pow(h,o),n=e.minResolution,n===void 0&&(e.maxZoom!==void 0?e.maxResolution!==void 0?n=i/Math.pow(h,a):n=b/Math.pow(h,a):n=T),a=o+Math.floor(Math.log(i/n)/Math.log(h)),n=i/Math.pow(h,a-o),e.constrainResolution?t=vM(h,i,n,u,!w&&v,m):t=_f(i,n,u,!w&&v,m)}return{constraint:t,maxResolution:i,minResolution:n,minZoom:o,zoomFactor:h}}function tI(e){if(e.enableRotation!==void 0?e.enableRotation:!0){const i=e.constrainRotation;return i===void 0||i===!0?EM():i===!1?yf:typeof i=="number"?IM(i):yf}return MM}function eI(e){return!(e.sourceCenter&&e.targetCenter&&!ch(e.sourceCenter,e.targetCenter)||e.sourceResolution!==e.targetResolution||e.sourceRotation!==e.targetRotation)}function Il(e,t,i,n,s){const r=Math.cos(-s);let o=Math.sin(-s),a=e[0]*r-e[1]*o,h=e[1]*r+e[0]*o;a+=(t[0]/2-i[0])*n,h+=(i[1]-t[1]/2)*n,o=-o;const c=a*r-h*o,u=h*r+a*o;return[c,u]}class iI extends F2{constructor(t){const i=Object.assign({},t);delete i.source,super(i),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(ce.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(ce.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Io(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=cr(t,fc.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let i;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof Cf?i={viewState:t.getState(),extent:t.calculateExtent()}:i=t,!i.layerStatesArray&&n&&(i.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let s;i.layerStatesArray?s=i.layerStatesArray.find(o=>o.layer===this):s=this.getLayerState();const r=this.getExtent();return nI(s,i.viewState)&&(!r||Xp(r,i.extent))}getAttributions(t){if(!this.isVisible(t))return[];let i;const n=this.getSource();if(n&&(i=n.getAttributions()),!i)return[];const s=t instanceof Cf?t.getViewStateAndExtent():t;let r=i(s);return Array.isArray(r)||(r=[r]),r}render(t,i){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,i)):null}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set(ce.MAP,t)}getMapInternal(){return this.get(ce.MAP)}setMap(t){this.mapPrecomposeKey_&&(Io(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Io(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=cr(t,N2.PRECOMPOSE,function(i){const s=i.frameState.layerStatesArray,r=this.getLayerState(!1);Yn(!s.some(function(o){return o.layer===r.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),s.push(r)},this),this.mapRenderKey_=cr(this,fc.CHANGE,t.render,t),this.changed())}setSource(t){this.set(ce.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function nI(e,t){if(!e.visible)return!1;const i=t.resolution;if(i<e.minResolution||i>=e.maxResolution)return!1;const n=t.zoom;return n>e.minZoom&&n<=e.maxZoom}var s0=typeof global=="object"&&global&&global.Object===Object&&global,sI=typeof self=="object"&&self&&self.Object===Object&&self,Vi=s0||sI||Function("return this")(),wr=Vi.Symbol,r0=Object.prototype,rI=r0.hasOwnProperty,oI=r0.toString,Qr=wr?wr.toStringTag:void 0;function aI(e){var t=rI.call(e,Qr),i=e[Qr];try{e[Qr]=void 0;var n=!0}catch{}var s=oI.call(e);return n&&(t?e[Qr]=i:delete e[Qr]),s}var hI=Object.prototype,lI=hI.toString;function cI(e){return lI.call(e)}var uI="[object Null]",dI="[object Undefined]",xf=wr?wr.toStringTag:void 0;function Pr(e){return e==null?e===void 0?dI:uI:xf&&xf in Object(e)?aI(e):cI(e)}function Gr(e){return e!=null&&typeof e=="object"}var fI="[object Symbol]";function gI(e){return typeof e=="symbol"||Gr(e)&&Pr(e)==fI}var Iu=Array.isArray,mI=/\s/;function pI(e){for(var t=e.length;t--&&mI.test(e.charAt(t)););return t}var _I=/^\s+/;function yI(e){return e&&e.slice(0,pI(e)+1).replace(_I,"")}function is(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Sf=NaN,wI=/^[-+]0x[0-9a-f]+$/i,vI=/^0b[01]+$/i,MI=/^0o[0-7]+$/i,II=parseInt;function bf(e){if(typeof e=="number")return e;if(gI(e))return Sf;if(is(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=is(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=yI(e);var i=vI.test(e);return i||MI.test(e)?II(e.slice(2),i?2:8):wI.test(e)?Sf:+e}var EI="[object AsyncFunction]",CI="[object Function]",xI="[object GeneratorFunction]",SI="[object Proxy]";function o0(e){if(!is(e))return!1;var t=Pr(e);return t==CI||t==xI||t==EI||t==SI}var El=Vi["__core-js_shared__"],Af=(function(){var e=/[^.]+$/.exec(El&&El.keys&&El.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""})();function bI(e){return!!Af&&Af in e}var AI=Function.prototype,TI=AI.toString;function ks(e){if(e!=null){try{return TI.call(e)}catch{}try{return e+""}catch{}}return""}var RI=/[\\^$.*+?()[\]{}|]/g,PI=/^\[object .+?Constructor\]$/,GI=Function.prototype,LI=Object.prototype,OI=GI.toString,FI=LI.hasOwnProperty,NI=RegExp("^"+OI.call(FI).replace(RI,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function DI(e){if(!is(e)||bI(e))return!1;var t=o0(e)?NI:PI;return t.test(ks(e))}function kI(e,t){return e?.[t]}function js(e,t){var i=kI(e,t);return DI(i)?i:void 0}var pc=js(Vi,"WeakMap"),Tf=Object.create,jI=(function(){function e(){}return function(t){if(!is(t))return{};if(Tf)return Tf(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}})(),Rf=(function(){try{var e=js(Object,"defineProperty");return e({},"",{}),e}catch{}})();function BI(e,t){for(var i=-1,n=e==null?0:e.length;++i<n&&t(e[i],i,e)!==!1;);return e}var VI=9007199254740991,WI=/^(?:0|[1-9]\d*)$/;function zI(e,t){var i=typeof e;return t=t??VI,!!t&&(i=="number"||i!="symbol"&&WI.test(e))&&e>-1&&e%1==0&&e<t}function ZI(e,t,i){t=="__proto__"&&Rf?Rf(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}function a0(e,t){return e===t||e!==e&&t!==t}var UI=Object.prototype,XI=UI.hasOwnProperty;function $I(e,t,i){var n=e[t];(!(XI.call(e,t)&&a0(n,i))||i===void 0&&!(t in e))&&ZI(e,t,i)}var HI=9007199254740991;function h0(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=HI}function YI(e){return e!=null&&h0(e.length)&&!o0(e)}var KI=Object.prototype;function l0(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||KI;return e===i}function qI(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}var JI="[object Arguments]";function Pf(e){return Gr(e)&&Pr(e)==JI}var c0=Object.prototype,QI=c0.hasOwnProperty,tE=c0.propertyIsEnumerable,eE=Pf((function(){return arguments})())?Pf:function(e){return Gr(e)&&QI.call(e,"callee")&&!tE.call(e,"callee")};function iE(){return!1}var u0=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Gf=u0&&typeof module=="object"&&module&&!module.nodeType&&module,nE=Gf&&Gf.exports===u0,Lf=nE?Vi.Buffer:void 0,sE=Lf?Lf.isBuffer:void 0,d0=sE||iE,rE="[object Arguments]",oE="[object Array]",aE="[object Boolean]",hE="[object Date]",lE="[object Error]",cE="[object Function]",uE="[object Map]",dE="[object Number]",fE="[object Object]",gE="[object RegExp]",mE="[object Set]",pE="[object String]",_E="[object WeakMap]",yE="[object ArrayBuffer]",wE="[object DataView]",vE="[object Float32Array]",ME="[object Float64Array]",IE="[object Int8Array]",EE="[object Int16Array]",CE="[object Int32Array]",xE="[object Uint8Array]",SE="[object Uint8ClampedArray]",bE="[object Uint16Array]",AE="[object Uint32Array]",ge={};ge[vE]=ge[ME]=ge[IE]=ge[EE]=ge[CE]=ge[xE]=ge[SE]=ge[bE]=ge[AE]=!0;ge[rE]=ge[oE]=ge[yE]=ge[aE]=ge[wE]=ge[hE]=ge[lE]=ge[cE]=ge[uE]=ge[dE]=ge[fE]=ge[gE]=ge[mE]=ge[pE]=ge[_E]=!1;function TE(e){return Gr(e)&&h0(e.length)&&!!ge[Pr(e)]}function Eu(e){return function(t){return e(t)}}var f0=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Eo=f0&&typeof module=="object"&&module&&!module.nodeType&&module,RE=Eo&&Eo.exports===f0,Cl=RE&&s0.process,vr=(function(){try{var e=Eo&&Eo.require&&Eo.require("util").types;return e||Cl&&Cl.binding&&Cl.binding("util")}catch{}})(),Of=vr&&vr.isTypedArray,PE=Of?Eu(Of):TE,GE=Object.prototype,LE=GE.hasOwnProperty;function OE(e,t){var i=Iu(e),n=!i&&eE(e),s=!i&&!n&&d0(e),r=!i&&!n&&!s&&PE(e),o=i||n||s||r,a=o?qI(e.length,String):[],h=a.length;for(var c in e)LE.call(e,c)&&!(o&&(c=="length"||s&&(c=="offset"||c=="parent")||r&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||zI(c,h)))&&a.push(c);return a}function g0(e,t){return function(i){return e(t(i))}}var FE=g0(Object.keys,Object),NE=Object.prototype,DE=NE.hasOwnProperty;function kE(e){if(!l0(e))return FE(e);var t=[];for(var i in Object(e))DE.call(e,i)&&i!="constructor"&&t.push(i);return t}function jE(e){return YI(e)?OE(e):kE(e)}var zo=js(Object,"create");function BE(){this.__data__=zo?zo(null):{},this.size=0}function VE(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var WE="__lodash_hash_undefined__",zE=Object.prototype,ZE=zE.hasOwnProperty;function UE(e){var t=this.__data__;if(zo){var i=t[e];return i===WE?void 0:i}return ZE.call(t,e)?t[e]:void 0}var XE=Object.prototype,$E=XE.hasOwnProperty;function HE(e){var t=this.__data__;return zo?t[e]!==void 0:$E.call(t,e)}var YE="__lodash_hash_undefined__";function KE(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=zo&&t===void 0?YE:t,this}function As(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}As.prototype.clear=BE;As.prototype.delete=VE;As.prototype.get=UE;As.prototype.has=HE;As.prototype.set=KE;function qE(){this.__data__=[],this.size=0}function Uh(e,t){for(var i=e.length;i--;)if(a0(e[i][0],t))return i;return-1}var JE=Array.prototype,QE=JE.splice;function tC(e){var t=this.__data__,i=Uh(t,e);if(i<0)return!1;var n=t.length-1;return i==n?t.pop():QE.call(t,i,1),--this.size,!0}function eC(e){var t=this.__data__,i=Uh(t,e);return i<0?void 0:t[i][1]}function iC(e){return Uh(this.__data__,e)>-1}function nC(e,t){var i=this.__data__,n=Uh(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this}function An(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}An.prototype.clear=qE;An.prototype.delete=tC;An.prototype.get=eC;An.prototype.has=iC;An.prototype.set=nC;var Zo=js(Vi,"Map");function sC(){this.size=0,this.__data__={hash:new As,map:new(Zo||An),string:new As}}function rC(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Xh(e,t){var i=e.__data__;return rC(t)?i[typeof t=="string"?"string":"hash"]:i.map}function oC(e){var t=Xh(this,e).delete(e);return this.size-=t?1:0,t}function aC(e){return Xh(this,e).get(e)}function hC(e){return Xh(this,e).has(e)}function lC(e,t){var i=Xh(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this}function Lr(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}Lr.prototype.clear=sC;Lr.prototype.delete=oC;Lr.prototype.get=aC;Lr.prototype.has=hC;Lr.prototype.set=lC;function cC(e,t){for(var i=-1,n=t.length,s=e.length;++i<n;)e[s+i]=t[i];return e}var uC=g0(Object.getPrototypeOf,Object);function dC(){this.__data__=new An,this.size=0}function fC(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}function gC(e){return this.__data__.get(e)}function mC(e){return this.__data__.has(e)}var pC=200;function _C(e,t){var i=this.__data__;if(i instanceof An){var n=i.__data__;if(!Zo||n.length<pC-1)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new Lr(n)}return i.set(e,t),this.size=i.size,this}function Or(e){var t=this.__data__=new An(e);this.size=t.size}Or.prototype.clear=dC;Or.prototype.delete=fC;Or.prototype.get=gC;Or.prototype.has=mC;Or.prototype.set=_C;var m0=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ff=m0&&typeof module=="object"&&module&&!module.nodeType&&module,yC=Ff&&Ff.exports===m0,Nf=yC?Vi.Buffer:void 0;Nf&&Nf.allocUnsafe;function wC(e,t){return e.slice()}function vC(e,t){for(var i=-1,n=e==null?0:e.length,s=0,r=[];++i<n;){var o=e[i];t(o,i,e)&&(r[s++]=o)}return r}function MC(){return[]}var IC=Object.prototype,EC=IC.propertyIsEnumerable,Df=Object.getOwnPropertySymbols,CC=Df?function(e){return e==null?[]:(e=Object(e),vC(Df(e),function(t){return EC.call(e,t)}))}:MC;function xC(e,t,i){var n=t(e);return Iu(e)?n:cC(n,i(e))}function SC(e){return xC(e,jE,CC)}var _c=js(Vi,"DataView"),yc=js(Vi,"Promise"),wc=js(Vi,"Set"),kf="[object Map]",bC="[object Object]",jf="[object Promise]",Bf="[object Set]",Vf="[object WeakMap]",Wf="[object DataView]",AC=ks(_c),TC=ks(Zo),RC=ks(yc),PC=ks(wc),GC=ks(pc),vn=Pr;(_c&&vn(new _c(new ArrayBuffer(1)))!=Wf||Zo&&vn(new Zo)!=kf||yc&&vn(yc.resolve())!=jf||wc&&vn(new wc)!=Bf||pc&&vn(new pc)!=Vf)&&(vn=function(e){var t=Pr(e),i=t==bC?e.constructor:void 0,n=i?ks(i):"";if(n)switch(n){case AC:return Wf;case TC:return kf;case RC:return jf;case PC:return Bf;case GC:return Vf}return t});var LC=Object.prototype,OC=LC.hasOwnProperty;function FC(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&OC.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var zf=Vi.Uint8Array;function Cu(e){var t=new e.constructor(e.byteLength);return new zf(t).set(new zf(e)),t}function NC(e,t){var i=Cu(e.buffer);return new e.constructor(i,e.byteOffset,e.byteLength)}var DC=/\w*$/;function kC(e){var t=new e.constructor(e.source,DC.exec(e));return t.lastIndex=e.lastIndex,t}var Zf=wr?wr.prototype:void 0,Uf=Zf?Zf.valueOf:void 0;function jC(e){return Uf?Object(Uf.call(e)):{}}function BC(e,t){var i=Cu(e.buffer);return new e.constructor(i,e.byteOffset,e.length)}var VC="[object Boolean]",WC="[object Date]",zC="[object Map]",ZC="[object Number]",UC="[object RegExp]",XC="[object Set]",$C="[object String]",HC="[object Symbol]",YC="[object ArrayBuffer]",KC="[object DataView]",qC="[object Float32Array]",JC="[object Float64Array]",QC="[object Int8Array]",tx="[object Int16Array]",ex="[object Int32Array]",ix="[object Uint8Array]",nx="[object Uint8ClampedArray]",sx="[object Uint16Array]",rx="[object Uint32Array]";function ox(e,t,i){var n=e.constructor;switch(t){case YC:return Cu(e);case VC:case WC:return new n(+e);case KC:return NC(e);case qC:case JC:case QC:case tx:case ex:case ix:case nx:case sx:case rx:return BC(e);case zC:return new n;case ZC:case $C:return new n(e);case UC:return kC(e);case XC:return new n;case HC:return jC(e)}}function ax(e){return typeof e.constructor=="function"&&!l0(e)?jI(uC(e)):{}}var hx="[object Map]";function lx(e){return Gr(e)&&vn(e)==hx}var Xf=vr&&vr.isMap,cx=Xf?Eu(Xf):lx,ux="[object Set]";function dx(e){return Gr(e)&&vn(e)==ux}var $f=vr&&vr.isSet,fx=$f?Eu($f):dx,p0="[object Arguments]",gx="[object Array]",mx="[object Boolean]",px="[object Date]",_x="[object Error]",_0="[object Function]",yx="[object GeneratorFunction]",wx="[object Map]",vx="[object Number]",y0="[object Object]",Mx="[object RegExp]",Ix="[object Set]",Ex="[object String]",Cx="[object Symbol]",xx="[object WeakMap]",Sx="[object ArrayBuffer]",bx="[object DataView]",Ax="[object Float32Array]",Tx="[object Float64Array]",Rx="[object Int8Array]",Px="[object Int16Array]",Gx="[object Int32Array]",Lx="[object Uint8Array]",Ox="[object Uint8ClampedArray]",Fx="[object Uint16Array]",Nx="[object Uint32Array]",de={};de[p0]=de[gx]=de[Sx]=de[bx]=de[mx]=de[px]=de[Ax]=de[Tx]=de[Rx]=de[Px]=de[Gx]=de[wx]=de[vx]=de[y0]=de[Mx]=de[Ix]=de[Ex]=de[Cx]=de[Lx]=de[Ox]=de[Fx]=de[Nx]=!0;de[_x]=de[_0]=de[xx]=!1;function $a(e,t,i,n,s,r){var o;if(o!==void 0)return o;if(!is(e))return e;var a=Iu(e);if(a)o=FC(e);else{var h=vn(e),c=h==_0||h==yx;if(d0(e))return wC(e);if(h==y0||h==p0||c&&!s)o=c?{}:ax(e);else{if(!de[h])return s?e:{};o=ox(e,h)}}r||(r=new Or);var u=r.get(e);if(u)return u;r.set(e,o),fx(e)?e.forEach(function(y){o.add($a(y,t,i,y,e,r))}):cx(e)&&e.forEach(function(y,w){o.set(w,$a(y,t,i,w,e,r))});var m=SC,p=a?void 0:m(e);return BI(p||e,function(y,w){p&&(w=y,y=e[w]),$I(o,w,$a(y,t,i,w,e,r))}),o}var Dx=1,kx=4;function Hf(e){return $a(e,Dx|kx)}var xl=function(){return Vi.Date.now()},jx="Expected a function",Bx=Math.max,Vx=Math.min;function Wx(e,t,i){var n,s,r,o,a,h,c=0,u=!1,m=!1,p=!0;if(typeof e!="function")throw new TypeError(jx);t=bf(t)||0,is(i)&&(u=!!i.leading,m="maxWait"in i,r=m?Bx(bf(i.maxWait)||0,t):r,p="trailing"in i?!!i.trailing:p);function y(O){var U=n,Y=s;return n=s=void 0,c=O,o=e.apply(Y,U),o}function w(O){return c=O,a=setTimeout(b,t),u?y(O):o}function v(O){var U=O-h,Y=O-c,W=t-U;return m?Vx(W,r-Y):W}function I(O){var U=O-h,Y=O-c;return h===void 0||U>=t||U<0||m&&Y>=r}function b(){var O=xl();if(I(O))return T(O);a=setTimeout(b,v(O))}function T(O){return a=void 0,p&&n?y(O):(n=s=void 0,o)}function P(){a!==void 0&&clearTimeout(a),c=0,n=h=s=a=void 0}function G(){return a===void 0?o:T(xl())}function k(){var O=xl(),U=I(O);if(n=arguments,s=this,h=O,U){if(a===void 0)return w(h);if(m)return clearTimeout(a),a=setTimeout(b,t),y(h)}return a===void 0&&(a=setTimeout(b,t)),o}return k.cancel=P,k.flush=G,k}var zx="Expected a function";function vc(e,t,i){var n=!0,s=!0;if(typeof e!="function")throw new TypeError(zx);return is(i)&&(n="leading"in i?!!i.leading:n,s="trailing"in i?!!i.trailing:s),Wx(e,t,{leading:n,maxWait:t,trailing:s})}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const w0=Symbol("Comlink.proxy"),Zx=Symbol("Comlink.endpoint"),Ux=Symbol("Comlink.releaseProxy"),Sl=Symbol("Comlink.finalizer"),Ha=Symbol("Comlink.thrown"),v0=e=>typeof e=="object"&&e!==null||typeof e=="function",Xx={canHandle:e=>v0(e)&&e[w0],serialize(e){const{port1:t,port2:i}=new MessageChannel;return I0(e,t),[i,[i]]},deserialize(e){return e.start(),C0(e)}},$x={canHandle:e=>v0(e)&&Ha in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},M0=new Map([["proxy",Xx],["throw",$x]]);function Hx(e,t){for(const i of e)if(t===i||i==="*"||i instanceof RegExp&&i.test(t))return!0;return!1}function I0(e,t=globalThis,i=["*"]){t.addEventListener("message",function n(s){if(!s||!s.data)return;if(!Hx(i,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:r,type:o,path:a}=Object.assign({path:[]},s.data),h=(s.data.argumentList||[]).map(ws);let c;try{const u=a.slice(0,-1).reduce((p,y)=>p[y],e),m=a.reduce((p,y)=>p[y],e);switch(o){case"GET":c=m;break;case"SET":u[a.slice(-1)[0]]=ws(s.data.value),c=!0;break;case"APPLY":c=m.apply(u,h);break;case"CONSTRUCT":{const p=new m(...h);c=b0(p)}break;case"ENDPOINT":{const{port1:p,port2:y}=new MessageChannel;I0(e,y),c=Qx(p,[p])}break;case"RELEASE":c=void 0;break;default:return}}catch(u){c={value:u,[Ha]:0}}Promise.resolve(c).catch(u=>({value:u,[Ha]:0})).then(u=>{const[m,p]=gh(u);t.postMessage(Object.assign(Object.assign({},m),{id:r}),p),o==="RELEASE"&&(t.removeEventListener("message",n),E0(t),Sl in e&&typeof e[Sl]=="function"&&e[Sl]())}).catch(u=>{const[m,p]=gh({value:new TypeError("Unserializable return value"),[Ha]:0});t.postMessage(Object.assign(Object.assign({},m),{id:r}),p)})}),t.start&&t.start()}function Yx(e){return e.constructor.name==="MessagePort"}function E0(e){Yx(e)&&e.close()}function C0(e,t){const i=new Map;return e.addEventListener("message",function(s){const{data:r}=s;if(!r||!r.id)return;const o=i.get(r.id);if(o)try{o(r)}finally{i.delete(r.id)}}),Mc(e,i,[],t)}function Oa(e){if(e)throw new Error("Proxy has been released and is not useable")}function x0(e){return Js(e,new Map,{type:"RELEASE"}).then(()=>{E0(e)})}const dh=new WeakMap,fh="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(dh.get(e)||0)-1;dh.set(e,t),t===0&&x0(e)});function Kx(e,t){const i=(dh.get(t)||0)+1;dh.set(t,i),fh&&fh.register(e,t,e)}function qx(e){fh&&fh.unregister(e)}function Mc(e,t,i=[],n=function(){}){let s=!1;const r=new Proxy(n,{get(o,a){if(Oa(s),a===Ux)return()=>{qx(r),x0(e),t.clear(),s=!0};if(a==="then"){if(i.length===0)return{then:()=>r};const h=Js(e,t,{type:"GET",path:i.map(c=>c.toString())}).then(ws);return h.then.bind(h)}return Mc(e,t,[...i,a])},set(o,a,h){Oa(s);const[c,u]=gh(h);return Js(e,t,{type:"SET",path:[...i,a].map(m=>m.toString()),value:c},u).then(ws)},apply(o,a,h){Oa(s);const c=i[i.length-1];if(c===Zx)return Js(e,t,{type:"ENDPOINT"}).then(ws);if(c==="bind")return Mc(e,t,i.slice(0,-1));const[u,m]=Yf(h);return Js(e,t,{type:"APPLY",path:i.map(p=>p.toString()),argumentList:u},m).then(ws)},construct(o,a){Oa(s);const[h,c]=Yf(a);return Js(e,t,{type:"CONSTRUCT",path:i.map(u=>u.toString()),argumentList:h},c).then(ws)}});return Kx(r,e),r}function Jx(e){return Array.prototype.concat.apply([],e)}function Yf(e){const t=e.map(gh);return[t.map(i=>i[0]),Jx(t.map(i=>i[1]))]}const S0=new WeakMap;function Qx(e,t){return S0.set(e,t),e}function b0(e){return Object.assign(e,{[w0]:!0})}function gh(e){for(const[t,i]of M0)if(i.canHandle(e)){const[n,s]=i.serialize(e);return[{type:"HANDLER",name:t,value:n},s]}return[{type:"RAW",value:e},S0.get(e)||[]]}function ws(e){switch(e.type){case"HANDLER":return M0.get(e.name).deserialize(e.value);case"RAW":return e.value}}function Js(e,t,i,n){return new Promise(s=>{const r=tS();t.set(r,s),e.start&&e.start(),e.postMessage(Object.assign({id:r},i),n)})}function tS(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}async function eS(e,t,i){let n;if(typeof i=="function"?n=await i(e,t):n=await fetch(e,t),!n.ok){const s=await n.json();throw s&&s.error?new Error(s.error):n.statusText?new Error(n.statusText):n.status===404?new Error(`Not found: ${e} (404)`):n.status===500?new Error("Internal server error (500)"):new Error(`Failed to fetch: ${e} (${n.status})`)}return n}async function iS(e,t,i){return await(await eS(e,t,i)).json()}async function nS(e,t,i){return await iS(`${e}/info.json`,t,i)}function sS(e,t={}){const{sorted:i}=t;i||(e=e.slice().sort(rS));const n=e.length,s=new Array(n*2);let r=0;for(let a=0;a<n;a++){const h=e[a];for(;r>=2&&Kf(s[r-2],s[r-1],h)<=0;)r--;s[r++]=h}const o=r+1;for(let a=n-2;a>=0;a--){const h=e[a];for(;r>=o&&Kf(s[r-2],s[r-1],h)<=0;)r--;s[r++]=h}return s.slice(0,r-1)}function Kf(e,t,i){return(t[1]-e[1])*(i[0]-e[0])-(t[0]-e[0])*(i[1]-e[1])}function rS(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}function oS(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return A0(e);case"FeatureCollection":return aS(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return xu(e);default:throw new Error("unknown GeoJSON type")}}function A0(e){const t={type:"Feature"};return Object.keys(e).forEach(i=>{switch(i){case"type":case"properties":case"geometry":return;default:t[i]=e[i]}}),t.properties=T0(e.properties),e.geometry==null?t.geometry=null:t.geometry=xu(e.geometry),t}function T0(e){const t={};return e&&Object.keys(e).forEach(i=>{const n=e[i];typeof n=="object"?n===null?t[i]=null:Array.isArray(n)?t[i]=n.map(s=>s):t[i]=T0(n):t[i]=n}),t}function aS(e){const t={type:"FeatureCollection"};return Object.keys(e).forEach(i=>{switch(i){case"type":case"features":return;default:t[i]=e[i]}}),t.features=e.features.map(i=>A0(i)),t}function xu(e){const t={type:e.type};return e.bbox&&(t.bbox=e.bbox),e.type==="GeometryCollection"?(t.geometries=e.geometries.map(i=>xu(i)),t):(t.coordinates=R0(e.coordinates),t)}function R0(e){const t=e;return typeof t[0]!="object"?t.slice():t.map(i=>R0(i))}var gi=63710088e-1,P0={centimeters:gi*100,centimetres:gi*100,degrees:360/(2*Math.PI),feet:gi*3.28084,inches:gi*39.37,kilometers:gi/1e3,kilometres:gi/1e3,meters:gi,metres:gi,miles:gi/1609.344,millimeters:gi*1e3,millimetres:gi*1e3,nauticalmiles:gi/1852,radians:1,yards:gi*1.0936};function hS(e,t,i={}){const n={type:"Feature"};return(i.id===0||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=t||{},n.geometry=e,n}function lS(e,t,i={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!qf(e[0])||!qf(e[1]))throw new Error("coordinates must contain numbers");return hS({type:"Point",coordinates:e},t,i)}function cS(e,t={}){const i={type:"FeatureCollection"};return t.id&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.features=e,i}function uS(e,t="kilometers"){const i=P0[t];if(!i)throw new Error(t+" units is invalid");return e*i}function dS(e,t="kilometers"){const i=P0[t];if(!i)throw new Error(t+" units is invalid");return e/i}function Ic(e){return e%(2*Math.PI)*180/Math.PI}function Fi(e){return e%360*Math.PI/180}function qf(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function fS(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function Uo(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return[...e.geometry.coordinates];if(e.type==="Point")return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function go(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ec(e){const t=go(e);let i=0,n=1,s,r;for(;n<t.length;)s=r||t[0],r=t[n],i+=(r[0]-s[0])*(r[1]+s[1]),n++;return i>0}function Jf(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var i=0;i<e.features.length&&t(e.features[i],i)!==!1;i++);}function G0(e,t){var i,n,s,r,o,a,h,c,u,m,p=0,y=e.type==="FeatureCollection",w=e.type==="Feature",v=y?e.features.length:1;for(i=0;i<v;i++){for(a=y?e.features[i].geometry:w?e.geometry:e,c=y?e.features[i].properties:w?e.properties:{},u=y?e.features[i].bbox:w?e.bbox:void 0,m=y?e.features[i].id:w?e.id:void 0,h=a?a.type==="GeometryCollection":!1,o=h?a.geometries.length:1,s=0;s<o;s++){if(r=h?a.geometries[s]:a,r===null){if(t(null,p,c,u,m)===!1)return!1;continue}switch(r.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(r,p,c,u,m)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<r.geometries.length;n++)if(t(r.geometries[n],p,c,u,m)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}p++}}function gS(e,t={}){var i,n;if(t=t||{},!fS(t))throw new Error("options is invalid");const s=(i=t.mutate)!=null?i:!1,r=(n=t.reverse)!=null?n:!1;if(!e)throw new Error("<geojson> is required");if(typeof r!="boolean")throw new Error("<reverse> must be a boolean");if(typeof s!="boolean")throw new Error("<mutate> must be a boolean");!s&&e.type!=="Point"&&e.type!=="MultiPoint"&&(e=oS(e));const o=[];switch(e.type){case"GeometryCollection":return G0(e,function(a){Ya(a,r)}),e;case"FeatureCollection":return Jf(e,function(a){const h=Ya(a,r);Jf(h,function(c){o.push(c)})}),cS(o)}return Ya(e,r)}function Ya(e,t){switch(e.type==="Feature"?e.geometry.type:e.type){case"GeometryCollection":return G0(e,function(n){Ya(n,t)}),e;case"LineString":return Qf(go(e),t),e;case"Polygon":return tg(go(e),t),e;case"MultiLineString":return go(e).forEach(function(n){Qf(n,t)}),e;case"MultiPolygon":return go(e).forEach(function(n){tg(n,t)}),e;case"Point":case"MultiPoint":return e}}function Qf(e,t){Ec(e)===t&&e.reverse()}function tg(e,t){Ec(e[0])!==t&&e[0].reverse();for(let i=1;i<e.length;i++)Ec(e[i])===t&&e[i].reverse()}function ci(e){return Array.isArray(e)&&e.length>=2&&typeof e[0]=="number"&&typeof e[1]=="number"}function Ts(e){return Array.isArray(e)&&e.every(ci)}function mS(e){return Array.isArray(e)&&e.every(ci)}function Mr(e){return Array.isArray(e)&&e.every(mS)}function eg(e){return Array.isArray(e)&&e.every(ci)}function ig(e){return Array.isArray(e)&&e.every(Ts)}function Cc(e){return Array.isArray(e)&&e.every(Mr)}function L0(e){return[...e,e[0]]}function pS(e){return e.splice(-1),e}function O0(e){return e.map(t=>L0(t))}function Su(e){if(e=e.filter(function(t,i,n){return i===0||!$h(t,n[i-1])}),e.length<2)throw new Error("LineString should contain at least 2 points");return e}function F0(e){if(e=e.filter(function(t,i,n){return i===0||!$h(t,n[i-1])}),bS(e)&&pS(e),e.length<3)throw new Error("Ring should contain at least 3 points");return e}function bu(e){return e.map(t=>F0(t))}function _S(e){return e.map(t=>Su(t))}function yS(e){return e.map(t=>bu(t))}function wS(e){return{type:"Point",coordinates:e}}function vS(e){return{type:"LineString",coordinates:e}}function MS(e,t=!0){const i={type:"Polygon",coordinates:t?O0(e):e};return gS(i)}function IS(e,t){{if(ci(e))return wS(e);if(Ts(e))return vS(e);if(Mr(e))return MS(e);throw new Error("Geometry type not supported")}}function ES(e){return{type:"circle",coordinates:e}}function CS(e){return{type:"polyline",coordinates:e}}function xS(e){return{type:"polygon",coordinates:e[0]}}function SS(e){if(ci(e))return ES(e);if(Ts(e))return CS(e);if(Mr(e))return xS(e);throw new Error("Unsupported GeoJSON Geometry")}function bS(e){return Array.isArray(e)&&e.length>=2&&$h(e[0],e[e.length-1])}function $h(e,t){return e===t?!0:e===null||t===null?!1:e[0]===t[0]&&e[1]===t[1]}function ng(e,t){if(e.length!==t.length)throw new Error("Point arrays should be of same length");return e.map((i,n)=>[i,t[n]])}function bl(e){return e.reduce((t,i,n)=>[...t,[i,e[(n+1)%e.length]]],[])}function to(e){return[e[0],-e[1]]}function xc(e,t,i){return e*(1-i)+t*i}function Sc(e,t,i){return[xc(e[0],t[0],i),xc(e[1],t[1],i)]}function mh(...e){const t=[0,0];for(let i=0;i<e.length;i++)t[0]+=e[i][0],t[1]+=e[i][1];return t[0]=t[0]/e.length,t[1]=t[1]/e.length,t}function AS(e){return Math.atan2(e[1][1]-e[0][1],e[1][0]-e[0][0])}function TS(e,t,i){return[e[0]+Math.cos(i)*t,e[1]+Math.sin(i)*t]}function bi(e,t){if(Ts(e)&&e.length===2)return bi(e[0],e[1]);if(ci(e)&&t===void 0)return bi(e,[0,0]);if(ci(e)&&ci(t))return Math.sqrt(an(e,t));throw new Error("Input type not supported")}function an(e,t){if(Ts(e)&&e.length===2)return an(e[0],e[1]);if(ci(e)&&t===void 0)return an(e,[0,0]);if(ci(e)&&ci(t))return(t[0]-e[0])**2+(t[1]-e[1])**2;throw new Error("Input type not supported")}function RS(e,t){if(e.length!==t.length)throw new Error("Arrays need to be of same length");const i=e.map((r,o)=>an(r,t[o])),n=i.reduce((r,o)=>r+o,0)/i.length;return Math.sqrt(n)}function bc(e,t){return t===1?e:[e[0]*t,e[1]*t]}function PS(e,t){return t===1?e:e.map(i=>bc(i,t))}function Ac(e,t,i="add"){return i==="add"?[e[0]+t[0],e[1]+t[1]]:[e[0]-t[0],e[1]-t[1]]}function sg(e,t,i="add"){return $h(t,[0,0])?e:e.map(n=>Ac(n,t,i))}function ph(e,t=0,i=void 0,n,s){return t===0||t===void 0?e:i?Ac(ph(Ac(e,i,"substract"),t,void 0,n,s),i):(n=n||Math.cos(t),s=s||Math.sin(t),[e[0]*n-e[1]*s,e[0]*s+e[1]*n])}function Al(e,t=0,i=void 0,n,s){return t===0||t===void 0?e:(n=n||Math.cos(t),s=s||Math.sin(t),e.map(r=>ph(r,t,i,n,s)))}function GS(e){return[Tl(e[0],e[1],e[2]),Tl(e[1],e[2],e[0]),Tl(e[2],e[0],e[1])]}function Tl(e,t,i){const n=bi(e,t),s=bi(t,i),r=bi(e,i);return Math.acos((n**2+r**2-s**2)/(2*n*r))}function Hh(e){return Array.isArray(e)&&e.length>=2&&e.every(t=>typeof t=="number")}function N0(e){return Array.isArray(e)&&e.every(Hh)}function LS(e){return Array.isArray(e)&&e.every(Hh)}function D0(e){return Array.isArray(e)&&e.every(LS)}function OS(e){return Array.isArray(e)&&e.every(Hh)}function FS(e){return Array.isArray(e)&&e.every(N0)}function NS(e){return Array.isArray(e)&&e.every(D0)}function DS(e){return typeof e=="object"&&e!==null&&"type"in e&&e.type==="Point"&&"coordinates"in e&&Hh(e.coordinates)}function kS(e){return typeof e=="object"&&e!==null&&"type"in e&&e.type==="LineString"&&"coordinates"in e&&N0(e.coordinates)}function jS(e){return typeof e=="object"&&e!==null&&"type"in e&&e.type==="Polygon"&&"coordinates"in e&&Array.isArray(e.coordinates)&&D0(e.coordinates)}function BS(e){return typeof e=="object"&&e!==null&&"type"in e&&e.type==="MultiPoint"&&"coordinates"in e&&OS(e.coordinates)}function VS(e){return typeof e=="object"&&e!==null&&"type"in e&&e.type==="MultiLineString"&&"coordinates"in e&&FS(e.coordinates)}function WS(e){return typeof e=="object"&&e!==null&&"type"in e&&e.type==="MultiPolygon"&&"coordinates"in e&&Array.isArray(e.coordinates)&&NS(e.coordinates)}function zS(e){const t=typeof e=="object"&&e!==null,n=t&&"type"in e&&typeof e.type=="string"&&(e.type==="Point"||e.type==="LineString"||e.type==="Polygon"||e.type==="MultiPoint"||e.type==="MultiLineString"||e.type==="MultiPolygon"),s=t&&"coordinates"in e&&Array.isArray(e.coordinates);return n&&s}function Fr(e){return e.slice(0,2)}function ZS(e){return Fr(e.coordinates)}function US(e){return Su(e.coordinates.map(Fr))}function XS(e,t=!1){const i=bu(e.coordinates.map(n=>n.map(Fr)));return t?i.map(n=>[...n,n[0]]):i}function $S(e){return e.coordinates.map(Fr)}function HS(e){return _S(e.coordinates.map(t=>t.map(Fr)))}function YS(e,t=!1){const i=yS(e.coordinates.map(n=>n.map(s=>s.map(Fr))));return t?i.map(n=>n.map(s=>[...s,s[0]])):i}function k0(e){if(DS(e))return ZS(e);if(kS(e))return US(e);if(jS(e))return XS(e);if(BS(e))return $S(e);if(VS(e))return HS(e);if(WS(e))return YS(e);throw new Error("Geometry type not supported")}function KS(e,t){return{type:"Feature",properties:{},geometry:e}}function qS(e,t){return{type:"FeatureCollection",features:e.map((i,n)=>KS(i))}}function JS(e){return e.geometry}function QS(e){return e.features.map(JS)}function rg(e){let t=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;for(const n of e)t===void 0?n>=n&&(t=i=n):(t>n&&(t=n),i<n&&(i=n));return[t,i]}function Fe(e){if(ci(e)&&(e=[e]),Mr(e)&&(e=e.flat()),Cc(e)&&(e=e.flat()),zS(e))return Fe(k0(e));const t=[],i=[];for(const a of e)t.push(a[0]),i.push(a[1]);const[n,s]=rg(t),[r,o]=rg(i);return[n,r,s,o]}function tb(e,t){const i=e[2]>=t[0]&&t[2]>=e[0],n=e[3]>=t[1]&&t[3]>=e[1];return i&&n}function eb(e,t){const i=Math.max(e[0],t[0]),n=Math.min(e[2],t[2]),s=Math.max(e[1],t[1]),r=Math.min(e[3],t[3]);if(i<n&&s<r)return[i,s,n,r]}function ib(e,t,i){return i===void 0&&(i=t),[e[0]-t,e[1]-i,e[2]+t,e[3]+i]}function j0(e,t){if(t===0)return e;const i=Ka(e);return ib(e,...i.map(n=>n*t/2))}function En(e){return[[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]]}function xs(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function Ka(e){return[e[2]-e[0],e[3]-e[1]]}function og(e){return[.5*(bi(e[0],e[1])+bi(e[2],e[3])),.5*(bi(e[1],e[2])+bi(e[3],e[0]))]}function nb(e){if(e.length!==0)return sS(e)}function B0(e,t,i){return i?i==="contain"?e[0]/e[1]>=t[0]/t[1]?e[0]/t[0]:e[1]/t[1]:e[0]/e[1]>=t[0]/t[1]?e[1]/t[1]:e[0]/t[0]:Math.sqrt(e[0]*e[1]/(t[0]*t[1]))}function Rl(e,t){return[e[0]*t,e[1]*t]}function mo(e){return e[0]*e[1]}function sb(e){return[e[0]/2,e[1]/2]}function Tc(e){return[0,0,...e]}function V0(e){return En(Tc(e))}function ag(e,t){return B0(og(e),og(t))}function W0(e,t,i,n=()=>!0,s=()=>!0){if(e.has(t)&&n(e.get(t)))return e.get(t);{const r=i();return s(r)&&e.set(t,r),r}}function hg(e,t,i,n,s,r=()=>!0,o=()=>!0){if(e.get(t)?.get(i)?.has(n)&&r(e.get(t)?.get(i)?.get(n)))return e.get(t)?.get(i)?.get(n);{const a=s();return o(a)&&(e.get(t)||e.set(t,new Map),e.get(t)?.get(i)||e.get(t)?.set(i,new Map),e.get(t)?.get(i)?.set(n,a)),a}}const Xo="a-f\\d",rb=`#?[${Xo}]{3}[${Xo}]?`,ob=`#?[${Xo}]{6}([${Xo}]{2})?`,ab=new RegExp(`[^#${Xo}]`,"gi"),hb=new RegExp(`^${rb}$|^${ob}$`,"i");function z0(e,t={}){if(typeof e!="string"||ab.test(e)||!hb.test(e))throw new TypeError("Expected a valid hex string");e=e.replace(/^#/,"");let i=1;e.length===8&&(i=Number.parseInt(e.slice(6,8),16)/255,e=e.slice(0,6)),e.length===4&&(i=Number.parseInt(e.slice(3,4).repeat(2),16)/255,e=e.slice(0,3)),e.length===3&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);const n=Number.parseInt(e,16),s=n>>16,r=n>>8&255,o=n&255,a=typeof t.alpha=="number"?t.alpha:i;if(t.format==="array")return[s,r,o,a];if(t.format==="css"){const h=a===1?"":` / ${Number((a*100).toFixed(2))}%`;return`rgb(${s} ${r} ${o}${h})`}return{red:s,green:r,blue:o,alpha:a}}function lb(e){return z0(e,{format:"array"}).slice(0,3)}function cb(e){const t=z0(e,{format:"array"});return t[3]=255,t}function $i(e){return lb(e).map(t=>t/255)}function Fa(e){return cb(e).map(t=>t/255)}function lg(e,t,i=(n,s)=>n==s){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!i(e[n],t[n]))return!1;return!0}function ub(e,t){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])===-1)return!1;return!0}function db(e,t){return!e||!t||e.size!==t.size?!1:[...e].every(i=>t.has(i))}function cg(e,t){if(e!==void 0&&t!==void 0)return Math.max(e,t);if(e!==void 0)return e;if(t!==void 0)return t}function Qi(e,t,i=0){if(e<=0||t<=0)throw new Error("Empty ArrayMatrix not supported");return Array.from(Array(e),n=>Array(t).fill(i))}function ns(e){if(e.length===0)throw new Error("ArrayMatrix may not be empty, but rows are empty");const t=e.map(s=>s.length);if(t.some(s=>s===0))throw new Error("ArrayMatrix may not be empty, but at least one row is empty");if(!t.every(s=>s===t[0]))throw new Error("Rows of unequal length");const i=e.length,n=t[0];return[i,n]}function fb(e){return e.map(t=>[...t])}function $o(e,t,i,n){const s=ns(n),r=fb(e);for(let o=0;o<s[0];o++)for(let a=0;a<s[1];a++)r[t+o][i+a]=n[o][a];return r}function Z0(e){return e[0].map((t,i)=>e.map(n=>n[i]))}function gb(e,t=0){const i=ns(e),n=e.map(w=>w.map(v=>ns(v))),s=n.map(w=>w.map(v=>v[0])),r=Z0(s),o=r[0];if(!r.every(w=>lg(w,r[0])))throw new Error("The blocks, by block column, must have the same sequence of rows.");const a=[];let h=0;o.forEach(w=>{a.push(h),h=h+w});const c=h,u=n.map(w=>w.map(v=>v[1])),m=u[0];if(!u.every(w=>lg(w,m)))throw new Error("The blocks, by block row, must have the same sequence of columns.");h=0,u[0].forEach(w=>{h=h+w});let y=Qi(c,h,t);for(let w=0;w<i[0];w++)for(let v=0;v<i[1];v++)y=$o(y,a[w],a[v],e[w][v]);return y}function Ee(e,t){return t?{...e,...t}:e}function U0(e,t){if(!t)return e;for(const i in t){const n=t[i];n!==void 0&&(e[i]=n)}return e}function Jn(...e){const t=e.filter(i=>i!=null);return t.length===0?{}:t.length===1?t[0]:Object.assign({},...t)}function mb(e,t){t===void 0&&(t={});var i=t.offsetLine||0,n=t.offsetColumn||0,s=e.split(`
`),r=0,o=s.map(function(m,p){var y=r+m.length+1,w={start:r,end:y,line:p};return r=y,w}),a=0;function h(m,p){return m.start<=p&&p<m.end}function c(m,p){return{line:i+m.line,column:n+p-m.start,character:p}}function u(m,p){typeof m=="string"&&(m=e.indexOf(m,p||0));for(var y=o[a],w=m>=y.end?1:-1;y;){if(h(y,m))return c(y,m);a+=w,y=o[a]}}return u}function pb(e,t,i){return mb(e,i)(t,i)}var ug=/[a-zA-Z0-9:_-]/,dg=/[\s\t\r\n]/,_b=/['"]/;function yb(e,t){for(var i="";t--;)i+=e;return i}function wb(e){var t="",i=[],n=a,s=null,r=null;function o(G){var k=pb(e,P),O=k.line,U=k.column,Y=e.slice(0,P),W=/(^|\n).*$/.exec(Y)[0].replace(/\t/g,"  "),Q=e.slice(P),ot=/.*(\n|$)/.exec(Q)[0],ut=""+W+ot+`
`+yb(" ",W.length)+"^";throw new Error(G+" ("+O+":"+U+`). If this is valid SVG, it's probably a bug in svg-parser. Please raise an issue at https://github.com/Rich-Harris/svg-parser/issues – thanks!

`+ut)}function a(){for(;P<e.length&&e[P]!=="<"||!ug.test(e[P+1]);)t+=e[P++];return h()}function h(){for(var G="";P<e.length&&e[P]!=="<";)G+=e[P++];return/\S/.test(G)&&s.children.push({type:"text",value:G}),e[P]==="<"?c:h}function c(){var G=e[P];if(G==="?")return h;if(G==="!"){if(e.slice(P+1,P+3)==="--")return u;if(e.slice(P+1,P+8)==="[CDATA[")return m;if(/doctype/i.test(e.slice(P+1,P+8)))return h}if(G==="/")return p;var k=y(),O={type:"element",tagName:k,properties:{},children:[]};s?s.children.push(O):r=O;for(var U;P<e.length&&(U=w());)O.properties[U.name]=U.value;var Y=!1;return e[P]==="/"&&(P+=1,Y=!0),e[P]!==">"&&o("Expected >"),Y||(s=O,i.push(O)),h}function u(){var G=e.indexOf("-->",P);return~G||o("expected -->"),P=G+2,h}function m(){var G=e.indexOf("]]>",P);return~G||o("expected ]]>"),s.children.push(e.slice(P+7,G)),P=G+2,h}function p(){var G=y();return G||o("Expected tag name"),G!==s.tagName&&o("Expected closing tag </"+G+"> to match opening tag <"+s.tagName+">"),T(),e[P]!==">"&&o("Expected >"),i.pop(),s=i[i.length-1],h}function y(){for(var G="";P<e.length&&ug.test(e[P]);)G+=e[P++];return G}function w(){if(!dg.test(e[P]))return null;T();var G=y();if(!G)return null;var k=!0;return T(),e[P]==="="&&(P+=1,T(),k=v(),!isNaN(k)&&k.trim()!==""&&(k=+k)),{name:G,value:k}}function v(){return _b.test(e[P])?b():I()}function I(){var G="";do{var k=e[P];if(k===" "||k===">"||k==="/")return G;G+=k,P+=1}while(P<e.length);return G}function b(){for(var G=e[P++],k="",O=!1;P<e.length;){var U=e[P++];if(U===G&&!O)return k;U==="\\"&&!O&&(O=!0),k+=O?"\\"+U:U,O=!1}}function T(){for(;P<e.length&&dg.test(e[P]);)P+=1}for(var P=a.length;P<e.length;)n||o("Unexpected character"),n=n(),P+=1;return n!==h&&o("Unexpected end of input"),r.tagName==="svg"&&(r.metadata=t),{type:"root",children:[r]}}function vb(e){return e.type==="circle"}function Mb(e){return e.type==="line"}function Ib(e){return e.type==="polyline"}function Eb(e){return e.type==="rect"}function Cb(e){return e.type==="polygon"}function*xb(e){function*t(n){if("children"in n)for(const s of n.children)typeof s!="string"&&(yield*t(s));yield n}const i=wb(e);for(const n of t(i))if("tagName"in n&&n.tagName!=="svg"&&n.tagName!=="g"){const s=Sb(n);s&&(yield s)}}function Sb(e){const t=e?.tagName?.toLowerCase();if(t==="circle")return{type:"circle",coordinates:[Ae(e,"cx"),Ae(e,"cy")]};if(t==="line")return{type:"line",coordinates:[[Ae(e,"x1"),Ae(e,"y1")],[Ae(e,"x2"),Ae(e,"y2")]]};if(t==="polyline")return{type:"polyline",coordinates:fg(e)};if(t==="polygon")return{type:"polygon",coordinates:fg(e)};if(t==="rect")return{type:"rect",coordinates:[[Ae(e,"x"),Ae(e,"y")],[Ae(e,"x")+Ae(e,"width"),Ae(e,"y")],[Ae(e,"x")+Ae(e,"width"),Ae(e,"y")+Ae(e,"height")],[Ae(e,"x"),Ae(e,"y")+Ae(e,"height")],[Ae(e,"x"),Ae(e,"y")]]};throw new Error(`Unsupported SVG element: ${t}`)}function Ae(e,t){const i=e?.properties?.[t];return Number(i)||0}function fg(e){const t=e?.properties?.points;return t?String(t).trim().split(/\s+/).map(i=>{const n=i.split(",").map(s=>Number(s));return[n[0],n[1]]}):[]}function gg(e){return e.map(t=>t.join(",")).join(" ")}function bb(e){return`<svg xmlns="http://www.w3.org/2000/svg">
  ${e.map(Ab).join(`
`)}
</svg>`}function Ab(e){if(e.type==="circle")return eo("circle",{...e.attributes,cx:e.coordinates[0],cy:e.coordinates[1]});if(e.type==="line")return eo("line",{...e.attributes,x1:e.coordinates[0][0],y1:e.coordinates[0][1],x2:e.coordinates[1][0],y2:e.coordinates[1][1]});if(e.type==="polyline")return eo("polyline",{...e.attributes,points:gg(e.coordinates)});if(e.type==="polygon")return eo("polygon",{...e.attributes,points:gg(e.coordinates)});if(e.type==="rect")return eo("rect",{...e.attributes,x:e.coordinates[0][0],y:e.coordinates[0][1],width:e.coordinates[1][0]-e.coordinates[0][0],height:e.coordinates[2][1]-e.coordinates[0][1]});throw new Error("Unknown SVG element")}function eo(e,t){const i=Object.entries(t).map(([n,s])=>`${n}="${s}"`);return`<${e} ${i.join(" ")} />`}function Tb(e){if(vb(e))return e.coordinates;if(Mb(e))return e.coordinates;if(Ib(e))return e.coordinates;if(Eb(e))return[e.coordinates];if(Cb(e))return[e.coordinates];throw new Error("Unsupported SVG geometry")}const Rc=["log2sigma","twoOmega","airyKavr","signDetJ","thetaa"];function mg(e,t,i,n=1){if(e.length===0)return new Map;if(!t||!i)return new Map(e.map(h=>[h,0]));const{E:s,F:r,a:o,b:a}=Rb(t,i);return new Map(e.map(h=>{if(Rc.indexOf(h)===-1)throw new Error("Distortion "+h+" not supported");switch(Rc.indexOf(h)){case 0:return[h,Pb(o,a,n)];case 1:return[h,Gb(o,a)];case 2:return[h,Lb(o,a,n)];case 3:return[h,Ob(t,i)];case 4:return[h,Fb(t,o,a,s,r)];default:return[h,0]}}))}function Rb(e,t){const i=e[0]**2+e[1]**2,n=e[0]*t[0]+e[1]*t[1],s=t[0]**2+t[1]**2,r=Math.sqrt(.5*(i+s+Math.sqrt((i-s)**2+4*n**2))),o=Math.sqrt(.5*(i+s-Math.sqrt((i-s)**2+4*n**2)));return{E:i,F:n,G:s,a:r,b:o}}function Pb(e,t,i=1){return(Math.log(e*t)-2*Math.log(i))/Math.log(2)}function Gb(e,t){return 2*Math.asin((e-t)/(e+t))}function Lb(e,t,i=1){return .5*(Math.log(e/i)**2+Math.log(t/i)**2)}function Ob(e,t){return Math.sign(e[0]*t[1]-e[1]*t[0])}function Fb(e,t,i,n,s){const r=Math.atan(e[1]/e[0]),o=Math.sign(-s)*Math.asin(Math.sqrt((1-t**2/n)/(1-(t/i)**2)));return r-o}class Au{sourcePoints;destinationPoints;destinationTransformedSourcePoints;type;pointCount;pointCountMinimum;errors;rmse;constructor(t,i,n,s){if(this.sourcePoints=t,this.destinationPoints=i,this.pointCount=this.sourcePoints.length,this.type=n,this.pointCountMinimum=s,this.pointCount<this.pointCountMinimum)throw new Error("Not enough control points. A "+this.type+" transformation requires a minimum of "+this.pointCountMinimum+" points, but "+this.pointCount+" are given.")}setWeightsArrays(t){this.weightsArrays=t,this.processWeightsArrays()}processWeightsArrays(){}getDestinationTransformedSourcePoints(){return this.destinationTransformedSourcePoints||(this.destinationTransformedSourcePoints=this.sourcePoints.map(t=>this.evaluateFunction(t))),this.destinationTransformedSourcePoints}getMeasures(){return{}}getErrors(){if(!this.errors){const t=this.getDestinationTransformedSourcePoints();this.errors=this.destinationPoints.map((i,n)=>bi(i,t[n]))}return this.errors}getRmse(){if(!this.rmse){const t=this.getDestinationTransformedSourcePoints();this.destinationTransformedSourcePoints||this.getDestinationTransformedSourcePoints(),this.rmse=RS(this.destinationPoints,t)}return this.rmse}}class X0 extends Au{destinationPointsArrays;constructor(t,i,n,s){super(t,i,n,s),this.destinationPointsArrays=this.getDestinationPointsArrays()}}function Nb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function $0(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var i=function n(){var s=!1;try{s=this instanceof n}catch{}return s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(i,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),i}var Yt={};const Db=Object.prototype.toString;function Ho(e){const t=Db.call(e);return t.endsWith("Array]")&&!t.includes("Big")}const kb=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:Ho},Symbol.toStringTag,{value:"Module"})),jb=$0(kb);function Bb(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ho(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var i=t.fromIndex,n=i===void 0?0:i,s=t.toIndex,r=s===void 0?e.length:s;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(r<=n||r>e.length||!Number.isInteger(r))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=e[n],a=n+1;a<r;a++)e[a]>o&&(o=e[a]);return o}function Vb(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ho(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var i=t.fromIndex,n=i===void 0?0:i,s=t.toIndex,r=s===void 0?e.length:s;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(r<=n||r>e.length||!Number.isInteger(r))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=e[n],a=n+1;a<r;a++)e[a]<o&&(o=e[a]);return o}function Wb(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ho(e)){if(e.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var i;if(t.output!==void 0){if(!Ho(t.output))throw new TypeError("output option must be an array if specified");i=t.output}else i=new Array(e.length);var n=Vb(e),s=Bb(e);if(n===s)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var r=t.min,o=r===void 0?t.autoMinMax?n:0:r,a=t.max,h=a===void 0?t.autoMinMax?s:1:a;if(o>=h)throw new RangeError("min option must be smaller than max option");for(var c=(h-o)/(s-n),u=0;u<e.length;u++)i[u]=(e[u]-n)*c+o;return i}const zb=Object.freeze(Object.defineProperty({__proto__:null,default:Wb},Symbol.toStringTag,{value:"Module"})),Zb=$0(zb);var pg;function Ub(){if(pg)return Yt;pg=1,Object.defineProperty(Yt,"__esModule",{value:!0});var e=jb,t=Zb;const i=" ".repeat(2),n=" ".repeat(4);function s(){return r(this)}function r(M,d={}){const{maxRows:f=15,maxColumns:l=10,maxNumSize:g=8,padMinus:_="auto"}=d;return`${M.constructor.name} {
${i}[
${n}${o(M,f,l,g,_)}
${i}]
${i}rows: ${M.rows}
${i}columns: ${M.columns}
}`}function o(M,d,f,l,g){const{rows:_,columns:C}=M,E=Math.min(_,d),x=Math.min(C,f),S=[];if(g==="auto"){g=!1;t:for(let N=0;N<E;N++)for(let R=0;R<x;R++)if(M.get(N,R)<0){g=!0;break t}}for(let N=0;N<E;N++){let R=[];for(let $=0;$<x;$++)R.push(a(M.get(N,$),l,g));S.push(`${R.join(" ")}`)}return x!==C&&(S[S.length-1]+=` ... ${C-f} more columns`),E!==_&&S.push(`... ${_-d} more rows`),S.join(`
${n}`)}function a(M,d,f){return(M>=0&&f?` ${h(M,d-1)}`:h(M,d)).padEnd(d)}function h(M,d){let f=M.toString();if(f.length<=d)return f;let l=M.toFixed(d);if(l.length>d&&(l=M.toFixed(Math.max(0,d-(l.length-d)))),l.length<=d&&!l.startsWith("0.000")&&!l.startsWith("-0.000"))return l;let g=M.toExponential(d);return g.length>d&&(g=M.toExponential(Math.max(0,d-(g.length-d)))),g.slice(0)}function c(M,d){M.prototype.add=function(l){return typeof l=="number"?this.addS(l):this.addM(l)},M.prototype.addS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)+l);return this},M.prototype.addM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)+l.get(g,_));return this},M.add=function(l,g){return new d(l).add(g)},M.prototype.sub=function(l){return typeof l=="number"?this.subS(l):this.subM(l)},M.prototype.subS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)-l);return this},M.prototype.subM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)-l.get(g,_));return this},M.sub=function(l,g){return new d(l).sub(g)},M.prototype.subtract=M.prototype.sub,M.prototype.subtractS=M.prototype.subS,M.prototype.subtractM=M.prototype.subM,M.subtract=M.sub,M.prototype.mul=function(l){return typeof l=="number"?this.mulS(l):this.mulM(l)},M.prototype.mulS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)*l);return this},M.prototype.mulM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)*l.get(g,_));return this},M.mul=function(l,g){return new d(l).mul(g)},M.prototype.multiply=M.prototype.mul,M.prototype.multiplyS=M.prototype.mulS,M.prototype.multiplyM=M.prototype.mulM,M.multiply=M.mul,M.prototype.div=function(l){return typeof l=="number"?this.divS(l):this.divM(l)},M.prototype.divS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)/l);return this},M.prototype.divM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)/l.get(g,_));return this},M.div=function(l,g){return new d(l).div(g)},M.prototype.divide=M.prototype.div,M.prototype.divideS=M.prototype.divS,M.prototype.divideM=M.prototype.divM,M.divide=M.div,M.prototype.mod=function(l){return typeof l=="number"?this.modS(l):this.modM(l)},M.prototype.modS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)%l);return this},M.prototype.modM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)%l.get(g,_));return this},M.mod=function(l,g){return new d(l).mod(g)},M.prototype.modulus=M.prototype.mod,M.prototype.modulusS=M.prototype.modS,M.prototype.modulusM=M.prototype.modM,M.modulus=M.mod,M.prototype.and=function(l){return typeof l=="number"?this.andS(l):this.andM(l)},M.prototype.andS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)&l);return this},M.prototype.andM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)&l.get(g,_));return this},M.and=function(l,g){return new d(l).and(g)},M.prototype.or=function(l){return typeof l=="number"?this.orS(l):this.orM(l)},M.prototype.orS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)|l);return this},M.prototype.orM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)|l.get(g,_));return this},M.or=function(l,g){return new d(l).or(g)},M.prototype.xor=function(l){return typeof l=="number"?this.xorS(l):this.xorM(l)},M.prototype.xorS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)^l);return this},M.prototype.xorM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)^l.get(g,_));return this},M.xor=function(l,g){return new d(l).xor(g)},M.prototype.leftShift=function(l){return typeof l=="number"?this.leftShiftS(l):this.leftShiftM(l)},M.prototype.leftShiftS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)<<l);return this},M.prototype.leftShiftM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)<<l.get(g,_));return this},M.leftShift=function(l,g){return new d(l).leftShift(g)},M.prototype.signPropagatingRightShift=function(l){return typeof l=="number"?this.signPropagatingRightShiftS(l):this.signPropagatingRightShiftM(l)},M.prototype.signPropagatingRightShiftS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)>>l);return this},M.prototype.signPropagatingRightShiftM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)>>l.get(g,_));return this},M.signPropagatingRightShift=function(l,g){return new d(l).signPropagatingRightShift(g)},M.prototype.rightShift=function(l){return typeof l=="number"?this.rightShiftS(l):this.rightShiftM(l)},M.prototype.rightShiftS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)>>>l);return this},M.prototype.rightShiftM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)>>>l.get(g,_));return this},M.rightShift=function(l,g){return new d(l).rightShift(g)},M.prototype.zeroFillRightShift=M.prototype.rightShift,M.prototype.zeroFillRightShiftS=M.prototype.rightShiftS,M.prototype.zeroFillRightShiftM=M.prototype.rightShiftM,M.zeroFillRightShift=M.rightShift,M.prototype.not=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,~this.get(l,g));return this},M.not=function(l){return new d(l).not()},M.prototype.abs=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.abs(this.get(l,g)));return this},M.abs=function(l){return new d(l).abs()},M.prototype.acos=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.acos(this.get(l,g)));return this},M.acos=function(l){return new d(l).acos()},M.prototype.acosh=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.acosh(this.get(l,g)));return this},M.acosh=function(l){return new d(l).acosh()},M.prototype.asin=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.asin(this.get(l,g)));return this},M.asin=function(l){return new d(l).asin()},M.prototype.asinh=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.asinh(this.get(l,g)));return this},M.asinh=function(l){return new d(l).asinh()},M.prototype.atan=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.atan(this.get(l,g)));return this},M.atan=function(l){return new d(l).atan()},M.prototype.atanh=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.atanh(this.get(l,g)));return this},M.atanh=function(l){return new d(l).atanh()},M.prototype.cbrt=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.cbrt(this.get(l,g)));return this},M.cbrt=function(l){return new d(l).cbrt()},M.prototype.ceil=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.ceil(this.get(l,g)));return this},M.ceil=function(l){return new d(l).ceil()},M.prototype.clz32=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.clz32(this.get(l,g)));return this},M.clz32=function(l){return new d(l).clz32()},M.prototype.cos=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.cos(this.get(l,g)));return this},M.cos=function(l){return new d(l).cos()},M.prototype.cosh=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.cosh(this.get(l,g)));return this},M.cosh=function(l){return new d(l).cosh()},M.prototype.exp=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.exp(this.get(l,g)));return this},M.exp=function(l){return new d(l).exp()},M.prototype.expm1=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.expm1(this.get(l,g)));return this},M.expm1=function(l){return new d(l).expm1()},M.prototype.floor=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.floor(this.get(l,g)));return this},M.floor=function(l){return new d(l).floor()},M.prototype.fround=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.fround(this.get(l,g)));return this},M.fround=function(l){return new d(l).fround()},M.prototype.log=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.log(this.get(l,g)));return this},M.log=function(l){return new d(l).log()},M.prototype.log1p=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.log1p(this.get(l,g)));return this},M.log1p=function(l){return new d(l).log1p()},M.prototype.log10=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.log10(this.get(l,g)));return this},M.log10=function(l){return new d(l).log10()},M.prototype.log2=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.log2(this.get(l,g)));return this},M.log2=function(l){return new d(l).log2()},M.prototype.round=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.round(this.get(l,g)));return this},M.round=function(l){return new d(l).round()},M.prototype.sign=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.sign(this.get(l,g)));return this},M.sign=function(l){return new d(l).sign()},M.prototype.sin=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.sin(this.get(l,g)));return this},M.sin=function(l){return new d(l).sin()},M.prototype.sinh=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.sinh(this.get(l,g)));return this},M.sinh=function(l){return new d(l).sinh()},M.prototype.sqrt=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.sqrt(this.get(l,g)));return this},M.sqrt=function(l){return new d(l).sqrt()},M.prototype.tan=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.tan(this.get(l,g)));return this},M.tan=function(l){return new d(l).tan()},M.prototype.tanh=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.tanh(this.get(l,g)));return this},M.tanh=function(l){return new d(l).tanh()},M.prototype.trunc=function(){for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.set(l,g,Math.trunc(this.get(l,g)));return this},M.trunc=function(l){return new d(l).trunc()},M.pow=function(l,g){return new d(l).pow(g)},M.prototype.pow=function(l){return typeof l=="number"?this.powS(l):this.powM(l)},M.prototype.powS=function(l){for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)**l);return this},M.prototype.powM=function(l){if(l=d.checkMatrix(l),this.rows!==l.rows||this.columns!==l.columns)throw new RangeError("Matrices dimensions must be equal");for(let g=0;g<this.rows;g++)for(let _=0;_<this.columns;_++)this.set(g,_,this.get(g,_)**l.get(g,_));return this}}function u(M,d,f){let l=f?M.rows:M.rows-1;if(d<0||d>l)throw new RangeError("Row index out of range")}function m(M,d,f){let l=f?M.columns:M.columns-1;if(d<0||d>l)throw new RangeError("Column index out of range")}function p(M,d){if(d.to1DArray&&(d=d.to1DArray()),d.length!==M.columns)throw new RangeError("vector size must be the same as the number of columns");return d}function y(M,d){if(d.to1DArray&&(d=d.to1DArray()),d.length!==M.rows)throw new RangeError("vector size must be the same as the number of rows");return d}function w(M,d){if(!e.isAnyArray(d))throw new TypeError("row indices must be an array");for(let f=0;f<d.length;f++)if(d[f]<0||d[f]>=M.rows)throw new RangeError("row indices are out of range")}function v(M,d){if(!e.isAnyArray(d))throw new TypeError("column indices must be an array");for(let f=0;f<d.length;f++)if(d[f]<0||d[f]>=M.columns)throw new RangeError("column indices are out of range")}function I(M,d,f,l,g){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(T("startRow",d),T("endRow",f),T("startColumn",l),T("endColumn",g),d>f||l>g||d<0||d>=M.rows||f<0||f>=M.rows||l<0||l>=M.columns||g<0||g>=M.columns)throw new RangeError("Submatrix indices are out of range")}function b(M,d=0){let f=[];for(let l=0;l<M;l++)f.push(d);return f}function T(M,d){if(typeof d!="number")throw new TypeError(`${M} must be a number`)}function P(M){if(M.isEmpty())throw new Error("Empty matrix has no elements to index")}function G(M){let d=b(M.rows);for(let f=0;f<M.rows;++f)for(let l=0;l<M.columns;++l)d[f]+=M.get(f,l);return d}function k(M){let d=b(M.columns);for(let f=0;f<M.rows;++f)for(let l=0;l<M.columns;++l)d[l]+=M.get(f,l);return d}function O(M){let d=0;for(let f=0;f<M.rows;f++)for(let l=0;l<M.columns;l++)d+=M.get(f,l);return d}function U(M){let d=b(M.rows,1);for(let f=0;f<M.rows;++f)for(let l=0;l<M.columns;++l)d[f]*=M.get(f,l);return d}function Y(M){let d=b(M.columns,1);for(let f=0;f<M.rows;++f)for(let l=0;l<M.columns;++l)d[l]*=M.get(f,l);return d}function W(M){let d=1;for(let f=0;f<M.rows;f++)for(let l=0;l<M.columns;l++)d*=M.get(f,l);return d}function Q(M,d,f){const l=M.rows,g=M.columns,_=[];for(let C=0;C<l;C++){let E=0,x=0,S=0;for(let N=0;N<g;N++)S=M.get(C,N)-f[C],E+=S,x+=S*S;d?_.push((x-E*E/g)/(g-1)):_.push((x-E*E/g)/g)}return _}function ot(M,d,f){const l=M.rows,g=M.columns,_=[];for(let C=0;C<g;C++){let E=0,x=0,S=0;for(let N=0;N<l;N++)S=M.get(N,C)-f[C],E+=S,x+=S*S;d?_.push((x-E*E/l)/(l-1)):_.push((x-E*E/l)/l)}return _}function ut(M,d,f){const l=M.rows,g=M.columns,_=l*g;let C=0,E=0,x=0;for(let S=0;S<l;S++)for(let N=0;N<g;N++)x=M.get(S,N)-f,C+=x,E+=x*x;return d?(E-C*C/_)/(_-1):(E-C*C/_)/_}function vt(M,d){for(let f=0;f<M.rows;f++)for(let l=0;l<M.columns;l++)M.set(f,l,M.get(f,l)-d[f])}function A(M,d){for(let f=0;f<M.rows;f++)for(let l=0;l<M.columns;l++)M.set(f,l,M.get(f,l)-d[l])}function D(M,d){for(let f=0;f<M.rows;f++)for(let l=0;l<M.columns;l++)M.set(f,l,M.get(f,l)-d)}function F(M){const d=[];for(let f=0;f<M.rows;f++){let l=0;for(let g=0;g<M.columns;g++)l+=M.get(f,g)**2/(M.columns-1);d.push(Math.sqrt(l))}return d}function Z(M,d){for(let f=0;f<M.rows;f++)for(let l=0;l<M.columns;l++)M.set(f,l,M.get(f,l)/d[f])}function H(M){const d=[];for(let f=0;f<M.columns;f++){let l=0;for(let g=0;g<M.rows;g++)l+=M.get(g,f)**2/(M.rows-1);d.push(Math.sqrt(l))}return d}function tt(M,d){for(let f=0;f<M.rows;f++)for(let l=0;l<M.columns;l++)M.set(f,l,M.get(f,l)/d[l])}function V(M){const d=M.size-1;let f=0;for(let l=0;l<M.columns;l++)for(let g=0;g<M.rows;g++)f+=M.get(g,l)**2/d;return Math.sqrt(f)}function J(M,d){for(let f=0;f<M.rows;f++)for(let l=0;l<M.columns;l++)M.set(f,l,M.get(f,l)/d)}class B{static from1DArray(d,f,l){if(d*f!==l.length)throw new RangeError("data length does not match given dimensions");let _=new z(d,f);for(let C=0;C<d;C++)for(let E=0;E<f;E++)_.set(C,E,l[C*f+E]);return _}static rowVector(d){let f=new z(1,d.length);for(let l=0;l<d.length;l++)f.set(0,l,d[l]);return f}static columnVector(d){let f=new z(d.length,1);for(let l=0;l<d.length;l++)f.set(l,0,d[l]);return f}static zeros(d,f){return new z(d,f)}static ones(d,f){return new z(d,f).fill(1)}static rand(d,f,l={}){if(typeof l!="object")throw new TypeError("options must be an object");const{random:g=Math.random}=l;let _=new z(d,f);for(let C=0;C<d;C++)for(let E=0;E<f;E++)_.set(C,E,g());return _}static randInt(d,f,l={}){if(typeof l!="object")throw new TypeError("options must be an object");const{min:g=0,max:_=1e3,random:C=Math.random}=l;if(!Number.isInteger(g))throw new TypeError("min must be an integer");if(!Number.isInteger(_))throw new TypeError("max must be an integer");if(g>=_)throw new RangeError("min must be smaller than max");let E=_-g,x=new z(d,f);for(let S=0;S<d;S++)for(let N=0;N<f;N++){let R=g+Math.round(C()*E);x.set(S,N,R)}return x}static eye(d,f,l){f===void 0&&(f=d),l===void 0&&(l=1);let g=Math.min(d,f),_=this.zeros(d,f);for(let C=0;C<g;C++)_.set(C,C,l);return _}static diag(d,f,l){let g=d.length;f===void 0&&(f=g),l===void 0&&(l=f);let _=Math.min(g,f,l),C=this.zeros(f,l);for(let E=0;E<_;E++)C.set(E,E,d[E]);return C}static min(d,f){d=this.checkMatrix(d),f=this.checkMatrix(f);let l=d.rows,g=d.columns,_=new z(l,g);for(let C=0;C<l;C++)for(let E=0;E<g;E++)_.set(C,E,Math.min(d.get(C,E),f.get(C,E)));return _}static max(d,f){d=this.checkMatrix(d),f=this.checkMatrix(f);let l=d.rows,g=d.columns,_=new this(l,g);for(let C=0;C<l;C++)for(let E=0;E<g;E++)_.set(C,E,Math.max(d.get(C,E),f.get(C,E)));return _}static checkMatrix(d){return B.isMatrix(d)?d:new z(d)}static isMatrix(d){return d!=null&&d.klass==="Matrix"}get size(){return this.rows*this.columns}apply(d){if(typeof d!="function")throw new TypeError("callback must be a function");for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)d.call(this,f,l);return this}to1DArray(){let d=[];for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)d.push(this.get(f,l));return d}to2DArray(){let d=[];for(let f=0;f<this.rows;f++){d.push([]);for(let l=0;l<this.columns;l++)d[f].push(this.get(f,l))}return d}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let d=0;d<this.rows;d++)for(let f=0;f<=d;f++)if(this.get(d,f)!==this.get(f,d))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let d=0;d<this.rows;d++)if(this.get(d,d)!==0)return!1;return!0}isEchelonForm(){let d=0,f=0,l=-1,g=!0,_=!1;for(;d<this.rows&&g;){for(f=0,_=!1;f<this.columns&&_===!1;)this.get(d,f)===0?f++:this.get(d,f)===1&&f>l?(_=!0,l=f):(g=!1,_=!0);d++}return g}isReducedEchelonForm(){let d=0,f=0,l=-1,g=!0,_=!1;for(;d<this.rows&&g;){for(f=0,_=!1;f<this.columns&&_===!1;)this.get(d,f)===0?f++:this.get(d,f)===1&&f>l?(_=!0,l=f):(g=!1,_=!0);for(let C=f+1;C<this.rows;C++)this.get(d,C)!==0&&(g=!1);d++}return g}echelonForm(){let d=this.clone(),f=0,l=0;for(;f<d.rows&&l<d.columns;){let g=f;for(let _=f;_<d.rows;_++)d.get(_,l)>d.get(g,l)&&(g=_);if(d.get(g,l)===0)l++;else{d.swapRows(f,g);let _=d.get(f,l);for(let C=l;C<d.columns;C++)d.set(f,C,d.get(f,C)/_);for(let C=f+1;C<d.rows;C++){let E=d.get(C,l)/d.get(f,l);d.set(C,l,0);for(let x=l+1;x<d.columns;x++)d.set(C,x,d.get(C,x)-d.get(f,x)*E)}f++,l++}}return d}reducedEchelonForm(){let d=this.echelonForm(),f=d.columns,l=d.rows,g=l-1;for(;g>=0;)if(d.maxRow(g)===0)g--;else{let _=0,C=!1;for(;_<l&&C===!1;)d.get(g,_)===1?C=!0:_++;for(let E=0;E<g;E++){let x=d.get(E,_);for(let S=_;S<f;S++){let N=d.get(E,S)-x*d.get(g,S);d.set(E,S,N)}}g--}return d}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(d={}){if(typeof d!="object")throw new TypeError("options must be an object");const{rows:f=1,columns:l=1}=d;if(!Number.isInteger(f)||f<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(l)||l<=0)throw new TypeError("columns must be a positive integer");let g=new z(this.rows*f,this.columns*l);for(let _=0;_<f;_++)for(let C=0;C<l;C++)g.setSubMatrix(this,this.rows*_,this.columns*C);return g}fill(d){for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)this.set(f,l,d);return this}neg(){return this.mulS(-1)}getRow(d){u(this,d);let f=[];for(let l=0;l<this.columns;l++)f.push(this.get(d,l));return f}getRowVector(d){return z.rowVector(this.getRow(d))}setRow(d,f){u(this,d),f=p(this,f);for(let l=0;l<this.columns;l++)this.set(d,l,f[l]);return this}swapRows(d,f){u(this,d),u(this,f);for(let l=0;l<this.columns;l++){let g=this.get(d,l);this.set(d,l,this.get(f,l)),this.set(f,l,g)}return this}getColumn(d){m(this,d);let f=[];for(let l=0;l<this.rows;l++)f.push(this.get(l,d));return f}getColumnVector(d){return z.columnVector(this.getColumn(d))}setColumn(d,f){m(this,d),f=y(this,f);for(let l=0;l<this.rows;l++)this.set(l,d,f[l]);return this}swapColumns(d,f){m(this,d),m(this,f);for(let l=0;l<this.rows;l++){let g=this.get(l,d);this.set(l,d,this.get(l,f)),this.set(l,f,g)}return this}addRowVector(d){d=p(this,d);for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)this.set(f,l,this.get(f,l)+d[l]);return this}subRowVector(d){d=p(this,d);for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)this.set(f,l,this.get(f,l)-d[l]);return this}mulRowVector(d){d=p(this,d);for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)this.set(f,l,this.get(f,l)*d[l]);return this}divRowVector(d){d=p(this,d);for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)this.set(f,l,this.get(f,l)/d[l]);return this}addColumnVector(d){d=y(this,d);for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)this.set(f,l,this.get(f,l)+d[f]);return this}subColumnVector(d){d=y(this,d);for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)this.set(f,l,this.get(f,l)-d[f]);return this}mulColumnVector(d){d=y(this,d);for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)this.set(f,l,this.get(f,l)*d[f]);return this}divColumnVector(d){d=y(this,d);for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)this.set(f,l,this.get(f,l)/d[f]);return this}mulRow(d,f){u(this,d);for(let l=0;l<this.columns;l++)this.set(d,l,this.get(d,l)*f);return this}mulColumn(d,f){m(this,d);for(let l=0;l<this.rows;l++)this.set(l,d,this.get(l,d)*f);return this}max(d){if(this.isEmpty())return NaN;switch(d){case"row":{const f=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.get(l,g)>f[l]&&(f[l]=this.get(l,g));return f}case"column":{const f=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.get(l,g)>f[g]&&(f[g]=this.get(l,g));return f}case void 0:{let f=this.get(0,0);for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.get(l,g)>f&&(f=this.get(l,g));return f}default:throw new Error(`invalid option: ${d}`)}}maxIndex(){P(this);let d=this.get(0,0),f=[0,0];for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.get(l,g)>d&&(d=this.get(l,g),f[0]=l,f[1]=g);return f}min(d){if(this.isEmpty())return NaN;switch(d){case"row":{const f=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.get(l,g)<f[l]&&(f[l]=this.get(l,g));return f}case"column":{const f=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.get(l,g)<f[g]&&(f[g]=this.get(l,g));return f}case void 0:{let f=this.get(0,0);for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.get(l,g)<f&&(f=this.get(l,g));return f}default:throw new Error(`invalid option: ${d}`)}}minIndex(){P(this);let d=this.get(0,0),f=[0,0];for(let l=0;l<this.rows;l++)for(let g=0;g<this.columns;g++)this.get(l,g)<d&&(d=this.get(l,g),f[0]=l,f[1]=g);return f}maxRow(d){if(u(this,d),this.isEmpty())return NaN;let f=this.get(d,0);for(let l=1;l<this.columns;l++)this.get(d,l)>f&&(f=this.get(d,l));return f}maxRowIndex(d){u(this,d),P(this);let f=this.get(d,0),l=[d,0];for(let g=1;g<this.columns;g++)this.get(d,g)>f&&(f=this.get(d,g),l[1]=g);return l}minRow(d){if(u(this,d),this.isEmpty())return NaN;let f=this.get(d,0);for(let l=1;l<this.columns;l++)this.get(d,l)<f&&(f=this.get(d,l));return f}minRowIndex(d){u(this,d),P(this);let f=this.get(d,0),l=[d,0];for(let g=1;g<this.columns;g++)this.get(d,g)<f&&(f=this.get(d,g),l[1]=g);return l}maxColumn(d){if(m(this,d),this.isEmpty())return NaN;let f=this.get(0,d);for(let l=1;l<this.rows;l++)this.get(l,d)>f&&(f=this.get(l,d));return f}maxColumnIndex(d){m(this,d),P(this);let f=this.get(0,d),l=[0,d];for(let g=1;g<this.rows;g++)this.get(g,d)>f&&(f=this.get(g,d),l[0]=g);return l}minColumn(d){if(m(this,d),this.isEmpty())return NaN;let f=this.get(0,d);for(let l=1;l<this.rows;l++)this.get(l,d)<f&&(f=this.get(l,d));return f}minColumnIndex(d){m(this,d),P(this);let f=this.get(0,d),l=[0,d];for(let g=1;g<this.rows;g++)this.get(g,d)<f&&(f=this.get(g,d),l[0]=g);return l}diag(){let d=Math.min(this.rows,this.columns),f=[];for(let l=0;l<d;l++)f.push(this.get(l,l));return f}norm(d="frobenius"){switch(d){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${d}`)}}cumulativeSum(){let d=0;for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)d+=this.get(f,l),this.set(f,l,d);return this}dot(d){B.isMatrix(d)&&(d=d.to1DArray());let f=this.to1DArray();if(f.length!==d.length)throw new RangeError("vectors do not have the same size");let l=0;for(let g=0;g<f.length;g++)l+=f[g]*d[g];return l}mmul(d){d=z.checkMatrix(d);let f=this.rows,l=this.columns,g=d.columns,_=new z(f,g),C=new Float64Array(l);for(let E=0;E<g;E++){for(let x=0;x<l;x++)C[x]=d.get(x,E);for(let x=0;x<f;x++){let S=0;for(let N=0;N<l;N++)S+=this.get(x,N)*C[N];_.set(x,E,S)}}return _}mpow(d){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(d)||d<0)throw new RangeError("Exponent must be a non-negative integer");let f=z.eye(this.rows),l=this;for(let g=d;g>=1;g/=2)(g&1)!==0&&(f=f.mmul(l)),l=l.mmul(l);return f}strassen2x2(d){d=z.checkMatrix(d);let f=new z(2,2);const l=this.get(0,0),g=d.get(0,0),_=this.get(0,1),C=d.get(0,1),E=this.get(1,0),x=d.get(1,0),S=this.get(1,1),N=d.get(1,1),R=(l+S)*(g+N),$=(E+S)*g,at=l*(C-N),X=S*(x-g),q=(l+_)*N,gt=(E-l)*(g+C),L=(_-S)*(x+N),ht=R+X-q+L,Mt=at+q,Nt=$+X,jt=R-$+at+gt;return f.set(0,0,ht),f.set(0,1,Mt),f.set(1,0,Nt),f.set(1,1,jt),f}strassen3x3(d){d=z.checkMatrix(d);let f=new z(3,3);const l=this.get(0,0),g=this.get(0,1),_=this.get(0,2),C=this.get(1,0),E=this.get(1,1),x=this.get(1,2),S=this.get(2,0),N=this.get(2,1),R=this.get(2,2),$=d.get(0,0),at=d.get(0,1),X=d.get(0,2),q=d.get(1,0),gt=d.get(1,1),L=d.get(1,2),ht=d.get(2,0),Mt=d.get(2,1),Nt=d.get(2,2),jt=(l+g+_-C-E-N-R)*gt,pe=(l-C)*(-at+gt),At=E*(-$+at+q-gt-L-ht+Nt),Gt=(-l+C+E)*($-at+gt),ue=(C+E)*(-$+at),j=l*$,et=(-l+S+N)*($-X+L),mt=(-l+S)*(X-L),rt=(S+N)*(-$+X),_e=(l+g+_-E-x-S-N)*L,le=N*(-$+X+q-gt-L-ht+Mt),fe=(-_+N+R)*(gt+ht-Mt),ye=(_-R)*(gt-Mt),De=_*ht,Ti=(N+R)*(-ht+Mt),Ge=(-_+E+x)*(L+ht-Nt),zi=(_-x)*(L-Nt),fn=(E+x)*(-ht+Nt),qt=g*q,ke=x*Mt,di=C*X,fi=S*at,Le=R*Nt,Ny=j+De+qt,Dy=jt+Gt+ue+j+fe+De+Ti,ky=j+et+rt+_e+De+Ge+fn,jy=pe+At+Gt+j+De+Ge+zi,By=pe+Gt+ue+j+ke,Vy=De+Ge+zi+fn+di,Wy=j+et+mt+le+fe+ye+De,zy=fe+ye+De+Ti+fi,Zy=j+et+mt+rt+Le;return f.set(0,0,Ny),f.set(0,1,Dy),f.set(0,2,ky),f.set(1,0,jy),f.set(1,1,By),f.set(1,2,Vy),f.set(2,0,Wy),f.set(2,1,zy),f.set(2,2,Zy),f}mmulStrassen(d){d=z.checkMatrix(d);let f=this.clone(),l=f.rows,g=f.columns,_=d.rows,C=d.columns;g!==_&&console.warn(`Multiplying ${l} x ${g} and ${_} x ${C} matrix: dimensions do not match.`);function E(R,$,at){let X=R.rows,q=R.columns;if(X===$&&q===at)return R;{let gt=B.zeros($,at);return gt=gt.setSubMatrix(R,0,0),gt}}let x=Math.max(l,_),S=Math.max(g,C);f=E(f,x,S),d=E(d,x,S);function N(R,$,at,X){if(at<=512||X<=512)return R.mmul($);at%2===1&&X%2===1?(R=E(R,at+1,X+1),$=E($,at+1,X+1)):at%2===1?(R=E(R,at+1,X),$=E($,at+1,X)):X%2===1&&(R=E(R,at,X+1),$=E($,at,X+1));let q=parseInt(R.rows/2,10),gt=parseInt(R.columns/2,10),L=R.subMatrix(0,q-1,0,gt-1),ht=$.subMatrix(0,q-1,0,gt-1),Mt=R.subMatrix(0,q-1,gt,R.columns-1),Nt=$.subMatrix(0,q-1,gt,$.columns-1),jt=R.subMatrix(q,R.rows-1,0,gt-1),pe=$.subMatrix(q,$.rows-1,0,gt-1),At=R.subMatrix(q,R.rows-1,gt,R.columns-1),Gt=$.subMatrix(q,$.rows-1,gt,$.columns-1),ue=N(B.add(L,At),B.add(ht,Gt),q,gt),j=N(B.add(jt,At),ht,q,gt),et=N(L,B.sub(Nt,Gt),q,gt),mt=N(At,B.sub(pe,ht),q,gt),rt=N(B.add(L,Mt),Gt,q,gt),_e=N(B.sub(jt,L),B.add(ht,Nt),q,gt),le=N(B.sub(Mt,At),B.add(pe,Gt),q,gt),fe=B.add(ue,mt);fe.sub(rt),fe.add(le);let ye=B.add(et,rt),De=B.add(j,mt),Ti=B.sub(ue,j);Ti.add(et),Ti.add(_e);let Ge=B.zeros(2*fe.rows,2*fe.columns);return Ge=Ge.setSubMatrix(fe,0,0),Ge=Ge.setSubMatrix(ye,fe.rows,0),Ge=Ge.setSubMatrix(De,0,fe.columns),Ge=Ge.setSubMatrix(Ti,fe.rows,fe.columns),Ge.subMatrix(0,at-1,0,X-1)}return N(f,d,x,S)}scaleRows(d={}){if(typeof d!="object")throw new TypeError("options must be an object");const{min:f=0,max:l=1}=d;if(!Number.isFinite(f))throw new TypeError("min must be a number");if(!Number.isFinite(l))throw new TypeError("max must be a number");if(f>=l)throw new RangeError("min must be smaller than max");let g=new z(this.rows,this.columns);for(let _=0;_<this.rows;_++){const C=this.getRow(_);C.length>0&&t(C,{min:f,max:l,output:C}),g.setRow(_,C)}return g}scaleColumns(d={}){if(typeof d!="object")throw new TypeError("options must be an object");const{min:f=0,max:l=1}=d;if(!Number.isFinite(f))throw new TypeError("min must be a number");if(!Number.isFinite(l))throw new TypeError("max must be a number");if(f>=l)throw new RangeError("min must be smaller than max");let g=new z(this.rows,this.columns);for(let _=0;_<this.columns;_++){const C=this.getColumn(_);C.length&&t(C,{min:f,max:l,output:C}),g.setColumn(_,C)}return g}flipRows(){const d=Math.ceil(this.columns/2);for(let f=0;f<this.rows;f++)for(let l=0;l<d;l++){let g=this.get(f,l),_=this.get(f,this.columns-1-l);this.set(f,l,_),this.set(f,this.columns-1-l,g)}return this}flipColumns(){const d=Math.ceil(this.rows/2);for(let f=0;f<this.columns;f++)for(let l=0;l<d;l++){let g=this.get(l,f),_=this.get(this.rows-1-l,f);this.set(l,f,_),this.set(this.rows-1-l,f,g)}return this}kroneckerProduct(d){d=z.checkMatrix(d);let f=this.rows,l=this.columns,g=d.rows,_=d.columns,C=new z(f*g,l*_);for(let E=0;E<f;E++)for(let x=0;x<l;x++)for(let S=0;S<g;S++)for(let N=0;N<_;N++)C.set(g*E+S,_*x+N,this.get(E,x)*d.get(S,N));return C}kroneckerSum(d){if(d=z.checkMatrix(d),!this.isSquare()||!d.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let f=this.rows,l=d.rows,g=this.kroneckerProduct(z.eye(l,l)),_=z.eye(f,f).kroneckerProduct(d);return g.add(_)}transpose(){let d=new z(this.columns,this.rows);for(let f=0;f<this.rows;f++)for(let l=0;l<this.columns;l++)d.set(l,f,this.get(f,l));return d}sortRows(d=dt){for(let f=0;f<this.rows;f++)this.setRow(f,this.getRow(f).sort(d));return this}sortColumns(d=dt){for(let f=0;f<this.columns;f++)this.setColumn(f,this.getColumn(f).sort(d));return this}subMatrix(d,f,l,g){I(this,d,f,l,g);let _=new z(f-d+1,g-l+1);for(let C=d;C<=f;C++)for(let E=l;E<=g;E++)_.set(C-d,E-l,this.get(C,E));return _}subMatrixRow(d,f,l){if(f===void 0&&(f=0),l===void 0&&(l=this.columns-1),f>l||f<0||f>=this.columns||l<0||l>=this.columns)throw new RangeError("Argument out of range");let g=new z(d.length,l-f+1);for(let _=0;_<d.length;_++)for(let C=f;C<=l;C++){if(d[_]<0||d[_]>=this.rows)throw new RangeError(`Row index out of range: ${d[_]}`);g.set(_,C-f,this.get(d[_],C))}return g}subMatrixColumn(d,f,l){if(f===void 0&&(f=0),l===void 0&&(l=this.rows-1),f>l||f<0||f>=this.rows||l<0||l>=this.rows)throw new RangeError("Argument out of range");let g=new z(l-f+1,d.length);for(let _=0;_<d.length;_++)for(let C=f;C<=l;C++){if(d[_]<0||d[_]>=this.columns)throw new RangeError(`Column index out of range: ${d[_]}`);g.set(C-f,_,this.get(C,d[_]))}return g}setSubMatrix(d,f,l){if(d=z.checkMatrix(d),d.isEmpty())return this;let g=f+d.rows-1,_=l+d.columns-1;I(this,f,g,l,_);for(let C=0;C<d.rows;C++)for(let E=0;E<d.columns;E++)this.set(f+C,l+E,d.get(C,E));return this}selection(d,f){w(this,d),v(this,f);let l=new z(d.length,f.length);for(let g=0;g<d.length;g++){let _=d[g];for(let C=0;C<f.length;C++){let E=f[C];l.set(g,C,this.get(_,E))}}return l}trace(){let d=Math.min(this.rows,this.columns),f=0;for(let l=0;l<d;l++)f+=this.get(l,l);return f}clone(){return this.constructor.copy(this,new z(this.rows,this.columns))}static copy(d,f){for(const[l,g,_]of d.entries())f.set(l,g,_);return f}sum(d){switch(d){case"row":return G(this);case"column":return k(this);case void 0:return O(this);default:throw new Error(`invalid option: ${d}`)}}product(d){switch(d){case"row":return U(this);case"column":return Y(this);case void 0:return W(this);default:throw new Error(`invalid option: ${d}`)}}mean(d){const f=this.sum(d);switch(d){case"row":{for(let l=0;l<this.rows;l++)f[l]/=this.columns;return f}case"column":{for(let l=0;l<this.columns;l++)f[l]/=this.rows;return f}case void 0:return f/this.size;default:throw new Error(`invalid option: ${d}`)}}variance(d,f={}){if(typeof d=="object"&&(f=d,d=void 0),typeof f!="object")throw new TypeError("options must be an object");const{unbiased:l=!0,mean:g=this.mean(d)}=f;if(typeof l!="boolean")throw new TypeError("unbiased must be a boolean");switch(d){case"row":{if(!e.isAnyArray(g))throw new TypeError("mean must be an array");return Q(this,l,g)}case"column":{if(!e.isAnyArray(g))throw new TypeError("mean must be an array");return ot(this,l,g)}case void 0:{if(typeof g!="number")throw new TypeError("mean must be a number");return ut(this,l,g)}default:throw new Error(`invalid option: ${d}`)}}standardDeviation(d,f){typeof d=="object"&&(f=d,d=void 0);const l=this.variance(d,f);if(d===void 0)return Math.sqrt(l);for(let g=0;g<l.length;g++)l[g]=Math.sqrt(l[g]);return l}center(d,f={}){if(typeof d=="object"&&(f=d,d=void 0),typeof f!="object")throw new TypeError("options must be an object");const{center:l=this.mean(d)}=f;switch(d){case"row":{if(!e.isAnyArray(l))throw new TypeError("center must be an array");return vt(this,l),this}case"column":{if(!e.isAnyArray(l))throw new TypeError("center must be an array");return A(this,l),this}case void 0:{if(typeof l!="number")throw new TypeError("center must be a number");return D(this,l),this}default:throw new Error(`invalid option: ${d}`)}}scale(d,f={}){if(typeof d=="object"&&(f=d,d=void 0),typeof f!="object")throw new TypeError("options must be an object");let l=f.scale;switch(d){case"row":{if(l===void 0)l=F(this);else if(!e.isAnyArray(l))throw new TypeError("scale must be an array");return Z(this,l),this}case"column":{if(l===void 0)l=H(this);else if(!e.isAnyArray(l))throw new TypeError("scale must be an array");return tt(this,l),this}case void 0:{if(l===void 0)l=V(this);else if(typeof l!="number")throw new TypeError("scale must be a number");return J(this,l),this}default:throw new Error(`invalid option: ${d}`)}}toString(d){return r(this,d)}[Symbol.iterator](){return this.entries()}*entries(){for(let d=0;d<this.rows;d++)for(let f=0;f<this.columns;f++)yield[d,f,this.get(d,f)]}*values(){for(let d=0;d<this.rows;d++)for(let f=0;f<this.columns;f++)yield this.get(d,f)}}B.prototype.klass="Matrix",typeof Symbol<"u"&&(B.prototype[Symbol.for("nodejs.util.inspect.custom")]=s);function dt(M,d){return M-d}function It(M){return M.every(d=>typeof d=="number")}B.random=B.rand,B.randomInt=B.randInt,B.diagonal=B.diag,B.prototype.diagonal=B.prototype.diag,B.identity=B.eye,B.prototype.negate=B.prototype.neg,B.prototype.tensorProduct=B.prototype.kroneckerProduct;class z extends B{data;#t(d,f){if(this.data=[],Number.isInteger(f)&&f>=0)for(let l=0;l<d;l++)this.data.push(new Float64Array(f));else throw new TypeError("nColumns must be a positive integer");this.rows=d,this.columns=f}constructor(d,f){if(super(),z.isMatrix(d))this.#t(d.rows,d.columns),z.copy(d,this);else if(Number.isInteger(d)&&d>=0)this.#t(d,f);else if(e.isAnyArray(d)){const l=d;if(d=l.length,f=d?l[0].length:0,typeof f!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let g=0;g<d;g++){if(l[g].length!==f)throw new RangeError("Inconsistent array dimensions");if(!It(l[g]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(l[g]))}this.rows=d,this.columns=f}else throw new TypeError("First argument must be a positive number or an array")}set(d,f,l){return this.data[d][f]=l,this}get(d,f){return this.data[d][f]}removeRow(d){return u(this,d),this.data.splice(d,1),this.rows-=1,this}addRow(d,f){return f===void 0&&(f=d,d=this.rows),u(this,d,!0),f=Float64Array.from(p(this,f)),this.data.splice(d,0,f),this.rows+=1,this}removeColumn(d){m(this,d);for(let f=0;f<this.rows;f++){const l=new Float64Array(this.columns-1);for(let g=0;g<d;g++)l[g]=this.data[f][g];for(let g=d+1;g<this.columns;g++)l[g-1]=this.data[f][g];this.data[f]=l}return this.columns-=1,this}addColumn(d,f){typeof f>"u"&&(f=d,d=this.columns),m(this,d,!0),f=y(this,f);for(let l=0;l<this.rows;l++){const g=new Float64Array(this.columns+1);let _=0;for(;_<d;_++)g[_]=this.data[l][_];for(g[_++]=f[l];_<this.columns+1;_++)g[_]=this.data[l][_-1];this.data[l]=g}return this.columns+=1,this}}c(B,z);class bt extends B{#t;get size(){return this.#t.size}get rows(){return this.#t.rows}get columns(){return this.#t.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(d){return z.isMatrix(d)&&d.klassType==="SymmetricMatrix"}static zeros(d){return new this(d)}static ones(d){return new this(d).fill(1)}constructor(d){if(super(),z.isMatrix(d)){if(!d.isSymmetric())throw new TypeError("not symmetric data");this.#t=z.copy(d,new z(d.rows,d.rows))}else if(Number.isInteger(d)&&d>=0)this.#t=new z(d,d);else if(this.#t=new z(d),!this.isSymmetric())throw new TypeError("not symmetric data")}clone(){const d=new bt(this.diagonalSize);for(const[f,l,g]of this.upperRightEntries())d.set(f,l,g);return d}toMatrix(){return new z(this)}get(d,f){return this.#t.get(d,f)}set(d,f,l){return this.#t.set(d,f,l),this.#t.set(f,d,l),this}removeCross(d){return this.#t.removeRow(d),this.#t.removeColumn(d),this}addCross(d,f){f===void 0&&(f=d,d=this.diagonalSize);const l=f.slice();return l.splice(d,1),this.#t.addRow(d,l),this.#t.addColumn(d,f),this}applyMask(d){if(d.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const f=[];for(const[l,g]of d.entries())g||f.push(l);f.reverse();for(const l of f)this.removeCross(l);return this}toCompact(){const{diagonalSize:d}=this,f=new Array(d*(d+1)/2);for(let l=0,g=0,_=0;_<f.length;_++)f[_]=this.get(g,l),++l>=d&&(l=++g);return f}static fromCompact(d){const f=d.length,l=(Math.sqrt(8*f+1)-1)/2;if(!Number.isInteger(l))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(d)}`);const g=new bt(l);for(let _=0,C=0,E=0;E<f;E++)g.set(_,C,d[E]),++_>=l&&(_=++C);return g}*upperRightEntries(){for(let d=0,f=0;d<this.diagonalSize;void 0){const l=this.get(d,f);yield[d,f,l],++f>=this.diagonalSize&&(f=++d)}}*upperRightValues(){for(let d=0,f=0;d<this.diagonalSize;void 0)yield this.get(d,f),++f>=this.diagonalSize&&(f=++d)}}bt.prototype.klassType="SymmetricMatrix";class Et extends bt{static isDistanceMatrix(d){return bt.isSymmetricMatrix(d)&&d.klassSubType==="DistanceMatrix"}constructor(d){if(super(d),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(d,f,l){return d===f&&(l=0),super.set(d,f,l)}addCross(d,f){return f===void 0&&(f=d,d=this.diagonalSize),f=f.slice(),f[d]=0,super.addCross(d,f)}toSymmetricMatrix(){return new bt(this)}clone(){const d=new Et(this.diagonalSize);for(const[f,l,g]of this.upperRightEntries())f!==l&&d.set(f,l,g);return d}toCompact(){const{diagonalSize:d}=this,f=(d-1)*d/2,l=new Array(f);for(let g=1,_=0,C=0;C<l.length;C++)l[C]=this.get(_,g),++g>=d&&(g=++_+1);return l}static fromCompact(d){const f=d.length;if(f===0)return new this(0);const l=(Math.sqrt(8*f+1)+1)/2;if(!Number.isInteger(l))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(d)}`);const g=new this(l);for(let _=1,C=0,E=0;E<f;E++)g.set(_,C,d[E]),++_>=l&&(_=++C+1);return g}}Et.prototype.klassSubType="DistanceMatrix";class Ot extends B{constructor(d,f,l){super(),this.matrix=d,this.rows=f,this.columns=l}}class Vt extends Ot{constructor(d,f){m(d,f),super(d,d.rows,1),this.column=f}set(d,f,l){return this.matrix.set(d,this.column,l),this}get(d){return this.matrix.get(d,this.column)}}class Wt extends Ot{constructor(d,f){v(d,f),super(d,d.rows,f.length),this.columnIndices=f}set(d,f,l){return this.matrix.set(d,this.columnIndices[f],l),this}get(d,f){return this.matrix.get(d,this.columnIndices[f])}}class Kt extends Ot{constructor(d){super(d,d.rows,d.columns)}set(d,f,l){return this.matrix.set(d,this.columns-f-1,l),this}get(d,f){return this.matrix.get(d,this.columns-f-1)}}class Zt extends Ot{constructor(d){super(d,d.rows,d.columns)}set(d,f,l){return this.matrix.set(this.rows-d-1,f,l),this}get(d,f){return this.matrix.get(this.rows-d-1,f)}}class Ht extends Ot{constructor(d,f){u(d,f),super(d,1,d.columns),this.row=f}set(d,f,l){return this.matrix.set(this.row,f,l),this}get(d,f){return this.matrix.get(this.row,f)}}class Ne extends Ot{constructor(d,f){w(d,f),super(d,f.length,d.columns),this.rowIndices=f}set(d,f,l){return this.matrix.set(this.rowIndices[d],f,l),this}get(d,f){return this.matrix.get(this.rowIndices[d],f)}}class ei extends Ot{constructor(d,f,l){w(d,f),v(d,l),super(d,f.length,l.length),this.rowIndices=f,this.columnIndices=l}set(d,f,l){return this.matrix.set(this.rowIndices[d],this.columnIndices[f],l),this}get(d,f){return this.matrix.get(this.rowIndices[d],this.columnIndices[f])}}class xe extends Ot{constructor(d,f,l,g,_){I(d,f,l,g,_),super(d,l-f+1,_-g+1),this.startRow=f,this.startColumn=g}set(d,f,l){return this.matrix.set(this.startRow+d,this.startColumn+f,l),this}get(d,f){return this.matrix.get(this.startRow+d,this.startColumn+f)}}class Se extends Ot{constructor(d){super(d,d.columns,d.rows)}set(d,f,l){return this.matrix.set(f,d,l),this}get(d,f){return this.matrix.get(f,d)}}class va extends B{constructor(d,f={}){const{rows:l=1}=f;if(d.length%l!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=l,this.columns=d.length/l,this.data=d}set(d,f,l){let g=this._calculateIndex(d,f);return this.data[g]=l,this}get(d,f){let l=this._calculateIndex(d,f);return this.data[l]}_calculateIndex(d,f){return d*this.columns+f}}class We extends B{constructor(d){super(),this.data=d,this.rows=d.length,this.columns=d[0].length}set(d,f,l){return this.data[d][f]=l,this}get(d,f){return this.data[d][f]}}function Vr(M,d){if(e.isAnyArray(M))return M[0]&&e.isAnyArray(M[0])?new We(M):new va(M,d);throw new Error("the argument is not an array")}class Bs{constructor(d){d=We.checkMatrix(d);let f=d.clone(),l=f.rows,g=f.columns,_=new Float64Array(l),C=1,E,x,S,N,R,$,at,X,q;for(E=0;E<l;E++)_[E]=E;for(X=new Float64Array(l),x=0;x<g;x++){for(E=0;E<l;E++)X[E]=f.get(E,x);for(E=0;E<l;E++){for(q=Math.min(E,x),R=0,S=0;S<q;S++)R+=f.get(E,S)*X[S];X[E]-=R,f.set(E,x,X[E])}for(N=x,E=x+1;E<l;E++)Math.abs(X[E])>Math.abs(X[N])&&(N=E);if(N!==x){for(S=0;S<g;S++)$=f.get(N,S),f.set(N,S,f.get(x,S)),f.set(x,S,$);at=_[N],_[N]=_[x],_[x]=at,C=-C}if(x<l&&f.get(x,x)!==0)for(E=x+1;E<l;E++)f.set(E,x,f.get(E,x)/f.get(x,x))}this.LU=f,this.pivotVector=_,this.pivotSign=C}isSingular(){let d=this.LU,f=d.columns;for(let l=0;l<f;l++)if(d.get(l,l)===0)return!0;return!1}solve(d){d=z.checkMatrix(d);let f=this.LU;if(f.rows!==d.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let g=d.columns,_=d.subMatrixRow(this.pivotVector,0,g-1),C=f.columns,E,x,S;for(S=0;S<C;S++)for(E=S+1;E<C;E++)for(x=0;x<g;x++)_.set(E,x,_.get(E,x)-_.get(S,x)*f.get(E,S));for(S=C-1;S>=0;S--){for(x=0;x<g;x++)_.set(S,x,_.get(S,x)/f.get(S,S));for(E=0;E<S;E++)for(x=0;x<g;x++)_.set(E,x,_.get(E,x)-_.get(S,x)*f.get(E,S))}return _}get determinant(){let d=this.LU;if(!d.isSquare())throw new Error("Matrix must be square");let f=this.pivotSign,l=d.columns;for(let g=0;g<l;g++)f*=d.get(g,g);return f}get lowerTriangularMatrix(){let d=this.LU,f=d.rows,l=d.columns,g=new z(f,l);for(let _=0;_<f;_++)for(let C=0;C<l;C++)_>C?g.set(_,C,d.get(_,C)):_===C?g.set(_,C,1):g.set(_,C,0);return g}get upperTriangularMatrix(){let d=this.LU,f=d.rows,l=d.columns,g=new z(f,l);for(let _=0;_<f;_++)for(let C=0;C<l;C++)_<=C?g.set(_,C,d.get(_,C)):g.set(_,C,0);return g}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ii(M,d){let f=0;return Math.abs(M)>Math.abs(d)?(f=d/M,Math.abs(M)*Math.sqrt(1+f*f)):d!==0?(f=M/d,Math.abs(d)*Math.sqrt(1+f*f)):0}class un{constructor(d){d=We.checkMatrix(d);let f=d.clone(),l=d.rows,g=d.columns,_=new Float64Array(g),C,E,x,S;for(x=0;x<g;x++){let N=0;for(C=x;C<l;C++)N=ii(N,f.get(C,x));if(N!==0){for(f.get(x,x)<0&&(N=-N),C=x;C<l;C++)f.set(C,x,f.get(C,x)/N);for(f.set(x,x,f.get(x,x)+1),E=x+1;E<g;E++){for(S=0,C=x;C<l;C++)S+=f.get(C,x)*f.get(C,E);for(S=-S/f.get(x,x),C=x;C<l;C++)f.set(C,E,f.get(C,E)+S*f.get(C,x))}}_[x]=-N}this.QR=f,this.Rdiag=_}solve(d){d=z.checkMatrix(d);let f=this.QR,l=f.rows;if(d.rows!==l)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let g=d.columns,_=d.clone(),C=f.columns,E,x,S,N;for(S=0;S<C;S++)for(x=0;x<g;x++){for(N=0,E=S;E<l;E++)N+=f.get(E,S)*_.get(E,x);for(N=-N/f.get(S,S),E=S;E<l;E++)_.set(E,x,_.get(E,x)+N*f.get(E,S))}for(S=C-1;S>=0;S--){for(x=0;x<g;x++)_.set(S,x,_.get(S,x)/this.Rdiag[S]);for(E=0;E<S;E++)for(x=0;x<g;x++)_.set(E,x,_.get(E,x)-_.get(S,x)*f.get(E,S))}return _.subMatrix(0,C-1,0,g-1)}isFullRank(){let d=this.QR.columns;for(let f=0;f<d;f++)if(this.Rdiag[f]===0)return!1;return!0}get upperTriangularMatrix(){let d=this.QR,f=d.columns,l=new z(f,f),g,_;for(g=0;g<f;g++)for(_=0;_<f;_++)g<_?l.set(g,_,d.get(g,_)):g===_?l.set(g,_,this.Rdiag[g]):l.set(g,_,0);return l}get orthogonalMatrix(){let d=this.QR,f=d.rows,l=d.columns,g=new z(f,l),_,C,E,x;for(E=l-1;E>=0;E--){for(_=0;_<f;_++)g.set(_,E,0);for(g.set(E,E,1),C=E;C<l;C++)if(d.get(E,E)!==0){for(x=0,_=E;_<f;_++)x+=d.get(_,E)*g.get(_,C);for(x=-x/d.get(E,E),_=E;_<f;_++)g.set(_,C,g.get(_,C)+x*d.get(_,E))}}return g}}class Wi{constructor(d,f={}){if(d=We.checkMatrix(d),d.isEmpty())throw new Error("Matrix must be non-empty");let l=d.rows,g=d.columns;const{computeLeftSingularVectors:_=!0,computeRightSingularVectors:C=!0,autoTranspose:E=!1}=f;let x=!!_,S=!!C,N=!1,R;if(l<g)if(!E)R=d.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{R=d.transpose(),l=R.rows,g=R.columns,N=!0;let j=x;x=S,S=j}else R=d.clone();let $=Math.min(l,g),at=Math.min(l+1,g),X=new Float64Array(at),q=new z(l,$),gt=new z(g,g),L=new Float64Array(g),ht=new Float64Array(l),Mt=new Float64Array(at);for(let j=0;j<at;j++)Mt[j]=j;let Nt=Math.min(l-1,g),jt=Math.max(0,Math.min(g-2,l)),pe=Math.max(Nt,jt);for(let j=0;j<pe;j++){if(j<Nt){X[j]=0;for(let et=j;et<l;et++)X[j]=ii(X[j],R.get(et,j));if(X[j]!==0){R.get(j,j)<0&&(X[j]=-X[j]);for(let et=j;et<l;et++)R.set(et,j,R.get(et,j)/X[j]);R.set(j,j,R.get(j,j)+1)}X[j]=-X[j]}for(let et=j+1;et<g;et++){if(j<Nt&&X[j]!==0){let mt=0;for(let rt=j;rt<l;rt++)mt+=R.get(rt,j)*R.get(rt,et);mt=-mt/R.get(j,j);for(let rt=j;rt<l;rt++)R.set(rt,et,R.get(rt,et)+mt*R.get(rt,j))}L[et]=R.get(j,et)}if(x&&j<Nt)for(let et=j;et<l;et++)q.set(et,j,R.get(et,j));if(j<jt){L[j]=0;for(let et=j+1;et<g;et++)L[j]=ii(L[j],L[et]);if(L[j]!==0){L[j+1]<0&&(L[j]=0-L[j]);for(let et=j+1;et<g;et++)L[et]/=L[j];L[j+1]+=1}if(L[j]=-L[j],j+1<l&&L[j]!==0){for(let et=j+1;et<l;et++)ht[et]=0;for(let et=j+1;et<l;et++)for(let mt=j+1;mt<g;mt++)ht[et]+=L[mt]*R.get(et,mt);for(let et=j+1;et<g;et++){let mt=-L[et]/L[j+1];for(let rt=j+1;rt<l;rt++)R.set(rt,et,R.get(rt,et)+mt*ht[rt])}}if(S)for(let et=j+1;et<g;et++)gt.set(et,j,L[et])}}let At=Math.min(g,l+1);if(Nt<g&&(X[Nt]=R.get(Nt,Nt)),l<At&&(X[At-1]=0),jt+1<At&&(L[jt]=R.get(jt,At-1)),L[At-1]=0,x){for(let j=Nt;j<$;j++){for(let et=0;et<l;et++)q.set(et,j,0);q.set(j,j,1)}for(let j=Nt-1;j>=0;j--)if(X[j]!==0){for(let et=j+1;et<$;et++){let mt=0;for(let rt=j;rt<l;rt++)mt+=q.get(rt,j)*q.get(rt,et);mt=-mt/q.get(j,j);for(let rt=j;rt<l;rt++)q.set(rt,et,q.get(rt,et)+mt*q.get(rt,j))}for(let et=j;et<l;et++)q.set(et,j,-q.get(et,j));q.set(j,j,1+q.get(j,j));for(let et=0;et<j-1;et++)q.set(et,j,0)}else{for(let et=0;et<l;et++)q.set(et,j,0);q.set(j,j,1)}}if(S)for(let j=g-1;j>=0;j--){if(j<jt&&L[j]!==0)for(let et=j+1;et<g;et++){let mt=0;for(let rt=j+1;rt<g;rt++)mt+=gt.get(rt,j)*gt.get(rt,et);mt=-mt/gt.get(j+1,j);for(let rt=j+1;rt<g;rt++)gt.set(rt,et,gt.get(rt,et)+mt*gt.get(rt,j))}for(let et=0;et<g;et++)gt.set(et,j,0);gt.set(j,j,1)}let Gt=At-1,ue=Number.EPSILON;for(;At>0;){let j,et;for(j=At-2;j>=-1&&j!==-1;j--){const mt=Number.MIN_VALUE+ue*Math.abs(X[j]+Math.abs(X[j+1]));if(Math.abs(L[j])<=mt||Number.isNaN(L[j])){L[j]=0;break}}if(j===At-2)et=4;else{let mt;for(mt=At-1;mt>=j&&mt!==j;mt--){let rt=(mt!==At?Math.abs(L[mt]):0)+(mt!==j+1?Math.abs(L[mt-1]):0);if(Math.abs(X[mt])<=ue*rt){X[mt]=0;break}}mt===j?et=3:mt===At-1?et=1:(et=2,j=mt)}switch(j++,et){case 1:{let mt=L[At-2];L[At-2]=0;for(let rt=At-2;rt>=j;rt--){let _e=ii(X[rt],mt),le=X[rt]/_e,fe=mt/_e;if(X[rt]=_e,rt!==j&&(mt=-fe*L[rt-1],L[rt-1]=le*L[rt-1]),S)for(let ye=0;ye<g;ye++)_e=le*gt.get(ye,rt)+fe*gt.get(ye,At-1),gt.set(ye,At-1,-fe*gt.get(ye,rt)+le*gt.get(ye,At-1)),gt.set(ye,rt,_e)}break}case 2:{let mt=L[j-1];L[j-1]=0;for(let rt=j;rt<At;rt++){let _e=ii(X[rt],mt),le=X[rt]/_e,fe=mt/_e;if(X[rt]=_e,mt=-fe*L[rt],L[rt]=le*L[rt],x)for(let ye=0;ye<l;ye++)_e=le*q.get(ye,rt)+fe*q.get(ye,j-1),q.set(ye,j-1,-fe*q.get(ye,rt)+le*q.get(ye,j-1)),q.set(ye,rt,_e)}break}case 3:{const mt=Math.max(Math.abs(X[At-1]),Math.abs(X[At-2]),Math.abs(L[At-2]),Math.abs(X[j]),Math.abs(L[j])),rt=X[At-1]/mt,_e=X[At-2]/mt,le=L[At-2]/mt,fe=X[j]/mt,ye=L[j]/mt,De=((_e+rt)*(_e-rt)+le*le)/2,Ti=rt*le*(rt*le);let Ge=0;(De!==0||Ti!==0)&&(De<0?Ge=0-Math.sqrt(De*De+Ti):Ge=Math.sqrt(De*De+Ti),Ge=Ti/(De+Ge));let zi=(fe+rt)*(fe-rt)+Ge,fn=fe*ye;for(let qt=j;qt<At-1;qt++){let ke=ii(zi,fn);ke===0&&(ke=Number.MIN_VALUE);let di=zi/ke,fi=fn/ke;if(qt!==j&&(L[qt-1]=ke),zi=di*X[qt]+fi*L[qt],L[qt]=di*L[qt]-fi*X[qt],fn=fi*X[qt+1],X[qt+1]=di*X[qt+1],S)for(let Le=0;Le<g;Le++)ke=di*gt.get(Le,qt)+fi*gt.get(Le,qt+1),gt.set(Le,qt+1,-fi*gt.get(Le,qt)+di*gt.get(Le,qt+1)),gt.set(Le,qt,ke);if(ke=ii(zi,fn),ke===0&&(ke=Number.MIN_VALUE),di=zi/ke,fi=fn/ke,X[qt]=ke,zi=di*L[qt]+fi*X[qt+1],X[qt+1]=-fi*L[qt]+di*X[qt+1],fn=fi*L[qt+1],L[qt+1]=di*L[qt+1],x&&qt<l-1)for(let Le=0;Le<l;Le++)ke=di*q.get(Le,qt)+fi*q.get(Le,qt+1),q.set(Le,qt+1,-fi*q.get(Le,qt)+di*q.get(Le,qt+1)),q.set(Le,qt,ke)}L[At-2]=zi;break}case 4:{if(X[j]<=0&&(X[j]=X[j]<0?-X[j]:0,S))for(let mt=0;mt<=Gt;mt++)gt.set(mt,j,-gt.get(mt,j));for(;j<Gt&&!(X[j]>=X[j+1]);){let mt=X[j];if(X[j]=X[j+1],X[j+1]=mt,S&&j<g-1)for(let rt=0;rt<g;rt++)mt=gt.get(rt,j+1),gt.set(rt,j+1,gt.get(rt,j)),gt.set(rt,j,mt);if(x&&j<l-1)for(let rt=0;rt<l;rt++)mt=q.get(rt,j+1),q.set(rt,j+1,q.get(rt,j)),q.set(rt,j,mt);j++}At--;break}}}if(N){let j=gt;gt=q,q=j}this.m=l,this.n=g,this.s=X,this.U=q,this.V=gt}solve(d){let f=d,l=this.threshold,g=this.s.length,_=z.zeros(g,g);for(let $=0;$<g;$++)Math.abs(this.s[$])<=l?_.set($,$,0):_.set($,$,1/this.s[$]);let C=this.U,E=this.rightSingularVectors,x=E.mmul(_),S=E.rows,N=C.rows,R=z.zeros(S,N);for(let $=0;$<S;$++)for(let at=0;at<N;at++){let X=0;for(let q=0;q<g;q++)X+=x.get($,q)*C.get(at,q);R.set($,at,X)}return R.mmul(f)}solveForDiagonal(d){return this.solve(z.diag(d))}inverse(){let d=this.V,f=this.threshold,l=d.rows,g=d.columns,_=new z(l,this.s.length);for(let N=0;N<l;N++)for(let R=0;R<g;R++)Math.abs(this.s[R])>f&&_.set(N,R,d.get(N,R)/this.s[R]);let C=this.U,E=C.rows,x=C.columns,S=new z(l,E);for(let N=0;N<l;N++)for(let R=0;R<E;R++){let $=0;for(let at=0;at<x;at++)$+=_.get(N,at)*C.get(R,at);S.set(N,R,$)}return S}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let d=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,f=0,l=this.s;for(let g=0,_=l.length;g<_;g++)l[g]>d&&f++;return f}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return z.diag(this.s)}}function Wr(M,d=!1){return M=We.checkMatrix(M),d?new Wi(M).inverse():ls(M,z.eye(M.rows))}function ls(M,d,f=!1){return M=We.checkMatrix(M),d=We.checkMatrix(d),f?new Wi(M).solve(d):M.isSquare()?new Bs(M).solve(d):new un(M).solve(d)}function dn(M){if(M=z.checkMatrix(M),M.isSquare()){if(M.columns===0)return 1;let d,f,l,g;if(M.columns===2)return d=M.get(0,0),f=M.get(0,1),l=M.get(1,0),g=M.get(1,1),d*g-f*l;if(M.columns===3){let _,C,E;return _=new ei(M,[1,2],[1,2]),C=new ei(M,[1,2],[0,2]),E=new ei(M,[1,2],[0,1]),d=M.get(0,0),f=M.get(0,1),l=M.get(0,2),d*dn(_)-f*dn(C)+l*dn(E)}else return new Bs(M).determinant}else throw Error("determinant can only be calculated for a square matrix")}function rl(M,d){let f=[];for(let l=0;l<M;l++)l!==d&&f.push(l);return f}function Ma(M,d,f,l=1e-9,g=1e-9){if(M>g)return new Array(d.rows+1).fill(0);{let _=d.addRow(f,[0]);for(let C=0;C<_.rows;C++)Math.abs(_.get(C,0))<l&&_.set(C,0,0);return _.to1DArray()}}function Ia(M,d={}){const{thresholdValue:f=1e-9,thresholdError:l=1e-9}=d;M=z.checkMatrix(M);let g=M.rows,_=new z(g,g);for(let C=0;C<g;C++){let E=z.columnVector(M.getRow(C)),x=M.subMatrixRow(rl(g,C)).transpose(),N=new Wi(x).solve(E),R=z.sub(E,x.mmul(N)).abs().max();_.setRow(C,Ma(R,N,C,f,l))}return _}function zr(M,d=Number.EPSILON){if(M=z.checkMatrix(M),M.isEmpty())return M.transpose();let f=new Wi(M,{autoTranspose:!0}),l=f.leftSingularVectors,g=f.rightSingularVectors,_=f.diagonal;for(let C=0;C<_.length;C++)Math.abs(_[C])>d?_[C]=1/_[C]:_[C]=0;return g.mmul(z.diag(_).mmul(l.transpose()))}function ol(M,d=M,f={}){M=new z(M);let l=!1;if(typeof d=="object"&&!z.isMatrix(d)&&!e.isAnyArray(d)?(f=d,d=M,l=!0):d=new z(d),M.rows!==d.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:g=!0}=f;g&&(M=M.center("column"),l||(d=d.center("column")));const _=M.transpose().mmul(d);for(let C=0;C<_.rows;C++)for(let E=0;E<_.columns;E++)_.set(C,E,_.get(C,E)*(1/(M.rows-1)));return _}function al(M,d=M,f={}){M=new z(M);let l=!1;if(typeof d=="object"&&!z.isMatrix(d)&&!e.isAnyArray(d)?(f=d,d=M,l=!0):d=new z(d),M.rows!==d.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:g=!0,scale:_=!0}=f;g&&(M.center("column"),l||d.center("column")),_&&(M.scale("column"),l||d.scale("column"));const C=M.standardDeviation("column",{unbiased:!0}),E=l?C:d.standardDeviation("column",{unbiased:!0}),x=M.transpose().mmul(d);for(let S=0;S<x.rows;S++)for(let N=0;N<x.columns;N++)x.set(S,N,x.get(S,N)*(1/(C[S]*E[N]))*(1/(M.rows-1)));return x}class Zr{constructor(d,f={}){const{assumeSymmetric:l=!1}=f;if(d=We.checkMatrix(d),!d.isSquare())throw new Error("Matrix is not a square matrix");if(d.isEmpty())throw new Error("Matrix must be non-empty");let g=d.columns,_=new z(g,g),C=new Float64Array(g),E=new Float64Array(g),x=d,S,N,R=!1;if(l?R=!0:R=d.isSymmetric(),R){for(S=0;S<g;S++)for(N=0;N<g;N++)_.set(S,N,x.get(S,N));Ea(g,E,C,_),Ur(g,E,C,_)}else{let $=new z(g,g),at=new Float64Array(g);for(N=0;N<g;N++)for(S=0;S<g;S++)$.set(S,N,x.get(S,N));Ca(g,$,at,_),hl(g,E,C,_,$)}this.n=g,this.e=E,this.d=C,this.V=_}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let d=this.n,f=this.e,l=this.d,g=new z(d,d),_,C;for(_=0;_<d;_++){for(C=0;C<d;C++)g.set(_,C,0);g.set(_,_,l[_]),f[_]>0?g.set(_,_+1,f[_]):f[_]<0&&g.set(_,_-1,f[_])}return g}}function Ea(M,d,f,l){let g,_,C,E,x,S,N,R;for(x=0;x<M;x++)f[x]=l.get(M-1,x);for(E=M-1;E>0;E--){for(R=0,C=0,S=0;S<E;S++)R=R+Math.abs(f[S]);if(R===0)for(d[E]=f[E-1],x=0;x<E;x++)f[x]=l.get(E-1,x),l.set(E,x,0),l.set(x,E,0);else{for(S=0;S<E;S++)f[S]/=R,C+=f[S]*f[S];for(g=f[E-1],_=Math.sqrt(C),g>0&&(_=-_),d[E]=R*_,C=C-g*_,f[E-1]=g-_,x=0;x<E;x++)d[x]=0;for(x=0;x<E;x++){for(g=f[x],l.set(x,E,g),_=d[x]+l.get(x,x)*g,S=x+1;S<=E-1;S++)_+=l.get(S,x)*f[S],d[S]+=l.get(S,x)*g;d[x]=_}for(g=0,x=0;x<E;x++)d[x]/=C,g+=d[x]*f[x];for(N=g/(C+C),x=0;x<E;x++)d[x]-=N*f[x];for(x=0;x<E;x++){for(g=f[x],_=d[x],S=x;S<=E-1;S++)l.set(S,x,l.get(S,x)-(g*d[S]+_*f[S]));f[x]=l.get(E-1,x),l.set(E,x,0)}}f[E]=C}for(E=0;E<M-1;E++){if(l.set(M-1,E,l.get(E,E)),l.set(E,E,1),C=f[E+1],C!==0){for(S=0;S<=E;S++)f[S]=l.get(S,E+1)/C;for(x=0;x<=E;x++){for(_=0,S=0;S<=E;S++)_+=l.get(S,E+1)*l.get(S,x);for(S=0;S<=E;S++)l.set(S,x,l.get(S,x)-_*f[S])}}for(S=0;S<=E;S++)l.set(S,E+1,0)}for(x=0;x<M;x++)f[x]=l.get(M-1,x),l.set(M-1,x,0);l.set(M-1,M-1,1),d[0]=0}function Ur(M,d,f,l){let g,_,C,E,x,S,N,R,$,at,X,q,gt,L,ht,Mt;for(C=1;C<M;C++)d[C-1]=d[C];d[M-1]=0;let Nt=0,jt=0,pe=Number.EPSILON;for(S=0;S<M;S++){for(jt=Math.max(jt,Math.abs(f[S])+Math.abs(d[S])),N=S;N<M&&!(Math.abs(d[N])<=pe*jt);)N++;if(N>S)do{for(g=f[S],R=(f[S+1]-g)/(2*d[S]),$=ii(R,1),R<0&&($=-$),f[S]=d[S]/(R+$),f[S+1]=d[S]*(R+$),at=f[S+1],_=g-f[S],C=S+2;C<M;C++)f[C]-=_;for(Nt=Nt+_,R=f[N],X=1,q=X,gt=X,L=d[S+1],ht=0,Mt=0,C=N-1;C>=S;C--)for(gt=q,q=X,Mt=ht,g=X*d[C],_=X*R,$=ii(R,d[C]),d[C+1]=ht*$,ht=d[C]/$,X=R/$,R=X*f[C]-ht*g,f[C+1]=_+ht*(X*g+ht*f[C]),x=0;x<M;x++)_=l.get(x,C+1),l.set(x,C+1,ht*l.get(x,C)+X*_),l.set(x,C,X*l.get(x,C)-ht*_);R=-ht*Mt*gt*L*d[S]/at,d[S]=ht*R,f[S]=X*R}while(Math.abs(d[S])>pe*jt);f[S]=f[S]+Nt,d[S]=0}for(C=0;C<M-1;C++){for(x=C,R=f[C],E=C+1;E<M;E++)f[E]<R&&(x=E,R=f[E]);if(x!==C)for(f[x]=f[C],f[C]=R,E=0;E<M;E++)R=l.get(E,C),l.set(E,C,l.get(E,x)),l.set(E,x,R)}}function Ca(M,d,f,l){let g=0,_=M-1,C,E,x,S,N,R,$;for(R=g+1;R<=_-1;R++){for($=0,S=R;S<=_;S++)$=$+Math.abs(d.get(S,R-1));if($!==0){for(x=0,S=_;S>=R;S--)f[S]=d.get(S,R-1)/$,x+=f[S]*f[S];for(E=Math.sqrt(x),f[R]>0&&(E=-E),x=x-f[R]*E,f[R]=f[R]-E,N=R;N<M;N++){for(C=0,S=_;S>=R;S--)C+=f[S]*d.get(S,N);for(C=C/x,S=R;S<=_;S++)d.set(S,N,d.get(S,N)-C*f[S])}for(S=0;S<=_;S++){for(C=0,N=_;N>=R;N--)C+=f[N]*d.get(S,N);for(C=C/x,N=R;N<=_;N++)d.set(S,N,d.get(S,N)-C*f[N])}f[R]=$*f[R],d.set(R,R-1,$*E)}}for(S=0;S<M;S++)for(N=0;N<M;N++)l.set(S,N,S===N?1:0);for(R=_-1;R>=g+1;R--)if(d.get(R,R-1)!==0){for(S=R+1;S<=_;S++)f[S]=d.get(S,R-1);for(N=R;N<=_;N++){for(E=0,S=R;S<=_;S++)E+=f[S]*l.get(S,N);for(E=E/f[R]/d.get(R,R-1),S=R;S<=_;S++)l.set(S,N,l.get(S,N)+E*f[S])}}}function hl(M,d,f,l,g){let _=M-1,C=0,E=M-1,x=Number.EPSILON,S=0,N=0,R=0,$=0,at=0,X=0,q=0,gt=0,L,ht,Mt,Nt,jt,pe,At,Gt,ue,j,et,mt,rt,_e,le;for(L=0;L<M;L++)for((L<C||L>E)&&(f[L]=g.get(L,L),d[L]=0),ht=Math.max(L-1,0);ht<M;ht++)N=N+Math.abs(g.get(L,ht));for(;_>=C;){for(Nt=_;Nt>C&&(X=Math.abs(g.get(Nt-1,Nt-1))+Math.abs(g.get(Nt,Nt)),X===0&&(X=N),!(Math.abs(g.get(Nt,Nt-1))<x*X));)Nt--;if(Nt===_)g.set(_,_,g.get(_,_)+S),f[_]=g.get(_,_),d[_]=0,_--,gt=0;else if(Nt===_-1){if(At=g.get(_,_-1)*g.get(_-1,_),R=(g.get(_-1,_-1)-g.get(_,_))/2,$=R*R+At,q=Math.sqrt(Math.abs($)),g.set(_,_,g.get(_,_)+S),g.set(_-1,_-1,g.get(_-1,_-1)+S),Gt=g.get(_,_),$>=0){for(q=R>=0?R+q:R-q,f[_-1]=Gt+q,f[_]=f[_-1],q!==0&&(f[_]=Gt-At/q),d[_-1]=0,d[_]=0,Gt=g.get(_,_-1),X=Math.abs(Gt)+Math.abs(q),R=Gt/X,$=q/X,at=Math.sqrt(R*R+$*$),R=R/at,$=$/at,ht=_-1;ht<M;ht++)q=g.get(_-1,ht),g.set(_-1,ht,$*q+R*g.get(_,ht)),g.set(_,ht,$*g.get(_,ht)-R*q);for(L=0;L<=_;L++)q=g.get(L,_-1),g.set(L,_-1,$*q+R*g.get(L,_)),g.set(L,_,$*g.get(L,_)-R*q);for(L=C;L<=E;L++)q=l.get(L,_-1),l.set(L,_-1,$*q+R*l.get(L,_)),l.set(L,_,$*l.get(L,_)-R*q)}else f[_-1]=Gt+R,f[_]=Gt+R,d[_-1]=q,d[_]=-q;_=_-2,gt=0}else{if(Gt=g.get(_,_),ue=0,At=0,Nt<_&&(ue=g.get(_-1,_-1),At=g.get(_,_-1)*g.get(_-1,_)),gt===10){for(S+=Gt,L=C;L<=_;L++)g.set(L,L,g.get(L,L)-Gt);X=Math.abs(g.get(_,_-1))+Math.abs(g.get(_-1,_-2)),Gt=ue=.75*X,At=-.4375*X*X}if(gt===30&&(X=(ue-Gt)/2,X=X*X+At,X>0)){for(X=Math.sqrt(X),ue<Gt&&(X=-X),X=Gt-At/((ue-Gt)/2+X),L=C;L<=_;L++)g.set(L,L,g.get(L,L)-X);S+=X,Gt=ue=At=.964}for(gt=gt+1,jt=_-2;jt>=Nt&&(q=g.get(jt,jt),at=Gt-q,X=ue-q,R=(at*X-At)/g.get(jt+1,jt)+g.get(jt,jt+1),$=g.get(jt+1,jt+1)-q-at-X,at=g.get(jt+2,jt+1),X=Math.abs(R)+Math.abs($)+Math.abs(at),R=R/X,$=$/X,at=at/X,!(jt===Nt||Math.abs(g.get(jt,jt-1))*(Math.abs($)+Math.abs(at))<x*(Math.abs(R)*(Math.abs(g.get(jt-1,jt-1))+Math.abs(q)+Math.abs(g.get(jt+1,jt+1))))));)jt--;for(L=jt+2;L<=_;L++)g.set(L,L-2,0),L>jt+2&&g.set(L,L-3,0);for(Mt=jt;Mt<=_-1&&(_e=Mt!==_-1,Mt!==jt&&(R=g.get(Mt,Mt-1),$=g.get(Mt+1,Mt-1),at=_e?g.get(Mt+2,Mt-1):0,Gt=Math.abs(R)+Math.abs($)+Math.abs(at),Gt!==0&&(R=R/Gt,$=$/Gt,at=at/Gt)),Gt!==0);Mt++)if(X=Math.sqrt(R*R+$*$+at*at),R<0&&(X=-X),X!==0){for(Mt!==jt?g.set(Mt,Mt-1,-X*Gt):Nt!==jt&&g.set(Mt,Mt-1,-g.get(Mt,Mt-1)),R=R+X,Gt=R/X,ue=$/X,q=at/X,$=$/R,at=at/R,ht=Mt;ht<M;ht++)R=g.get(Mt,ht)+$*g.get(Mt+1,ht),_e&&(R=R+at*g.get(Mt+2,ht),g.set(Mt+2,ht,g.get(Mt+2,ht)-R*q)),g.set(Mt,ht,g.get(Mt,ht)-R*Gt),g.set(Mt+1,ht,g.get(Mt+1,ht)-R*ue);for(L=0;L<=Math.min(_,Mt+3);L++)R=Gt*g.get(L,Mt)+ue*g.get(L,Mt+1),_e&&(R=R+q*g.get(L,Mt+2),g.set(L,Mt+2,g.get(L,Mt+2)-R*at)),g.set(L,Mt,g.get(L,Mt)-R),g.set(L,Mt+1,g.get(L,Mt+1)-R*$);for(L=C;L<=E;L++)R=Gt*l.get(L,Mt)+ue*l.get(L,Mt+1),_e&&(R=R+q*l.get(L,Mt+2),l.set(L,Mt+2,l.get(L,Mt+2)-R*at)),l.set(L,Mt,l.get(L,Mt)-R),l.set(L,Mt+1,l.get(L,Mt+1)-R*$)}}}if(N!==0){for(_=M-1;_>=0;_--)if(R=f[_],$=d[_],$===0)for(Nt=_,g.set(_,_,1),L=_-1;L>=0;L--){for(At=g.get(L,L)-R,at=0,ht=Nt;ht<=_;ht++)at=at+g.get(L,ht)*g.get(ht,_);if(d[L]<0)q=At,X=at;else if(Nt=L,d[L]===0?g.set(L,_,At!==0?-at/At:-at/(x*N)):(Gt=g.get(L,L+1),ue=g.get(L+1,L),$=(f[L]-R)*(f[L]-R)+d[L]*d[L],pe=(Gt*X-q*at)/$,g.set(L,_,pe),g.set(L+1,_,Math.abs(Gt)>Math.abs(q)?(-at-At*pe)/Gt:(-X-ue*pe)/q)),pe=Math.abs(g.get(L,_)),x*pe*pe>1)for(ht=L;ht<=_;ht++)g.set(ht,_,g.get(ht,_)/pe)}else if($<0)for(Nt=_-1,Math.abs(g.get(_,_-1))>Math.abs(g.get(_-1,_))?(g.set(_-1,_-1,$/g.get(_,_-1)),g.set(_-1,_,-(g.get(_,_)-R)/g.get(_,_-1))):(le=Pn(0,-g.get(_-1,_),g.get(_-1,_-1)-R,$),g.set(_-1,_-1,le[0]),g.set(_-1,_,le[1])),g.set(_,_-1,0),g.set(_,_,1),L=_-2;L>=0;L--){for(j=0,et=0,ht=Nt;ht<=_;ht++)j=j+g.get(L,ht)*g.get(ht,_-1),et=et+g.get(L,ht)*g.get(ht,_);if(At=g.get(L,L)-R,d[L]<0)q=At,at=j,X=et;else if(Nt=L,d[L]===0?(le=Pn(-j,-et,At,$),g.set(L,_-1,le[0]),g.set(L,_,le[1])):(Gt=g.get(L,L+1),ue=g.get(L+1,L),mt=(f[L]-R)*(f[L]-R)+d[L]*d[L]-$*$,rt=(f[L]-R)*2*$,mt===0&&rt===0&&(mt=x*N*(Math.abs(At)+Math.abs($)+Math.abs(Gt)+Math.abs(ue)+Math.abs(q))),le=Pn(Gt*at-q*j+$*et,Gt*X-q*et-$*j,mt,rt),g.set(L,_-1,le[0]),g.set(L,_,le[1]),Math.abs(Gt)>Math.abs(q)+Math.abs($)?(g.set(L+1,_-1,(-j-At*g.get(L,_-1)+$*g.get(L,_))/Gt),g.set(L+1,_,(-et-At*g.get(L,_)-$*g.get(L,_-1))/Gt)):(le=Pn(-at-ue*g.get(L,_-1),-X-ue*g.get(L,_),q,$),g.set(L+1,_-1,le[0]),g.set(L+1,_,le[1]))),pe=Math.max(Math.abs(g.get(L,_-1)),Math.abs(g.get(L,_))),x*pe*pe>1)for(ht=L;ht<=_;ht++)g.set(ht,_-1,g.get(ht,_-1)/pe),g.set(ht,_,g.get(ht,_)/pe)}for(L=0;L<M;L++)if(L<C||L>E)for(ht=L;ht<M;ht++)l.set(L,ht,g.get(L,ht));for(ht=M-1;ht>=C;ht--)for(L=C;L<=E;L++){for(q=0,Mt=C;Mt<=Math.min(ht,E);Mt++)q=q+l.get(L,Mt)*g.get(Mt,ht);l.set(L,ht,q)}}}function Pn(M,d,f,l){let g,_;return Math.abs(f)>Math.abs(l)?(g=l/f,_=f+g*l,[(M+g*d)/_,(d-g*M)/_]):(g=f/l,_=l+g*f,[(g*M+d)/_,(g*d-M)/_])}class Gn{constructor(d){if(d=We.checkMatrix(d),!d.isSymmetric())throw new Error("Matrix is not symmetric");let f=d,l=f.rows,g=new z(l,l),_=!0,C,E,x;for(E=0;E<l;E++){let S=0;for(x=0;x<E;x++){let N=0;for(C=0;C<x;C++)N+=g.get(x,C)*g.get(E,C);N=(f.get(E,x)-N)/g.get(x,x),g.set(E,x,N),S=S+N*N}for(S=f.get(E,E)-S,_&&=S>0,g.set(E,E,Math.sqrt(Math.max(S,0))),x=E+1;x<l;x++)g.set(E,x,0)}this.L=g,this.positiveDefinite=_}isPositiveDefinite(){return this.positiveDefinite}solve(d){d=We.checkMatrix(d);let f=this.L,l=f.rows;if(d.rows!==l)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let g=d.columns,_=d.clone(),C,E,x;for(x=0;x<l;x++)for(E=0;E<g;E++){for(C=0;C<x;C++)_.set(x,E,_.get(x,E)-_.get(C,E)*f.get(x,C));_.set(x,E,_.get(x,E)/f.get(x,x))}for(x=l-1;x>=0;x--)for(E=0;E<g;E++){for(C=x+1;C<l;C++)_.set(x,E,_.get(x,E)-_.get(C,E)*f.get(C,x));_.set(x,E,_.get(x,E)/f.get(x,x))}return _}get lowerTriangularMatrix(){return this.L}}class Ln{constructor(d,f={}){d=We.checkMatrix(d);let{Y:l}=f;const{scaleScores:g=!1,maxIterations:_=1e3,terminationCriteria:C=1e-10}=f;let E;if(l){if(e.isAnyArray(l)&&typeof l[0]=="number"?l=z.columnVector(l):l=We.checkMatrix(l),l.rows!==d.rows)throw new Error("Y should have the same number of rows as X");E=l.getColumnVector(0)}else E=d.getColumnVector(0);let x=1,S,N,R,$;for(let at=0;at<_&&x>C;at++)R=d.transpose().mmul(E).div(E.transpose().mmul(E).get(0,0)),R=R.div(R.norm()),S=d.mmul(R).div(R.transpose().mmul(R).get(0,0)),at>0&&(x=S.clone().sub($).pow(2).sum()),$=S.clone(),l?(N=l.transpose().mmul(S).div(S.transpose().mmul(S).get(0,0)),N=N.div(N.norm()),E=l.mmul(N).div(N.transpose().mmul(N).get(0,0))):E=S;if(l){let at=d.transpose().mmul(S).div(S.transpose().mmul(S).get(0,0));at=at.div(at.norm());let X=d.clone().sub(S.clone().mmul(at.transpose())),q=E.transpose().mmul(S).div(S.transpose().mmul(S).get(0,0)),gt=l.clone().sub(S.clone().mulS(q.get(0,0)).mmul(N.transpose()));this.t=S,this.p=at.transpose(),this.w=R.transpose(),this.q=N,this.u=E,this.s=S.transpose().mmul(S),this.xResidual=X,this.yResidual=gt,this.betas=q}else this.w=R.transpose(),this.s=S.transpose().mmul(S).sqrt(),g?this.t=S.clone().div(this.s.get(0,0)):this.t=S,this.xResidual=d.sub(S.mmul(R.transpose()))}}return Yt.AbstractMatrix=B,Yt.CHO=Gn,Yt.CholeskyDecomposition=Gn,Yt.DistanceMatrix=Et,Yt.EVD=Zr,Yt.EigenvalueDecomposition=Zr,Yt.LU=Bs,Yt.LuDecomposition=Bs,Yt.Matrix=z,Yt.MatrixColumnSelectionView=Wt,Yt.MatrixColumnView=Vt,Yt.MatrixFlipColumnView=Kt,Yt.MatrixFlipRowView=Zt,Yt.MatrixRowSelectionView=Ne,Yt.MatrixRowView=Ht,Yt.MatrixSelectionView=ei,Yt.MatrixSubView=xe,Yt.MatrixTransposeView=Se,Yt.NIPALS=Ln,Yt.Nipals=Ln,Yt.QR=un,Yt.QrDecomposition=un,Yt.SVD=Wi,Yt.SingularValueDecomposition=Wi,Yt.SymmetricMatrix=bt,Yt.WrapperMatrix1D=va,Yt.WrapperMatrix2D=We,Yt.correlation=al,Yt.covariance=ol,Yt.default=z,Yt.determinant=dn,Yt.inverse=Wr,Yt.linearDependencies=Ia,Yt.pseudoInverse=zr,Yt.solve=ls,Yt.wrap=Vr,Yt}var fa=Ub();const _g=Nb(fa),Xb=fa.SingularValueDecomposition,Cn=_g.Matrix?_g.Matrix:fa.Matrix,$b=fa.inverse,H0=fa.pseudoInverse;function Hb(e,t){const i=new Cn([...e[0],...e[1]]),n=Cn.columnVector([...t[0],...t[1]]);return H0(i).mmul(n).to1DArray()}function Yb(e,t){const i=new Cn(e),n=[Cn.columnVector(t[0]),Cn.columnVector(t[1])],s=H0(i);return[s.mmul(n[0]),s.mmul(n[1])].map(a=>a.to1DArray())}function Kb(e,t){const i=new Cn(e),n=[Cn.columnVector(t[0]),Cn.columnVector(t[1])],s=$b(i);return[s.mmul(n[0]),s.mmul(n[1])].map(a=>a.to1DArray())}function qb(e,t){const i=[];for(let o=0;o<t;o++)i.push(e[0][o]),i.push(e[1][o]);const n=new Xb(i);return Cn.from1DArray(3,3,n.rightSingularVectors.getColumn(8)).transpose().to2DArray()}class Y0 extends X0{coefsArrayMatrices;coefsArrayMatricesSize;weightsArray;weightsArrays;constructor(t,i){super(t,i,"helmert",2),this.coefsArrayMatrices=this.getCoefsArrayMatrices(),this.coefsArrayMatricesSize=this.coefsArrayMatrices.map(n=>ns(n))}getDestinationPointsArrays(){return[this.destinationPoints.map(t=>t[0]),this.destinationPoints.map(t=>t[1])]}getCoefsArrayMatrices(){let t=Qi(this.pointCount,4,0),i=Qi(this.pointCount,4,0);for(let n=0;n<this.pointCount;n++){const s=this.getSourcePointCoefsArrays(this.sourcePoints[n]);t=$o(t,n,0,[s[0]]),i=$o(i,n,0,[s[1]])}return[t,i]}getSourcePointCoefsArrays(t){return[[1,0,t[0],-t[1]],[0,1,t[1],t[0]]]}solve(){this.weightsArray=Hb(this.coefsArrayMatrices,this.destinationPointsArrays),this.weightsArrays=[this.weightsArray,this.weightsArray]}getMeasures(){if(this.weightsArrays||this.solve(),!this.weightsArray)throw new Error("Helmert weights not computed");const t={};return t.scale=Math.sqrt(this.weightsArray[2]**2+this.weightsArray[3]**2),t.rotation=Math.atan2(this.weightsArray[3],this.weightsArray[2]),t.translation=[this.weightsArray[0],this.weightsArray[1]],t}evaluateFunction(t){if(this.weightsArrays||this.solve(),!this.weightsArray)throw new Error("Helmert weights not computed");return[this.weightsArray[0]+this.weightsArray[2]*t[0]-this.weightsArray[3]*t[1],this.weightsArray[1]+this.weightsArray[2]*t[1]+this.weightsArray[3]*t[0]]}evaluatePartialDerivativeX(t){if(this.weightsArrays||this.solve(),!this.weightsArray)throw new Error("Helmert weights not computed");return[this.weightsArray[2],this.weightsArray[3]]}evaluatePartialDerivativeY(t){if(this.weightsArrays||this.solve(),!this.weightsArray)throw new Error("Helmert weights not computed");return[-this.weightsArray[3],this.weightsArray[2]]}}class Jb extends Au{weightsArrays;constructor(t,i){super(t,i,"straight",2)}solve(){const i=new Y0(this.sourcePoints,this.destinationPoints).getMeasures().scale,n=this.sourcePoints.reduce((o,a)=>[o[0]+a[0],o[1]+a[1]]).map(o=>o/this.pointCount),s=this.destinationPoints.reduce((o,a)=>[o[0]+a[0],o[1]+a[1]]).map(o=>o/this.pointCount),r=s.map((o,a)=>o-n[a]*i);this.weightsArrays={scale:i,sourcePointsCenter:n,destinationPointsCenter:s,translation:r}}evaluateFunction(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");return[this.weightsArrays.translation[0]+this.weightsArrays.scale*t[0],this.weightsArrays.translation[1]+this.weightsArrays.scale*t[1]]}evaluatePartialDerivativeX(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");return[this.weightsArrays.scale,0]}evaluatePartialDerivativeY(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");return[0,this.weightsArrays.scale]}}class K0 extends X0{constructor(t,i,n,s){super(t,i,n,s)}getCoefsArrayMatrices(){const t=this.getCoefsArrayMatrix();return[t,t]}getSourcePointCoefsArrays(t){const i=this.getSourcePointCoefsArray(t);return[i,i]}}class Tu extends K0{coefsArrayMatrices;coefsArrayMatrix;coefsArrayMatricesSize;coefsArrayMatrixSize;order;weightsArrays;constructor(t,i,n){n=n||1;const s=(n+1)*(n+2)/2;if(super(t,i,"polynomial"+n,s),this.order=n,this.order<1||this.order>3)throw new Error("Only polynomial transformations of order 1, 2 or 3 are supported");this.coefsArrayMatrices=this.getCoefsArrayMatrices(),this.coefsArrayMatrix=this.coefsArrayMatrices[0],this.coefsArrayMatricesSize=this.coefsArrayMatrices.map(r=>ns(r)),this.coefsArrayMatrixSize=ns(this.coefsArrayMatrix)}getDestinationPointsArrays(){return[this.destinationPoints.map(t=>t[0]),this.destinationPoints.map(t=>t[1])]}getCoefsArrayMatrix(){let t=Qi(this.pointCount,this.pointCountMinimum,0);for(let i=0;i<this.pointCount;i++)t=$o(t,i,0,[this.getSourcePointCoefsArray(this.sourcePoints[i])]);return t}solve(){this.weightsArrays=Yb(this.coefsArrayMatrix,this.destinationPointsArrays)}}class Yo extends Tu{constructor(t,i){super(t,i,1)}getSourcePointCoefsArray(t){return Yo.getPolynomial1SourcePointCoefsArray(t)}static getPolynomial1SourcePointCoefsArray(t){return[1,t[0],t[1]]}getHomogeneousTransform(){if(this.weightsArrays)return[this.weightsArrays[0][1],this.weightsArrays[1][1],this.weightsArrays[0][2],this.weightsArrays[1][2],this.weightsArrays[0][0],this.weightsArrays[1][0]]}setWeightsArraysFromHomogeneousTransform(t){this.weightsArrays=[[t[4],t[0],t[2]],[t[5],t[1],t[3]]]}getMeasures(){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const t={};t.translation=[this.weightsArrays[0][0],this.weightsArrays[1][0]];const i=this.weightsArrays[0][1],n=this.weightsArrays[1][1],s=this.weightsArrays[0][2],r=this.weightsArrays[1][2],o=i*r-n*s;if(i!=0||n!=0){const a=Math.sqrt(i*i+n*n);t.rotation=n>0?Math.acos(i/a):-Math.acos(i/a),t.scales=[a,o/a],t.shears=[Math.atan((i*s+n*r)/(a*a)),0]}else if(s!=0||r!=0){const a=Math.sqrt(s*s+r*r);t.rotation=Math.PI/2-(r>0?Math.acos(-s/a):-Math.acos(s/a)),t.scales=[o/a,a],t.shears=[0,Math.atan((i*s+n*r)/(a*a))]}return t}evaluateFunction(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=[0,0];for(let n=0;n<2;n++)i[n]+=this.weightsArrays[n][0]+this.weightsArrays[n][1]*t[0]+this.weightsArrays[n][2]*t[1];return i}evaluatePartialDerivativeX(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=[0,0];for(let n=0;n<2;n++)i[n]+=this.weightsArrays[n][1];return i}evaluatePartialDerivativeY(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=[0,0];for(let n=0;n<2;n++)i[n]+=this.weightsArrays[n][2];return i}}class Ru extends Tu{constructor(t,i){super(t,i,2)}getSourcePointCoefsArray(t){return Ru.getPolynomial2SourcePointCoefsArray(t)}static getPolynomial2SourcePointCoefsArray(t){return[1,t[0],t[1],t[0]**2,t[1]**2,t[0]*t[1]]}evaluateFunction(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=[0,0];for(let n=0;n<2;n++)i[n]+=this.weightsArrays[n][0]+this.weightsArrays[n][1]*t[0]+this.weightsArrays[n][2]*t[1]+this.weightsArrays[n][3]*t[0]**2+this.weightsArrays[n][4]*t[1]**2+this.weightsArrays[n][5]*t[0]*t[1];return i}evaluatePartialDerivativeX(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=[0,0];for(let n=0;n<2;n++)i[n]+=this.weightsArrays[n][1]+2*this.weightsArrays[n][3]*t[0]+this.weightsArrays[n][5]*t[1];return i}evaluatePartialDerivativeY(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=[0,0];for(let n=0;n<2;n++)i[n]+=this.weightsArrays[n][2]+2*this.weightsArrays[n][4]*t[1]+this.weightsArrays[n][5]*t[0];return i}}class Pu extends Tu{constructor(t,i){super(t,i,3)}getSourcePointCoefsArray(t){return Pu.getPolynomial3SourcePointCoefsArray(t)}static getPolynomial3SourcePointCoefsArray(t){return[1,t[0],t[1],t[0]**2,t[1]**2,t[0]*t[1],t[0]**3,t[1]**3,t[0]**2*t[1],t[0]*t[1]**2]}evaluateFunction(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=[0,0];for(let n=0;n<2;n++)i[n]+=this.weightsArrays[n][0]+this.weightsArrays[n][1]*t[0]+this.weightsArrays[n][2]*t[1]+this.weightsArrays[n][3]*t[0]**2+this.weightsArrays[n][4]*t[1]**2+this.weightsArrays[n][5]*t[0]*t[1]+this.weightsArrays[n][6]*t[0]**3+this.weightsArrays[n][7]*t[1]**3+this.weightsArrays[n][8]*t[0]**2*t[1]+this.weightsArrays[n][9]*t[0]*t[1]**2;return i}evaluatePartialDerivativeX(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=[0,0];for(let n=0;n<2;n++)i[n]+=this.weightsArrays[n][1]+2*this.weightsArrays[n][3]*t[0]+this.weightsArrays[n][5]*t[1]+3*this.weightsArrays[n][6]*t[0]**2+2*this.weightsArrays[n][8]*t[0]*t[1]+this.weightsArrays[n][9]*t[1]**2;return i}evaluatePartialDerivativeY(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=[0,0];for(let n=0;n<2;n++)i[n]+=this.weightsArrays[n][2]+2*this.weightsArrays[n][4]*t[1]+this.weightsArrays[n][5]*t[0]+3*this.weightsArrays[n][7]*t[1]**2+this.weightsArrays[n][8]*t[0]**2+2*this.weightsArrays[n][9]*t[0]*t[1];return i}}class Qb extends Au{coefsArrayMatrices;weightsArrays;constructor(t,i){super(t,i,"projective",4),this.coefsArrayMatrices=[Qi(this.pointCount,9,0),Qi(this.pointCount,9,0)];for(let n=0;n<this.pointCount;n++)this.coefsArrayMatrices[0][n][0]=-t[n][0],this.coefsArrayMatrices[0][n][1]=-t[n][1],this.coefsArrayMatrices[0][n][2]=-1,this.coefsArrayMatrices[0][n][3]=0,this.coefsArrayMatrices[0][n][4]=0,this.coefsArrayMatrices[0][n][5]=0,this.coefsArrayMatrices[0][n][6]=i[n][0]*t[n][0],this.coefsArrayMatrices[0][n][7]=i[n][0]*t[n][1],this.coefsArrayMatrices[0][n][8]=i[n][0],this.coefsArrayMatrices[1][n][0]=0,this.coefsArrayMatrices[1][n][1]=0,this.coefsArrayMatrices[1][n][2]=0,this.coefsArrayMatrices[1][n][3]=-t[n][0],this.coefsArrayMatrices[1][n][4]=-t[n][1],this.coefsArrayMatrices[1][n][5]=-1,this.coefsArrayMatrices[1][n][6]=i[n][1]*t[n][0],this.coefsArrayMatrices[1][n][7]=i[n][1]*t[n][1],this.coefsArrayMatrices[1][n][8]=i[n][1]}solve(){this.weightsArrays=qb(this.coefsArrayMatrices,this.pointCount)}evaluateFunction(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=this.weightsArrays[0][2]*t[0]+this.weightsArrays[1][2]*t[1]+this.weightsArrays[2][2],n=this.weightsArrays[0][0]*t[0]+this.weightsArrays[1][0]*t[1]+this.weightsArrays[2][0],s=this.weightsArrays[0][1]*t[0]+this.weightsArrays[1][1]*t[1]+this.weightsArrays[2][1];return[n/i,s/i]}evaluatePartialDerivativeX(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=this.weightsArrays[0][2]*t[0]+this.weightsArrays[1][2]*t[1]+this.weightsArrays[2][2],n=this.weightsArrays[0][0]*t[0]+this.weightsArrays[1][0]*t[1]+this.weightsArrays[2][0],s=this.weightsArrays[0][1]*t[0]+this.weightsArrays[1][1]*t[1]+this.weightsArrays[2][1];return[(i*this.weightsArrays[0][0]-this.weightsArrays[0][2]*n)/i**2,(i*this.weightsArrays[0][1]-this.weightsArrays[0][2]*s)/i**2]}evaluatePartialDerivativeY(t){if(this.weightsArrays||this.solve(),!this.weightsArrays)throw new Error("Weights not computed");const i=this.weightsArrays[0][2]*t[0]+this.weightsArrays[1][2]*t[1]+this.weightsArrays[2][2],n=this.weightsArrays[0][0]*t[0]+this.weightsArrays[1][0]*t[1]+this.weightsArrays[2][0],s=this.weightsArrays[0][1]*t[0]+this.weightsArrays[1][1]*t[1]+this.weightsArrays[2][1];return[(i*this.weightsArrays[1][0]-this.weightsArrays[1][2]*n)/i**2,(i*this.weightsArrays[1][1]-this.weightsArrays[1][2]*s)/i**2]}}class yg extends K0{kernelFunction;normFunction;epsilon;coefsArrayMatrices;coefsArrayMatrix;coefsArrayMatricesSize;coefsArrayMatrixSize;weightsArrays;rbfWeightsArrays;affineWeightsArrays;constructor(t,i,n,s,r,o){super(t,i,r,3),this.kernelFunction=n,this.normFunction=s,this.epsilon=o,this.coefsArrayMatrices=this.getCoefsArrayMatrices(),this.coefsArrayMatrix=this.coefsArrayMatrices[0],this.coefsArrayMatricesSize=this.coefsArrayMatrices.map(a=>ns(a)),this.coefsArrayMatrixSize=ns(this.coefsArrayMatrix)}getDestinationPointsArrays(){return[[...this.destinationPoints,[0,0],[0,0],[0,0]].map(t=>t[0]),[...this.destinationPoints,[0,0],[0,0],[0,0]].map(t=>t[1])]}getCoefsArrayMatrix(){const t=Qi(this.pointCount,this.pointCount,0);for(let o=0;o<this.pointCount;o++)for(let a=0;a<this.pointCount;a++)t[o][a]=this.normFunction(this.sourcePoints[o],this.sourcePoints[a]);if(this.epsilon===void 0){const o=t.map(a=>a.reduce((h,c)=>h+c,0)).reduce((a,h)=>a+h,0);this.epsilon=o/(Math.pow(this.pointCount,2)-this.pointCount)}const i=Qi(this.pointCount,this.pointCount,0);for(let o=0;o<this.pointCount;o++)for(let a=0;a<this.pointCount;a++)i[o][a]=this.kernelFunction(t[o][a],{epsilon:this.epsilon});let n=Qi(this.pointCount,3,0);for(let o=0;o<this.pointCount;o++)n=$o(n,o,0,[Yo.getPolynomial1SourcePointCoefsArray(this.sourcePoints[o])]);const s=Qi(3,3,0);return gb([[i,n],[Z0(n),s]])}getSourcePointCoefsArray(t){return[...this.getRbfKernelSourcePointCoefsArray(t),...Yo.getPolynomial1SourcePointCoefsArray(t)]}getRbfKernelSourcePointCoefsArray(t){const i=[];for(let n=0;n<this.pointCount;n++)i.push(this.kernelFunction(this.normFunction(this.sourcePoints[n],t),{epsilon:this.epsilon}));return i}setWeightsArrays(t,i){i&&(this.epsilon=i),super.setWeightsArrays(t)}solve(){this.weightsArrays=Kb(this.coefsArrayMatrix,this.destinationPointsArrays),this.processWeightsArrays()}processWeightsArrays(){if(!this.weightsArrays)throw new Error("Weights not computed");this.rbfWeightsArrays=this.weightsArrays.map(t=>t.slice(0,this.pointCount)),this.affineWeightsArrays=this.weightsArrays.map(t=>t.slice(this.pointCount))}evaluateFunction(t){if(this.weightsArrays||this.solve(),!this.rbfWeightsArrays||!this.affineWeightsArrays)throw new Error("RBF weights not computed");const i=this.rbfWeightsArrays,n=this.affineWeightsArrays,s=this.sourcePoints.map(o=>this.normFunction(t,o)),r=[0,0];for(let o=0;o<2;o++)r[o]=s.reduce((a,h,c)=>a+this.kernelFunction(h,{epsilon:this.epsilon})*i[o][c],0),r[o]+=n[o][0]+n[o][1]*t[0]+n[o][2]*t[1];return r}evaluatePartialDerivativeX(t){if(this.weightsArrays||this.solve(),!this.rbfWeightsArrays||!this.affineWeightsArrays)throw new Error("RBF weights not computed");const i=this.rbfWeightsArrays,n=this.affineWeightsArrays,s=this.sourcePoints.map(o=>this.normFunction(t,o)),r=[0,0];for(let o=0;o<2;o++)r[o]=s.reduce((a,h,c)=>a+(h===0?0:this.kernelFunction(h,{derivative:1,epsilon:this.epsilon})*((t[0]-this.sourcePoints[c][0])/h)*i[o][c]),0),r[o]+=n[o][1];return r}evaluatePartialDerivativeY(t){if(this.weightsArrays||this.solve(),!this.rbfWeightsArrays||!this.affineWeightsArrays)throw new Error("RBF weights not computed");const i=this.rbfWeightsArrays,n=this.affineWeightsArrays,s=this.sourcePoints.map(o=>this.normFunction(t,o)),r=[0,0];for(let o=0;o<2;o++)r[o]=s.reduce((a,h,c)=>a+(h===0?0:this.kernelFunction(h,{derivative:1,epsilon:this.epsilon})*((t[1]-this.sourcePoints[c][1])/h)*i[o][c]),0),r[o]+=n[o][2];return r}}function tA(e,t){if(t.derivative){if(t.derivative===1)return 1;throw new Error("Derivate of order "+t.derivative+" not implemented")}else return e}function eA(e,t){if(t.derivative){if(t.derivative===1)return e===0?0:e+2*e*Math.log(e);throw new Error("Derivate of order "+t.derivative+" not implemented")}else return e===0?0:Math.pow(e,2)*Math.log(e)}function wg(e,t){const i=[t[0]-e[0],t[1]-e[1]];return Math.sqrt(i[0]**2+i[1]**2)}function q0(e,t,i={}){if(i.final===!0)return iA(e,t);const n=Uo(e),s=Uo(t),r=Fi(n[0]),o=Fi(s[0]),a=Fi(n[1]),h=Fi(s[1]),c=Math.sin(o-r)*Math.cos(h),u=Math.cos(a)*Math.sin(h)-Math.sin(a)*Math.cos(h)*Math.cos(o-r);return Ic(Math.atan2(c,u))}function iA(e,t){let i=q0(t,e);return i=(i+180)%360,i}function nA(e,t,i,n={}){const s=Uo(e),r=Fi(s[0]),o=Fi(s[1]),a=Fi(i),h=dS(t,n.units),c=Math.asin(Math.sin(o)*Math.cos(h)+Math.cos(o)*Math.sin(h)*Math.cos(a)),u=r+Math.atan2(Math.sin(a)*Math.sin(h)*Math.cos(o),Math.cos(h)-Math.sin(o)*Math.sin(c)),m=Ic(u),p=Ic(c);return lS([m,p],n.properties)}function J0(e,t,i={}){var n=Uo(e),s=Uo(t),r=Fi(s[1]-n[1]),o=Fi(s[0]-n[0]),a=Fi(n[1]),h=Fi(s[1]),c=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(a)*Math.cos(h);return uS(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),i.units)}var Q0=J0;function sA(e,t){const i=J0(e,t),n=q0(e,t);return nA(e,i/2,n)}var _h=sA;const t_={maxDepth:0,minOffsetRatio:0,minOffsetDistance:1/0,minLineDistance:1/0,sourceMidPointFunction:mh,destinationMidPointFunction:mh,destinationDistanceFunction:bi};function yh(e,t,i){e=Su(e);const n=e.map(o=>({source:o,destination:t(o)})),r=e_(n,!1).map(o=>wh(o,t,i,0)).flat(1);return i_(r,!0)}function vg(e,t,i){e=F0(e);const n=e.map(o=>({source:o,destination:t(o)})),r=e_(n,!0).map(o=>wh(o,t,i,0)).flat(1);return i_(r,!1)}function wh(e,t,i,n){const s=rA(e,t,i,n);return s?[wh([e[0],s],t,i,n+1),wh([s,e[1]],t,i,n+1)].flat(1):[e]}function rA(e,t,i,n){if(n>=i.maxDepth||i.maxDepth<=0)return;const{sourceMidPoint:s,destinationMidPointFromRefinementFunction:r,destinationMidPointsDistance:o,destinationLineDistance:a,destinationRefinedLineDistance:h}=oA(e,t,i);return aA({destinationMidPointsDistance:o,destinationLineDistance:a,destinationRefinedLineDistance:h},i)?{source:s,destination:r}:void 0}function oA(e,t,i){const n=i.sourceMidPointFunction(e[0].source,e[1].source),s=i.destinationMidPointFunction(e[0].destination,e[1].destination),r=t(n),o=i.destinationDistanceFunction(e[0].destination,e[1].destination),a=i.destinationDistanceFunction(t(e[0].source),t(e[1].source)),h=i.destinationDistanceFunction(s,r);return{sourceMidPoint:n,destinationMidPointFromRefinementFunction:r,destinationMidPointsDistance:h,destinationLineDistance:o,destinationRefinedLineDistance:a}}function aA({destinationMidPointsDistance:e,destinationLineDistance:t,destinationRefinedLineDistance:i},n){return e/t>n.minOffsetRatio||e>n.minOffsetDistance||i>n.minLineDistance}function Mg(e,t,i){const n=En(e),s=n[2],r=n[3],o=n[1],a=n[0],h=i.sourceMidPointFunction(s,o),c=i.sourceMidPointFunction(r,a),u=i.sourceMidPointFunction(s,r),m=i.sourceMidPointFunction(o,a),p=[h,c],y=[u,m],w=yh(p,t,i).map(k=>k.source),v=yh(y,t,i).map(k=>k.source);if(w.length===2&&v.length===2)return;const I=[];for(let k=0;k<w.length-1;k++)I.push(an(w[k],w[k+1]));const b=Math.sqrt(Math.min(...I)),T=[];for(let k=0;k<v.length-1;k++)T.push(an(v[k],v[k+1]));const P=Math.sqrt(Math.min(...T));return Math.min(b,P)}function e_(e,t=!1){const i=e.length-(t?0:1),n=[];for(let s=0;s<i;s++)n.push([e[s],e[(s+1)%e.length]]);return n}function i_(e,t=!1){const i=e.map(n=>n[0]);return t&&i.push(e[e.length-1][1]),i}const n_={maxDepth:0,minOffsetRatio:0,minOffsetDistance:1/0,minLineDistance:1/0,sourceIsGeographic:!1,destinationIsGeographic:!1,isMultiGeometry:!1,distortionMeasures:[],referenceScale:1,preForward:e=>e,postForward:e=>e,preBackward:e=>e,postBackward:e=>e},s_={differentHandedness:!1,...n_};function po(e){if(e===void 0)return{};const t=e;return e.geoIsGeographic&&(t.destinationIsGeographic=e.geoIsGeographic),e.postToGeo&&(t.postForward=e.postToGeo),e.preToResource&&(t.preBackward=e.preToResource),t}function Ig(e){return e===void 0?{}:po(e)}function hA(e){if(e===void 0)return{};const t=e;return e.postForward&&(t.postToGeo=e.postForward),e.preBackward&&(t.preToResource=e.preBackward),t}function lA(e){return e??{}}hA(n_);const r_=lA(s_);function Pl(e){const t=Ee(t_,{minOffsetRatio:e.minOffsetRatio,minOffsetDistance:e.minOffsetDistance,minLineDistance:e.minLineDistance,maxDepth:e.maxDepth});return e.sourceIsGeographic&&(t.sourceMidPointFunction=(i,n)=>_h(i,n).geometry.coordinates),e.destinationIsGeographic&&(t.destinationMidPointFunction=(i,n)=>_h(i,n).geometry.coordinates,t.destinationDistanceFunction=Q0),t}function Gl(e){const t=Ee(t_,{minOffsetRatio:e.minOffsetRatio,minOffsetDistance:e.minOffsetDistance,minLineDistance:e.minLineDistance,maxDepth:e.maxDepth});return e.destinationIsGeographic&&(t.sourceMidPointFunction=(i,n)=>_h(i,n).geometry.coordinates),e.sourceIsGeographic&&(t.destinationMidPointFunction=(i,n)=>_h(i,n).geometry.coordinates,t.destinationDistanceFunction=Q0),t}function Eg(e){return{source:e.destination,destination:e.source}}function Cg(e){return e.destination}function xg(e){return e.source}function cA(e){return e.geo}function uA(e){return e.resource}function Ll(e){return{resource:e.source,geo:e.destination,partialDerivativeX:e.partialDerivativeX,partialDerivativeY:e.partialDerivativeY,distortions:e.distortions,distortion:e.distortion}}function dA(e){return{source:e.resource,destination:e.geo,partialDerivativeX:e.partialDerivativeX,partialDerivativeY:e.partialDerivativeY,distortions:e.distortions,distortion:e.distortion}}class fA{generalGcpsInternal;sourcePointsInternal;destinationPointsInternal;type;transformerOptions;forwardTransformation;backwardTransformation;constructor(t,i="polynomial",n){if(this.transformerOptions=Ee(s_,n),t.length===0)throw new Error("No control points");this.generalGcpsInternal=t,this.sourcePointsInternal=this.generalGcpsInternal.map(s=>{const r=this.transformerOptions.differentHandedness?to(s.source):s.source;return this.transformerOptions.preForward(r)}),this.destinationPointsInternal=this.generalGcpsInternal.map(s=>this.transformerOptions.preBackward(s.destination)),this.type=i}getForwardTransformationInternal(){return this.forwardTransformation||(this.forwardTransformation=this.createTransformation(this.sourcePointsInternal,this.destinationPointsInternal)),this.forwardTransformation}getBackwardTransformationInternal(){return this.backwardTransformation||(this.backwardTransformation=this.createTransformation(this.destinationPointsInternal,this.sourcePointsInternal)),this.backwardTransformation}createTransformation(t,i){if(this.type==="straight")return new Jb(t,i);if(this.type==="helmert")return new Y0(t,i);if(this.type==="polynomial1"||this.type==="polynomial")return new Yo(t,i);if(this.type==="polynomial2")return new Ru(t,i);if(this.type==="polynomial3")return new Pu(t,i);if(this.type==="projective")return new Qb(t,i);if(this.type==="thinPlateSpline")return new yg(t,i,eA,wg,"thinPlateSpline");if(this.type==="linear")return new yg(t,i,tA,wg,"linear");throw new Error(`Unsupported transformation type: ${this.type}`)}getForwardTransformationResolutionInternal(t,i){const n=Ee(this.transformerOptions,i);return Mg(t,s=>this.transformForwardInternal(s,n),Pl(n))}getBackwardTransformationResolutionInternal(t,i){const n=Ee(this.transformerOptions,i);return Mg(t,s=>this.transformBackwardInternal(s,n),Gl(n))}transformForwardInternal(t,i,n=Cg){const s=Ee(this.transformerOptions,i);if(s.isMultiGeometry){if(i&&(i.isMultiGeometry=!1),eg(t))return t.map(r=>this.transformForwardInternal(r,i,n));if(ig(t))return t.map(r=>this.transformForwardInternal(r,i,n));if(Cc(t))return t.map(r=>this.transformForwardInternal(r,i,n));throw new Error("Geometry type not supported")}else{if(ci(t))return this.transformPointForwardInternal(t,s,n);if(Ts(t))return this.transformLineStringForwardInternal(t,s,n);if(Mr(t))return this.transformPolygonForwardInternal(t,s,n);throw new Error("Geometry type not supported")}}transformBackwardInternal(t,i,n=xg){const s=Ee(this.transformerOptions,i);if(s.isMultiGeometry){if(i&&(i.isMultiGeometry=!1),eg(t))return t.map(r=>this.transformBackwardInternal(r,i,n));if(ig(t))return t.map(r=>this.transformBackwardInternal(r,i,n));if(Cc(t))return t.map(r=>this.transformBackwardInternal(r,i,n));throw new Error("Geometry type not supported")}else{if(ci(t))return this.transformPointBackwardInternal(t,s,n);if(Ts(t))return this.transformLineStringBackwardInternal(t,s,n);if(Mr(t))return this.transformPolygonBackwardInternal(t,s,n);throw new Error("Geometry type not supported")}}transformPointForwardInternal(t,i,n=Cg){const s=this.getForwardTransformationInternal();let r=this.transformerOptions.differentHandedness?to(t):t;r=i.preForward(r);let o=s.evaluateFunction(r);o=i.postForward(o);let a,h,c=new Map;return i.distortionMeasures.length>0&&(a=s.evaluatePartialDerivativeX(r),h=s.evaluatePartialDerivativeY(r),c=mg(i.distortionMeasures,a,h,i.referenceScale)),n({source:t,destination:o,partialDerivativeX:a,partialDerivativeY:h,distortions:c})}transformPointBackwardInternal(t,i,n=xg){const s=this.getBackwardTransformationInternal(),r=i.preBackward(t);let o=s.evaluateFunction(r);o=i.postBackward(o),o=this.transformerOptions.differentHandedness?to(o):o;let a,h,c=new Map;return i.distortionMeasures.length>0&&(a=s.evaluatePartialDerivativeX(r),a=this.transformerOptions.differentHandedness?to(a):a,h=s.evaluatePartialDerivativeY(r),h=this.transformerOptions.differentHandedness?to(h):h,c=mg(i.distortionMeasures,a,h,i.referenceScale)),n({source:o,destination:r,partialDerivativeX:a,partialDerivativeY:h,distortions:c})}transformLineStringForwardInternal(t,i,n){return yh(t,s=>this.transformPointForwardInternal(s,i),Pl(i)).map(s=>n(s))}transformLineStringBackwardInternal(t,i,n){return yh(t,s=>this.transformPointBackwardInternal(s,i),Gl(i)).map(s=>n(Eg(s)))}transformRingForwardInternal(t,i,n){return vg(t,s=>this.transformPointForwardInternal(s,i),Pl(i)).map(s=>n(s))}transformRingBackwardInternal(t,i,n){return vg(t,s=>this.transformPointBackwardInternal(s,i),Gl(i)).map(s=>n(Eg(s)))}transformPolygonForwardInternal(t,i,n){return t.map(s=>this.transformRingForwardInternal(s,i,n))}transformPolygonBackwardInternal(t,i,n){return t.map(s=>this.transformRingBackwardInternal(s,i,n))}}class Gu extends fA{constructor(t,i="polynomial",n){const s=t.map(dA);n=Jn({differentHandedness:!0},n),super(s,i,Ig(n))}get gcps(){return this.generalGcpsInternal.map(Ll)}getToGeoTransformation(){return super.getForwardTransformationInternal()}getToResourceTransformation(){return super.getBackwardTransformationInternal()}getToGeoTransformationResolution(t,i){const n=po(i);return super.getForwardTransformationResolutionInternal(t,n)}getToResourceTransformationResolution(t,i){const n=po(i);return super.getBackwardTransformationResolutionInternal(t,n)}getTransformerOptions(){return this.transformerOptions}setTransformerOptionsInternal(t){this.transformerOptions=Ee(this.transformerOptions,Ig(t))}transformToGeo(t,i,n=cA){const s=o=>n(Ll(o)),r=i?po(i):void 0;return super.transformForwardInternal(t,r,s)}transformToResource(t,i,n=uA){const s=o=>n(Ll(o)),r=i?po(i):void 0;return super.transformBackwardInternal(t,r,s)}static transformSvgToGeojson(t,i,n){n=Jn({geoIsGeographic:!0},n);const s=t.transformToGeo(Tb(i),n);return IS(s)}static transformSvgStringToGeojsonFeatureCollection(t,i,n){const s=[];for(const r of xb(i)){const o=this.transformSvgToGeojson(t,r,n);s.push(o)}return qS(s)}static transformGeojsonToSvg(t,i,n){n=Jn({geoIsGeographic:!0},n);const s=t.transformToResource(k0(i),n);return SS(s)}static transformGeojsonFeatureCollectionToSvgString(t,i,n){const s=[];for(const r of QS(i)){const o=this.transformGeojsonToSvg(t,r,n);s.push(o)}return bb(s)}static fromGeoreferencedMap(t,i){return new Gu(t.gcps,i?.transformationType||t.transformation?.type,i)}}const Lu="#222222",o_="#ffffff",Tn=4,a_=["#dff7fa","#c0eff5","#a1e7f0","#82dfeb","#63d8e6","#4facb8","#3b818a","#27565c","#132b2d"],h_=["#d7d9ee","#b0b4de","#898ecd","#6269bd","#3b44ad","#2f368a","#232867","#171b45","#0b0d22"],l_=["#f3dcf0","#e7b9e1","#dc97d2","#d074c3","#c552b5","#9d4190","#76316c","#4e2048","#271024"],c_=["#ffddf1","#ffbbe3","#ff99d5","#ff77c7","#ff56ba","#cc4494","#99336f","#66224a","#321125"],u_=["#ffe3d0","#ffc7a1","#ffab72","#ff8f43","#ff7415","#cc5c10","#99450c","#662e08","#321704"],d_=["#fededf","#febebf","#fe9e9f","#fe7e7f","#fe5e60","#cb4b4c","#983839","#652526","#321213"],f_=["#e0f2e8","#c1e6d2","#a2d9bb","#83cda5","#64c18f","#509a72","#3c7355","#284d39","#13261c"],g_=["#fff3d9","#ffe8b3","#ffdd8d","#ffd267","#ffc742","#cc9f34","#997727","#664f1a","#32270d"],m_=["#efefef","#e0e0e0","#d0d0d0","#c1c1c1","#b2b2b2","#8e8e8e","#6a6a6a","#474747","#232323"],pn={blue:a_,darkblue:h_,purple:l_,pink:c_,orange:u_,red:d_,green:f_,yellow:g_,gray:m_},gA=a_[Tn],mA=h_[Tn];l_[Tn];const Sg=c_[Tn];u_[Tn];const bg=d_[Tn],p_=f_[Tn],pA=g_[Tn];m_[Tn];function _n(e,t){return t.reduce((i,n,s)=>{const r=(s+1)*100,o=`${e}-${r}`;return i[o]=n,i},{})}({..._n("blue",pn.blue),..._n("darkblue",pn.darkblue),..._n("purple",pn.purple),..._n("pink",pn.pink),..._n("orange",pn.orange),..._n("red",pn.red),..._n("green",pn.green),..._n("yellow",pn.yellow),..._n("gray",pn.gray)});var st=(e=>(e.GEOREFERENCEANNOTATIONADDED="georeferenceannotationadded",e.GEOREFERENCEANNOTATIONREMOVED="georeferenceannotationremoved",e.WARPEDMAPADDED="warpedmapadded",e.WARPEDMAPREMOVED="warpedmapremoved",e.WARPEDMAPENTER="warpedmapenter",e.WARPEDMAPLEAVE="warpedmapleave",e.IMAGEINFOLOADED="imageinfoloaded",e.TILEFETCHED="tilefetched",e.TILEFETCHERROR="tilefetcherror",e.MAPTILELOADED="maptileloaded",e.MAPTILEREMOVED="maptileremoved",e.FIRSTMAPTILELOADED="firstmaptileloaded",e.ALLREQUESTEDTILESLOADED="allrequestedtilesloaded",e.TEXTURESUPDATED="texturesupdated",e.PRECHANGE="prechange",e.OPTIONSCHANGED="optionschanged",e.ZINDICESCHANGED="zindiceschanged",e.RESOURCEMASKCHANGED="resourcemaskchanged",e.GCPSCHANGED="gcpschanged",e.VISIBILITYCHANGED="visibilitychanged",e.TRANSFORMATIONCHANGED="transformationchanged",e.DISTORTIONCHANGED="distortionchanged",e.INTERNALPROJECTIONCHANGED="internalprojectionchanged",e.PROJECTIONCHANGED="projectionchanged",e.CHANGED="changed",e.CLEARED="cleared",e))(st||{});class Rt extends Event{data;constructor(t,i){super(t),this.data=i}}function _A(e,t,i,n){let s=Number.POSITIVE_INFINITY,r=e.at(-1);for(const o of e){const a=Math.abs(Math.log2(o.scaleFactor)-(Math.log2(t+i)+n));a<s&&(s=a,r=o)}return r}function yA(e,t,i){const n=wA(e,t),s=vA(n);return IA(s,t,i)}function wA(e,t){return e.map(i=>[i[0]/t.originalWidth,i[1]/t.originalHeight])}function vA(e){const t={};for(let i=0;i<e.length;i++){const n=[e[i],e[(i+1)%e.length]];MA(n).forEach(([r,o])=>{t[r]||(t[r]=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]),o<t[r][0]&&(t[r][0]=o),o>t[r][1]&&(t[r][1]=o)})}return t}function MA([e,t]){let i=Math.floor(e[0]),n=Math.floor(e[1]);const s=Math.floor(t[0]),r=Math.floor(t[1]),o=[[i,n]];if(i===s&&n===r)return o;const a=Math.sign(t[0]-e[0]),h=Math.sign(t[1]-e[1]),c=Math.abs(e[0]-i-Math.max(0,a)),u=Math.abs(e[1]-n-Math.max(0,h)),m=Math.abs(e[0]-t[0]),p=Math.abs(e[1]-t[1]);let y=c/m,w=u/p;const v=1/m,I=1/p;for(;!(i===s&&n===r);)p===0?i=i+a:m===0?n=n+h:y<w?(y=y+v,i=i+a):(w=w+I,n=n+h),o.push([i,n]);return o}function IA(e,t,i){const n=[];for(const s in e){const r=parseInt(s);if(r<0||r>=t.columns)break;const o=Math.max(e[r][0],0),a=Math.min(e[r][1],t.rows-1);for(let h=o;h<=a;h++)n.push({column:r,row:h,tileZoomLevel:t,imageSize:i})}return n}function __(e,t,i,n){let s=Math.floor(e.column*e.tileZoomLevel.scaleFactor/i);s=s>=0?s:0;const r=Math.ceil((e.column+1)*e.tileZoomLevel.scaleFactor/i);let o=Math.floor(e.row*e.tileZoomLevel.scaleFactor/i);o=o>=0?o:0;const a=Math.ceil((e.row+1)*e.tileZoomLevel.scaleFactor/i);return y_(i,t,s,r,o,a,n)}function y_(e,t,i,n,s,r,o=a=>!0){const a=t.tileZoomLevels.find(u=>u.scaleFactor===e),h=[t.width,t.height];if(!a)return[];i=i||0,n=n||a.columns,s=s||0,r=r||a.rows;const c=[];for(let u=i;u<n;u++)for(let m=s;m<r;m++){const p={column:u,row:m,tileZoomLevel:a,imageSize:h};o(p)&&c.push(p)}return c}function Ag(e,t){return an(EA(e),t)}function EA(e){const t=w_(e);return[(t[2]-t[0])/2+t[0],(t[3]-t[1])/2+t[1]]}function CA(e){return[e.column*e.tileZoomLevel.originalWidth,e.row*e.tileZoomLevel.originalHeight]}function w_(e){const t=CA(e),i=Math.min(t[0]+e.tileZoomLevel.originalWidth,e.imageSize[0]),n=Math.min(t[1]+e.tileZoomLevel.originalHeight,e.imageSize[1]);return[t[0],t[1],i,n]}function xA(e){return[e.tileZoomLevel.width,e.tileZoomLevel.height]}function SA(e){return mo(xA(e))}function bA(e){return e.map(t=>SA(t)).reduce((t,i)=>t+i,0)}function AA(e){return e.rows*e.width*e.columns*e.height}function TA(e,t,i,n,s,r){const o=[],a=M_(e,t,i,n,r);for(const h of a)h&&o.push(h);if(o.length===0){const h=v_(e,t,i,s,r);h&&o.push(h)}return o}function v_(e,t,i,n,s){const r=2**(Math.log2(i)+1);if(r>t.tileZoomLevels.map(a=>a.scaleFactor).reduce((a,h)=>a+h,0)-i||n===0)return;const o=RA(e,t,r,s);return o!==void 0?o:v_(e,t,r,n--,s)}function M_(e,t,i,n,s){const r=2**(Math.log2(i)-1);if(r<=0||n===0)return[];const o=Tg(e,t,r,s),a=Tg(e,t,r,h=>!0);return o.length===a.length?o:[...o,...M_(e,t,r,n--,s)]}function RA(e,t,i,n){const s=__(e,t,i,n);if(s.length!==0)return s[0]}function Tg(e,t,i,n){return __(e,t,i,n)}function PA(e){return GA(e.mapId,e.tileUrl)}function GA(e,t){return`${e}:${t}`}function Pc(e){return LA(e.tileZoomLevel.scaleFactor,e.row,e.column)}function LA(e,t,i){return`${e}:${t}:${i}`}function OA(e,t,i){if(t.overviewTileZoomLevelForViewport&&e.tileZoomLevel.scaleFactor==t.overviewTileZoomLevelForViewport.scaleFactor)return!1;if(t.resourceViewportRingBboxForViewport===void 0||t.tileZoomLevelForViewport===void 0)return!0;const n=Math.log2(e.tileZoomLevel.scaleFactor)-Math.log2(t.tileZoomLevelForViewport.scaleFactor);return n>i.maxHigherLog2ScaleFactorDiff||-n>i.maxLowerLog2ScaleFactorDiff||!tb(j0(w_(e),Math.max(0,n)),t.resourceViewportRingBboxForViewport)}const FA=4,NA=2;class DA extends EventTarget{cachableTileFactory;fetchFn;tilesByTileUrl=new Map;mapIdsByTileUrl=new Map;tileUrlsByMapId=new Map;tilesFetchingCount=0;fetchableTiles=[];constructor(t,i){super(),this.setOptions(i),this.cachableTileFactory=t}getCacheableTiles(){return this.tilesByTileUrl.values()}getCacheableTile(t){return this.tilesByTileUrl.get(t)}getMapCacheableTiles(t){const i=[];for(const n of this.tilesByTileUrl.values())this.tileUrlsByMapId.get(t)?.has(n.tileUrl)&&i.push(n);return i}getCachedTiles(){const t=[];for(const i of this.tilesByTileUrl.values())i.isCachedTile()&&t.push(i);return t}getCachedTile(t){const i=this.tilesByTileUrl.get(t);if(i&&i.isCachedTile())return i}getMapCachedTiles(t){const i=[];for(const n of this.tilesByTileUrl.values())n.isCachedTile()&&this.tileUrlsByMapId.get(t)?.has(n.tileUrl)&&i.push(n);return i}getTileUrls(){return this.tilesByTileUrl.keys()}getMapTileUrls(t){return this.tileUrlsByMapId.get(t)||new Set}setOptions(t){this.fetchFn=t?.fetchFn}requestFetchableTiles(t){const i=new Set(this.fetchableTiles.map(s=>s.fetchableTileKey)),n=new Set(t.map(s=>s.fetchableTileKey));if(!db(i,n)){for(const s of t)this.requestFetchableTile(s);this.fetchableTiles=t}}async allRequestedTilesLoaded(){return new Promise(t=>{if(this.finished)t();else{const i=()=>{this.removeEventListener(st.ALLREQUESTEDTILESLOADED,i),t()};this.addEventListener(st.ALLREQUESTEDTILESLOADED,i)}})}prune(t){for(const[i,n]of this.mapIdsByTileUrl.entries())for(const s of n){const r=t.get(s),o=this.tilesByTileUrl.get(i)?.tile;o&&(!r||OA(o,r,{maxHigherLog2ScaleFactorDiff:FA,maxLowerLog2ScaleFactorDiff:NA}))&&this.removeCacheableTileForMapId(i,s)}}clear(){for(const t of this.getCacheableTiles())t.abort(),this.removeEventListenersFromCacheableTile(t);this.tilesByTileUrl=new Map,this.mapIdsByTileUrl=new Map,this.tileUrlsByMapId=new Map,this.tilesFetchingCount=0}destroy(){this.clear()}requestFetchableTile(t){const i=t.mapId,n=t.tileUrl;if(this.tilesByTileUrl.has(n))this.tilesByTileUrl.get(n)?.isCachedTile()&&this.dispatchEvent(new Rt(st.MAPTILELOADED,{mapId:i,tileUrl:n}));else{const s=this.cachableTileFactory(t,this.fetchFn);this.addEventListenersToCacheableTile(s),this.addCacheableTile(s)}this.addTileUrlForMapId(n,i),this.addMapIdForTileUrl(i,n)}addCacheableTile(t){this.tilesByTileUrl.set(t.tileUrl,t),t.fetch(),this.updateTilesFetchingCount(1)}removeCacheableTileForMapId(t,i){const n=this.tilesByTileUrl.get(t);if(!n)return;const s=this.removeMapIdForTileUrl(i,t);this.removeTileUrlForMapId(t,i),s.size||(n.isCachedTile()||(n.abort(),this.updateTilesFetchingCount(-1)),this.tilesByTileUrl.delete(t)),this.dispatchEvent(new Rt(st.MAPTILEREMOVED,{mapId:i,tileUrl:t}))}tileFetched(t){if(t instanceof Rt){const i=t.data;this.updateTilesFetchingCount(-1);for(const n of this.mapIdsByTileUrl.get(i)||[])this.dispatchEvent(new Rt(st.MAPTILELOADED,{mapId:n,tileUrl:i})),this.tileUrlsByMapId.get(n)?.values().next().value===i&&this.dispatchEvent(new Rt(st.FIRSTMAPTILELOADED,{mapId:n,tileUrl:i}))}}tileFetchError(t){if(t instanceof Rt){const i=t.data;this.tilesByTileUrl.has(i)||this.updateTilesFetchingCount(-1)}}addMapIdForTileUrl(t,i){let n=this.mapIdsByTileUrl.get(i);return n?n.add(t):n=new Set([t]),this.mapIdsByTileUrl.set(i,n),n}removeMapIdForTileUrl(t,i){const n=this.mapIdsByTileUrl.get(i);if(n)n.delete(t);else return new Set;return n.size?this.mapIdsByTileUrl.set(i,n):this.mapIdsByTileUrl.delete(i),n}addTileUrlForMapId(t,i){let n=this.tileUrlsByMapId.get(i);return n?n.add(t):n=new Set([t]),this.tileUrlsByMapId.set(i,n),n}removeTileUrlForMapId(t,i){const n=this.tileUrlsByMapId.get(i);return n?(n.delete(t),n.size?this.tileUrlsByMapId.set(i,n):this.tileUrlsByMapId.delete(i),n):new Set}get finished(){return this.tilesFetchingCount===0}updateTilesFetchingCount(t){this.tilesFetchingCount+=t,this.tilesFetchingCount===0&&this.dispatchEvent(new Rt(st.ALLREQUESTEDTILESLOADED))}addEventListenersToCacheableTile(t){t.addEventListener(st.TILEFETCHED,this.tileFetched.bind(this)),t.addEventListener(st.TILEFETCHERROR,this.tileFetchError.bind(this))}removeEventListenersFromCacheableTile(t){t.removeEventListener(st.TILEFETCHED,this.tileFetched.bind(this)),t.removeEventListener(st.TILEFETCHERROR,this.tileFetchError.bind(this))}}function Gc(e){return Array.isArray(e)?`[${e.map(t=>Gc(t)).join(",")}]`:typeof e=="number"?`${e}`:typeof e=="string"?`"${e}"`:typeof e=="object"&&e!==null?Object.keys(e).sort().map(t=>`${t}:${Gc(e[t])}`).join("|"):String(e)}const I_=16;async function kA(e){const t=await crypto.subtle.digest("SHA-1",new TextEncoder().encode(e));return Array.from(new Uint8Array(t)).map(s=>s.toString(16).padStart(2,"0")).join("")}async function jA(e,t=I_){return(await kA(String(e))).slice(0,t)}async function BA(e,t=I_){return await jA(Gc(e),t)}var ne;(function(e){e.assertEqual=s=>{};function t(s){}e.assertIs=t;function i(s){throw new Error}e.assertNever=i,e.arrayToEnum=s=>{const r={};for(const o of s)r[o]=o;return r},e.getValidEnumValues=s=>{const r=e.objectKeys(s).filter(a=>typeof s[s[a]]!="number"),o={};for(const a of r)o[a]=s[a];return e.objectValues(o)},e.objectValues=s=>e.objectKeys(s).map(function(r){return s[r]}),e.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const r=[];for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&r.push(o);return r},e.find=(s,r)=>{for(const o of s)if(r(o))return o},e.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,r=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(r)}e.joinValues=n,e.jsonStringifyReplacer=(s,r)=>typeof r=="bigint"?r.toString():r})(ne||(ne={}));var Rg;(function(e){e.mergeShapes=(t,i)=>({...t,...i})})(Rg||(Rg={}));const xt=ne.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),$n=e=>{switch(typeof e){case"undefined":return xt.undefined;case"string":return xt.string;case"number":return Number.isNaN(e)?xt.nan:xt.number;case"boolean":return xt.boolean;case"function":return xt.function;case"bigint":return xt.bigint;case"symbol":return xt.symbol;case"object":return Array.isArray(e)?xt.array:e===null?xt.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?xt.promise:typeof Map<"u"&&e instanceof Map?xt.map:typeof Set<"u"&&e instanceof Set?xt.set:typeof Date<"u"&&e instanceof Date?xt.date:xt.object;default:return xt.unknown}},lt=ne.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class xn extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=t}format(t){const i=t||function(r){return r.message},n={_errors:[]},s=r=>{for(const o of r.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)n._errors.push(i(o));else{let a=n,h=0;for(;h<o.path.length;){const c=o.path[h];h===o.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(i(o))):a[c]=a[c]||{_errors:[]},a=a[c],h++}}};return s(this),n}static assert(t){if(!(t instanceof xn))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ne.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=i=>i.message){const i={},n=[];for(const s of this.issues)if(s.path.length>0){const r=s.path[0];i[r]=i[r]||[],i[r].push(t(s))}else n.push(t(s));return{formErrors:n,fieldErrors:i}}get formErrors(){return this.flatten()}}xn.create=e=>new xn(e);const Lc=(e,t)=>{let i;switch(e.code){case lt.invalid_type:e.received===xt.undefined?i="Required":i=`Expected ${e.expected}, received ${e.received}`;break;case lt.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(e.expected,ne.jsonStringifyReplacer)}`;break;case lt.unrecognized_keys:i=`Unrecognized key(s) in object: ${ne.joinValues(e.keys,", ")}`;break;case lt.invalid_union:i="Invalid input";break;case lt.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ne.joinValues(e.options)}`;break;case lt.invalid_enum_value:i=`Invalid enum value. Expected ${ne.joinValues(e.options)}, received '${e.received}'`;break;case lt.invalid_arguments:i="Invalid function arguments";break;case lt.invalid_return_type:i="Invalid function return type";break;case lt.invalid_date:i="Invalid date";break;case lt.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(i=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?i=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?i=`Invalid input: must end with "${e.validation.endsWith}"`:ne.assertNever(e.validation):e.validation!=="regex"?i=`Invalid ${e.validation}`:i="Invalid";break;case lt.too_small:e.type==="array"?i=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?i=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?i=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?i=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?i=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:i="Invalid input";break;case lt.too_big:e.type==="array"?i=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?i=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?i=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?i=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?i=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:i="Invalid input";break;case lt.custom:i="Invalid input";break;case lt.invalid_intersection_types:i="Intersection results could not be merged";break;case lt.not_multiple_of:i=`Number must be a multiple of ${e.multipleOf}`;break;case lt.not_finite:i="Number must be finite";break;default:i=t.defaultError,ne.assertNever(e)}return{message:i}};let VA=Lc;function WA(){return VA}const zA=e=>{const{data:t,path:i,errorMaps:n,issueData:s}=e,r=[...i,...s.path||[]],o={...s,path:r};if(s.message!==void 0)return{...s,path:r,message:s.message};let a="";const h=n.filter(c=>!!c).slice().reverse();for(const c of h)a=c(o,{data:t,defaultError:a}).message;return{...s,path:r,message:a}};function yt(e,t){const i=WA(),n=zA({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,i,i===Lc?void 0:Lc].filter(s=>!!s)});e.common.issues.push(n)}class ti{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,i){const n=[];for(const s of i){if(s.status==="aborted")return Bt;s.status==="dirty"&&t.dirty(),n.push(s.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,i){const n=[];for(const s of i){const r=await s.key,o=await s.value;n.push({key:r,value:o})}return ti.mergeObjectSync(t,n)}static mergeObjectSync(t,i){const n={};for(const s of i){const{key:r,value:o}=s;if(r.status==="aborted"||o.status==="aborted")return Bt;r.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),r.value!=="__proto__"&&(typeof o.value<"u"||s.alwaysSet)&&(n[r.value]=o.value)}return{status:t.value,value:n}}}const Bt=Object.freeze({status:"aborted"}),_o=e=>({status:"dirty",value:e}),Ai=e=>({status:"valid",value:e}),Pg=e=>e.status==="aborted",Gg=e=>e.status==="dirty",Ir=e=>e.status==="valid",vh=e=>typeof Promise<"u"&&e instanceof Promise;var St;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t?.message})(St||(St={}));class hn{constructor(t,i,n,s){this._cachedPath=[],this.parent=t,this.data=i,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Lg=(e,t)=>{if(Ir(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const i=new xn(e.common.issues);return this._error=i,this._error}}};function $t(e){if(!e)return{};const{errorMap:t,invalid_type_error:i,required_error:n,description:s}=e;if(t&&(i||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:s}:{errorMap:(o,a)=>{const{message:h}=e;return o.code==="invalid_enum_value"?{message:h??a.defaultError}:typeof a.data>"u"?{message:h??n??a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:h??i??a.defaultError}},description:s}}class Qt{get description(){return this._def.description}_getType(t){return $n(t.data)}_getOrReturnCtx(t,i){return i||{common:t.parent.common,data:t.data,parsedType:$n(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ti,ctx:{common:t.parent.common,data:t.data,parsedType:$n(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const i=this._parse(t);if(vh(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(t){const i=this._parse(t);return Promise.resolve(i)}parse(t,i){const n=this.safeParse(t,i);if(n.success)return n.data;throw n.error}safeParse(t,i){const n={common:{issues:[],async:i?.async??!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:$n(t)},s=this._parseSync({data:t,path:n.path,parent:n});return Lg(n,s)}"~validate"(t){const i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:$n(t)};if(!this["~standard"].async)try{const n=this._parseSync({data:t,path:[],parent:i});return Ir(n)?{value:n.value}:{issues:i.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:i}).then(n=>Ir(n)?{value:n.value}:{issues:i.common.issues})}async parseAsync(t,i){const n=await this.safeParseAsync(t,i);if(n.success)return n.data;throw n.error}async safeParseAsync(t,i){const n={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:$n(t)},s=this._parse({data:t,path:n.path,parent:n}),r=await(vh(s)?s:Promise.resolve(s));return Lg(n,r)}refine(t,i){const n=s=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(s):i;return this._refinement((s,r)=>{const o=t(s),a=()=>r.addIssue({code:lt.custom,...n(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(h=>h?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(t,i){return this._refinement((n,s)=>t(n)?!0:(s.addIssue(typeof i=="function"?i(n,s):i),!1))}_refinement(t){return new xr({schema:this,typeName:kt.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return Qn.create(this,this._def)}nullable(){return Sr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return rn.create(this)}promise(){return xh.create(this,this._def)}or(t){return Ih.create([this,t],this._def)}and(t){return Eh.create(this,t,this._def)}transform(t){return new xr({...$t(this._def),schema:this,typeName:kt.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const i=typeof t=="function"?t:()=>t;return new jc({...$t(this._def),innerType:this,defaultValue:i,typeName:kt.ZodDefault})}brand(){return new dT({typeName:kt.ZodBranded,type:this,...$t(this._def)})}catch(t){const i=typeof t=="function"?t:()=>t;return new Bc({...$t(this._def),innerType:this,catchValue:i,typeName:kt.ZodCatch})}describe(t){const i=this.constructor;return new i({...this._def,description:t})}pipe(t){return Ou.create(this,t)}readonly(){return Vc.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const ZA=/^c[^\s-]{8,}$/i,UA=/^[0-9a-z]+$/,XA=/^[0-9A-HJKMNP-TV-Z]{26}$/i,$A=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,HA=/^[a-z0-9_-]{21}$/i,YA=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,KA=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,qA=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,JA="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Ol;const QA=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,tT=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,eT=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,iT=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,nT=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,sT=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,E_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",rT=new RegExp(`^${E_}$`);function C_(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const i=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${i}`}function oT(e){return new RegExp(`^${C_(e)}$`)}function aT(e){let t=`${E_}T${C_(e)}`;const i=[];return i.push(e.local?"Z?":"Z"),e.offset&&i.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${i.join("|")})`,new RegExp(`^${t}$`)}function hT(e,t){return!!((t==="v4"||!t)&&QA.test(e)||(t==="v6"||!t)&&eT.test(e))}function lT(e,t){if(!YA.test(e))return!1;try{const[i]=e.split(".");if(!i)return!1;const n=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||t&&s.alg!==t)}catch{return!1}}function cT(e,t){return!!((t==="v4"||!t)&&tT.test(e)||(t==="v6"||!t)&&iT.test(e))}class tn extends Qt{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==xt.string){const r=this._getOrReturnCtx(t);return yt(r,{code:lt.invalid_type,expected:xt.string,received:r.parsedType}),Bt}const n=new ti;let s;for(const r of this._def.checks)if(r.kind==="min")t.data.length<r.value&&(s=this._getOrReturnCtx(t,s),yt(s,{code:lt.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),n.dirty());else if(r.kind==="max")t.data.length>r.value&&(s=this._getOrReturnCtx(t,s),yt(s,{code:lt.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),n.dirty());else if(r.kind==="length"){const o=t.data.length>r.value,a=t.data.length<r.value;(o||a)&&(s=this._getOrReturnCtx(t,s),o?yt(s,{code:lt.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):a&&yt(s,{code:lt.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),n.dirty())}else if(r.kind==="email")qA.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"email",code:lt.invalid_string,message:r.message}),n.dirty());else if(r.kind==="emoji")Ol||(Ol=new RegExp(JA,"u")),Ol.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"emoji",code:lt.invalid_string,message:r.message}),n.dirty());else if(r.kind==="uuid")$A.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"uuid",code:lt.invalid_string,message:r.message}),n.dirty());else if(r.kind==="nanoid")HA.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"nanoid",code:lt.invalid_string,message:r.message}),n.dirty());else if(r.kind==="cuid")ZA.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"cuid",code:lt.invalid_string,message:r.message}),n.dirty());else if(r.kind==="cuid2")UA.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"cuid2",code:lt.invalid_string,message:r.message}),n.dirty());else if(r.kind==="ulid")XA.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"ulid",code:lt.invalid_string,message:r.message}),n.dirty());else if(r.kind==="url")try{new URL(t.data)}catch{s=this._getOrReturnCtx(t,s),yt(s,{validation:"url",code:lt.invalid_string,message:r.message}),n.dirty()}else r.kind==="regex"?(r.regex.lastIndex=0,r.regex.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"regex",code:lt.invalid_string,message:r.message}),n.dirty())):r.kind==="trim"?t.data=t.data.trim():r.kind==="includes"?t.data.includes(r.value,r.position)||(s=this._getOrReturnCtx(t,s),yt(s,{code:lt.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),n.dirty()):r.kind==="toLowerCase"?t.data=t.data.toLowerCase():r.kind==="toUpperCase"?t.data=t.data.toUpperCase():r.kind==="startsWith"?t.data.startsWith(r.value)||(s=this._getOrReturnCtx(t,s),yt(s,{code:lt.invalid_string,validation:{startsWith:r.value},message:r.message}),n.dirty()):r.kind==="endsWith"?t.data.endsWith(r.value)||(s=this._getOrReturnCtx(t,s),yt(s,{code:lt.invalid_string,validation:{endsWith:r.value},message:r.message}),n.dirty()):r.kind==="datetime"?aT(r).test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{code:lt.invalid_string,validation:"datetime",message:r.message}),n.dirty()):r.kind==="date"?rT.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{code:lt.invalid_string,validation:"date",message:r.message}),n.dirty()):r.kind==="time"?oT(r).test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{code:lt.invalid_string,validation:"time",message:r.message}),n.dirty()):r.kind==="duration"?KA.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"duration",code:lt.invalid_string,message:r.message}),n.dirty()):r.kind==="ip"?hT(t.data,r.version)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"ip",code:lt.invalid_string,message:r.message}),n.dirty()):r.kind==="jwt"?lT(t.data,r.alg)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"jwt",code:lt.invalid_string,message:r.message}),n.dirty()):r.kind==="cidr"?cT(t.data,r.version)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"cidr",code:lt.invalid_string,message:r.message}),n.dirty()):r.kind==="base64"?nT.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"base64",code:lt.invalid_string,message:r.message}),n.dirty()):r.kind==="base64url"?sT.test(t.data)||(s=this._getOrReturnCtx(t,s),yt(s,{validation:"base64url",code:lt.invalid_string,message:r.message}),n.dirty()):ne.assertNever(r);return{status:n.value,value:t.data}}_regex(t,i,n){return this.refinement(s=>t.test(s),{validation:i,code:lt.invalid_string,...St.errToObj(n)})}_addCheck(t){return new tn({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...St.errToObj(t)})}url(t){return this._addCheck({kind:"url",...St.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...St.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...St.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...St.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...St.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...St.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...St.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...St.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...St.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...St.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...St.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...St.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof t?.precision>"u"?null:t?.precision,offset:t?.offset??!1,local:t?.local??!1,...St.errToObj(t?.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof t?.precision>"u"?null:t?.precision,...St.errToObj(t?.message)})}duration(t){return this._addCheck({kind:"duration",...St.errToObj(t)})}regex(t,i){return this._addCheck({kind:"regex",regex:t,...St.errToObj(i)})}includes(t,i){return this._addCheck({kind:"includes",value:t,position:i?.position,...St.errToObj(i?.message)})}startsWith(t,i){return this._addCheck({kind:"startsWith",value:t,...St.errToObj(i)})}endsWith(t,i){return this._addCheck({kind:"endsWith",value:t,...St.errToObj(i)})}min(t,i){return this._addCheck({kind:"min",value:t,...St.errToObj(i)})}max(t,i){return this._addCheck({kind:"max",value:t,...St.errToObj(i)})}length(t,i){return this._addCheck({kind:"length",value:t,...St.errToObj(i)})}nonempty(t){return this.min(1,St.errToObj(t))}trim(){return new tn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new tn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new tn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxLength(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}}tn.create=e=>new tn({checks:[],typeName:kt.ZodString,coerce:e?.coerce??!1,...$t(e)});function uT(e,t){const i=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,s=i>n?i:n,r=Number.parseInt(e.toFixed(s).replace(".","")),o=Number.parseInt(t.toFixed(s).replace(".",""));return r%o/10**s}class Rs extends Qt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==xt.number){const r=this._getOrReturnCtx(t);return yt(r,{code:lt.invalid_type,expected:xt.number,received:r.parsedType}),Bt}let n;const s=new ti;for(const r of this._def.checks)r.kind==="int"?ne.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),yt(n,{code:lt.invalid_type,expected:"integer",received:"float",message:r.message}),s.dirty()):r.kind==="min"?(r.inclusive?t.data<r.value:t.data<=r.value)&&(n=this._getOrReturnCtx(t,n),yt(n,{code:lt.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty()):r.kind==="max"?(r.inclusive?t.data>r.value:t.data>=r.value)&&(n=this._getOrReturnCtx(t,n),yt(n,{code:lt.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty()):r.kind==="multipleOf"?uT(t.data,r.value)!==0&&(n=this._getOrReturnCtx(t,n),yt(n,{code:lt.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):r.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),yt(n,{code:lt.not_finite,message:r.message}),s.dirty()):ne.assertNever(r);return{status:s.value,value:t.data}}gte(t,i){return this.setLimit("min",t,!0,St.toString(i))}gt(t,i){return this.setLimit("min",t,!1,St.toString(i))}lte(t,i){return this.setLimit("max",t,!0,St.toString(i))}lt(t,i){return this.setLimit("max",t,!1,St.toString(i))}setLimit(t,i,n,s){return new Rs({...this._def,checks:[...this._def.checks,{kind:t,value:i,inclusive:n,message:St.toString(s)}]})}_addCheck(t){return new Rs({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:St.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:St.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:St.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:St.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:St.toString(t)})}multipleOf(t,i){return this._addCheck({kind:"multipleOf",value:t,message:St.toString(i)})}finite(t){return this._addCheck({kind:"finite",message:St.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:St.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:St.toString(t)})}get minValue(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxValue(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&ne.isInteger(t.value))}get isFinite(){let t=null,i=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(i===null||n.value>i)&&(i=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(i)&&Number.isFinite(t)}}Rs.create=e=>new Rs({checks:[],typeName:kt.ZodNumber,coerce:e?.coerce||!1,...$t(e)});class Ps extends Qt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==xt.bigint)return this._getInvalidInput(t);let n;const s=new ti;for(const r of this._def.checks)r.kind==="min"?(r.inclusive?t.data<r.value:t.data<=r.value)&&(n=this._getOrReturnCtx(t,n),yt(n,{code:lt.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty()):r.kind==="max"?(r.inclusive?t.data>r.value:t.data>=r.value)&&(n=this._getOrReturnCtx(t,n),yt(n,{code:lt.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty()):r.kind==="multipleOf"?t.data%r.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),yt(n,{code:lt.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):ne.assertNever(r);return{status:s.value,value:t.data}}_getInvalidInput(t){const i=this._getOrReturnCtx(t);return yt(i,{code:lt.invalid_type,expected:xt.bigint,received:i.parsedType}),Bt}gte(t,i){return this.setLimit("min",t,!0,St.toString(i))}gt(t,i){return this.setLimit("min",t,!1,St.toString(i))}lte(t,i){return this.setLimit("max",t,!0,St.toString(i))}lt(t,i){return this.setLimit("max",t,!1,St.toString(i))}setLimit(t,i,n,s){return new Ps({...this._def,checks:[...this._def.checks,{kind:t,value:i,inclusive:n,message:St.toString(s)}]})}_addCheck(t){return new Ps({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:St.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:St.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:St.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:St.toString(t)})}multipleOf(t,i){return this._addCheck({kind:"multipleOf",value:t,message:St.toString(i)})}get minValue(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxValue(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}}Ps.create=e=>new Ps({checks:[],typeName:kt.ZodBigInt,coerce:e?.coerce??!1,...$t(e)});class Mh extends Qt{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==xt.boolean){const n=this._getOrReturnCtx(t);return yt(n,{code:lt.invalid_type,expected:xt.boolean,received:n.parsedType}),Bt}return Ai(t.data)}}Mh.create=e=>new Mh({typeName:kt.ZodBoolean,coerce:e?.coerce||!1,...$t(e)});class Er extends Qt{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==xt.date){const r=this._getOrReturnCtx(t);return yt(r,{code:lt.invalid_type,expected:xt.date,received:r.parsedType}),Bt}if(Number.isNaN(t.data.getTime())){const r=this._getOrReturnCtx(t);return yt(r,{code:lt.invalid_date}),Bt}const n=new ti;let s;for(const r of this._def.checks)r.kind==="min"?t.data.getTime()<r.value&&(s=this._getOrReturnCtx(t,s),yt(s,{code:lt.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),n.dirty()):r.kind==="max"?t.data.getTime()>r.value&&(s=this._getOrReturnCtx(t,s),yt(s,{code:lt.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),n.dirty()):ne.assertNever(r);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Er({...this._def,checks:[...this._def.checks,t]})}min(t,i){return this._addCheck({kind:"min",value:t.getTime(),message:St.toString(i)})}max(t,i){return this._addCheck({kind:"max",value:t.getTime(),message:St.toString(i)})}get minDate(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t!=null?new Date(t):null}}Er.create=e=>new Er({checks:[],coerce:e?.coerce||!1,typeName:kt.ZodDate,...$t(e)});class Og extends Qt{_parse(t){if(this._getType(t)!==xt.symbol){const n=this._getOrReturnCtx(t);return yt(n,{code:lt.invalid_type,expected:xt.symbol,received:n.parsedType}),Bt}return Ai(t.data)}}Og.create=e=>new Og({typeName:kt.ZodSymbol,...$t(e)});class Fg extends Qt{_parse(t){if(this._getType(t)!==xt.undefined){const n=this._getOrReturnCtx(t);return yt(n,{code:lt.invalid_type,expected:xt.undefined,received:n.parsedType}),Bt}return Ai(t.data)}}Fg.create=e=>new Fg({typeName:kt.ZodUndefined,...$t(e)});class Ng extends Qt{_parse(t){if(this._getType(t)!==xt.null){const n=this._getOrReturnCtx(t);return yt(n,{code:lt.invalid_type,expected:xt.null,received:n.parsedType}),Bt}return Ai(t.data)}}Ng.create=e=>new Ng({typeName:kt.ZodNull,...$t(e)});class Oc extends Qt{constructor(){super(...arguments),this._any=!0}_parse(t){return Ai(t.data)}}Oc.create=e=>new Oc({typeName:kt.ZodAny,...$t(e)});class Fc extends Qt{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ai(t.data)}}Fc.create=e=>new Fc({typeName:kt.ZodUnknown,...$t(e)});class ss extends Qt{_parse(t){const i=this._getOrReturnCtx(t);return yt(i,{code:lt.invalid_type,expected:xt.never,received:i.parsedType}),Bt}}ss.create=e=>new ss({typeName:kt.ZodNever,...$t(e)});class Dg extends Qt{_parse(t){if(this._getType(t)!==xt.undefined){const n=this._getOrReturnCtx(t);return yt(n,{code:lt.invalid_type,expected:xt.void,received:n.parsedType}),Bt}return Ai(t.data)}}Dg.create=e=>new Dg({typeName:kt.ZodVoid,...$t(e)});class rn extends Qt{_parse(t){const{ctx:i,status:n}=this._processInputParams(t),s=this._def;if(i.parsedType!==xt.array)return yt(i,{code:lt.invalid_type,expected:xt.array,received:i.parsedType}),Bt;if(s.exactLength!==null){const o=i.data.length>s.exactLength.value,a=i.data.length<s.exactLength.value;(o||a)&&(yt(i,{code:o?lt.too_big:lt.too_small,minimum:a?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&i.data.length<s.minLength.value&&(yt(i,{code:lt.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&i.data.length>s.maxLength.value&&(yt(i,{code:lt.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),i.common.async)return Promise.all([...i.data].map((o,a)=>s.type._parseAsync(new hn(i,o,i.path,a)))).then(o=>ti.mergeArray(n,o));const r=[...i.data].map((o,a)=>s.type._parseSync(new hn(i,o,i.path,a)));return ti.mergeArray(n,r)}get element(){return this._def.type}min(t,i){return new rn({...this._def,minLength:{value:t,message:St.toString(i)}})}max(t,i){return new rn({...this._def,maxLength:{value:t,message:St.toString(i)}})}length(t,i){return new rn({...this._def,exactLength:{value:t,message:St.toString(i)}})}nonempty(t){return this.min(1,t)}}rn.create=(e,t)=>new rn({type:e,minLength:null,maxLength:null,exactLength:null,typeName:kt.ZodArray,...$t(t)});function Qs(e){if(e instanceof Re){const t={};for(const i in e.shape){const n=e.shape[i];t[i]=Qn.create(Qs(n))}return new Re({...e._def,shape:()=>t})}else return e instanceof rn?new rn({...e._def,type:Qs(e.element)}):e instanceof Qn?Qn.create(Qs(e.unwrap())):e instanceof Sr?Sr.create(Qs(e.unwrap())):e instanceof Gs?Gs.create(e.items.map(t=>Qs(t))):e}class Re extends Qt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),i=ne.objectKeys(t);return this._cached={shape:t,keys:i},this._cached}_parse(t){if(this._getType(t)!==xt.object){const c=this._getOrReturnCtx(t);return yt(c,{code:lt.invalid_type,expected:xt.object,received:c.parsedType}),Bt}const{status:n,ctx:s}=this._processInputParams(t),{shape:r,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof ss&&this._def.unknownKeys==="strip"))for(const c in s.data)o.includes(c)||a.push(c);const h=[];for(const c of o){const u=r[c],m=s.data[c];h.push({key:{status:"valid",value:c},value:u._parse(new hn(s,m,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof ss){const c=this._def.unknownKeys;if(c==="passthrough")for(const u of a)h.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(c==="strict")a.length>0&&(yt(s,{code:lt.unrecognized_keys,keys:a}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const u of a){const m=s.data[u];h.push({key:{status:"valid",value:u},value:c._parse(new hn(s,m,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const u of h){const m=await u.key,p=await u.value;c.push({key:m,value:p,alwaysSet:u.alwaysSet})}return c}).then(c=>ti.mergeObjectSync(n,c)):ti.mergeObjectSync(n,h)}get shape(){return this._def.shape()}strict(t){return St.errToObj,new Re({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(i,n)=>{const s=this._def.errorMap?.(i,n).message??n.defaultError;return i.code==="unrecognized_keys"?{message:St.errToObj(t).message??s}:{message:s}}}:{}})}strip(){return new Re({...this._def,unknownKeys:"strip"})}passthrough(){return new Re({...this._def,unknownKeys:"passthrough"})}extend(t){return new Re({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Re({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:kt.ZodObject})}setKey(t,i){return this.augment({[t]:i})}catchall(t){return new Re({...this._def,catchall:t})}pick(t){const i={};for(const n of ne.objectKeys(t))t[n]&&this.shape[n]&&(i[n]=this.shape[n]);return new Re({...this._def,shape:()=>i})}omit(t){const i={};for(const n of ne.objectKeys(this.shape))t[n]||(i[n]=this.shape[n]);return new Re({...this._def,shape:()=>i})}deepPartial(){return Qs(this)}partial(t){const i={};for(const n of ne.objectKeys(this.shape)){const s=this.shape[n];t&&!t[n]?i[n]=s:i[n]=s.optional()}return new Re({...this._def,shape:()=>i})}required(t){const i={};for(const n of ne.objectKeys(this.shape))if(t&&!t[n])i[n]=this.shape[n];else{let r=this.shape[n];for(;r instanceof Qn;)r=r._def.innerType;i[n]=r}return new Re({...this._def,shape:()=>i})}keyof(){return x_(ne.objectKeys(this.shape))}}Re.create=(e,t)=>new Re({shape:()=>e,unknownKeys:"strip",catchall:ss.create(),typeName:kt.ZodObject,...$t(t)});Re.strictCreate=(e,t)=>new Re({shape:()=>e,unknownKeys:"strict",catchall:ss.create(),typeName:kt.ZodObject,...$t(t)});Re.lazycreate=(e,t)=>new Re({shape:e,unknownKeys:"strip",catchall:ss.create(),typeName:kt.ZodObject,...$t(t)});class Ih extends Qt{_parse(t){const{ctx:i}=this._processInputParams(t),n=this._def.options;function s(r){for(const a of r)if(a.result.status==="valid")return a.result;for(const a of r)if(a.result.status==="dirty")return i.common.issues.push(...a.ctx.common.issues),a.result;const o=r.map(a=>new xn(a.ctx.common.issues));return yt(i,{code:lt.invalid_union,unionErrors:o}),Bt}if(i.common.async)return Promise.all(n.map(async r=>{const o={...i,common:{...i.common,issues:[]},parent:null};return{result:await r._parseAsync({data:i.data,path:i.path,parent:o}),ctx:o}})).then(s);{let r;const o=[];for(const h of n){const c={...i,common:{...i.common,issues:[]},parent:null},u=h._parseSync({data:i.data,path:i.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!r&&(r={result:u,ctx:c}),c.common.issues.length&&o.push(c.common.issues)}if(r)return i.common.issues.push(...r.ctx.common.issues),r.result;const a=o.map(h=>new xn(h));return yt(i,{code:lt.invalid_union,unionErrors:a}),Bt}}get options(){return this._def.options}}Ih.create=(e,t)=>new Ih({options:e,typeName:kt.ZodUnion,...$t(t)});function Nc(e,t){const i=$n(e),n=$n(t);if(e===t)return{valid:!0,data:e};if(i===xt.object&&n===xt.object){const s=ne.objectKeys(t),r=ne.objectKeys(e).filter(a=>s.indexOf(a)!==-1),o={...e,...t};for(const a of r){const h=Nc(e[a],t[a]);if(!h.valid)return{valid:!1};o[a]=h.data}return{valid:!0,data:o}}else if(i===xt.array&&n===xt.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let r=0;r<e.length;r++){const o=e[r],a=t[r],h=Nc(o,a);if(!h.valid)return{valid:!1};s.push(h.data)}return{valid:!0,data:s}}else return i===xt.date&&n===xt.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class Eh extends Qt{_parse(t){const{status:i,ctx:n}=this._processInputParams(t),s=(r,o)=>{if(Pg(r)||Pg(o))return Bt;const a=Nc(r.value,o.value);return a.valid?((Gg(r)||Gg(o))&&i.dirty(),{status:i.value,value:a.data}):(yt(n,{code:lt.invalid_intersection_types}),Bt)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([r,o])=>s(r,o)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Eh.create=(e,t,i)=>new Eh({left:e,right:t,typeName:kt.ZodIntersection,...$t(i)});class Gs extends Qt{_parse(t){const{status:i,ctx:n}=this._processInputParams(t);if(n.parsedType!==xt.array)return yt(n,{code:lt.invalid_type,expected:xt.array,received:n.parsedType}),Bt;if(n.data.length<this._def.items.length)return yt(n,{code:lt.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Bt;!this._def.rest&&n.data.length>this._def.items.length&&(yt(n,{code:lt.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),i.dirty());const r=[...n.data].map((o,a)=>{const h=this._def.items[a]||this._def.rest;return h?h._parse(new hn(n,o,n.path,a)):null}).filter(o=>!!o);return n.common.async?Promise.all(r).then(o=>ti.mergeArray(i,o)):ti.mergeArray(i,r)}get items(){return this._def.items}rest(t){return new Gs({...this._def,rest:t})}}Gs.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Gs({items:e,typeName:kt.ZodTuple,rest:null,...$t(t)})};class Ch extends Qt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:i,ctx:n}=this._processInputParams(t);if(n.parsedType!==xt.object)return yt(n,{code:lt.invalid_type,expected:xt.object,received:n.parsedType}),Bt;const s=[],r=this._def.keyType,o=this._def.valueType;for(const a in n.data)s.push({key:r._parse(new hn(n,a,n.path,a)),value:o._parse(new hn(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?ti.mergeObjectAsync(i,s):ti.mergeObjectSync(i,s)}get element(){return this._def.valueType}static create(t,i,n){return i instanceof Qt?new Ch({keyType:t,valueType:i,typeName:kt.ZodRecord,...$t(n)}):new Ch({keyType:tn.create(),valueType:t,typeName:kt.ZodRecord,...$t(i)})}}class kg extends Qt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:i,ctx:n}=this._processInputParams(t);if(n.parsedType!==xt.map)return yt(n,{code:lt.invalid_type,expected:xt.map,received:n.parsedType}),Bt;const s=this._def.keyType,r=this._def.valueType,o=[...n.data.entries()].map(([a,h],c)=>({key:s._parse(new hn(n,a,n.path,[c,"key"])),value:r._parse(new hn(n,h,n.path,[c,"value"]))}));if(n.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const h of o){const c=await h.key,u=await h.value;if(c.status==="aborted"||u.status==="aborted")return Bt;(c.status==="dirty"||u.status==="dirty")&&i.dirty(),a.set(c.value,u.value)}return{status:i.value,value:a}})}else{const a=new Map;for(const h of o){const c=h.key,u=h.value;if(c.status==="aborted"||u.status==="aborted")return Bt;(c.status==="dirty"||u.status==="dirty")&&i.dirty(),a.set(c.value,u.value)}return{status:i.value,value:a}}}}kg.create=(e,t,i)=>new kg({valueType:t,keyType:e,typeName:kt.ZodMap,...$t(i)});class Ko extends Qt{_parse(t){const{status:i,ctx:n}=this._processInputParams(t);if(n.parsedType!==xt.set)return yt(n,{code:lt.invalid_type,expected:xt.set,received:n.parsedType}),Bt;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(yt(n,{code:lt.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),i.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(yt(n,{code:lt.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),i.dirty());const r=this._def.valueType;function o(h){const c=new Set;for(const u of h){if(u.status==="aborted")return Bt;u.status==="dirty"&&i.dirty(),c.add(u.value)}return{status:i.value,value:c}}const a=[...n.data.values()].map((h,c)=>r._parse(new hn(n,h,n.path,c)));return n.common.async?Promise.all(a).then(h=>o(h)):o(a)}min(t,i){return new Ko({...this._def,minSize:{value:t,message:St.toString(i)}})}max(t,i){return new Ko({...this._def,maxSize:{value:t,message:St.toString(i)}})}size(t,i){return this.min(t,i).max(t,i)}nonempty(t){return this.min(1,t)}}Ko.create=(e,t)=>new Ko({valueType:e,minSize:null,maxSize:null,typeName:kt.ZodSet,...$t(t)});class Dc extends Qt{get schema(){return this._def.getter()}_parse(t){const{ctx:i}=this._processInputParams(t);return this._def.getter()._parse({data:i.data,path:i.path,parent:i})}}Dc.create=(e,t)=>new Dc({getter:e,typeName:kt.ZodLazy,...$t(t)});class kc extends Qt{_parse(t){if(t.data!==this._def.value){const i=this._getOrReturnCtx(t);return yt(i,{received:i.data,code:lt.invalid_literal,expected:this._def.value}),Bt}return{status:"valid",value:t.data}}get value(){return this._def.value}}kc.create=(e,t)=>new kc({value:e,typeName:kt.ZodLiteral,...$t(t)});function x_(e,t){return new Cr({values:e,typeName:kt.ZodEnum,...$t(t)})}class Cr extends Qt{_parse(t){if(typeof t.data!="string"){const i=this._getOrReturnCtx(t),n=this._def.values;return yt(i,{expected:ne.joinValues(n),received:i.parsedType,code:lt.invalid_type}),Bt}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const i=this._getOrReturnCtx(t),n=this._def.values;return yt(i,{received:i.data,code:lt.invalid_enum_value,options:n}),Bt}return Ai(t.data)}get options(){return this._def.values}get enum(){const t={};for(const i of this._def.values)t[i]=i;return t}get Values(){const t={};for(const i of this._def.values)t[i]=i;return t}get Enum(){const t={};for(const i of this._def.values)t[i]=i;return t}extract(t,i=this._def){return Cr.create(t,{...this._def,...i})}exclude(t,i=this._def){return Cr.create(this.options.filter(n=>!t.includes(n)),{...this._def,...i})}}Cr.create=x_;class jg extends Qt{_parse(t){const i=ne.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==xt.string&&n.parsedType!==xt.number){const s=ne.objectValues(i);return yt(n,{expected:ne.joinValues(s),received:n.parsedType,code:lt.invalid_type}),Bt}if(this._cache||(this._cache=new Set(ne.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const s=ne.objectValues(i);return yt(n,{received:n.data,code:lt.invalid_enum_value,options:s}),Bt}return Ai(t.data)}get enum(){return this._def.values}}jg.create=(e,t)=>new jg({values:e,typeName:kt.ZodNativeEnum,...$t(t)});class xh extends Qt{unwrap(){return this._def.type}_parse(t){const{ctx:i}=this._processInputParams(t);if(i.parsedType!==xt.promise&&i.common.async===!1)return yt(i,{code:lt.invalid_type,expected:xt.promise,received:i.parsedType}),Bt;const n=i.parsedType===xt.promise?i.data:Promise.resolve(i.data);return Ai(n.then(s=>this._def.type.parseAsync(s,{path:i.path,errorMap:i.common.contextualErrorMap})))}}xh.create=(e,t)=>new xh({type:e,typeName:kt.ZodPromise,...$t(t)});class xr extends Qt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===kt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:i,ctx:n}=this._processInputParams(t),s=this._def.effect||null,r={addIssue:o=>{yt(n,o),o.fatal?i.abort():i.dirty()},get path(){return n.path}};if(r.addIssue=r.addIssue.bind(r),s.type==="preprocess"){const o=s.transform(n.data,r);if(n.common.async)return Promise.resolve(o).then(async a=>{if(i.value==="aborted")return Bt;const h=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return h.status==="aborted"?Bt:h.status==="dirty"||i.value==="dirty"?_o(h.value):h});{if(i.value==="aborted")return Bt;const a=this._def.schema._parseSync({data:o,path:n.path,parent:n});return a.status==="aborted"?Bt:a.status==="dirty"||i.value==="dirty"?_o(a.value):a}}if(s.type==="refinement"){const o=a=>{const h=s.refinement(a,r);if(n.common.async)return Promise.resolve(h);if(h instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?Bt:(a.status==="dirty"&&i.dirty(),o(a.value),{status:i.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?Bt:(a.status==="dirty"&&i.dirty(),o(a.value).then(()=>({status:i.value,value:a.value}))))}if(s.type==="transform")if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Ir(o))return Bt;const a=s.transform(o.value,r);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:i.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>Ir(o)?Promise.resolve(s.transform(o.value,r)).then(a=>({status:i.value,value:a})):Bt);ne.assertNever(s)}}xr.create=(e,t,i)=>new xr({schema:e,typeName:kt.ZodEffects,effect:t,...$t(i)});xr.createWithPreprocess=(e,t,i)=>new xr({schema:t,effect:{type:"preprocess",transform:e},typeName:kt.ZodEffects,...$t(i)});class Qn extends Qt{_parse(t){return this._getType(t)===xt.undefined?Ai(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Qn.create=(e,t)=>new Qn({innerType:e,typeName:kt.ZodOptional,...$t(t)});class Sr extends Qt{_parse(t){return this._getType(t)===xt.null?Ai(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Sr.create=(e,t)=>new Sr({innerType:e,typeName:kt.ZodNullable,...$t(t)});class jc extends Qt{_parse(t){const{ctx:i}=this._processInputParams(t);let n=i.data;return i.parsedType===xt.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:i.path,parent:i})}removeDefault(){return this._def.innerType}}jc.create=(e,t)=>new jc({innerType:e,typeName:kt.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...$t(t)});class Bc extends Qt{_parse(t){const{ctx:i}=this._processInputParams(t),n={...i,common:{...i.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return vh(s)?s.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new xn(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new xn(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Bc.create=(e,t)=>new Bc({innerType:e,typeName:kt.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...$t(t)});class Bg extends Qt{_parse(t){if(this._getType(t)!==xt.nan){const n=this._getOrReturnCtx(t);return yt(n,{code:lt.invalid_type,expected:xt.nan,received:n.parsedType}),Bt}return{status:"valid",value:t.data}}}Bg.create=e=>new Bg({typeName:kt.ZodNaN,...$t(e)});class dT extends Qt{_parse(t){const{ctx:i}=this._processInputParams(t),n=i.data;return this._def.type._parse({data:n,path:i.path,parent:i})}unwrap(){return this._def.type}}class Ou extends Qt{_parse(t){const{status:i,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const r=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return r.status==="aborted"?Bt:r.status==="dirty"?(i.dirty(),_o(r.value)):this._def.out._parseAsync({data:r.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?Bt:s.status==="dirty"?(i.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(t,i){return new Ou({in:t,out:i,typeName:kt.ZodPipeline})}}class Vc extends Qt{_parse(t){const i=this._def.innerType._parse(t),n=s=>(Ir(s)&&(s.value=Object.freeze(s.value)),s);return vh(i)?i.then(s=>n(s)):n(i)}unwrap(){return this._def.innerType}}Vc.create=(e,t)=>new Vc({innerType:e,typeName:kt.ZodReadonly,...$t(t)});var kt;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(kt||(kt={}));const ct=tn.create,Ft=Rs.create;Ps.create;const Fu=Mh.create;Er.create;const Nu=Oc.create,Du=Fc.create;ss.create;const cn=rn.create,wt=Re.create,Lt=Ih.create;Eh.create;const fT=Gs.create,ku=Ch.create,ga=Dc.create,Xt=kc.create,Nr=Cr.create;xh.create;Qn.create;Sr.create;const gT={string:(e=>tn.create({...e,coerce:!0})),number:(e=>Rs.create({...e,coerce:!0})),boolean:(e=>Mh.create({...e,coerce:!0})),bigint:(e=>Ps.create({...e,coerce:!0})),date:(e=>Er.create({...e,coerce:!0}))};function mT(e){if(e)return Array.isArray(e)?e:[e]}const pT=Lt([ct(),Ft(),Fu()]),_T=ku(ct(),pT.array()),rs=fT([Ft(),Ft()]),S_=wt({type:Xt("Point"),coordinates:rs}),b_=rs.array().min(3),A_=["ImageService1","ImageService2","ImageService3"],yT=[...A_,"Canvas"],ju=Nr(A_),T_=Nr(yT),wT=wt({id:ct().url(),type:ct(),label:_T.optional()}),Wc=wT.extend({partOf:ga(()=>Wc.array()).optional()}),Yh=Lt([Wc.array(),Wc]).transform(mT),Vg=wt({type:Nr(["helmert","polynomial","thinPlateSpline","projective"]),options:wt({}).passthrough().optional()});function Wg(e){const t=e.toLowerCase();if(t==="thinplatespline"||t==="thin-plate-spline")return{type:"thinPlateSpline"};if(t==="polynomial1")return{type:"polynomial",options:{order:1}};if(t==="polynomial2")return{type:"polynomial",options:{order:2}}}const Kh=Lt([Vg,Du()]).transform(e=>{const{success:t,data:i}=Vg.safeParse(e);if(t)return i;if(e==="string")return Wg(e);if(e&&typeof e=="object"&&"type"in e&&typeof e.type=="string")return Wg(e.type)}),R_=wt({name:ct().optional(),definition:Lt([ct(),Du()])}),qh=Lt([ct().url().array(),ct().url()]),vT=/^<svg\s+width="\d+"\s+height="\d+"\s*>\s*<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>\s*<\/svg>$/,MT=wt({type:Xt("SvgSelector"),value:ct().regex(vT)}),IT=wt({source:ct().url(),service:cn(wt({"@id":ct().url(),type:T_})).length(1),selector:MT}),P_=wt({pixelCoords:rs}),ET=wt({type:Xt("FeatureCollection"),transformation:Kh.optional(),features:cn(wt({type:Xt("Feature"),properties:P_,geometry:S_}))}),Bu=wt({id:ct().optional(),type:Xt("Annotation"),"@context":qh.optional(),motivation:ct().default("georeferencing").optional(),target:IT,body:ET}),G_=wt({id:ct().optional(),type:Xt("AnnotationPage"),"@context":qh.optional(),items:cn(Bu)}),Vu=/<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>/,CT=new RegExp(`^<svg\\s+width="\\d+"\\s+height="\\d+"\\s*>\\s*${Vu.source}\\s*</svg>$`),xT=new RegExp(`^<svg\\s+height="\\d+"\\s+width="\\d+"\\s*>\\s*${Vu.source}\\s*</svg>$`),ST=new RegExp(`^<svg\\s*>\\s*${Vu.source}\\s*</svg>$`),bT=ct().regex(ST),AT=ct().regex(CT),TT=ct().regex(xT),RT=wt({type:Xt("SvgSelector"),value:Lt([bT,AT,TT])}),PT=wt({"@id":ct().url(),type:ju,height:Ft().positive(),width:Ft().positive(),partOf:Yh.optional()}),GT=wt({id:ct().url(),type:ju,height:Ft().positive().optional(),width:Ft().positive().optional(),partOf:Yh.optional()}),LT=wt({id:ct().url(),type:Xt("Canvas"),height:Ft().positive().optional(),width:Ft().positive().optional(),partOf:Yh.optional()}),OT=Lt([PT,GT,LT]),FT=wt({type:Xt("SpecificResource"),source:OT,selector:RT}),L_=wt({resourceCoords:rs}),NT=wt({type:Xt("FeatureCollection"),transformation:Kh.optional(),resourceCrs:R_.optional(),features:cn(wt({type:Xt("Feature"),properties:L_,geometry:S_}))}),Wu=wt({id:ct().optional(),type:Xt("Annotation"),"@context":qh.optional(),motivation:ct().default("georeferencing").optional(),created:ct().datetime().optional(),modified:ct().datetime().optional(),target:FT,body:NT}),O_=wt({id:ct().optional(),type:Xt("AnnotationPage"),"@context":qh.optional(),items:cn(Wu)});Lt([Bu,Wu]);Lt([G_,O_]);Lt([P_,L_]);function F_(e){return Array.isArray(e)}function DT(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="AnnotationPage"&&"items"in e)}function Sh(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="GeoreferencedMap")}function zg(e){return!!(e&&typeof e=="object"&&"target"in e&&e.target&&typeof e.target=="object"&&"source"in e.target&&typeof e.target.source=="string")}function Jh(e){return"type"in e&&e.type==="GeoreferencedMap"}function Qh(e){return"source"in e.target&&typeof e.target.source=="object"}function kT(e){return{id:jT(e),...UT(e),type:BT(e),partOf:VT(e)}}function jT(e){if(Qh(e)){const t=e.target.source;return"id"in t?t.id:t["@id"]}else return e.target.service[0]["@id"]}function BT(e){return"service"in e.target?e.target.service[0].type:e.target.source.type}function VT(e){if(Qh(e))return e.target.source.partOf}function WT(e){return"pixelCoords"in e?e.pixelCoords:e.resourceCoords}function zT(e){return e.body.features.map(t=>({resource:WT(t.properties),geo:t.geometry.coordinates}))}function ZT(e){if(Qh(e))return{created:e.created,modified:e.modified}}function UT(e){if(Qh(e))return{width:e.target.source.width,height:e.target.source.height};const i=e.target.selector.value,n=/width="(?<width>\d+)"/.exec(i),s=/height="(?<height>\d+)"/.exec(i),r=n?.groups?.width,o=s?.groups?.height;if(!r||!o)throw new Error("Could not parse image dimensions");return{width:parseInt(r),height:parseInt(o)}}function XT(e){const i=e.target.selector.value,s=/points="(?<points>.+)"/.exec(i)?.groups;if(s&&s.points){const r=s.points.trim().split(/\s+/);if(r[0]===r[r.length-1]&&r.splice(-1),r.length>=3)return r.map(o=>{const a=o.split(",");if(a.length===2)return[parseFloat(a[0]),parseFloat(a[1])];throw new Error("Could not parse resource mask")});throw new Error("Could not parse resource mask")}else throw new Error("Could not parse resource mask")}function Zg(e){let t;return"resourceCrs"in e.body&&(t=e.body.resourceCrs),{"@context":"https://schemas.allmaps.org/map/2/context.json",type:"GeoreferencedMap",id:e.id,...ZT(e),resource:kT(e),gcps:zT(e),resourceMask:XT(e),transformation:e.body.transformation,resourceCrs:t}}function zc(e){if(DT(e)){let t;return"items"in e&&Array.isArray(e.items)&&zg(e.items[0])?t=G_.parse(e):t=O_.parse(e),t.items.map(i=>Zg(i))}else{let t;return zg(e)?t=Bu.parse(e):t=Wu.parse(e),[Zg(t)]}}const N_=wt({image:rs,world:rs}),$T=wt({uri:ct().url(),width:Ft(),height:Ft(),type:ju}),tl=wt({id:ct().optional(),version:Ft().min(1).max(1).default(1),image:$T,gcps:N_.array(),pixelMask:b_,transformation:Kh.optional()}),zu=cn(tl),D_=wt({resource:rs,geo:rs}),HT=wt({id:ct().url(),height:Ft().positive().optional(),width:Ft().positive().optional(),type:T_,partOf:Yh.optional()}),el=wt({"@context":Xt("https://schemas.allmaps.org/map/2/context.json").optional(),type:Xt("GeoreferencedMap"),id:ct().optional(),created:ct().datetime().optional(),modified:ct().datetime().optional(),resource:HT,gcps:D_.array(),resourceMask:b_,transformation:Kh.optional(),resourceCrs:R_.optional()}),Zu=cn(el);Lt([tl,el]);Lt([zu,Zu]);Lt([N_,D_]);function YT(e){let t,i,n;Jh(e)?(t=e.resource.width,i=e.resource.height,n=e.resourceMask):(t=e.image.width,i=e.image.height,n=e.pixelMask);let s="<svg>";return t&&i&&(s=`<svg width="${t}" height="${i}">`),{type:"SvgSelector",value:`${s}<polygon points="${n.map(r=>r.join(",")).join(" ")}" /></svg>`}}function KT(e){let t,i,n,s,r;if(Jh(e)){if(e.resource.type==="Canvas")return{id:e.resource.id,type:e.resource.type,height:e.resource.height,width:e.resource.width,partOf:e.resource.partOf};t=e.resource.id,i=e.resource.type,n=e.resource.width,s=e.resource.height,r=e.resource.partOf}else t=e.image.uri,i=e.image.type,n=e.image.width,s=e.image.height;return{id:t,type:i,height:s,width:n,partOf:r}}function qT(e){if(Jh(e))return{created:e.created,modified:e.modified}}function JT(){return["http://iiif.io/api/extension/georef/1/context.json","http://iiif.io/api/presentation/3/context.json"]}function QT(e){let t,i;return"resource"in e?(t=e.resource,i=e.geo):(t=e.image,i=e.world),{type:"Feature",properties:{resourceCoords:t},geometry:{type:"Point",coordinates:i}}}function Ug(e){const t={type:"SpecificResource",source:KT(e),selector:YT(e)};let i;"resourceCrs"in e&&(i=e.resourceCrs);const n={type:"FeatureCollection",transformation:e.transformation,resourceCrs:i,features:e.gcps.map(s=>QT(s))};return{id:e.id,type:"Annotation","@context":JT(),...qT(e),motivation:"georeferencing",target:t,body:n}}function tR(e){if(F_(e)){let t;return Sh(e[0])?t=Zu.parse(e):t=zu.parse(e),{type:"AnnotationPage","@context":"http://www.w3.org/ns/anno.jsonld",items:t.map(n=>Ug(n))}}else{let t;return Sh(e)?t=el.parse(e):t=tl.parse(e),Ug(t)}}function k_(e){return Jh(e)?e:zc(tR(e))[0]}function eR(e){return e.map(k_)}function Xg(e){if(F_(e)){let t;return Sh(e[0])?t=Zu.parse(e):t=zu.parse(e),eR(t)}else{let t;return Sh(e)?t=el.parse(e):t=tl.parse(e),k_(t)}}function iR(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var t=1;t<=60;++t)e("EPSG:"+(32600+t),"+proj=utm +zone="+t+" +datum=WGS84 +units=m"),e("EPSG:"+(32700+t),"+proj=utm +zone="+t+" +south +datum=WGS84 +units=m");e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}var Ls=1,Os=2,fr=3,nR=4,Zc=5,$g=6378137,sR=6356752314e-3,Hg=.0066943799901413165,Co=484813681109536e-20,nt=Math.PI/2,rR=.16666666666666666,oR=.04722222222222222,aR=.022156084656084655,ft=1e-10,je=.017453292519943295,en=57.29577951308232,ae=Math.PI/4,qo=Math.PI*2,be=3.14159265359,ui={};ui.greenwich=0;ui.lisbon=-9.131906111111;ui.paris=2.337229166667;ui.bogota=-74.080916666667;ui.madrid=-3.687938888889;ui.rome=12.452333333333;ui.bern=7.439583333333;ui.jakarta=106.807719444444;ui.ferro=-17.666666666667;ui.brussels=4.367975;ui.stockholm=18.058277777778;ui.athens=23.7163375;ui.oslo=10.722916666667;const hR={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var Yg=/[\s_\-\/\(\)]/g;function os(e,t){if(e[t])return e[t];for(var i=Object.keys(e),n=t.toLowerCase().replace(Yg,""),s=-1,r,o;++s<i.length;)if(r=i[s],o=r.toLowerCase().replace(Yg,""),o===n)return e[r]}function Uc(e){var t={},i=e.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,h){var c=h.split("=");return c.push(!0),a[c[0].toLowerCase()]=c[1],a},{}),n,s,r,o={proj:"projName",datum:"datumCode",rf:function(a){t.rf=parseFloat(a)},lat_0:function(a){t.lat0=a*je},lat_1:function(a){t.lat1=a*je},lat_2:function(a){t.lat2=a*je},lat_ts:function(a){t.lat_ts=a*je},lon_0:function(a){t.long0=a*je},lon_1:function(a){t.long1=a*je},lon_2:function(a){t.long2=a*je},alpha:function(a){t.alpha=parseFloat(a)*je},gamma:function(a){t.rectified_grid_angle=parseFloat(a)*je},lonc:function(a){t.longc=a*je},x_0:function(a){t.x0=parseFloat(a)},y_0:function(a){t.y0=parseFloat(a)},k_0:function(a){t.k0=parseFloat(a)},k:function(a){t.k0=parseFloat(a)},a:function(a){t.a=parseFloat(a)},b:function(a){t.b=parseFloat(a)},r:function(a){t.a=t.b=parseFloat(a)},r_a:function(){t.R_A=!0},zone:function(a){t.zone=parseInt(a,10)},south:function(){t.utmSouth=!0},towgs84:function(a){t.datum_params=a.split(",").map(function(h){return parseFloat(h)})},to_meter:function(a){t.to_meter=parseFloat(a)},units:function(a){t.units=a;var h=os(hR,a);h&&(t.to_meter=h.to_meter)},from_greenwich:function(a){t.from_greenwich=a*je},pm:function(a){var h=os(ui,a);t.from_greenwich=(h||parseFloat(a))*je},nadgrids:function(a){a==="@null"?t.datumCode="none":t.nadgrids=a},axis:function(a){var h="ewnsud";a.length===3&&h.indexOf(a.substr(0,1))!==-1&&h.indexOf(a.substr(1,1))!==-1&&h.indexOf(a.substr(2,1))!==-1&&(t.axis=a)},approx:function(){t.approx=!0}};for(n in i)s=i[n],n in o?(r=o[n],typeof r=="function"?r(s):t[r]=s):t[n]=s;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}class j_{static getId(t){const i=t.find(n=>Array.isArray(n)&&n[0]==="ID");return i&&i.length>=3?{authority:i[1],code:parseInt(i[2],10)}:null}static convertUnit(t,i="unit"){if(!t||t.length<3)return{type:i,name:"unknown",conversion_factor:null};const n=t[1],s=parseFloat(t[2])||null,r=t.find(a=>Array.isArray(a)&&a[0]==="ID"),o=r?{authority:r[1],code:parseInt(r[2],10)}:null;return{type:i,name:n,conversion_factor:s,id:o}}static convertAxis(t){const i=t[1]||"Unknown";let n;const s=i.match(/^\((.)\)$/);if(s){const c=s[1].toUpperCase();if(c==="E")n="east";else if(c==="N")n="north";else if(c==="U")n="up";else throw new Error(`Unknown axis abbreviation: ${c}`)}else n=t[2]?t[2].toLowerCase():"unknown";const r=t.find(c=>Array.isArray(c)&&c[0]==="ORDER"),o=r?parseInt(r[1],10):null,a=t.find(c=>Array.isArray(c)&&(c[0]==="LENGTHUNIT"||c[0]==="ANGLEUNIT"||c[0]==="SCALEUNIT")),h=this.convertUnit(a);return{name:i,direction:n,unit:h,order:o}}static extractAxes(t){return t.filter(i=>Array.isArray(i)&&i[0]==="AXIS").map(i=>this.convertAxis(i)).sort((i,n)=>(i.order||0)-(n.order||0))}static convert(t,i={}){switch(t[0]){case"PROJCRS":i.type="ProjectedCRS",i.name=t[1],i.base_crs=t.find(p=>Array.isArray(p)&&p[0]==="BASEGEOGCRS")?this.convert(t.find(p=>Array.isArray(p)&&p[0]==="BASEGEOGCRS")):null,i.conversion=t.find(p=>Array.isArray(p)&&p[0]==="CONVERSION")?this.convert(t.find(p=>Array.isArray(p)&&p[0]==="CONVERSION")):null;const n=t.find(p=>Array.isArray(p)&&p[0]==="CS");n&&(i.coordinate_system={type:n[1],axis:this.extractAxes(t)});const s=t.find(p=>Array.isArray(p)&&p[0]==="LENGTHUNIT");if(s){const p=this.convertUnit(s);i.coordinate_system.unit=p}i.id=this.getId(t);break;case"BASEGEOGCRS":case"GEOGCRS":i.type="GeographicCRS",i.name=t[1];const r=t.find(p=>Array.isArray(p)&&(p[0]==="DATUM"||p[0]==="ENSEMBLE"));if(r){const p=this.convert(r);r[0]==="ENSEMBLE"?i.datum_ensemble=p:i.datum=p;const y=t.find(w=>Array.isArray(w)&&w[0]==="PRIMEM");y&&y[1]!=="Greenwich"&&(p.prime_meridian={name:y[1],longitude:parseFloat(y[2])})}i.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(t)},i.id=this.getId(t);break;case"DATUM":i.type="GeodeticReferenceFrame",i.name=t[1],i.ellipsoid=t.find(p=>Array.isArray(p)&&p[0]==="ELLIPSOID")?this.convert(t.find(p=>Array.isArray(p)&&p[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":i.type="DatumEnsemble",i.name=t[1],i.members=t.filter(p=>Array.isArray(p)&&p[0]==="MEMBER").map(p=>({type:"DatumEnsembleMember",name:p[1],id:this.getId(p)}));const o=t.find(p=>Array.isArray(p)&&p[0]==="ENSEMBLEACCURACY");o&&(i.accuracy=parseFloat(o[1]));const a=t.find(p=>Array.isArray(p)&&p[0]==="ELLIPSOID");a&&(i.ellipsoid=this.convert(a)),i.id=this.getId(t);break;case"ELLIPSOID":i.type="Ellipsoid",i.name=t[1],i.semi_major_axis=parseFloat(t[2]),i.inverse_flattening=parseFloat(t[3]),t.find(p=>Array.isArray(p)&&p[0]==="LENGTHUNIT")&&this.convert(t.find(p=>Array.isArray(p)&&p[0]==="LENGTHUNIT"),i);break;case"CONVERSION":i.type="Conversion",i.name=t[1],i.method=t.find(p=>Array.isArray(p)&&p[0]==="METHOD")?this.convert(t.find(p=>Array.isArray(p)&&p[0]==="METHOD")):null,i.parameters=t.filter(p=>Array.isArray(p)&&p[0]==="PARAMETER").map(p=>this.convert(p));break;case"METHOD":i.type="Method",i.name=t[1],i.id=this.getId(t);break;case"PARAMETER":i.type="Parameter",i.name=t[1],i.value=parseFloat(t[2]),i.unit=this.convertUnit(t.find(p=>Array.isArray(p)&&(p[0]==="LENGTHUNIT"||p[0]==="ANGLEUNIT"||p[0]==="SCALEUNIT"))),i.id=this.getId(t);break;case"BOUNDCRS":i.type="BoundCRS";const h=t.find(p=>Array.isArray(p)&&p[0]==="SOURCECRS");if(h){const p=h.find(y=>Array.isArray(y));i.source_crs=p?this.convert(p):null}const c=t.find(p=>Array.isArray(p)&&p[0]==="TARGETCRS");if(c){const p=c.find(y=>Array.isArray(y));i.target_crs=p?this.convert(p):null}const u=t.find(p=>Array.isArray(p)&&p[0]==="ABRIDGEDTRANSFORMATION");u?i.transformation=this.convert(u):i.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(i.type="Transformation",i.name=t[1],i.method=t.find(p=>Array.isArray(p)&&p[0]==="METHOD")?this.convert(t.find(p=>Array.isArray(p)&&p[0]==="METHOD")):null,i.parameters=t.filter(p=>Array.isArray(p)&&(p[0]==="PARAMETER"||p[0]==="PARAMETERFILE")).map(p=>{if(p[0]==="PARAMETER")return this.convert(p);if(p[0]==="PARAMETERFILE")return{name:p[1],value:p[2],id:{authority:"EPSG",code:8656}}}),i.parameters.length===7){const p=i.parameters[6];p.name==="Scale difference"&&(p.value=Math.round((p.value-1)*1e12)/1e6)}i.id=this.getId(t);break;case"AXIS":i.coordinate_system||(i.coordinate_system={type:"unspecified",axis:[]}),i.coordinate_system.axis.push(this.convertAxis(t));break;case"LENGTHUNIT":const m=this.convertUnit(t,"LinearUnit");i.coordinate_system&&i.coordinate_system.axis&&i.coordinate_system.axis.forEach(p=>{p.unit||(p.unit=m)}),m.conversion_factor&&m.conversion_factor!==1&&i.semi_major_axis&&(i.semi_major_axis={value:i.semi_major_axis,unit:m});break;default:i.keyword=t[0];break}return i}}class lR extends j_{static convert(t,i={}){return super.convert(t,i),i.coordinate_system&&i.coordinate_system.subtype==="Cartesian"&&delete i.coordinate_system,i.usage&&delete i.usage,i}}class cR extends j_{static convert(t,i={}){super.convert(t,i);const n=t.find(r=>Array.isArray(r)&&r[0]==="CS");n&&(i.coordinate_system={subtype:n[1],axis:this.extractAxes(t)});const s=t.find(r=>Array.isArray(r)&&r[0]==="USAGE");if(s){const r=s.find(h=>Array.isArray(h)&&h[0]==="SCOPE"),o=s.find(h=>Array.isArray(h)&&h[0]==="AREA"),a=s.find(h=>Array.isArray(h)&&h[0]==="BBOX");i.usage={},r&&(i.usage.scope=r[1]),o&&(i.usage.area=o[1]),a&&(i.usage.bbox=a.slice(1))}return i}}function uR(e){return e.find(t=>Array.isArray(t)&&t[0]==="USAGE")?"2019":(e.find(t=>Array.isArray(t)&&t[0]==="CS")||e[0]==="BOUNDCRS"||e[0]==="PROJCRS"||e[0]==="GEOGCRS","2015")}function dR(e){return(uR(e)==="2019"?cR:lR).convert(e)}function fR(e){const t=e.toUpperCase();return t.includes("PROJCRS")||t.includes("GEOGCRS")||t.includes("BOUNDCRS")||t.includes("VERTCRS")||t.includes("LENGTHUNIT")||t.includes("ANGLEUNIT")||t.includes("SCALEUNIT")?"WKT2":(t.includes("PROJCS")||t.includes("GEOGCS")||t.includes("LOCAL_CS")||t.includes("VERT_CS")||t.includes("UNIT"),"WKT1")}var Jo=1,B_=2,V_=3,bh=4,W_=5,Uu=-1,gR=/\s/,mR=/[A-Za-z]/,pR=/[A-Za-z84_]/,il=/[,\]]/,z_=/[\d\.E\-\+]/;function Rn(e){if(typeof e!="string")throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Jo}Rn.prototype.readCharicter=function(){var e=this.text[this.place++];if(this.state!==bh)for(;gR.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case Jo:return this.neutral(e);case B_:return this.keyword(e);case bh:return this.quoted(e);case W_:return this.afterquote(e);case V_:return this.number(e);case Uu:return}};Rn.prototype.afterquote=function(e){if(e==='"'){this.word+='"',this.state=bh;return}if(il.test(e)){this.word=this.word.trim(),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in afterquote yet, index '+this.place)};Rn.prototype.afterItem=function(e){if(e===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Jo;return}if(e==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Jo,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Uu);return}};Rn.prototype.number=function(e){if(z_.test(e)){this.word+=e;return}if(il.test(e)){this.word=parseFloat(this.word),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in number yet, index '+this.place)};Rn.prototype.quoted=function(e){if(e==='"'){this.state=W_;return}this.word+=e};Rn.prototype.keyword=function(e){if(pR.test(e)){this.word+=e;return}if(e==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=Jo;return}if(il.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in keyword yet, index '+this.place)};Rn.prototype.neutral=function(e){if(mR.test(e)){this.word=e,this.state=B_;return}if(e==='"'){this.word="",this.state=bh;return}if(z_.test(e)){this.word=e,this.state=V_;return}if(il.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in neutral yet, index '+this.place)};Rn.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Uu)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function _R(e){var t=new Rn(e);return t.output()}function Fl(e,t,i){Array.isArray(t)&&(i.unshift(t),t=null);var n=t?{}:e,s=i.reduce(function(r,o){return nr(o,r),r},n);t&&(e[t]=s)}function nr(e,t){if(!Array.isArray(e)){t[e]=!0;return}var i=e.shift();if(i==="PARAMETER"&&(i=e.shift()),e.length===1){if(Array.isArray(e[0])){t[i]={},nr(e[0],t[i]);return}t[i]=e[0];return}if(!e.length){t[i]=!0;return}if(i==="TOWGS84"){t[i]=e;return}if(i==="AXIS"){i in t||(t[i]=[]),t[i].push(e);return}Array.isArray(i)||(t[i]={});var n;switch(i){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[i]={name:e[0].toLowerCase(),convert:e[1]},e.length===3&&nr(e[2],t[i]);return;case"SPHEROID":case"ELLIPSOID":t[i]={name:e[0],a:e[1],rf:e[2]},e.length===4&&nr(e[3],t[i]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":e[0]=["name",e[0]],Fl(t,i,e);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":e[0]=["name",e[0]],Fl(t,i,e),t[i].type=i;return;default:for(n=-1;++n<e.length;)if(!Array.isArray(e[n]))return nr(e,t[i]);return Fl(t,i,e)}}var yR=.017453292519943295;function Pi(e){return e*yR}function Z_(e){const t=(e.projName||"").toLowerCase().replace(/_/g," ");!e.long0&&e.longc&&(t==="albers conic equal area"||t==="lambert azimuthal equal area")&&(e.long0=e.longc),!e.lat_ts&&e.lat1&&(t==="stereographic south pole"||t==="polar stereographic (variant b)")?(e.lat0=Pi(e.lat1>0?90:-90),e.lat_ts=e.lat1,delete e.lat1):!e.lat_ts&&e.lat0&&(t==="polar stereographic"||t==="polar stereographic (variant a)")&&(e.lat_ts=e.lat0,e.lat0=Pi(e.lat0>0?90:-90),delete e.lat1)}function Kg(e){let t={units:null,to_meter:void 0};return typeof e=="string"?(t.units=e.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.units==="meter"&&(t.to_meter=1)):e&&e.name&&(t.units=e.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.to_meter=e.conversion_factor),t}function qg(e){return typeof e=="object"?e.value*e.unit.conversion_factor:e}function Jg(e,t){e.ellipsoid.radius?(t.a=e.ellipsoid.radius,t.rf=0):(t.a=qg(e.ellipsoid.semi_major_axis),e.ellipsoid.inverse_flattening!==void 0?t.rf=e.ellipsoid.inverse_flattening:e.ellipsoid.semi_major_axis!==void 0&&e.ellipsoid.semi_minor_axis!==void 0&&(t.rf=t.a/(t.a-qg(e.ellipsoid.semi_minor_axis))))}function Ah(e,t={}){return!e||typeof e!="object"?e:e.type==="BoundCRS"?(Ah(e.source_crs,t),e.transformation&&(e.transformation.method&&e.transformation.method.name==="NTv2"?t.nadgrids=e.transformation.parameters[0].value:t.datum_params=e.transformation.parameters.map(i=>i.value)),t):(Object.keys(e).forEach(i=>{const n=e[i];if(n!==null)switch(i){case"name":if(t.srsCode)break;t.name=n,t.srsCode=n;break;case"type":n==="GeographicCRS"?t.projName="longlat":n==="ProjectedCRS"&&e.conversion&&e.conversion.method&&(t.projName=e.conversion.method.name);break;case"datum":case"datum_ensemble":n.ellipsoid&&(t.ellps=n.ellipsoid.name,Jg(n,t)),n.prime_meridian&&(t.from_greenwich=n.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":t.ellps=n.name,Jg(n,t);break;case"prime_meridian":t.long0=(n.longitude||0)*Math.PI/180;break;case"coordinate_system":if(n.axis){if(t.axis=n.axis.map(s=>{const r=s.direction;if(r==="east")return"e";if(r==="north")return"n";if(r==="west")return"w";if(r==="south")return"s";throw new Error(`Unknown axis direction: ${r}`)}).join("")+"u",n.unit){const{units:s,to_meter:r}=Kg(n.unit);t.units=s,t.to_meter=r}else if(n.axis[0]&&n.axis[0].unit){const{units:s,to_meter:r}=Kg(n.axis[0].unit);t.units=s,t.to_meter=r}}break;case"id":n.authority&&n.code&&(t.title=n.authority+":"+n.code);break;case"conversion":n.method&&n.method.name&&(t.projName=n.method.name),n.parameters&&n.parameters.forEach(s=>{const r=s.name.toLowerCase().replace(/\s+/g,"_"),o=s.value;s.unit&&s.unit.conversion_factor?t[r]=o*s.unit.conversion_factor:s.unit==="degree"?t[r]=o*Math.PI/180:t[r]=o});break;case"unit":n.name&&(t.units=n.name.toLowerCase(),t.units==="metre"&&(t.units="meter")),n.conversion_factor&&(t.to_meter=n.conversion_factor);break;case"base_crs":Ah(n,t),t.datumCode=n.id?n.id.authority+"_"+n.id.code:n.name;break}}),t.latitude_of_false_origin!==void 0&&(t.lat0=t.latitude_of_false_origin),t.longitude_of_false_origin!==void 0&&(t.long0=t.longitude_of_false_origin),t.latitude_of_standard_parallel!==void 0&&(t.lat0=t.latitude_of_standard_parallel,t.lat1=t.latitude_of_standard_parallel),t.latitude_of_1st_standard_parallel!==void 0&&(t.lat1=t.latitude_of_1st_standard_parallel),t.latitude_of_2nd_standard_parallel!==void 0&&(t.lat2=t.latitude_of_2nd_standard_parallel),t.latitude_of_projection_centre!==void 0&&(t.lat0=t.latitude_of_projection_centre),t.longitude_of_projection_centre!==void 0&&(t.longc=t.longitude_of_projection_centre),t.easting_at_false_origin!==void 0&&(t.x0=t.easting_at_false_origin),t.northing_at_false_origin!==void 0&&(t.y0=t.northing_at_false_origin),t.latitude_of_natural_origin!==void 0&&(t.lat0=t.latitude_of_natural_origin),t.longitude_of_natural_origin!==void 0&&(t.long0=t.longitude_of_natural_origin),t.longitude_of_origin!==void 0&&(t.long0=t.longitude_of_origin),t.false_easting!==void 0&&(t.x0=t.false_easting),t.easting_at_projection_centre&&(t.x0=t.easting_at_projection_centre),t.false_northing!==void 0&&(t.y0=t.false_northing),t.northing_at_projection_centre&&(t.y0=t.northing_at_projection_centre),t.standard_parallel_1!==void 0&&(t.lat1=t.standard_parallel_1),t.standard_parallel_2!==void 0&&(t.lat2=t.standard_parallel_2),t.scale_factor_at_natural_origin!==void 0&&(t.k0=t.scale_factor_at_natural_origin),t.scale_factor_at_projection_centre!==void 0&&(t.k0=t.scale_factor_at_projection_centre),t.scale_factor_on_pseudo_standard_parallel!==void 0&&(t.k0=t.scale_factor_on_pseudo_standard_parallel),t.azimuth!==void 0&&(t.alpha=t.azimuth),t.azimuth_at_projection_centre!==void 0&&(t.alpha=t.azimuth_at_projection_centre),t.angle_from_rectified_to_skew_grid&&(t.rectified_grid_angle=t.angle_from_rectified_to_skew_grid),Z_(t),t)}var wR=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function vR(e,t){var i=t[0],n=t[1];!(i in e)&&n in e&&(e[i]=e[n],t.length===3&&(e[i]=t[2](e[i])))}function U_(e){for(var t=Object.keys(e),i=0,n=t.length;i<n;++i){var s=t[i];wR.indexOf(s)!==-1&&MR(e[s]),typeof e[s]=="object"&&U_(e[s])}}function MR(e){if(e.AUTHORITY){var t=Object.keys(e.AUTHORITY)[0];t&&t in e.AUTHORITY&&(e.title=t+":"+e.AUTHORITY[t])}if(e.type==="GEOGCS"?e.projName="longlat":e.type==="LOCAL_CS"?(e.projName="identity",e.local=!0):typeof e.PROJECTION=="object"?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var i="",n=0,s=e.AXIS.length;n<s;++n){var r=[e.AXIS[n][0].toLowerCase(),e.AXIS[n][1].toLowerCase()];r[0].indexOf("north")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="north"?i+="n":r[0].indexOf("south")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="south"?i+="s":r[0].indexOf("east")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="east"?i+="e":(r[0].indexOf("west")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="west")&&(i+="w")}i.length===2&&(i+="u"),i.length===3&&(e.axis=i)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.UNIT.convert&&(e.type==="GEOGCS"?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var o=e.GEOGCS;e.type==="GEOGCS"&&(o=e),o&&(o.DATUM?e.datumCode=o.DATUM.name.toLowerCase():e.datumCode=o.name.toLowerCase(),e.datumCode.slice(0,2)==="d_"&&(e.datumCode=e.datumCode.slice(2)),e.datumCode==="new_zealand_1949"&&(e.datumCode="nzgd49"),(e.datumCode==="wgs_1984"||e.datumCode==="world_geodetic_system_1984")&&(e.PROJECTION==="Mercator_Auxiliary_Sphere"&&(e.sphere=!0),e.datumCode="wgs84"),e.datumCode==="belge_1972"&&(e.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(e.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),e.ellps.toLowerCase().slice(0,13)==="international"&&(e.ellps="intl"),e.a=o.DATUM.SPHEROID.a,e.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),o.DATUM&&o.DATUM.TOWGS84&&(e.datum_params=o.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),e.datumCode==="ch1903+"&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a),e.rectified_grid_angle&&(e.rectified_grid_angle=Pi(e.rectified_grid_angle));function a(u){var m=e.to_meter||1;return u*m}var h=function(u){return vR(e,u)},c=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Pi],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Pi],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",Pi],["lat0","latitude_of_origin",Pi],["lat0","standard_parallel_1",Pi],["lat1","standard_parallel_1",Pi],["lat2","standard_parallel_2",Pi],["azimuth","Azimuth"],["alpha","azimuth",Pi],["srsCode","name"]];c.forEach(h),Z_(e)}function Xc(e){if(typeof e=="object")return Ah(e);const t=fR(e);var i=_R(e);if(t==="WKT2"){const r=dR(i);return Ah(r)}var n=i[0],s={};return nr(i,s),U_(s),s[n]}function qe(e){var t=this;if(arguments.length===2){var i=arguments[1];typeof i=="string"?i.charAt(0)==="+"?qe[e]=Uc(arguments[1]):qe[e]=Xc(arguments[1]):qe[e]=i}else if(arguments.length===1){if(Array.isArray(e))return e.map(function(n){return Array.isArray(n)?qe.apply(t,n):qe(n)});if(typeof e=="string"){if(e in qe)return qe[e]}else"EPSG"in e?qe["EPSG:"+e.EPSG]=e:"ESRI"in e?qe["ESRI:"+e.ESRI]=e:"IAU2000"in e?qe["IAU2000:"+e.IAU2000]=e:console.log(e);return}}iR(qe);function IR(e){return typeof e=="string"}function ER(e){return e in qe}function CR(e){return e.indexOf("+")!==0&&e.indexOf("[")!==-1||typeof e=="object"&&!("srsCode"in e)}var xR=["3857","900913","3785","102113"];function SR(e){var t=os(e,"authority");if(t){var i=os(t,"epsg");return i&&xR.indexOf(i)>-1}}function bR(e){var t=os(e,"extension");if(t)return os(t,"proj4")}function AR(e){return e[0]==="+"}function TR(e){if(IR(e)){if(ER(e))return qe[e];if(CR(e)){var t=Xc(e);if(SR(t))return qe["EPSG:3857"];var i=bR(t);return i?Uc(i):t}if(AR(e))return Uc(e)}else return"projName"in e?e:Xc(e)}function Qg(e,t){e=e||{};var i,n;if(!t)return e;for(n in t)i=t[n],i!==void 0&&(e[n]=i);return e}function ln(e,t,i){var n=e*t;return i/Math.sqrt(1-n*n)}function ma(e){return e<0?-1:1}function _t(e){return Math.abs(e)<=be?e:e-ma(e)*qo}function Di(e,t,i){var n=e*i,s=.5*e;return n=Math.pow((1-n)/(1+n),s),Math.tan(.5*(nt-t))/n}function Qo(e,t){for(var i=.5*e,n,s,r=nt-2*Math.atan(t),o=0;o<=15;o++)if(n=e*Math.sin(r),s=nt-2*Math.atan(t*Math.pow((1-n)/(1+n),i))-r,r+=s,Math.abs(s)<=1e-10)return r;return-9999}function RR(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=ln(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function PR(e){var t=e.x,i=e.y;if(i*en>90&&i*en<-90&&t*en>180&&t*en<-180)return null;var n,s;if(Math.abs(Math.abs(i)-nt)<=ft)return null;if(this.sphere)n=this.x0+this.a*this.k0*_t(t-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(ae+.5*i));else{var r=Math.sin(i),o=Di(this.e,i,r);n=this.x0+this.a*this.k0*_t(t-this.long0),s=this.y0-this.a*this.k0*Math.log(o)}return e.x=n,e.y=s,e}function GR(e){var t=e.x-this.x0,i=e.y-this.y0,n,s;if(this.sphere)s=nt-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var r=Math.exp(-i/(this.a*this.k0));if(s=Qo(this.e,r),s===-9999)return null}return n=_t(this.long0+t/(this.a*this.k0)),e.x=n,e.y=s,e}var LR=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"];const OR={init:RR,forward:PR,inverse:GR,names:LR};function FR(){}function tm(e){return e}var NR=["longlat","identity"];const DR={init:FR,forward:tm,inverse:tm,names:NR};var kR=[OR,DR],ps={},sr=[];function X_(e,t){var i=sr.length;return e.names?(sr[i]=e,e.names.forEach(function(n){ps[n.toLowerCase()]=i}),this):(console.log(t),!0)}function $_(e){return e.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function jR(e){if(!e)return!1;var t=e.toLowerCase();if(typeof ps[t]<"u"&&sr[ps[t]]||(t=$_(t),t in ps&&sr[ps[t]]))return sr[ps[t]]}function BR(){kR.forEach(X_)}const VR={start:BR,add:X_,get:jR};var H_={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};const WR=H_.WGS84;function zR(e,t,i,n){var s=e*e,r=t*t,o=(s-r)/s,a=0;n?(e*=1-o*(rR+o*(oR+o*aR)),s=e*e,o=0):a=Math.sqrt(o);var h=(s-r)/r;return{es:o,e:a,ep2:h}}function ZR(e,t,i,n,s){if(!e){var r=os(H_,n);r||(r=WR),e=r.a,t=r.b,i=r.rf}return i&&!t&&(t=(1-1/i)*e),(i===0||Math.abs(e-t)<ft)&&(s=!0,t=e),{a:e,b:t,rf:i,sphere:s}}var qa={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var UR in qa){var Nl=qa[UR];Nl.datumName&&(qa[Nl.datumName]=Nl)}function XR(e,t,i,n,s,r,o){var a={};return e===void 0||e==="none"?a.datum_type=Zc:a.datum_type=nR,t&&(a.datum_params=t.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=Ls),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=Os,a.datum_params[3]*=Co,a.datum_params[4]*=Co,a.datum_params[5]*=Co,a.datum_params[6]=a.datum_params[6]/1e6+1)),o&&(a.datum_type=fr,a.grids=o),a.a=i,a.b=n,a.es=s,a.ep2=r,a}var Xu={};function $R(e,t,i){return t instanceof ArrayBuffer?HR(e,t,i):{ready:YR(e,t)}}function HR(e,t,i){var n=!0;i!==void 0&&i.includeErrorFields===!1&&(n=!1);var s=new DataView(t),r=JR(s),o=QR(s,r),a=tP(s,o,r,n),h={header:o,subgrids:a};return Xu[e]=h,h}async function YR(e,t){for(var i=[],n=await t.getImageCount(),s=n-1;s>=0;s--){var r=await t.getImage(s),o=await r.readRasters(),a=o,h=[r.getWidth(),r.getHeight()],c=r.getBoundingBox().map(em),u=[r.fileDirectory.ModelPixelScale[0],r.fileDirectory.ModelPixelScale[1]].map(em),m=c[0]+(h[0]-1)*u[0],p=c[3]-(h[1]-1)*u[1],y=a[0],w=a[1],v=[];for(let T=h[1]-1;T>=0;T--)for(let P=h[0]-1;P>=0;P--){var I=T*h[0]+P;v.push([-qn(w[I]),qn(y[I])])}i.push({del:u,lim:h,ll:[-m,p],cvs:v})}var b={header:{nSubgrids:n},subgrids:i};return Xu[e]=b,b}function KR(e){if(e===void 0)return null;var t=e.split(",");return t.map(qR)}function qR(e){if(e.length===0)return null;var t=e[0]==="@";return t&&(e=e.slice(1)),e==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:Xu[e]||null,isNull:!1}}function em(e){return e*Math.PI/180}function qn(e){return e/3600*Math.PI/180}function JR(e){var t=e.getInt32(8,!1);return t===11?!1:(t=e.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function QR(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:$c(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}function $c(e,t,i){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,i)))}function tP(e,t,i,n){for(var s=176,r=[],o=0;o<t.nSubgrids;o++){var a=iP(e,s,i),h=nP(e,s,a,i,n),c=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),u=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);r.push({ll:[qn(a.lowerLongitude),qn(a.lowerLatitude)],del:[qn(a.longitudeInterval),qn(a.latitudeInterval)],lim:[c,u],count:a.gridNodeCount,cvs:eP(h)});var m=16;n===!1&&(m=8),s+=176+a.gridNodeCount*m}return r}function eP(e){return e.map(function(t){return[qn(t.longitudeShift),qn(t.latitudeShift)]})}function iP(e,t,i){return{name:$c(e,t+8,t+16).trim(),parent:$c(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,i),upperLatitude:e.getFloat64(t+88,i),lowerLongitude:e.getFloat64(t+104,i),upperLongitude:e.getFloat64(t+120,i),latitudeInterval:e.getFloat64(t+136,i),longitudeInterval:e.getFloat64(t+152,i),gridNodeCount:e.getInt32(t+168,i)}}function nP(e,t,i,n,s){var r=t+176,o=16;s===!1&&(o=8);for(var a=[],h=0;h<i.gridNodeCount;h++){var c={latitudeShift:e.getFloat32(r+h*o,n),longitudeShift:e.getFloat32(r+h*o+4,n)};s!==!1&&(c.latitudeAccuracy=e.getFloat32(r+h*o+8,n),c.longitudeAccuracy=e.getFloat32(r+h*o+12,n)),a.push(c)}return a}function ki(e,t){if(!(this instanceof ki))return new ki(e);this.forward=null,this.inverse=null,this.init=null,this.name,this.names=null,this.title,t=t||function(c){if(c)throw c};var i=TR(e);if(typeof i!="object"){t("Could not parse to valid json: "+e);return}var n=ki.projections.get(i.projName);if(!n){t("Could not get projection name from: "+e);return}if(i.datumCode&&i.datumCode!=="none"){var s=os(qa,i.datumCode);s&&(i.datum_params=i.datum_params||(s.towgs84?s.towgs84.split(","):null),i.ellps=s.ellipse,i.datumName=s.datumName?s.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84",i.lat1=i.lat1||i.lat0;var r=ZR(i.a,i.b,i.rf,i.ellps,i.sphere),o=zR(r.a,r.b,r.rf,i.R_A),a=KR(i.nadgrids),h=i.datum||XR(i.datumCode,i.datum_params,r.a,r.b,o.es,o.ep2,a);Qg(this,i),Qg(this,n),this.a=r.a,this.b=r.b,this.rf=r.rf,this.sphere=r.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=h,"init"in this&&typeof this.init=="function"&&this.init(),t(null,this)}ki.projections=VR;ki.projections.start();function sP(e,t){return e.datum_type!==t.datum_type||e.a!==t.a||Math.abs(e.es-t.es)>5e-11?!1:e.datum_type===Ls?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type===Os?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6]:!0}function Y_(e,t,i){var n=e.x,s=e.y,r=e.z?e.z:0,o,a,h,c;if(s<-nt&&s>-1.001*nt)s=-nt;else if(s>nt&&s<1.001*nt)s=nt;else{if(s<-nt)return{x:-1/0,y:-1/0,z:e.z};if(s>nt)return{x:1/0,y:1/0,z:e.z}}return n>Math.PI&&(n-=2*Math.PI),a=Math.sin(s),c=Math.cos(s),h=a*a,o=i/Math.sqrt(1-t*h),{x:(o+r)*c*Math.cos(n),y:(o+r)*c*Math.sin(n),z:(o*(1-t)+r)*a}}function K_(e,t,i,n){var s=1e-12,r=s*s,o=30,a,h,c,u,m,p,y,w,v,I,b,T,P,G=e.x,k=e.y,O=e.z?e.z:0,U,Y,W;if(a=Math.sqrt(G*G+k*k),h=Math.sqrt(G*G+k*k+O*O),a/i<s){if(U=0,h/i<s)return Y=nt,W=-n,{x:e.x,y:e.y,z:e.z}}else U=Math.atan2(k,G);c=O/h,u=a/h,m=1/Math.sqrt(1-t*(2-t)*u*u),w=u*(1-t)*m,v=c*m,P=0;do P++,y=i/Math.sqrt(1-t*v*v),W=a*w+O*v-y*(1-t*v*v),p=t*y/(y+W),m=1/Math.sqrt(1-p*(2-p)*u*u),I=u*(1-p)*m,b=c*m,T=b*w-I*v,w=I,v=b;while(T*T>r&&P<o);return Y=Math.atan(b/Math.abs(I)),{x:U,y:Y,z:W}}function rP(e,t,i){if(t===Ls)return{x:e.x+i[0],y:e.y+i[1],z:e.z+i[2]};if(t===Os){var n=i[0],s=i[1],r=i[2],o=i[3],a=i[4],h=i[5],c=i[6];return{x:c*(e.x-h*e.y+a*e.z)+n,y:c*(h*e.x+e.y-o*e.z)+s,z:c*(-a*e.x+o*e.y+e.z)+r}}}function oP(e,t,i){if(t===Ls)return{x:e.x-i[0],y:e.y-i[1],z:e.z-i[2]};if(t===Os){var n=i[0],s=i[1],r=i[2],o=i[3],a=i[4],h=i[5],c=i[6],u=(e.x-n)/c,m=(e.y-s)/c,p=(e.z-r)/c;return{x:u+h*m-a*p,y:-h*u+m+o*p,z:a*u-o*m+p}}}function Na(e){return e===Ls||e===Os}function aP(e,t,i){if(sP(e,t)||e.datum_type===Zc||t.datum_type===Zc)return i;var n=e.a,s=e.es;if(e.datum_type===fr){var r=im(e,!1,i);if(r!==0)return;n=$g,s=Hg}var o=t.a,a=t.b,h=t.es;if(t.datum_type===fr&&(o=$g,a=sR,h=Hg),s===h&&n===o&&!Na(e.datum_type)&&!Na(t.datum_type))return i;if(i=Y_(i,s,n),Na(e.datum_type)&&(i=rP(i,e.datum_type,e.datum_params)),Na(t.datum_type)&&(i=oP(i,t.datum_type,t.datum_params)),i=K_(i,h,o,a),t.datum_type===fr){var c=im(t,!0,i);if(c!==0)return}return i}function im(e,t,i){if(e.grids===null||e.grids.length===0)return console.log("Grid shift grids not found"),-1;var n={x:-i.x,y:i.y},s={x:Number.NaN,y:Number.NaN},r=[];t:for(var o=0;o<e.grids.length;o++){var a=e.grids[o];if(r.push(a.name),a.isNull){s=n;break}if(a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}for(var h=a.grid.subgrids,c=0,u=h.length;c<u;c++){var m=h[c],p=(Math.abs(m.del[1])+Math.abs(m.del[0]))/1e4,y=m.ll[0]-p,w=m.ll[1]-p,v=m.ll[0]+(m.lim[0]-1)*m.del[0]+p,I=m.ll[1]+(m.lim[1]-1)*m.del[1]+p;if(!(w>n.y||y>n.x||I<n.y||v<n.x)&&(s=hP(n,t,m),!isNaN(s.x)))break t}}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*en+" "+n.y*en+" tried: '"+r+"'"),-1):(i.x=-s.x,i.y=s.y,0)}function hP(e,t,i){var n={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return n;var s={x:e.x,y:e.y};s.x-=i.ll[0],s.y-=i.ll[1],s.x=_t(s.x-Math.PI)+Math.PI;var r=nm(s,i);if(t){if(isNaN(r.x))return n;r.x=s.x-r.x,r.y=s.y-r.y;var o=9,a=1e-12,h,c;do{if(c=nm(r,i),isNaN(c.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}h={x:s.x-(c.x+r.x),y:s.y-(c.y+r.y)},r.x+=h.x,r.y+=h.y}while(o--&&Math.abs(h.x)>a&&Math.abs(h.y)>a);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=_t(r.x+i.ll[0]),n.y=r.y+i.ll[1]}else isNaN(r.x)||(n.x=e.x+r.x,n.y=e.y+r.y);return n}function nm(e,t){var i={x:e.x/t.del[0],y:e.y/t.del[1]},n={x:Math.floor(i.x),y:Math.floor(i.y)},s={x:i.x-1*n.x,y:i.y-1*n.y},r={x:Number.NaN,y:Number.NaN},o;if(n.x<0||n.x>=t.lim[0]||n.y<0||n.y>=t.lim[1])return r;o=n.y*t.lim[0]+n.x;var a={x:t.cvs[o][0],y:t.cvs[o][1]};o++;var h={x:t.cvs[o][0],y:t.cvs[o][1]};o+=t.lim[0];var c={x:t.cvs[o][0],y:t.cvs[o][1]};o--;var u={x:t.cvs[o][0],y:t.cvs[o][1]},m=s.x*s.y,p=s.x*(1-s.y),y=(1-s.x)*(1-s.y),w=(1-s.x)*s.y;return r.x=y*a.x+p*h.x+w*u.x+m*c.x,r.y=y*a.y+p*h.y+w*u.y+m*c.y,r}function sm(e,t,i){var n=i.x,s=i.y,r=i.z||0,o,a,h,c={};for(h=0;h<3;h++)if(!(t&&h===2&&i.z===void 0))switch(h===0?(o=n,"ew".indexOf(e.axis[h])!==-1?a="x":a="y"):h===1?(o=s,"ns".indexOf(e.axis[h])!==-1?a="y":a="x"):(o=r,a="z"),e.axis[h]){case"e":c[a]=o;break;case"w":c[a]=-o;break;case"n":c[a]=o;break;case"s":c[a]=-o;break;case"u":i[a]!==void 0&&(c.z=o);break;case"d":i[a]!==void 0&&(c.z=-o);break;default:return null}return c}function q_(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}function lP(e){rm(e.x),rm(e.y)}function rm(e){if(typeof Number.isFinite=="function"){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if(typeof e!="number"||e!==e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function cP(e,t){return(e.datum.datum_type===Ls||e.datum.datum_type===Os||e.datum.datum_type===fr)&&t.datumCode!=="WGS84"||(t.datum.datum_type===Ls||t.datum.datum_type===Os||t.datum.datum_type===fr)&&e.datumCode!=="WGS84"}function Th(e,t,i,n){var s;Array.isArray(i)?i=q_(i):i={x:i.x,y:i.y,z:i.z,m:i.m};var r=i.z!==void 0;if(lP(i),e.datum&&t.datum&&cP(e,t)&&(s=new ki("WGS84"),i=Th(e,s,i,n),e=s),n&&e.axis!=="enu"&&(i=sm(e,!1,i)),e.projName==="longlat")i={x:i.x*je,y:i.y*je,z:i.z||0};else if(e.to_meter&&(i={x:i.x*e.to_meter,y:i.y*e.to_meter,z:i.z||0}),i=e.inverse(i),!i)return;if(e.from_greenwich&&(i.x+=e.from_greenwich),i=aP(e.datum,t.datum,i),!!i)return i=i,t.from_greenwich&&(i={x:i.x-t.from_greenwich,y:i.y,z:i.z||0}),t.projName==="longlat"?i={x:i.x*en,y:i.y*en,z:i.z||0}:(i=t.forward(i),t.to_meter&&(i={x:i.x/t.to_meter,y:i.y/t.to_meter,z:i.z||0})),n&&t.axis!=="enu"?sm(t,!0,i):(i&&!r&&delete i.z,i)}var om=ki("WGS84");function Dl(e,t,i,n){var s,r,o;return Array.isArray(i)?(s=Th(e,t,i,n)||{x:NaN,y:NaN},i.length>2?typeof e.name<"u"&&e.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(i.slice(3)):[s.x,s.y,i[2]].concat(i.slice(3)):[s.x,s.y].concat(i.slice(2)):[s.x,s.y]):(r=Th(e,t,i,n),o=Object.keys(i),o.length===2||o.forEach(function(a){if(typeof e.name<"u"&&e.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;r[a]=i[a]}),r)}function Da(e){return e instanceof ki?e:typeof e=="object"&&"oProj"in e?e.oProj:ki(e)}function uP(e,t,i){var n,s,r=!1,o;return typeof t>"u"?(s=Da(e),n=om,r=!0):(typeof t.x<"u"||Array.isArray(t))&&(i=t,s=Da(e),n=om,r=!0),n||(n=Da(e)),s||(s=Da(t)),i?Dl(n,s,i):(o={forward:function(a,h){return Dl(n,s,a,h)},inverse:function(a,h){return Dl(s,n,a,h)}},r&&(o.oProj=s),o)}var am=6,J_="AJSAJS",Q_="AFAFAF",rr=65,si=73,Ei=79,yo=86,wo=90;const dP={forward:ty,inverse:fP,toPoint:ey};function ty(e,t){return t=t||5,pP(gP({lat:e[1],lon:e[0]}),t)}function fP(e){var t=$u(ny(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function ey(e){var t=$u(ny(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function kl(e){return e*(Math.PI/180)}function hm(e){return 180*(e/Math.PI)}function gP(e){var t=e.lat,i=e.lon,n=6378137,s=.00669438,r=.9996,o,a,h,c,u,m,p,y=kl(t),w=kl(i),v,I;I=Math.floor((i+180)/6)+1,i===180&&(I=60),t>=56&&t<64&&i>=3&&i<12&&(I=32),t>=72&&t<84&&(i>=0&&i<9?I=31:i>=9&&i<21?I=33:i>=21&&i<33?I=35:i>=33&&i<42&&(I=37)),o=(I-1)*6-180+3,v=kl(o),a=s/(1-s),h=n/Math.sqrt(1-s*Math.sin(y)*Math.sin(y)),c=Math.tan(y)*Math.tan(y),u=a*Math.cos(y)*Math.cos(y),m=Math.cos(y)*(w-v),p=n*((1-s/4-3*s*s/64-5*s*s*s/256)*y-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*y)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*y)-35*s*s*s/3072*Math.sin(6*y));var b=r*h*(m+(1-c+u)*m*m*m/6+(5-18*c+c*c+72*u-58*a)*m*m*m*m*m/120)+5e5,T=r*(p+h*Math.tan(y)*(m*m/2+(5-c+9*u+4*u*u)*m*m*m*m/24+(61-58*c+c*c+600*u-330*a)*m*m*m*m*m*m/720));return t<0&&(T+=1e7),{northing:Math.round(T),easting:Math.round(b),zoneNumber:I,zoneLetter:mP(t)}}function $u(e){var t=e.northing,i=e.easting,n=e.zoneLetter,s=e.zoneNumber;if(s<0||s>60)return null;var r=.9996,o=6378137,a=.00669438,h,c=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),u,m,p,y,w,v,I,b,T,P=i-5e5,G=t;n<"N"&&(G-=1e7),I=(s-1)*6-180+3,h=a/(1-a),v=G/r,b=v/(o*(1-a/4-3*a*a/64-5*a*a*a/256)),T=b+(3*c/2-27*c*c*c/32)*Math.sin(2*b)+(21*c*c/16-55*c*c*c*c/32)*Math.sin(4*b)+151*c*c*c/96*Math.sin(6*b),u=o/Math.sqrt(1-a*Math.sin(T)*Math.sin(T)),m=Math.tan(T)*Math.tan(T),p=h*Math.cos(T)*Math.cos(T),y=o*(1-a)/Math.pow(1-a*Math.sin(T)*Math.sin(T),1.5),w=P/(u*r);var k=T-u*Math.tan(T)/y*(w*w/2-(5+3*m+10*p-4*p*p-9*h)*w*w*w*w/24+(61+90*m+298*p+45*m*m-252*h-3*p*p)*w*w*w*w*w*w/720);k=hm(k);var O=(w-(1+2*m+p)*w*w*w/6+(5-2*p+28*m-3*p*p+8*h+24*m*m)*w*w*w*w*w/120)/Math.cos(T);O=I+hm(O);var U;if(e.accuracy){var Y=$u({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});U={top:Y.lat,right:Y.lon,bottom:k,left:O}}else U={lat:k,lon:O};return U}function mP(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function pP(e,t){var i="00000"+e.easting,n="00000"+e.northing;return e.zoneNumber+e.zoneLetter+_P(e.easting,e.northing,e.zoneNumber)+i.substr(i.length-5,t)+n.substr(n.length-5,t)}function _P(e,t,i){var n=iy(i),s=Math.floor(e/1e5),r=Math.floor(t/1e5)%20;return yP(s,r,n)}function iy(e){var t=e%am;return t===0&&(t=am),t}function yP(e,t,i){var n=i-1,s=J_.charCodeAt(n),r=Q_.charCodeAt(n),o=s+e-1,a=r+t,h=!1;o>wo&&(o=o-wo+rr-1,h=!0),(o===si||s<si&&o>si||(o>si||s<si)&&h)&&o++,(o===Ei||s<Ei&&o>Ei||(o>Ei||s<Ei)&&h)&&(o++,o===si&&o++),o>wo&&(o=o-wo+rr-1),a>yo?(a=a-yo+rr-1,h=!0):h=!1,(a===si||r<si&&a>si||(a>si||r<si)&&h)&&a++,(a===Ei||r<Ei&&a>Ei||(a>Ei||r<Ei)&&h)&&(a++,a===si&&a++),a>yo&&(a=a-yo+rr-1);var c=String.fromCharCode(o)+String.fromCharCode(a);return c}function ny(e){if(e&&e.length===0)throw"MGRSPoint coverting from nothing";for(var t=e.length,i=null,n="",s,r=0;!/[A-Z]/.test(s=e.charAt(r));){if(r>=2)throw"MGRSPoint bad conversion from: "+e;n+=s,r++}var o=parseInt(n,10);if(r===0||r+3>t)throw"MGRSPoint bad conversion from: "+e;var a=e.charAt(r++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+e;i=e.substring(r,r+=2);for(var h=iy(o),c=wP(i.charAt(0),h),u=vP(i.charAt(1),h);u<MP(a);)u+=2e6;var m=t-r;if(m%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+e;var p=m/2,y=0,w=0,v,I,b,T,P;return p>0&&(v=1e5/Math.pow(10,p),I=e.substring(r,r+p),y=parseFloat(I)*v,b=e.substring(r+p),w=parseFloat(b)*v),T=y+c,P=w+u,{easting:T,northing:P,zoneLetter:a,zoneNumber:o,accuracy:v}}function wP(e,t){for(var i=J_.charCodeAt(t-1),n=1e5,s=!1;i!==e.charCodeAt(0);){if(i++,i===si&&i++,i===Ei&&i++,i>wo){if(s)throw"Bad character: "+e;i=rr,s=!0}n+=1e5}return n}function vP(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var i=Q_.charCodeAt(t-1),n=0,s=!1;i!==e.charCodeAt(0);){if(i++,i===si&&i++,i===Ei&&i++,i>yo){if(s)throw"Bad character: "+e;i=rr,s=!0}n+=1e5}return n}function MP(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function br(e,t,i){if(!(this instanceof br))return new br(e,t,i);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if(typeof e=="object")this.x=e.x,this.y=e.y,this.z=e.z||0;else if(typeof e=="string"&&typeof t>"u"){var n=e.split(",");this.x=parseFloat(n[0]),this.y=parseFloat(n[1]),this.z=parseFloat(n[2])||0}else this.x=e,this.y=t,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}br.fromMGRS=function(e){return new br(ey(e))};br.prototype.toMGRS=function(e){return ty([this.x,this.y],e)};var IP=1,EP=.25,lm=.046875,cm=.01953125,um=.01068115234375,CP=.75,xP=.46875,SP=.013020833333333334,bP=.007120768229166667,AP=.3645833333333333,TP=.005696614583333333,RP=.3076171875;function Hu(e){var t=[];t[0]=IP-e*(EP+e*(lm+e*(cm+e*um))),t[1]=e*(CP-e*(lm+e*(cm+e*um)));var i=e*e;return t[2]=i*(xP-e*(SP+e*bP)),i*=e,t[3]=i*(AP-e*TP),t[4]=i*e*RP,t}function Dr(e,t,i,n){return i*=t,t*=t,n[0]*e-i*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))}var PP=20;function Yu(e,t,i){for(var n=1/(1-t),s=e,r=PP;r;--r){var o=Math.sin(s),a=1-t*o*o;if(a=(Dr(s,o,Math.cos(s),i)-e)*(a*Math.sqrt(a))*n,s-=a,Math.abs(a)<ft)return s}return s}function GP(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Hu(this.es),this.ml0=Dr(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function LP(e){var t=e.x,i=e.y,n=_t(t-this.long0),s,r,o,a=Math.sin(i),h=Math.cos(i);if(this.es){var u=h*n,m=Math.pow(u,2),p=this.ep2*Math.pow(h,2),y=Math.pow(p,2),w=Math.abs(h)>ft?Math.tan(i):0,v=Math.pow(w,2),I=Math.pow(v,2);s=1-this.es*Math.pow(a,2),u=u/Math.sqrt(s);var b=Dr(i,a,h,this.en);r=this.a*(this.k0*u*(1+m/6*(1-v+p+m/20*(5-18*v+I+14*p-58*v*p+m/42*(61+179*I-I*v-479*v)))))+this.x0,o=this.a*(this.k0*(b-this.ml0+a*n*u/2*(1+m/12*(5-v+9*p+4*y+m/30*(61+I-58*v+270*p-330*v*p+m/56*(1385+543*I-I*v-3111*v))))))+this.y0}else{var c=h*Math.sin(n);if(Math.abs(Math.abs(c)-1)<ft)return 93;if(r=.5*this.a*this.k0*Math.log((1+c)/(1-c))+this.x0,o=h*Math.cos(n)/Math.sqrt(1-Math.pow(c,2)),c=Math.abs(o),c>=1){if(c-1>ft)return 93;o=0}else o=Math.acos(o);i<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return e.x=r,e.y=o,e}function OP(e){var t,i,n,s,r=(e.x-this.x0)*(1/this.a),o=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+o/this.k0,i=Yu(t,this.es,this.en),Math.abs(i)<nt){var m=Math.sin(i),p=Math.cos(i),y=Math.abs(p)>ft?Math.tan(i):0,w=this.ep2*Math.pow(p,2),v=Math.pow(w,2),I=Math.pow(y,2),b=Math.pow(I,2);t=1-this.es*Math.pow(m,2);var T=r*Math.sqrt(t)/this.k0,P=Math.pow(T,2);t=t*y,n=i-t*P/(1-this.es)*.5*(1-P/12*(5+3*I-9*w*I+w-4*v-P/30*(61+90*I-252*w*I+45*b+46*w-P/56*(1385+3633*I+4095*b+1574*b*I)))),s=_t(this.long0+T*(1-P/6*(1+2*I+w-P/20*(5+28*I+24*b+8*w*I+6*w-P/42*(61+662*I+1320*b+720*b*I))))/p)}else n=nt*ma(o),s=0;else{var a=Math.exp(r/this.k0),h=.5*(a-1/a),c=this.lat0+o/this.k0,u=Math.cos(c);t=Math.sqrt((1-Math.pow(u,2))/(1+Math.pow(h,2))),n=Math.asin(t),o<0&&(n=-n),h===0&&u===0?s=0:s=_t(Math.atan2(h,u)+this.long0)}return e.x=s,e.y=n,e}var FP=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Ja={init:GP,forward:LP,inverse:OP,names:FP};function sy(e){var t=Math.exp(e);return t=(t-1/t)/2,t}function li(e,t){e=Math.abs(e),t=Math.abs(t);var i=Math.max(e,t),n=Math.min(e,t)/(i||1);return i*Math.sqrt(1+Math.pow(n,2))}function NP(e){var t=1+e,i=t-1;return i===0?e:e*Math.log(t)/i}function DP(e){var t=Math.abs(e);return t=NP(t*(1+t/(li(1,t)+1))),e<0?-t:t}function Ku(e,t){for(var i=2*Math.cos(2*t),n=e.length-1,s=e[n],r=0,o;--n>=0;)o=-r+i*s+e[n],r=s,s=o;return t+o*Math.sin(2*t)}function kP(e,t){for(var i=2*Math.cos(t),n=e.length-1,s=e[n],r=0,o;--n>=0;)o=-r+i*s+e[n],r=s,s=o;return Math.sin(t)*o}function jP(e){var t=Math.exp(e);return t=(t+1/t)/2,t}function ry(e,t,i){for(var n=Math.sin(t),s=Math.cos(t),r=sy(i),o=jP(i),a=2*s*o,h=-2*n*r,c=e.length-1,u=e[c],m=0,p=0,y=0,w,v;--c>=0;)w=p,v=m,p=u,m=y,u=-w+a*p-h*m+e[c],y=-v+h*p+a*m;return a=n*o,h=s*r,[a*u-h*y,a*y+h*u]}function BP(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Ja.init.apply(this),this.forward=Ja.forward,this.inverse=Ja.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),i=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),i=i*t,this.cgb[1]=i*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=i*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),i=i*t,this.cgb[2]=i*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=i*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),i=i*t,this.cgb[3]=i*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=i*(1237/630+t*(-12/5+t*(-24832/14175))),i=i*t,this.cgb[4]=i*(4174/315+t*(-144838/6237)),this.cbg[4]=i*(-734/315+t*(109598/31185)),i=i*t,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+i*(1/4+i*(1/64+i/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=i*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=i*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),i=i*t,this.utg[2]=i*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=i*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),i=i*t,this.utg[3]=i*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=i*(49561/161280+t*(-179/168+t*(6601661/7257600))),i=i*t,this.utg[4]=i*(-4583/161280+t*(108847/3991680)),this.gtu[4]=i*(34729/80640+t*(-3418889/1995840)),i=i*t,this.utg[5]=i*(-20648693/638668800),this.gtu[5]=i*(212378941/319334400);var n=Ku(this.cbg,this.lat0);this.Zb=-this.Qn*(n+kP(this.gtu,2*n))}function VP(e){var t=_t(e.x-this.long0),i=e.y;i=Ku(this.cbg,i);var n=Math.sin(i),s=Math.cos(i),r=Math.sin(t),o=Math.cos(t);i=Math.atan2(n,o*s),t=Math.atan2(r*s,li(n,s*o)),t=DP(Math.tan(t));var a=ry(this.gtu,2*i,2*t);i=i+a[0],t=t+a[1];var h,c;return Math.abs(t)<=2.623395162778?(h=this.a*(this.Qn*t)+this.x0,c=this.a*(this.Qn*i+this.Zb)+this.y0):(h=1/0,c=1/0),e.x=h,e.y=c,e}function WP(e){var t=(e.x-this.x0)*(1/this.a),i=(e.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,t=t/this.Qn;var n,s;if(Math.abs(t)<=2.623395162778){var r=ry(this.utg,2*i,2*t);i=i+r[0],t=t+r[1],t=Math.atan(sy(t));var o=Math.sin(i),a=Math.cos(i),h=Math.sin(t),c=Math.cos(t);i=Math.atan2(o*c,li(h,c*a)),t=Math.atan2(h,c*a),n=_t(t+this.long0),s=Ku(this.cgb,i)}else n=1/0,s=1/0;return e.x=n,e.y=s,e}var zP=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Qa={init:BP,forward:VP,inverse:WP,names:zP};function ZP(e,t){if(e===void 0){if(e=Math.floor((_t(t)+Math.PI)*30/Math.PI)+1,e<0)return 0;if(e>60)return 60}return e}var UP="etmerc";function XP(){var e=ZP(this.zone,this.long0);if(e===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*je,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Qa.init.apply(this),this.forward=Qa.forward,this.inverse=Qa.inverse}var $P=["Universal Transverse Mercator System","utm"];const HP={init:XP,names:$P,dependsOn:UP};function qu(e,t){return Math.pow((1-e)/(1+e),t)}var YP=20;function KP(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+ae)/(Math.pow(Math.tan(.5*this.lat0+ae),this.C)*qu(this.e*e,this.ratexp))}function qP(e){var t=e.x,i=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+ae),this.C)*qu(this.e*Math.sin(i),this.ratexp))-nt,e.x=this.C*t,e}function JP(e){for(var t=1e-14,i=e.x/this.C,n=e.y,s=Math.pow(Math.tan(.5*n+ae)/this.K,1/this.C),r=YP;r>0&&(n=2*Math.atan(s*qu(this.e*Math.sin(e.y),-.5*this.e))-nt,!(Math.abs(n-e.y)<t));--r)e.y=n;return r?(e.x=i,e.y=n,e):null}const Ju={init:KP,forward:qP,inverse:JP};function QP(){Ju.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function t4(e){var t,i,n,s;return e.x=_t(e.x-this.long0),Ju.forward.apply(this,[e]),t=Math.sin(e.y),i=Math.cos(e.y),n=Math.cos(e.x),s=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*i*n),e.x=s*i*Math.sin(e.x),e.y=s*(this.cosc0*t-this.sinc0*i*n),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function e4(e){var t,i,n,s,r;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,r=li(e.x,e.y)){var o=2*Math.atan2(r,this.R2);t=Math.sin(o),i=Math.cos(o),s=Math.asin(i*this.sinc0+e.y*t*this.cosc0/r),n=Math.atan2(e.x*t,r*this.cosc0*i-e.y*this.sinc0*t)}else s=this.phic0,n=0;return e.x=n,e.y=s,Ju.inverse.apply(this,[e]),e.x=_t(e.x+this.long0),e}var i4=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const n4={init:QP,forward:t4,inverse:e4,names:i4};function Qu(e,t,i){return t*=i,Math.tan(.5*(nt+e))*Math.pow((1-t)/(1+t),.5*i)}function s4(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ft&&(this.k0=.5*(1+ma(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=ft&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ft&&Math.abs(Math.cos(this.lat_ts))>ft&&(this.k0=.5*this.cons*ln(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Di(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=ln(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(Qu(this.lat0,this.sinlat0,this.e))-nt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function r4(e){var t=e.x,i=e.y,n=Math.sin(i),s=Math.cos(i),r,o,a,h,c,u,m=_t(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=ft&&Math.abs(i+this.lat0)<=ft?(e.x=NaN,e.y=NaN,e):this.sphere?(r=2*this.k0/(1+this.sinlat0*n+this.coslat0*s*Math.cos(m)),e.x=this.a*r*s*Math.sin(m)+this.x0,e.y=this.a*r*(this.coslat0*n-this.sinlat0*s*Math.cos(m))+this.y0,e):(o=2*Math.atan(Qu(i,n,this.e))-nt,h=Math.cos(o),a=Math.sin(o),Math.abs(this.coslat0)<=ft?(c=Di(this.e,i*this.con,this.con*n),u=2*this.a*this.k0*c/this.cons,e.x=this.x0+u*Math.sin(t-this.long0),e.y=this.y0-this.con*u*Math.cos(t-this.long0),e):(Math.abs(this.sinlat0)<ft?(r=2*this.a*this.k0/(1+h*Math.cos(m)),e.y=r*a):(r=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*h*Math.cos(m))),e.y=r*(this.cosX0*a-this.sinX0*h*Math.cos(m))+this.y0),e.x=r*h*Math.sin(m)+this.x0,e))}function o4(e){e.x-=this.x0,e.y-=this.y0;var t,i,n,s,r,o=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return t=this.long0,i=this.lat0,o<=ft?(e.x=t,e.y=i,e):(i=Math.asin(Math.cos(a)*this.sinlat0+e.y*Math.sin(a)*this.coslat0/o),Math.abs(this.coslat0)<ft?this.lat0>0?t=_t(this.long0+Math.atan2(e.x,-1*e.y)):t=_t(this.long0+Math.atan2(e.x,e.y)):t=_t(this.long0+Math.atan2(e.x*Math.sin(a),o*this.coslat0*Math.cos(a)-e.y*this.sinlat0*Math.sin(a))),e.x=t,e.y=i,e)}else if(Math.abs(this.coslat0)<=ft){if(o<=ft)return i=this.lat0,t=this.long0,e.x=t,e.y=i,e;e.x*=this.con,e.y*=this.con,n=o*this.cons/(2*this.a*this.k0),i=this.con*Qo(this.e,n),t=this.con*_t(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else s=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,o<=ft?r=this.X0:(r=Math.asin(Math.cos(s)*this.sinX0+e.y*Math.sin(s)*this.cosX0/o),t=_t(this.long0+Math.atan2(e.x*Math.sin(s),o*this.cosX0*Math.cos(s)-e.y*this.sinX0*Math.sin(s)))),i=-1*Qo(this.e,Math.tan(.5*(nt+r)));return e.x=t,e.y=i,e}var a4=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"];const h4={init:s4,forward:r4,inverse:o4,names:a4,ssfn_:Qu};function l4(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),i=this.a,n=this.rf,s=1/n,r=2*s-Math.pow(s,2),o=this.e=Math.sqrt(r);this.R=this.k0*i*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+e/2)),c=Math.log((1+o*t)/(1-o*t));this.K=a-this.alpha*h+this.alpha*o/2*c}function c4(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),n=-this.alpha*(t+i)+this.K,s=2*(Math.atan(Math.exp(n))-Math.PI/4),r=this.alpha*(e.x-this.lambda0),o=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(r))),a=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(r));return e.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,e.x=this.R*o+this.x0,e}function u4(e){for(var t=e.x-this.x0,i=e.y-this.y0,n=t/this.R,s=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(n)),o=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(s))),a=this.lambda0+o/this.alpha,h=0,c=r,u=-1e3,m=0;Math.abs(c-u)>1e-7;){if(++m>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),u=c,c=2*Math.atan(Math.exp(h))-Math.PI/2}return e.x=a,e.y=c,e}var d4=["somerc"];const f4={init:l4,forward:c4,inverse:u4,names:d4};var tr=1e-7;function g4(e){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],i=typeof e.projName=="object"?Object.keys(e.projName)[0]:e.projName;return"no_uoff"in e||"no_off"in e||t.indexOf(i)!==-1||t.indexOf($_(i))!==-1}function m4(){var e,t,i,n,s,r,o,a,h,c,u=0,m,p=0,y=0,w=0,v=0,I=0,b=0;this.no_off=g4(this),this.no_rot="no_rot"in this;var T=!1;"alpha"in this&&(T=!0);var P=!1;if("rectified_grid_angle"in this&&(P=!0),T&&(b=this.alpha),P&&(u=this.rectified_grid_angle),T||P)p=this.longc;else if(y=this.long1,v=this.lat1,w=this.long2,I=this.lat2,Math.abs(v-I)<=tr||(e=Math.abs(v))<=tr||Math.abs(e-nt)<=tr||Math.abs(Math.abs(this.lat0)-nt)<=tr||Math.abs(Math.abs(I)-nt)<=tr)throw new Error;var G=1-this.es;t=Math.sqrt(G),Math.abs(this.lat0)>ft?(a=Math.sin(this.lat0),i=Math.cos(this.lat0),e=1-this.es*a*a,this.B=i*i,this.B=Math.sqrt(1+this.es*this.B*this.B/G),this.A=this.B*this.k0*t/e,n=this.B*t/(i*Math.sqrt(e)),s=n*n-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=n,this.E*=Math.pow(Di(this.e,this.lat0,a),this.B)):(this.B=1/t,this.A=this.k0,this.E=n=s=1),T||P?(T?(m=Math.asin(Math.sin(b)/n),P||(u=b)):(m=u,b=Math.asin(n*Math.sin(m))),this.lam0=p-Math.asin(.5*(s-1/s)*Math.tan(m))/this.B):(r=Math.pow(Di(this.e,v,Math.sin(v)),this.B),o=Math.pow(Di(this.e,I,Math.sin(I)),this.B),s=this.E/r,h=(o-r)/(o+r),c=this.E*this.E,c=(c-o*r)/(c+o*r),e=y-w,e<-Math.PI?w-=qo:e>Math.PI&&(w+=qo),this.lam0=_t(.5*(y+w)-Math.atan(c*Math.tan(.5*this.B*(y-w))/h)/this.B),m=Math.atan(2*Math.sin(this.B*_t(y-this.lam0))/(s-1/s)),u=b=Math.asin(n*Math.sin(m))),this.singam=Math.sin(m),this.cosgam=Math.cos(m),this.sinrot=Math.sin(u),this.cosrot=Math.cos(u),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(b))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*m,this.v_pole_n=this.ArB*Math.log(Math.tan(ae-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(ae+s))}function p4(e){var t={},i,n,s,r,o,a,h,c;if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-nt)>ft){if(o=this.E/Math.pow(Di(this.e,e.y,Math.sin(e.y)),this.B),a=1/o,i=.5*(o-a),n=.5*(o+a),r=Math.sin(this.B*e.x),s=(i*this.singam-r*this.cosgam)/n,Math.abs(Math.abs(s)-1)<ft)throw new Error;c=.5*this.ArB*Math.log((1-s)/(1+s)),a=Math.cos(this.B*e.x),Math.abs(a)<tr?h=this.A*e.x:h=this.ArB*Math.atan2(i*this.cosgam+r*this.singam,a)}else c=e.y>0?this.v_pole_n:this.v_pole_s,h=this.ArB*e.y;return this.no_rot?(t.x=h,t.y=c):(h-=this.u_0,t.x=c*this.cosrot+h*this.sinrot,t.y=h*this.cosrot-c*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function _4(e){var t,i,n,s,r,o,a,h={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(i=e.y,t=e.x):(i=e.x*this.cosrot-e.y*this.sinrot,t=e.y*this.cosrot+e.x*this.sinrot+this.u_0),n=Math.exp(-this.BrA*i),s=.5*(n-1/n),r=.5*(n+1/n),o=Math.sin(this.BrA*t),a=(o*this.cosgam+s*this.singam)/r,Math.abs(Math.abs(a)-1)<ft)h.x=0,h.y=a<0?-nt:nt;else{if(h.y=this.E/Math.sqrt((1+a)/(1-a)),h.y=Qo(this.e,Math.pow(h.y,1/this.B)),h.y===1/0)throw new Error;h.x=-this.rB*Math.atan2(s*this.cosgam-o*this.singam,Math.cos(this.BrA*t))}return h.x+=this.lam0,h}var y4=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const w4={init:m4,forward:p4,inverse:_4,names:y4};function v4(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<ft)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),i=Math.cos(this.lat1),n=ln(this.e,t,i),s=Di(this.e,this.lat1,t),r=Math.sin(this.lat2),o=Math.cos(this.lat2),a=ln(this.e,r,o),h=Di(this.e,this.lat2,r),c=Math.abs(Math.abs(this.lat0)-nt)<ft?0:Di(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>ft?this.ns=Math.log(n/a)/Math.log(s/h):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function M4(e){var t=e.x,i=e.y;Math.abs(2*Math.abs(i)-Math.PI)<=ft&&(i=ma(i)*(nt-2*ft));var n=Math.abs(Math.abs(i)-nt),s,r;if(n>ft)s=Di(this.e,i,Math.sin(i)),r=this.a*this.f0*Math.pow(s,this.ns);else{if(n=i*this.ns,n<=0)return null;r=0}var o=this.ns*_t(t-this.long0);return e.x=this.k0*(r*Math.sin(o))+this.x0,e.y=this.k0*(this.rh-r*Math.cos(o))+this.y0,e}function I4(e){var t,i,n,s,r,o=(e.x-this.x0)/this.k0,a=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(o*o+a*a),i=1):(t=-Math.sqrt(o*o+a*a),i=-1);var h=0;if(t!==0&&(h=Math.atan2(i*o,i*a)),t!==0||this.ns>0){if(i=1/this.ns,n=Math.pow(t/(this.a*this.f0),i),s=Qo(this.e,n),s===-9999)return null}else s=-nt;return r=_t(h/this.ns+this.long0),e.x=r,e.y=s,e}var E4=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const C4={init:v4,forward:M4,inverse:I4,names:E4};function x4(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function S4(e){var t,i,n,s,r,o,a,h=e.x,c=e.y,u=_t(h-this.long0);return t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45),n=-u*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),r=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(s)),o=this.n*r,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),e.y=a*Math.cos(o)/1,e.x=a*Math.sin(o)/1,this.czech||(e.y*=-1,e.x*=-1),e}function b4(e){var t,i,n,s,r,o,a,h,c=e.x;e.x=e.y,e.y=c,this.czech||(e.y*=-1,e.x*=-1),o=Math.sqrt(e.x*e.x+e.y*e.y),r=Math.atan2(e.y,e.x),s=r/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(s)),i=Math.asin(Math.cos(n)*Math.sin(s)/Math.cos(t)),e.x=this.long0-i/this.alfa,a=t,h=0;var u=0;do e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-e.y)<1e-10&&(h=1),a=e.y,u+=1;while(h===0&&u<15);return u>=15?null:e}var A4=["Krovak","krovak"];const T4={init:x4,forward:S4,inverse:b4,names:A4};function Qe(e,t,i,n,s){return e*s-t*Math.sin(2*s)+i*Math.sin(4*s)-n*Math.sin(6*s)}function pa(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function _a(e){return .375*e*(1+.25*e*(1+.46875*e))}function ya(e){return .05859375*e*e*(1+.75*e)}function wa(e){return e*e*e*(35/3072)}function td(e,t,i){var n=t*i;return e/Math.sqrt(1-n*n)}function hs(e){return Math.abs(e)<nt?e:e-ma(e)*Math.PI}function Rh(e,t,i,n,s){var r,o;r=e/t;for(var a=0;a<15;a++)if(o=(e-(t*r-i*Math.sin(2*r)+n*Math.sin(4*r)-s*Math.sin(6*r)))/(t-2*i*Math.cos(2*r)+4*n*Math.cos(4*r)-6*s*Math.cos(6*r)),r+=o,Math.abs(o)<=1e-10)return r;return NaN}function R4(){this.sphere||(this.e0=pa(this.es),this.e1=_a(this.es),this.e2=ya(this.es),this.e3=wa(this.es),this.ml0=this.a*Qe(this.e0,this.e1,this.e2,this.e3,this.lat0))}function P4(e){var t,i,n=e.x,s=e.y;if(n=_t(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(s)*Math.sin(n)),i=this.a*(Math.atan2(Math.tan(s),Math.cos(n))-this.lat0);else{var r=Math.sin(s),o=Math.cos(s),a=td(this.a,this.e,r),h=Math.tan(s)*Math.tan(s),c=n*Math.cos(s),u=c*c,m=this.es*o*o/(1-this.es),p=this.a*Qe(this.e0,this.e1,this.e2,this.e3,s);t=a*c*(1-u*h*(1/6-(8-h+8*m)*u/120)),i=p-this.ml0+a*r/o*u*(.5+(5-h+6*m)*u/24)}return e.x=t+this.x0,e.y=i+this.y0,e}function G4(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,i=e.y/this.a,n,s;if(this.sphere){var r=i+this.lat0;n=Math.asin(Math.sin(r)*Math.cos(t)),s=Math.atan2(Math.tan(t),Math.cos(r))}else{var o=this.ml0/this.a+i,a=Rh(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-nt)<=ft)return e.x=this.long0,e.y=nt,i<0&&(e.y*=-1),e;var h=td(this.a,this.e,Math.sin(a)),c=h*h*h/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(a),2),m=t*this.a/h,p=m*m;n=a-h*Math.tan(a)/c*m*m*(.5-(1+3*u)*m*m/24),s=m*(1-p*(u/3+(1+3*u)*u*p/15))/Math.cos(a)}return e.x=_t(s+this.long0),e.y=hs(n),e}var L4=["Cassini","Cassini_Soldner","cass"];const O4={init:R4,forward:P4,inverse:G4,names:L4};function ts(e,t){var i;return e>1e-7?(i=e*t,(1-e*e)*(t/(1-i*i)-.5/e*Math.log((1-i)/(1+i)))):2*t}var Hc=1,Yc=2,Kc=3,th=4;function F4(){var e=Math.abs(this.lat0);if(Math.abs(e-nt)<ft?this.mode=this.lat0<0?Hc:Yc:Math.abs(e)<ft?this.mode=Kc:this.mode=th,this.es>0){var t;switch(this.qp=ts(this.e,1),this.mmf=.5/(1-this.es),this.apa=Z4(this.es),this.mode){case Yc:this.dd=1;break;case Hc:this.dd=1;break;case Kc:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case th:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=ts(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===th&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function N4(e){var t,i,n,s,r,o,a,h,c,u,m=e.x,p=e.y;if(m=_t(m-this.long0),this.sphere){if(r=Math.sin(p),u=Math.cos(p),n=Math.cos(m),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i=this.mode===this.EQUIT?1+u*n:1+this.sinph0*r+this.cosph0*u*n,i<=ft)return null;i=Math.sqrt(2/i),t=i*u*Math.sin(m),i*=this.mode===this.EQUIT?r:this.cosph0*r-this.sinph0*u*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(p+this.lat0)<ft)return null;i=ae-p*.5,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),t=i*Math.sin(m),i*=n}}else{switch(a=0,h=0,c=0,n=Math.cos(m),s=Math.sin(m),r=Math.sin(p),o=ts(this.e,r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=o/this.qp,h=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:c=1+this.sinb1*a+this.cosb1*h*n;break;case this.EQUIT:c=1+h*n;break;case this.N_POLE:c=nt+p,o=this.qp-o;break;case this.S_POLE:c=p-nt,o=this.qp+o;break}if(Math.abs(c)<ft)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),this.mode===this.OBLIQ?i=this.ymf*c*(this.cosb1*a-this.sinb1*h*n):i=(c=Math.sqrt(2/(1+h*n)))*a*this.ymf,t=this.xmf*c*h*s;break;case this.N_POLE:case this.S_POLE:o>=0?(t=(c=Math.sqrt(o))*s,i=n*(this.mode===this.S_POLE?c:-c)):t=i=0;break}}return e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e}function D4(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,i=e.y/this.a,n,s,r,o,a,h,c;if(this.sphere){var u=0,m,p=0;if(m=Math.sqrt(t*t+i*i),s=m*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(p=Math.sin(s),u=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(m)<=ft?0:Math.asin(i*p/m),t*=p,i=u*m;break;case this.OBLIQ:s=Math.abs(m)<=ft?this.lat0:Math.asin(u*this.sinph0+i*p*this.cosph0/m),t*=p*this.cosph0,i=(u-Math.sin(s)*this.sinph0)*m;break;case this.N_POLE:i=-i,s=nt-s;break;case this.S_POLE:s-=nt;break}n=i===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,i)}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,i*=this.dd,h=Math.sqrt(t*t+i*i),h<ft)return e.x=this.long0,e.y=this.lat0,e;o=2*Math.asin(.5*h/this.rq),r=Math.cos(o),t*=o=Math.sin(o),this.mode===this.OBLIQ?(c=r*this.sinb1+i*o*this.cosb1/h,a=this.qp*c,i=h*this.cosb1*r-i*this.sinb1*o):(c=i*o/h,a=this.qp*c,i=h*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),a=t*t+i*i,!a)return e.x=this.long0,e.y=this.lat0,e;c=1-a/this.qp,this.mode===this.S_POLE&&(c=-c)}n=Math.atan2(t,i),s=U4(Math.asin(c),this.apa)}return e.x=_t(this.long0+n),e.y=s,e}var k4=.3333333333333333,j4=.17222222222222222,B4=.10257936507936508,V4=.06388888888888888,W4=.0664021164021164,z4=.016415012942191543;function Z4(e){var t,i=[];return i[0]=e*k4,t=e*e,i[0]+=t*j4,i[1]=t*V4,t*=e,i[0]+=t*B4,i[1]+=t*W4,i[2]=t*z4,i}function U4(e,t){var i=e+e;return e+t[0]*Math.sin(i)+t[1]*Math.sin(i+i)+t[2]*Math.sin(i+i+i)}var X4=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const $4={init:F4,forward:N4,inverse:D4,names:X4,S_POLE:Hc,N_POLE:Yc,EQUIT:Kc,OBLIQ:th};function as(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}function H4(){Math.abs(this.lat1+this.lat2)<ft||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=ln(this.e3,this.sin_po,this.cos_po),this.qs1=ts(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=ln(this.e3,this.sin_po,this.cos_po),this.qs2=ts(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ts(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>ft?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function Y4(e){var t=e.x,i=e.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var n=ts(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,r=this.ns0*_t(t-this.long0),o=s*Math.sin(r)+this.x0,a=this.rh-s*Math.cos(r)+this.y0;return e.x=o,e.y=a,e}function K4(e){var t,i,n,s,r,o;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),n=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),n=-1),s=0,t!==0&&(s=Math.atan2(n*e.x,n*e.y)),n=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-n*n)/(2*this.ns0)):(i=(this.c-n*n)/this.ns0,o=this.phi1z(this.e3,i)),r=_t(s/this.ns0+this.long0),e.x=r,e.y=o,e}function q4(e,t){var i,n,s,r,o,a=as(.5*t);if(e<ft)return a;for(var h=e*e,c=1;c<=25;c++)if(i=Math.sin(a),n=Math.cos(a),s=e*i,r=1-s*s,o=.5*r*r/n*(t/(1-h)-i/r+.5/e*Math.log((1-s)/(1+s))),a=a+o,Math.abs(o)<=1e-7)return a;return null}var J4=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"];const Q4={init:H4,forward:Y4,inverse:K4,names:J4,phi1z:q4};function t3(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function e3(e){var t,i,n,s,r,o,a,h,c=e.x,u=e.y;return n=_t(c-this.long0),t=Math.sin(u),i=Math.cos(u),s=Math.cos(n),o=this.sin_p14*t+this.cos_p14*i*s,r=1,o>0||Math.abs(o)<=ft?(a=this.x0+this.a*r*i*Math.sin(n)/o,h=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*i*s)/o):(a=this.x0+this.infinity_dist*i*Math.sin(n),h=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*i*s)),e.x=a,e.y=h,e}function i3(e){var t,i,n,s,r,o;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(s=Math.atan2(t,this.rc),i=Math.sin(s),n=Math.cos(s),o=as(n*this.sin_p14+e.y*i*this.cos_p14/t),r=Math.atan2(e.x*i,t*this.cos_p14*n-e.y*this.sin_p14*i),r=_t(this.long0+r)):(o=this.phic0,r=0),e.x=r,e.y=o,e}var n3=["gnom"];const s3={init:t3,forward:e3,inverse:i3,names:n3};function r3(e,t){var i=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-i)<1e-6)return t<0?-1*nt:nt;for(var n=Math.asin(.5*t),s,r,o,a,h=0;h<30;h++)if(r=Math.sin(n),o=Math.cos(n),a=e*r,s=Math.pow(1-a*a,2)/(2*o)*(t/(1-e*e)-r/(1-a*a)+.5/e*Math.log((1-a)/(1+a))),n+=s,Math.abs(s)<=1e-10)return n;return NaN}function o3(){this.sphere||(this.k0=ln(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function a3(e){var t=e.x,i=e.y,n,s,r=_t(t-this.long0);if(this.sphere)n=this.x0+this.a*r*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var o=ts(this.e,Math.sin(i));n=this.x0+this.a*this.k0*r,s=this.y0+this.a*o*.5/this.k0}return e.x=n,e.y=s,e}function h3(e){e.x-=this.x0,e.y-=this.y0;var t,i;return this.sphere?(t=_t(this.long0+e.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(i=r3(this.e,2*e.y*this.k0/this.a),t=_t(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=i,e}var l3=["cea"];const c3={init:o3,forward:a3,inverse:h3,names:l3};function u3(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function d3(e){var t=e.x,i=e.y,n=_t(t-this.long0),s=hs(i-this.lat0);return e.x=this.x0+this.a*n*this.rc,e.y=this.y0+this.a*s,e}function f3(e){var t=e.x,i=e.y;return e.x=_t(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=hs(this.lat0+(i-this.y0)/this.a),e}var g3=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"];const m3={init:u3,forward:d3,inverse:f3,names:g3};var dm=20;function p3(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=pa(this.es),this.e1=_a(this.es),this.e2=ya(this.es),this.e3=wa(this.es),this.ml0=this.a*Qe(this.e0,this.e1,this.e2,this.e3,this.lat0)}function _3(e){var t=e.x,i=e.y,n,s,r,o=_t(t-this.long0);if(r=o*Math.sin(i),this.sphere)Math.abs(i)<=ft?(n=this.a*o,s=-1*this.a*this.lat0):(n=this.a*Math.sin(r)/Math.tan(i),s=this.a*(hs(i-this.lat0)+(1-Math.cos(r))/Math.tan(i)));else if(Math.abs(i)<=ft)n=this.a*o,s=-1*this.ml0;else{var a=td(this.a,this.e,Math.sin(i))/Math.tan(i);n=a*Math.sin(r),s=this.a*Qe(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+a*(1-Math.cos(r))}return e.x=n+this.x0,e.y=s+this.y0,e}function y3(e){var t,i,n,s,r,o,a,h,c;if(n=e.x-this.x0,s=e.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=ft)t=_t(n/this.a+this.long0),i=0;else{o=this.lat0+s/this.a,a=n*n/this.a/this.a+o*o,h=o;var u;for(r=dm;r;--r)if(u=Math.tan(h),c=-1*(o*(h*u+1)-h-.5*(h*h+a)*u)/((h-o)/u-1),h+=c,Math.abs(c)<=ft){i=h;break}t=_t(this.long0+Math.asin(n*Math.tan(h)/this.a)/Math.sin(i))}else if(Math.abs(s+this.ml0)<=ft)i=0,t=_t(this.long0+n/this.a);else{o=(this.ml0+s)/this.a,a=n*n/this.a/this.a+o*o,h=o;var m,p,y,w,v;for(r=dm;r;--r)if(v=this.e*Math.sin(h),m=Math.sqrt(1-v*v)*Math.tan(h),p=this.a*Qe(this.e0,this.e1,this.e2,this.e3,h),y=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),w=p/this.a,c=(o*(m*w+1)-w-.5*m*(w*w+a))/(this.es*Math.sin(2*h)*(w*w+a-2*o*w)/(4*m)+(o-w)*(m*y-2/Math.sin(2*h))-y),h-=c,Math.abs(c)<=ft){i=h;break}m=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),t=_t(this.long0+Math.asin(n*m/this.a)/Math.sin(i))}return e.x=t,e.y=i,e}var w3=["Polyconic","American_Polyconic","poly"];const v3={init:p3,forward:_3,inverse:y3,names:w3};function M3(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function I3(e){var t,i=e.x,n=e.y,s=n-this.lat0,r=i-this.long0,o=s/Co*1e-5,a=r,h=1,c=0;for(t=1;t<=10;t++)h=h*o,c=c+this.A[t]*h;var u=c,m=a,p=1,y=0,w,v,I=0,b=0;for(t=1;t<=6;t++)w=p*u-y*m,v=y*u+p*m,p=w,y=v,I=I+this.B_re[t]*p-this.B_im[t]*y,b=b+this.B_im[t]*p+this.B_re[t]*y;return e.x=b*this.a+this.x0,e.y=I*this.a+this.y0,e}function E3(e){var t,i=e.x,n=e.y,s=i-this.x0,r=n-this.y0,o=r/this.a,a=s/this.a,h=1,c=0,u,m,p=0,y=0;for(t=1;t<=6;t++)u=h*o-c*a,m=c*o+h*a,h=u,c=m,p=p+this.C_re[t]*h-this.C_im[t]*c,y=y+this.C_im[t]*h+this.C_re[t]*c;for(var w=0;w<this.iterations;w++){var v=p,I=y,b,T,P=o,G=a;for(t=2;t<=6;t++)b=v*p-I*y,T=I*p+v*y,v=b,I=T,P=P+(t-1)*(this.B_re[t]*v-this.B_im[t]*I),G=G+(t-1)*(this.B_im[t]*v+this.B_re[t]*I);v=1,I=0;var k=this.B_re[1],O=this.B_im[1];for(t=2;t<=6;t++)b=v*p-I*y,T=I*p+v*y,v=b,I=T,k=k+t*(this.B_re[t]*v-this.B_im[t]*I),O=O+t*(this.B_im[t]*v+this.B_re[t]*I);var U=k*k+O*O;p=(P*k+G*O)/U,y=(G*k-P*O)/U}var Y=p,W=y,Q=1,ot=0;for(t=1;t<=9;t++)Q=Q*Y,ot=ot+this.D[t]*Q;var ut=this.lat0+ot*Co*1e5,vt=this.long0+W;return e.x=vt,e.y=ut,e}var C3=["New_Zealand_Map_Grid","nzmg"];const x3={init:M3,forward:I3,inverse:E3,names:C3};function S3(){}function b3(e){var t=e.x,i=e.y,n=_t(t-this.long0),s=this.x0+this.a*n,r=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return e.x=s,e.y=r,e}function A3(e){e.x-=this.x0,e.y-=this.y0;var t=_t(this.long0+e.x/this.a),i=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=i,e}var T3=["Miller_Cylindrical","mill"];const R3={init:S3,forward:b3,inverse:A3,names:T3};var P3=20;function G3(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Hu(this.es)}function L3(e){var t,i,n=e.x,s=e.y;if(n=_t(n-this.long0),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var r=this.n*Math.sin(s),o=P3;o;--o){var a=(this.m*s+Math.sin(s)-r)/(this.m+Math.cos(s));if(s-=a,Math.abs(a)<ft)break}t=this.a*this.C_x*n*(this.m+Math.cos(s)),i=this.a*this.C_y*s}else{var h=Math.sin(s),c=Math.cos(s);i=this.a*Dr(s,h,c,this.en),t=this.a*n*c/Math.sqrt(1-this.es*h*h)}return e.x=t,e.y=i,e}function O3(e){var t,i,n,s;return e.x-=this.x0,n=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,n=n/(this.C_x*(this.m+Math.cos(t))),this.m?t=as((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=as(Math.sin(t)/this.n)),n=_t(n+this.long0),t=hs(t)):(t=Yu(e.y/this.a,this.es,this.en),s=Math.abs(t),s<nt?(s=Math.sin(t),i=this.long0+e.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(t)),n=_t(i)):s-ft<nt&&(n=this.long0)),e.x=n,e.y=t,e}var F3=["Sinusoidal","sinu"];const N3={init:G3,forward:L3,inverse:O3,names:F3};function D3(){}function k3(e){for(var t=e.x,i=e.y,n=_t(t-this.long0),s=i,r=Math.PI*Math.sin(i);;){var o=-(s+Math.sin(s)-r)/(1+Math.cos(s));if(s+=o,Math.abs(o)<ft)break}s/=2,Math.PI/2-Math.abs(i)<ft&&(n=0);var a=.900316316158*this.a*n*Math.cos(s)+this.x0,h=1.4142135623731*this.a*Math.sin(s)+this.y0;return e.x=a,e.y=h,e}function j3(e){var t,i;e.x-=this.x0,e.y-=this.y0,i=e.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),t=Math.asin(i);var n=_t(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),i=(2*t+Math.sin(2*t))/Math.PI,Math.abs(i)>1&&(i=1);var s=Math.asin(i);return e.x=n,e.y=s,e}var B3=["Mollweide","moll"];const V3={init:D3,forward:k3,inverse:j3,names:B3};function W3(){Math.abs(this.lat1+this.lat2)<ft||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=pa(this.es),this.e1=_a(this.es),this.e2=ya(this.es),this.e3=wa(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=ln(this.e,this.sin_phi,this.cos_phi),this.ml1=Qe(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<ft?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=ln(this.e,this.sin_phi,this.cos_phi),this.ml2=Qe(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Qe(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function z3(e){var t=e.x,i=e.y,n;if(this.sphere)n=this.a*(this.g-i);else{var s=Qe(this.e0,this.e1,this.e2,this.e3,i);n=this.a*(this.g-s)}var r=this.ns*_t(t-this.long0),o=this.x0+n*Math.sin(r),a=this.y0+this.rh-n*Math.cos(r);return e.x=o,e.y=a,e}function Z3(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,i,n,s;this.ns>=0?(i=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(i=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var r=0;if(i!==0&&(r=Math.atan2(t*e.x,t*e.y)),this.sphere)return s=_t(this.long0+r/this.ns),n=hs(this.g-i/this.a),e.x=s,e.y=n,e;var o=this.g-i/this.a;return n=Rh(o,this.e0,this.e1,this.e2,this.e3),s=_t(this.long0+r/this.ns),e.x=s,e.y=n,e}var U3=["Equidistant_Conic","eqdc"];const X3={init:W3,forward:z3,inverse:Z3,names:U3};function $3(){this.R=this.a}function H3(e){var t=e.x,i=e.y,n=_t(t-this.long0),s,r;Math.abs(i)<=ft&&(s=this.x0+this.R*n,r=this.y0);var o=as(2*Math.abs(i/Math.PI));(Math.abs(n)<=ft||Math.abs(Math.abs(i)-nt)<=ft)&&(s=this.x0,i>=0?r=this.y0+Math.PI*this.R*Math.tan(.5*o):r=this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/n-n/Math.PI),h=a*a,c=Math.sin(o),u=Math.cos(o),m=u/(c+u-1),p=m*m,y=m*(2/c-1),w=y*y,v=Math.PI*this.R*(a*(m-w)+Math.sqrt(h*(m-w)*(m-w)-(w+h)*(p-w)))/(w+h);n<0&&(v=-v),s=this.x0+v;var I=h+m;return v=Math.PI*this.R*(y*I-a*Math.sqrt((w+h)*(h+1)-I*I))/(w+h),i>=0?r=this.y0+v:r=this.y0-v,e.x=s,e.y=r,e}function Y3(e){var t,i,n,s,r,o,a,h,c,u,m,p,y;return e.x-=this.x0,e.y-=this.y0,m=Math.PI*this.R,n=e.x/m,s=e.y/m,r=n*n+s*s,o=-Math.abs(s)*(1+r),a=o-2*s*s+n*n,h=-2*o+1+2*s*s+r*r,y=s*s/h+(2*a*a*a/h/h/h-9*o*a/h/h)/27,c=(o-a*a/3/h)/h,u=2*Math.sqrt(-c/3),m=3*y/c/u,Math.abs(m)>1&&(m>=0?m=1:m=-1),p=Math.acos(m)/3,e.y>=0?i=(-u*Math.cos(p+Math.PI/3)-a/3/h)*Math.PI:i=-(-u*Math.cos(p+Math.PI/3)-a/3/h)*Math.PI,Math.abs(n)<ft?t=this.long0:t=_t(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(n*n-s*s)+r*r))/2/n),e.x=t,e.y=i,e}var K3=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"];const q3={init:$3,forward:H3,inverse:Y3,names:K3};function J3(e,t,i,n,s,r){const o=n-t,a=Math.atan((1-r)*Math.tan(e)),h=Math.atan((1-r)*Math.tan(i)),c=Math.sin(a),u=Math.cos(a),m=Math.sin(h),p=Math.cos(h);let y=o,w,v=100,I,b,T,P,G,k,O,U,Y,W,Q,ot,ut,vt;do{if(I=Math.sin(y),b=Math.cos(y),T=Math.sqrt(p*I*(p*I)+(u*m-c*p*b)*(u*m-c*p*b)),T===0)return{azi1:0,s12:0};P=c*m+u*p*b,G=Math.atan2(T,P),k=u*p*I/T,O=1-k*k,U=O!==0?P-2*c*m/O:0,Y=r/16*O*(4+r*(4-3*O)),w=y,y=o+(1-Y)*r*k*(G+Y*T*(U+Y*P*(-1+2*U*U)))}while(Math.abs(y-w)>1e-12&&--v>0);return v===0?{azi1:NaN,s12:NaN}:(W=O*(s*s-s*(1-r)*(s*(1-r)))/(s*(1-r)*(s*(1-r))),Q=1+W/16384*(4096+W*(-768+W*(320-175*W))),ot=W/1024*(256+W*(-128+W*(74-47*W))),ut=ot*T*(U+ot/4*(P*(-1+2*U*U)-ot/6*U*(-3+4*T*T)*(-3+4*U*U))),vt=s*(1-r)*Q*(G-ut),{azi1:Math.atan2(p*I,u*m-c*p*b),s12:vt})}function Q3(e,t,i,n,s,r){const o=Math.atan((1-r)*Math.tan(e)),a=Math.sin(o),h=Math.cos(o),c=Math.sin(i),u=Math.cos(i),m=Math.atan2(a,h*u),p=h*c,y=1-p*p,w=y*(s*s-s*(1-r)*(s*(1-r)))/(s*(1-r)*(s*(1-r))),v=1+w/16384*(4096+w*(-768+w*(320-175*w))),I=w/1024*(256+w*(-128+w*(74-47*w)));let b=n/(s*(1-r)*v),T,P=100,G,k,O,U;do G=Math.cos(2*m+b),k=Math.sin(b),O=Math.cos(b),U=I*k*(G+I/4*(O*(-1+2*G*G)-I/6*G*(-3+4*k*k)*(-3+4*G*G))),T=b,b=n/(s*(1-r)*v)+U;while(Math.abs(b-T)>1e-12&&--P>0);if(P===0)return{lat2:NaN,lon2:NaN};const Y=a*k-h*O*u,W=Math.atan2(a*O+h*k*u,(1-r)*Math.sqrt(p*p+Y*Y)),Q=Math.atan2(k*c,h*O-a*k*u),ot=r/16*y*(4+r*(4-3*y)),ut=Q-(1-ot)*r*p*(b+ot*k*(G+ot*O*(-1+2*G*G))),vt=t+ut;return{lat2:W,lon2:vt}}function tG(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))}function eG(e){var t=e.x,i=e.y,n=Math.sin(e.y),s=Math.cos(e.y),r=_t(t-this.long0),o,a,h,c,u,m,p,y,w,v,I;return this.sphere?Math.abs(this.sin_p12-1)<=ft?(e.x=this.x0+this.a*(nt-i)*Math.sin(r),e.y=this.y0-this.a*(nt-i)*Math.cos(r),e):Math.abs(this.sin_p12+1)<=ft?(e.x=this.x0+this.a*(nt+i)*Math.sin(r),e.y=this.y0+this.a*(nt+i)*Math.cos(r),e):(w=this.sin_p12*n+this.cos_p12*s*Math.cos(r),p=Math.acos(w),y=p?p/Math.sin(p):1,e.x=this.x0+this.a*y*s*Math.sin(r),e.y=this.y0+this.a*y*(this.cos_p12*n-this.sin_p12*s*Math.cos(r)),e):(o=pa(this.es),a=_a(this.es),h=ya(this.es),c=wa(this.es),Math.abs(this.sin_p12-1)<=ft?(u=this.a*Qe(o,a,h,c,nt),m=this.a*Qe(o,a,h,c,i),e.x=this.x0+(u-m)*Math.sin(r),e.y=this.y0-(u-m)*Math.cos(r),e):Math.abs(this.sin_p12+1)<=ft?(u=this.a*Qe(o,a,h,c,nt),m=this.a*Qe(o,a,h,c,i),e.x=this.x0+(u+m)*Math.sin(r),e.y=this.y0+(u+m)*Math.cos(r),e):Math.abs(t)<ft&&Math.abs(i-this.lat0)<ft?(e.x=e.y=0,e):(v=J3(this.lat0,this.long0,i,t,this.a,this.f),I=v.azi1,e.x=v.s12*Math.sin(I),e.y=v.s12*Math.cos(I),e))}function iG(e){e.x-=this.x0,e.y-=this.y0;var t,i,n,s,r,o,a,h,c,u,m,p,y,w,v,I;return this.sphere?(t=Math.sqrt(e.x*e.x+e.y*e.y),t>2*nt*this.a?void 0:(i=t/this.a,n=Math.sin(i),s=Math.cos(i),r=this.long0,Math.abs(t)<=ft?o=this.lat0:(o=as(s*this.sin_p12+e.y*n*this.cos_p12/t),a=Math.abs(this.lat0)-nt,Math.abs(a)<=ft?this.lat0>=0?r=_t(this.long0+Math.atan2(e.x,-e.y)):r=_t(this.long0-Math.atan2(-e.x,e.y)):r=_t(this.long0+Math.atan2(e.x*n,t*this.cos_p12*s-e.y*this.sin_p12*n))),e.x=r,e.y=o,e)):(h=pa(this.es),c=_a(this.es),u=ya(this.es),m=wa(this.es),Math.abs(this.sin_p12-1)<=ft?(p=this.a*Qe(h,c,u,m,nt),t=Math.sqrt(e.x*e.x+e.y*e.y),y=p-t,o=Rh(y/this.a,h,c,u,m),r=_t(this.long0+Math.atan2(e.x,-1*e.y)),e.x=r,e.y=o,e):Math.abs(this.sin_p12+1)<=ft?(p=this.a*Qe(h,c,u,m,nt),t=Math.sqrt(e.x*e.x+e.y*e.y),y=t-p,o=Rh(y/this.a,h,c,u,m),r=_t(this.long0+Math.atan2(e.x,e.y)),e.x=r,e.y=o,e):(w=Math.atan2(e.x,e.y),v=Math.sqrt(e.x*e.x+e.y*e.y),I=Q3(this.lat0,this.long0,w,v,this.a,this.f),e.x=I.lon2,e.y=I.lat2,e))}var nG=["Azimuthal_Equidistant","aeqd"];const sG={init:tG,forward:eG,inverse:iG,names:nG};function rG(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function oG(e){var t,i,n,s,r,o,a,h,c=e.x,u=e.y;return n=_t(c-this.long0),t=Math.sin(u),i=Math.cos(u),s=Math.cos(n),o=this.sin_p14*t+this.cos_p14*i*s,r=1,(o>0||Math.abs(o)<=ft)&&(a=this.a*r*i*Math.sin(n),h=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*i*s)),e.x=a,e.y=h,e}function aG(e){var t,i,n,s,r,o,a;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),i=as(t/this.a),n=Math.sin(i),s=Math.cos(i),o=this.long0,Math.abs(t)<=ft?(a=this.lat0,e.x=o,e.y=a,e):(a=as(s*this.sin_p14+e.y*n*this.cos_p14/t),r=Math.abs(this.lat0)-nt,Math.abs(r)<=ft?(this.lat0>=0?o=_t(this.long0+Math.atan2(e.x,-e.y)):o=_t(this.long0-Math.atan2(-e.x,e.y)),e.x=o,e.y=a,e):(o=_t(this.long0+Math.atan2(e.x*n,t*this.cos_p14*s-e.y*this.sin_p14*n)),e.x=o,e.y=a,e))}var hG=["ortho"];const lG={init:rG,forward:oG,inverse:aG,names:hG};var Ie={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},he={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function cG(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=nt-ae/2?this.face=Ie.TOP:this.lat0<=-(nt-ae/2)?this.face=Ie.BOTTOM:Math.abs(this.long0)<=ae?this.face=Ie.FRONT:Math.abs(this.long0)<=nt+ae?this.face=this.long0>0?Ie.RIGHT:Ie.LEFT:this.face=Ie.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function uG(e){var t={x:0,y:0},i,n,s,r,o,a,h={value:0};if(e.x-=this.long0,this.es!==0?i=Math.atan(this.one_minus_f_squared*Math.tan(e.y)):i=e.y,n=e.x,this.face===Ie.TOP)r=nt-i,n>=ae&&n<=nt+ae?(h.value=he.AREA_0,s=n-nt):n>nt+ae||n<=-(nt+ae)?(h.value=he.AREA_1,s=n>0?n-be:n+be):n>-(nt+ae)&&n<=-ae?(h.value=he.AREA_2,s=n+nt):(h.value=he.AREA_3,s=n);else if(this.face===Ie.BOTTOM)r=nt+i,n>=ae&&n<=nt+ae?(h.value=he.AREA_0,s=-n+nt):n<ae&&n>=-ae?(h.value=he.AREA_1,s=-n):n<-ae&&n>=-(nt+ae)?(h.value=he.AREA_2,s=-n-nt):(h.value=he.AREA_3,s=n>0?-n+be:-n-be);else{var c,u,m,p,y,w,v;this.face===Ie.RIGHT?n=gr(n,+nt):this.face===Ie.BACK?n=gr(n,+be):this.face===Ie.LEFT&&(n=gr(n,-nt)),p=Math.sin(i),y=Math.cos(i),w=Math.sin(n),v=Math.cos(n),c=y*v,u=y*w,m=p,this.face===Ie.FRONT?(r=Math.acos(c),s=ka(r,m,u,h)):this.face===Ie.RIGHT?(r=Math.acos(u),s=ka(r,m,-c,h)):this.face===Ie.BACK?(r=Math.acos(-c),s=ka(r,m,-u,h)):this.face===Ie.LEFT?(r=Math.acos(-u),s=ka(r,m,c,h)):(r=s=0,h.value=he.AREA_0)}return a=Math.atan(12/be*(s+Math.acos(Math.sin(s)*Math.cos(ae))-nt)),o=Math.sqrt((1-Math.cos(r))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(s))))),h.value===he.AREA_1?a+=nt:h.value===he.AREA_2?a+=be:h.value===he.AREA_3&&(a+=1.5*be),t.x=o*Math.cos(a),t.y=o*Math.sin(a),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,e.x=t.x,e.y=t.y,e}function dG(e){var t={lam:0,phi:0},i,n,s,r,o,a,h,c,u,m={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,n=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?m.value=he.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(m.value=he.AREA_1,i-=nt):e.x<0&&-e.x>=Math.abs(e.y)?(m.value=he.AREA_2,i=i<0?i+be:i-be):(m.value=he.AREA_3,i+=nt),u=be/12*Math.tan(i),o=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),a=Math.atan(o),s=Math.cos(i),r=Math.tan(n),h=1-s*s*r*r*(1-Math.cos(Math.atan(1/Math.cos(a)))),h<-1?h=-1:h>1&&(h=1),this.face===Ie.TOP)c=Math.acos(h),t.phi=nt-c,m.value===he.AREA_0?t.lam=a+nt:m.value===he.AREA_1?t.lam=a<0?a+be:a-be:m.value===he.AREA_2?t.lam=a-nt:t.lam=a;else if(this.face===Ie.BOTTOM)c=Math.acos(h),t.phi=c-nt,m.value===he.AREA_0?t.lam=-a+nt:m.value===he.AREA_1?t.lam=-a:m.value===he.AREA_2?t.lam=-a-nt:t.lam=a<0?-a-be:-a+be;else{var p,y,w;p=h,u=p*p,u>=1?w=0:w=Math.sqrt(1-u)*Math.sin(a),u+=w*w,u>=1?y=0:y=Math.sqrt(1-u),m.value===he.AREA_1?(u=y,y=-w,w=u):m.value===he.AREA_2?(y=-y,w=-w):m.value===he.AREA_3&&(u=y,y=w,w=-u),this.face===Ie.RIGHT?(u=p,p=-y,y=u):this.face===Ie.BACK?(p=-p,y=-y):this.face===Ie.LEFT&&(u=p,p=y,y=-u),t.phi=Math.acos(-w)-nt,t.lam=Math.atan2(y,p),this.face===Ie.RIGHT?t.lam=gr(t.lam,-nt):this.face===Ie.BACK?t.lam=gr(t.lam,-be):this.face===Ie.LEFT&&(t.lam=gr(t.lam,+nt))}if(this.es!==0){var v,I,b;v=t.phi<0?1:0,I=Math.tan(t.phi),b=this.b/Math.sqrt(I*I+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-b*b)/(this.one_minus_f*b)),v&&(t.phi=-t.phi)}return t.lam+=this.long0,e.x=t.lam,e.y=t.phi,e}function ka(e,t,i,n){var s;return e<ft?(n.value=he.AREA_0,s=0):(s=Math.atan2(t,i),Math.abs(s)<=ae?n.value=he.AREA_0:s>ae&&s<=nt+ae?(n.value=he.AREA_1,s-=nt):s>nt+ae||s<=-(nt+ae)?(n.value=he.AREA_2,s=s>=0?s-be:s+be):(n.value=he.AREA_3,s+=nt)),s}function gr(e,t){var i=e+t;return i<-be?i+=qo:i>+be&&(i-=qo),i}var fG=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const gG={init:cG,forward:uG,inverse:dG,names:fG};var qc=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],vo=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],oy=.8487,ay=1.3523,hy=en/5,mG=1/hy,or=18,Ph=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))},pG=function(e,t){return e[1]+t*(2*e[2]+t*3*e[3])};function _G(e,t,i,n){for(var s=t;n;--n){var r=e(s);if(s-=r,Math.abs(r)<i)break}return s}function yG(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function wG(e){var t=_t(e.x-this.long0),i=Math.abs(e.y),n=Math.floor(i*hy);n<0?n=0:n>=or&&(n=or-1),i=en*(i-mG*n);var s={x:Ph(qc[n],i)*t,y:Ph(vo[n],i)};return e.y<0&&(s.y=-s.y),s.x=s.x*this.a*oy+this.x0,s.y=s.y*this.a*ay+this.y0,s}function vG(e){var t={x:(e.x-this.x0)/(this.a*oy),y:Math.abs(e.y-this.y0)/(this.a*ay)};if(t.y>=1)t.x/=qc[or][0],t.y=e.y<0?-nt:nt;else{var i=Math.floor(t.y*or);for(i<0?i=0:i>=or&&(i=or-1);;)if(vo[i][0]>t.y)--i;else if(vo[i+1][0]<=t.y)++i;else break;var n=vo[i],s=5*(t.y-n[0])/(vo[i+1][0]-n[0]);s=_G(function(r){return(Ph(n,r)-t.y)/pG(n,r)},s,ft,100),t.x/=Ph(qc[i],s),t.y=(5*i+s)*je,e.y<0&&(t.y=-t.y)}return t.x=_t(t.x+this.long0),t}var MG=["Robinson","robin"];const IG={init:yG,forward:wG,inverse:vG,names:MG};function EG(){this.name="geocent"}function CG(e){var t=Y_(e,this.es,this.a);return t}function xG(e){var t=K_(e,this.es,this.a,this.b);return t}var SG=["Geocentric","geocentric","geocent","Geocent"];const bG={init:EG,forward:CG,inverse:xG,names:SG};var Ze={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},io={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function AG(){if(Object.keys(io).forEach((function(i){if(typeof this[i]>"u")this[i]=io[i].def;else{if(io[i].num&&isNaN(this[i]))throw new Error("Invalid parameter value, must be numeric "+i+" = "+this[i]);io[i].num&&(this[i]=parseFloat(this[i]))}io[i].degrees&&(this[i]=this[i]*je)}).bind(this)),Math.abs(Math.abs(this.lat0)-nt)<ft?this.mode=this.lat0<0?Ze.S_POLE:Ze.N_POLE:Math.abs(this.lat0)<ft?this.mode=Ze.EQUIT:(this.mode=Ze.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)}function TG(e){e.x-=this.long0;var t=Math.sin(e.y),i=Math.cos(e.y),n=Math.cos(e.x),s,r;switch(this.mode){case Ze.OBLIQ:r=this.sinph0*t+this.cosph0*i*n;break;case Ze.EQUIT:r=i*n;break;case Ze.S_POLE:r=-t;break;case Ze.N_POLE:r=t;break}switch(r=this.pn1/(this.p-r),s=r*i*Math.sin(e.x),this.mode){case Ze.OBLIQ:r*=this.cosph0*t-this.sinph0*i*n;break;case Ze.EQUIT:r*=t;break;case Ze.N_POLE:r*=-(i*n);break;case Ze.S_POLE:r*=i*n;break}var o,a;return o=r*this.cg+s*this.sg,a=1/(o*this.sw*this.h1+this.cw),s=(s*this.cg-r*this.sg)*this.cw*a,r=o*a,e.x=s*this.a,e.y=r*this.a,e}function RG(e){e.x/=this.a,e.y/=this.a;var t={x:e.x,y:e.y},i,n,s;s=1/(this.pn1-e.y*this.sw),i=this.pn1*e.x*s,n=this.pn1*e.y*this.cw*s,e.x=i*this.cg+n*this.sg,e.y=n*this.cg-i*this.sg;var r=li(e.x,e.y);if(Math.abs(r)<ft)t.x=0,t.y=e.y;else{var o,a;switch(a=1-r*r*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/r+r/this.pn1),o=Math.sqrt(1-a*a),this.mode){case Ze.OBLIQ:t.y=Math.asin(o*this.sinph0+e.y*a*this.cosph0/r),e.y=(o-this.sinph0*Math.sin(t.y))*r,e.x*=a*this.cosph0;break;case Ze.EQUIT:t.y=Math.asin(e.y*a/r),e.y=o*r,e.x*=a;break;case Ze.N_POLE:t.y=Math.asin(o),e.y=-e.y;break;case Ze.S_POLE:t.y=-Math.asin(o);break}t.x=Math.atan2(e.x,e.y)}return e.x=t.x+this.long0,e.y=t.y,e}var PG=["Tilted_Perspective","tpers"];const GG={init:AG,forward:TG,inverse:RG,names:PG};function LG(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var e=1-this.es,t=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function OG(e){var t=e.x,i=e.y,n,s,r,o;if(t=t-this.long0,this.shape==="ellipse"){i=Math.atan(this.radius_p2*Math.tan(i));var a=this.radius_p/li(this.radius_p*Math.cos(i),Math.sin(i));if(s=a*Math.cos(t)*Math.cos(i),r=a*Math.sin(t)*Math.cos(i),o=a*Math.sin(i),(this.radius_g-s)*s-r*r-o*o*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;n=this.radius_g-s,this.flip_axis?(e.x=this.radius_g_1*Math.atan(r/li(o,n)),e.y=this.radius_g_1*Math.atan(o/n)):(e.x=this.radius_g_1*Math.atan(r/n),e.y=this.radius_g_1*Math.atan(o/li(r,n)))}else this.shape==="sphere"&&(n=Math.cos(i),s=Math.cos(t)*n,r=Math.sin(t)*n,o=Math.sin(i),n=this.radius_g-s,this.flip_axis?(e.x=this.radius_g_1*Math.atan(r/li(o,n)),e.y=this.radius_g_1*Math.atan(o/n)):(e.x=this.radius_g_1*Math.atan(r/n),e.y=this.radius_g_1*Math.atan(o/li(r,n))));return e.x=e.x*this.a,e.y=e.y*this.a,e}function FG(e){var t=-1,i=0,n=0,s,r,o,a;if(e.x=e.x/this.a,e.y=e.y/this.a,this.shape==="ellipse"){this.flip_axis?(n=Math.tan(e.y/this.radius_g_1),i=Math.tan(e.x/this.radius_g_1)*li(1,n)):(i=Math.tan(e.x/this.radius_g_1),n=Math.tan(e.y/this.radius_g_1)*li(1,i));var h=n/this.radius_p;if(s=i*i+h*h+t*t,r=2*this.radius_g*t,o=r*r-4*s*this.C,o<0)return e.x=Number.NaN,e.y=Number.NaN,e;a=(-r-Math.sqrt(o))/(2*s),t=this.radius_g+a*t,i*=a,n*=a,e.x=Math.atan2(i,t),e.y=Math.atan(n*Math.cos(e.x)/t),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if(this.shape==="sphere"){if(this.flip_axis?(n=Math.tan(e.y/this.radius_g_1),i=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+n*n)):(i=Math.tan(e.x/this.radius_g_1),n=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+i*i)),s=i*i+n*n+t*t,r=2*this.radius_g*t,o=r*r-4*s*this.C,o<0)return e.x=Number.NaN,e.y=Number.NaN,e;a=(-r-Math.sqrt(o))/(2*s),t=this.radius_g+a*t,i*=a,n*=a,e.x=Math.atan2(i,t),e.y=Math.atan(n*Math.cos(e.x)/t)}return e.x=e.x+this.long0,e}var NG=["Geostationary Satellite View","Geostationary_Satellite","geos"];const DG={init:LG,forward:OG,inverse:FG,names:NG};var xo=1.340264,So=-.081106,bo=893e-6,Ao=.003796,Gh=Math.sqrt(3)/2;function kG(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function jG(e){var t=_t(e.x-this.long0),i=e.y,n=Math.asin(Gh*Math.sin(i)),s=n*n,r=s*s*s;return e.x=t*Math.cos(n)/(Gh*(xo+3*So*s+r*(7*bo+9*Ao*s))),e.y=n*(xo+So*s+r*(bo+Ao*s)),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function BG(e){e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a;var t=1e-9,i=12,n=e.y,s,r,o,a,h,c;for(c=0;c<i&&(s=n*n,r=s*s*s,o=n*(xo+So*s+r*(bo+Ao*s))-e.y,a=xo+3*So*s+r*(7*bo+9*Ao*s),n-=h=o/a,!(Math.abs(h)<t));++c);return s=n*n,r=s*s*s,e.x=Gh*e.x*(xo+3*So*s+r*(7*bo+9*Ao*s))/Math.cos(n),e.y=Math.asin(Math.sin(n)/Gh),e.x=_t(e.x+this.long0),e}var VG=["eqearth","Equal Earth","Equal_Earth"];const WG={init:kG,forward:jG,inverse:BG,names:VG};var ta=1e-10;function zG(){var e;if(this.phi1=this.lat1,Math.abs(this.phi1)<ta)throw new Error;this.es?(this.en=Hu(this.es),this.m1=Dr(this.phi1,this.am1=Math.sin(this.phi1),e=Math.cos(this.phi1),this.en),this.am1=e/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=UG,this.forward=ZG):(Math.abs(this.phi1)+ta>=nt?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=$G,this.forward=XG)}function ZG(e){var t=_t(e.x-(this.long0||0)),i=e.y,n,s,r;return n=this.am1+this.m1-Dr(i,s=Math.sin(i),r=Math.cos(i),this.en),s=r*t/(n*Math.sqrt(1-this.es*s*s)),e.x=n*Math.sin(s),e.y=this.am1-n*Math.cos(s),e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function UG(e){e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a;var t,i,n,s;if(i=li(e.x,e.y=this.am1-e.y),s=Yu(this.am1+this.m1-i,this.es,this.en),(t=Math.abs(s))<nt)t=Math.sin(s),n=i*Math.atan2(e.x,e.y)*Math.sqrt(1-this.es*t*t)/Math.cos(s);else if(Math.abs(t-nt)<=ta)n=0;else throw new Error;return e.x=_t(n+(this.long0||0)),e.y=hs(s),e}function XG(e){var t=_t(e.x-(this.long0||0)),i=e.y,n,s;return s=this.cphi1+this.phi1-i,Math.abs(s)>ta?(e.x=s*Math.sin(n=t*Math.cos(i)/s),e.y=this.cphi1-s*Math.cos(n)):e.x=e.y=0,e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function $G(e){e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a;var t,i,n=li(e.x,e.y=this.cphi1-e.y);if(i=this.cphi1+this.phi1-n,Math.abs(i)>nt)throw new Error;return Math.abs(Math.abs(i)-nt)<=ta?t=0:t=n*Math.atan2(e.x,e.y)/Math.cos(i),e.x=_t(t+(this.long0||0)),e.y=hs(i),e}var HG=["bonne","Bonne (Werner lat_1=90)"];const YG={init:zG,names:HG};function KG(e){e.Proj.projections.add(Ja),e.Proj.projections.add(Qa),e.Proj.projections.add(HP),e.Proj.projections.add(n4),e.Proj.projections.add(h4),e.Proj.projections.add(f4),e.Proj.projections.add(w4),e.Proj.projections.add(C4),e.Proj.projections.add(T4),e.Proj.projections.add(O4),e.Proj.projections.add($4),e.Proj.projections.add(Q4),e.Proj.projections.add(s3),e.Proj.projections.add(c3),e.Proj.projections.add(m3),e.Proj.projections.add(v3),e.Proj.projections.add(x3),e.Proj.projections.add(R3),e.Proj.projections.add(N3),e.Proj.projections.add(V3),e.Proj.projections.add(X3),e.Proj.projections.add(q3),e.Proj.projections.add(sG),e.Proj.projections.add(lG),e.Proj.projections.add(gG),e.Proj.projections.add(IG),e.Proj.projections.add(bG),e.Proj.projections.add(GG),e.Proj.projections.add(DG),e.Proj.projections.add(WG),e.Proj.projections.add(YG)}const pi=Object.assign(uP,{defaultDatum:"WGS84",Proj:ki,WGS84:new ki("WGS84"),Point:br,toPoint:q_,defs:qe,nadgrid:$R,transform:Th,mgrs:dP,version:"__VERSION__"});KG(pi);const ly=["+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","+proj=longlat +datum=WGS84 +no_defs +type=crs","EPSG:4326","WGS84"],cy=["+proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs","EPSG:3857","EPSG:3785","GOOGLE","EPSG:900913","EPSG:102113"],nn={name:"EPSG:4326",definition:ly[0]},Sn={name:"EPSG:3857",definition:cy[0]},qG={internalProjection:Sn,projection:Sn,...r_};({...r_});const uy=pi(nn.definition,Sn.definition);uy.forward;uy.inverse;function fm(e){if(e===void 0)return;const t=ly.indexOf(e),i=cy.indexOf(e);return t!=-1?nn.definition:i!=-1?Sn.definition:e}function gm(e,t){return fm(String(e?.definition))==fm(String(t?.definition))}class ed extends Gu{internalProjection;projection;internalProjectionToProjection;projectionToInternalProjection;lonLatToProjection;projectionToLatLon;constructor(t,i="polynomial",n){const s=U0(qG,n),r=pi(s.internalProjection.definition,s.projection.definition),o=r.forward,a=r.inverse,h=pi(nn.definition,s.projection.definition),c=h.forward,u=h.inverse,m={...n,postToGeo:o,preToResource:a};t=t.map(p=>({resource:p.resource,geo:c(p.geo)})),super(t,i,m),this.internalProjection=s.internalProjection,this.projection=s.projection,this.internalProjectionToProjection=o,this.projectionToInternalProjection=a,this.lonLatToProjection=c,this.projectionToLatLon=u}get interalProjectedGcps(){return this.gcps.map(({resource:t,geo:i})=>({resource:t,geo:this.projectionToInternalProjection(this.lonLatToProjection(i))}))}get projectedGcps(){return this.gcps.map(({resource:t,geo:i})=>({resource:t,geo:this.lonLatToProjection(i)}))}setProjection(t){if(t==this.projection)return this;const i=pi(this.internalProjection.definition,t.definition),n=i.forward,s=i.inverse,r=pi(nn.definition,t.definition),o=r.forward,a=r.inverse,h={postToGeo:n,preToResource:s};return this.setTransformerOptionsInternal(h),this.projection=t,this.internalProjectionToProjection=n,this.projectionToInternalProjection=s,this.lonLatToProjection=o,this.projectionToLatLon=a,this}transformToGeo(t,i,n){const s=i?.projection;let r=i;if(s){const o=pi(this.internalProjection.definition,s.definition),a=o.forward,h=o.inverse;r=Jn(r,{postToGeo:a,preToResource:h})}return super.transformToGeo(t,r,n)}transformToResource(t,i,n){const s=i?.projection;let r=i;if(s){const o=pi(this.internalProjection.definition,s.definition),a=o.forward,h=o.inverse;r=Jn(r,{postToGeo:a,preToResource:h})}return super.transformToResource(t,r,n)}static fromGeoreferencedMap(t,i){const n={transformationType:t.transformation?.type,internalProjection:t.resourceCrs};return i=Ee(n,i),new ed(t.gcps,i.transformationType,i)}}const Xe=11102230246251565e-32,pt=134217729,dy=(3+8*Xe)*Xe;function Te(e,t,i,n,s){let r,o,a,h,c=t[0],u=n[0],m=0,p=0;u>c==u>-c?(r=c,c=t[++m]):(r=u,u=n[++p]);let y=0;if(m<e&&p<i)for(u>c==u>-c?(o=c+r,a=r-(o-c),c=t[++m]):(o=u+r,a=r-(o-u),u=n[++p]),r=o,a!==0&&(s[y++]=a);m<e&&p<i;)u>c==u>-c?(o=r+c,h=o-r,a=r-(o-h)+(c-h),c=t[++m]):(o=r+u,h=o-r,a=r-(o-h)+(u-h),u=n[++p]),r=o,a!==0&&(s[y++]=a);for(;m<e;)o=r+c,h=o-r,a=r-(o-h)+(c-h),c=t[++m],r=o,a!==0&&(s[y++]=a);for(;p<i;)o=r+u,h=o-r,a=r-(o-h)+(u-h),u=n[++p],r=o,a!==0&&(s[y++]=a);return(r!==0||y===0)&&(s[y++]=r),y}function vi(e,t,i,n,s,r,o,a){return Te(Te(e,t,i,n,o),o,s,r,a)}function it(e,t,i,n){let s,r,o,a,h,c,u,m,p,y,w;u=pt*i,y=u-(u-i),w=i-y;let v=t[0];s=v*i,u=pt*v,m=u-(u-v),p=v-m,o=p*w-(s-m*y-p*y-m*w);let I=0;o!==0&&(n[I++]=o);for(let b=1;b<e;b++)v=t[b],a=v*i,u=pt*v,m=u-(u-v),p=v-m,h=p*w-(a-m*y-p*y-m*w),r=s+h,c=r-s,o=s-(r-c)+(h-c),o!==0&&(n[I++]=o),s=a+r,o=r-(s-a),o!==0&&(n[I++]=o);return(s!==0||I===0)&&(n[I++]=s),I}function fy(e,t){let i=t[0];for(let n=1;n<e;n++)i+=t[n];return i}function te(e){return new Float64Array(e)}const JG=(3+16*Xe)*Xe,QG=(2+12*Xe)*Xe,tL=(9+64*Xe)*Xe*Xe,$s=te(4),mm=te(8),pm=te(12),_m=te(16),$e=te(4);function eL(e,t,i,n,s,r,o){let a,h,c,u,m,p,y,w,v,I,b,T,P,G,k,O,U,Y;const W=e-s,Q=i-s,ot=t-r,ut=n-r;G=W*ut,p=pt*W,y=p-(p-W),w=W-y,p=pt*ut,v=p-(p-ut),I=ut-v,k=w*I-(G-y*v-w*v-y*I),O=ot*Q,p=pt*ot,y=p-(p-ot),w=ot-y,p=pt*Q,v=p-(p-Q),I=Q-v,U=w*I-(O-y*v-w*v-y*I),b=k-U,m=k-b,$s[0]=k-(b+m)+(m-U),T=G+b,m=T-G,P=G-(T-m)+(b-m),b=P-O,m=P-b,$s[1]=P-(b+m)+(m-O),Y=T+b,m=Y-T,$s[2]=T-(Y-m)+(b-m),$s[3]=Y;let vt=fy(4,$s),A=QG*o;if(vt>=A||-vt>=A||(m=e-W,a=e-(W+m)+(m-s),m=i-Q,c=i-(Q+m)+(m-s),m=t-ot,h=t-(ot+m)+(m-r),m=n-ut,u=n-(ut+m)+(m-r),a===0&&h===0&&c===0&&u===0)||(A=tL*o+dy*Math.abs(vt),vt+=W*u+ut*a-(ot*c+Q*h),vt>=A||-vt>=A))return vt;G=a*ut,p=pt*a,y=p-(p-a),w=a-y,p=pt*ut,v=p-(p-ut),I=ut-v,k=w*I-(G-y*v-w*v-y*I),O=h*Q,p=pt*h,y=p-(p-h),w=h-y,p=pt*Q,v=p-(p-Q),I=Q-v,U=w*I-(O-y*v-w*v-y*I),b=k-U,m=k-b,$e[0]=k-(b+m)+(m-U),T=G+b,m=T-G,P=G-(T-m)+(b-m),b=P-O,m=P-b,$e[1]=P-(b+m)+(m-O),Y=T+b,m=Y-T,$e[2]=T-(Y-m)+(b-m),$e[3]=Y;const D=Te(4,$s,4,$e,mm);G=W*u,p=pt*W,y=p-(p-W),w=W-y,p=pt*u,v=p-(p-u),I=u-v,k=w*I-(G-y*v-w*v-y*I),O=ot*c,p=pt*ot,y=p-(p-ot),w=ot-y,p=pt*c,v=p-(p-c),I=c-v,U=w*I-(O-y*v-w*v-y*I),b=k-U,m=k-b,$e[0]=k-(b+m)+(m-U),T=G+b,m=T-G,P=G-(T-m)+(b-m),b=P-O,m=P-b,$e[1]=P-(b+m)+(m-O),Y=T+b,m=Y-T,$e[2]=T-(Y-m)+(b-m),$e[3]=Y;const F=Te(D,mm,4,$e,pm);G=a*u,p=pt*a,y=p-(p-a),w=a-y,p=pt*u,v=p-(p-u),I=u-v,k=w*I-(G-y*v-w*v-y*I),O=h*c,p=pt*h,y=p-(p-h),w=h-y,p=pt*c,v=p-(p-c),I=c-v,U=w*I-(O-y*v-w*v-y*I),b=k-U,m=k-b,$e[0]=k-(b+m)+(m-U),T=G+b,m=T-G,P=G-(T-m)+(b-m),b=P-O,m=P-b,$e[1]=P-(b+m)+(m-O),Y=T+b,m=Y-T,$e[2]=T-(Y-m)+(b-m),$e[3]=Y;const Z=Te(F,pm,4,$e,_m);return _m[Z-1]}function sn(e,t,i,n,s,r){const o=(t-r)*(i-s),a=(e-s)*(n-r),h=o-a,c=Math.abs(o+a);return Math.abs(h)>=JG*c?h:-eL(e,t,i,n,s,r,c)}const iL=(10+96*Xe)*Xe,nL=(4+48*Xe)*Xe,sL=(44+576*Xe)*Xe*Xe,Bn=te(4),Vn=te(4),Wn=te(4),Zi=te(4),Ui=te(4),Xi=te(4),He=te(4),Ye=te(4),jl=te(8),Bl=te(8),Vl=te(8),Wl=te(8),zl=te(8),Zl=te(8),ja=te(8),Ba=te(8),Va=te(8),ds=te(4),fs=te(4),gs=te(4),Ct=te(8),Tt=te(16),re=te(16),oe=te(16),ee=te(32),zn=te(32),we=te(48),ni=te(64);let mr=te(1152),Ul=te(1152);function ve(e,t,i){e=Te(e,mr,t,i,Ul);const n=mr;return mr=Ul,Ul=n,e}function rL(e,t,i,n,s,r,o,a,h){let c,u,m,p,y,w,v,I,b,T,P,G,k,O,U,Y,W,Q,ot,ut,vt,A,D,F,Z,H,tt,V,J,B,dt,It,z,bt,Et;const Ot=e-o,Vt=i-o,Wt=s-o,Kt=t-a,Zt=n-a,Ht=r-a;dt=Vt*Ht,D=pt*Vt,F=D-(D-Vt),Z=Vt-F,D=pt*Ht,H=D-(D-Ht),tt=Ht-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=Wt*Zt,D=pt*Wt,F=D-(D-Wt),Z=Wt-F,D=pt*Zt,H=D-(D-Zt),tt=Zt-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It-bt,A=It-V,Bn[0]=It-(V+A)+(A-bt),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B-z,A=B-V,Bn[1]=B-(V+A)+(A-z),Et=J+V,A=Et-J,Bn[2]=J-(Et-A)+(V-A),Bn[3]=Et,dt=Wt*Kt,D=pt*Wt,F=D-(D-Wt),Z=Wt-F,D=pt*Kt,H=D-(D-Kt),tt=Kt-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=Ot*Ht,D=pt*Ot,F=D-(D-Ot),Z=Ot-F,D=pt*Ht,H=D-(D-Ht),tt=Ht-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It-bt,A=It-V,Vn[0]=It-(V+A)+(A-bt),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B-z,A=B-V,Vn[1]=B-(V+A)+(A-z),Et=J+V,A=Et-J,Vn[2]=J-(Et-A)+(V-A),Vn[3]=Et,dt=Ot*Zt,D=pt*Ot,F=D-(D-Ot),Z=Ot-F,D=pt*Zt,H=D-(D-Zt),tt=Zt-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=Vt*Kt,D=pt*Vt,F=D-(D-Vt),Z=Vt-F,D=pt*Kt,H=D-(D-Kt),tt=Kt-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It-bt,A=It-V,Wn[0]=It-(V+A)+(A-bt),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B-z,A=B-V,Wn[1]=B-(V+A)+(A-z),Et=J+V,A=Et-J,Wn[2]=J-(Et-A)+(V-A),Wn[3]=Et,c=Te(Te(Te(it(it(4,Bn,Ot,Ct),Ct,Ot,Tt),Tt,it(it(4,Bn,Kt,Ct),Ct,Kt,re),re,ee),ee,Te(it(it(4,Vn,Vt,Ct),Ct,Vt,Tt),Tt,it(it(4,Vn,Zt,Ct),Ct,Zt,re),re,zn),zn,ni),ni,Te(it(it(4,Wn,Wt,Ct),Ct,Wt,Tt),Tt,it(it(4,Wn,Ht,Ct),Ct,Ht,re),re,ee),ee,mr);let Ne=fy(c,mr),ei=nL*h;if(Ne>=ei||-Ne>=ei||(A=e-Ot,u=e-(Ot+A)+(A-o),A=t-Kt,y=t-(Kt+A)+(A-a),A=i-Vt,m=i-(Vt+A)+(A-o),A=n-Zt,w=n-(Zt+A)+(A-a),A=s-Wt,p=s-(Wt+A)+(A-o),A=r-Ht,v=r-(Ht+A)+(A-a),u===0&&m===0&&p===0&&y===0&&w===0&&v===0)||(ei=sL*h+dy*Math.abs(Ne),Ne+=(Ot*Ot+Kt*Kt)*(Vt*v+Ht*m-(Zt*p+Wt*w))+2*(Ot*u+Kt*y)*(Vt*Ht-Zt*Wt)+((Vt*Vt+Zt*Zt)*(Wt*y+Kt*p-(Ht*u+Ot*v))+2*(Vt*m+Zt*w)*(Wt*Kt-Ht*Ot))+((Wt*Wt+Ht*Ht)*(Ot*w+Zt*u-(Kt*m+Vt*y))+2*(Wt*p+Ht*v)*(Ot*Zt-Kt*Vt)),Ne>=ei||-Ne>=ei))return Ne;if((m!==0||w!==0||p!==0||v!==0)&&(dt=Ot*Ot,D=pt*Ot,F=D-(D-Ot),Z=Ot-F,It=Z*Z-(dt-F*F-(F+F)*Z),z=Kt*Kt,D=pt*Kt,F=D-(D-Kt),Z=Kt-F,bt=Z*Z-(z-F*F-(F+F)*Z),V=It+bt,A=V-It,Zi[0]=It-(V-A)+(bt-A),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B+z,A=V-B,Zi[1]=B-(V-A)+(z-A),Et=J+V,A=Et-J,Zi[2]=J-(Et-A)+(V-A),Zi[3]=Et),(p!==0||v!==0||u!==0||y!==0)&&(dt=Vt*Vt,D=pt*Vt,F=D-(D-Vt),Z=Vt-F,It=Z*Z-(dt-F*F-(F+F)*Z),z=Zt*Zt,D=pt*Zt,F=D-(D-Zt),Z=Zt-F,bt=Z*Z-(z-F*F-(F+F)*Z),V=It+bt,A=V-It,Ui[0]=It-(V-A)+(bt-A),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B+z,A=V-B,Ui[1]=B-(V-A)+(z-A),Et=J+V,A=Et-J,Ui[2]=J-(Et-A)+(V-A),Ui[3]=Et),(u!==0||y!==0||m!==0||w!==0)&&(dt=Wt*Wt,D=pt*Wt,F=D-(D-Wt),Z=Wt-F,It=Z*Z-(dt-F*F-(F+F)*Z),z=Ht*Ht,D=pt*Ht,F=D-(D-Ht),Z=Ht-F,bt=Z*Z-(z-F*F-(F+F)*Z),V=It+bt,A=V-It,Xi[0]=It-(V-A)+(bt-A),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B+z,A=V-B,Xi[1]=B-(V-A)+(z-A),Et=J+V,A=Et-J,Xi[2]=J-(Et-A)+(V-A),Xi[3]=Et),u!==0&&(I=it(4,Bn,u,jl),c=ve(c,vi(it(I,jl,2*Ot,Tt),Tt,it(it(4,Xi,u,Ct),Ct,Zt,re),re,it(it(4,Ui,u,Ct),Ct,-Ht,oe),oe,ee,we),we)),y!==0&&(b=it(4,Bn,y,Bl),c=ve(c,vi(it(b,Bl,2*Kt,Tt),Tt,it(it(4,Ui,y,Ct),Ct,Wt,re),re,it(it(4,Xi,y,Ct),Ct,-Vt,oe),oe,ee,we),we)),m!==0&&(T=it(4,Vn,m,Vl),c=ve(c,vi(it(T,Vl,2*Vt,Tt),Tt,it(it(4,Zi,m,Ct),Ct,Ht,re),re,it(it(4,Xi,m,Ct),Ct,-Kt,oe),oe,ee,we),we)),w!==0&&(P=it(4,Vn,w,Wl),c=ve(c,vi(it(P,Wl,2*Zt,Tt),Tt,it(it(4,Xi,w,Ct),Ct,Ot,re),re,it(it(4,Zi,w,Ct),Ct,-Wt,oe),oe,ee,we),we)),p!==0&&(G=it(4,Wn,p,zl),c=ve(c,vi(it(G,zl,2*Wt,Tt),Tt,it(it(4,Ui,p,Ct),Ct,Kt,re),re,it(it(4,Zi,p,Ct),Ct,-Zt,oe),oe,ee,we),we)),v!==0&&(k=it(4,Wn,v,Zl),c=ve(c,vi(it(k,Zl,2*Ht,Tt),Tt,it(it(4,Zi,v,Ct),Ct,Vt,re),re,it(it(4,Ui,v,Ct),Ct,-Ot,oe),oe,ee,we),we)),u!==0||y!==0){if(m!==0||w!==0||p!==0||v!==0?(dt=m*Ht,D=pt*m,F=D-(D-m),Z=m-F,D=pt*Ht,H=D-(D-Ht),tt=Ht-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=Vt*v,D=pt*Vt,F=D-(D-Vt),Z=Vt-F,D=pt*v,H=D-(D-v),tt=v-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It+bt,A=V-It,He[0]=It-(V-A)+(bt-A),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B+z,A=V-B,He[1]=B-(V-A)+(z-A),Et=J+V,A=Et-J,He[2]=J-(Et-A)+(V-A),He[3]=Et,dt=p*-Zt,D=pt*p,F=D-(D-p),Z=p-F,D=pt*-Zt,H=D-(D- -Zt),tt=-Zt-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=Wt*-w,D=pt*Wt,F=D-(D-Wt),Z=Wt-F,D=pt*-w,H=D-(D- -w),tt=-w-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It+bt,A=V-It,Ye[0]=It-(V-A)+(bt-A),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B+z,A=V-B,Ye[1]=B-(V-A)+(z-A),Et=J+V,A=Et-J,Ye[2]=J-(Et-A)+(V-A),Ye[3]=Et,U=Te(4,He,4,Ye,Ba),dt=m*v,D=pt*m,F=D-(D-m),Z=m-F,D=pt*v,H=D-(D-v),tt=v-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=p*w,D=pt*p,F=D-(D-p),Z=p-F,D=pt*w,H=D-(D-w),tt=w-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It-bt,A=It-V,fs[0]=It-(V+A)+(A-bt),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B-z,A=B-V,fs[1]=B-(V+A)+(A-z),Et=J+V,A=Et-J,fs[2]=J-(Et-A)+(V-A),fs[3]=Et,Q=4):(Ba[0]=0,U=1,fs[0]=0,Q=1),u!==0){const xe=it(U,Ba,u,oe);c=ve(c,Te(it(I,jl,u,Tt),Tt,it(xe,oe,2*Ot,ee),ee,we),we);const Se=it(Q,fs,u,Ct);c=ve(c,vi(it(Se,Ct,2*Ot,Tt),Tt,it(Se,Ct,u,re),re,it(xe,oe,u,ee),ee,zn,ni),ni),w!==0&&(c=ve(c,it(it(4,Xi,u,Ct),Ct,w,Tt),Tt)),v!==0&&(c=ve(c,it(it(4,Ui,-u,Ct),Ct,v,Tt),Tt))}if(y!==0){const xe=it(U,Ba,y,oe);c=ve(c,Te(it(b,Bl,y,Tt),Tt,it(xe,oe,2*Kt,ee),ee,we),we);const Se=it(Q,fs,y,Ct);c=ve(c,vi(it(Se,Ct,2*Kt,Tt),Tt,it(Se,Ct,y,re),re,it(xe,oe,y,ee),ee,zn,ni),ni)}}if(m!==0||w!==0){if(p!==0||v!==0||u!==0||y!==0?(dt=p*Kt,D=pt*p,F=D-(D-p),Z=p-F,D=pt*Kt,H=D-(D-Kt),tt=Kt-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=Wt*y,D=pt*Wt,F=D-(D-Wt),Z=Wt-F,D=pt*y,H=D-(D-y),tt=y-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It+bt,A=V-It,He[0]=It-(V-A)+(bt-A),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B+z,A=V-B,He[1]=B-(V-A)+(z-A),Et=J+V,A=Et-J,He[2]=J-(Et-A)+(V-A),He[3]=Et,ut=-Ht,vt=-v,dt=u*ut,D=pt*u,F=D-(D-u),Z=u-F,D=pt*ut,H=D-(D-ut),tt=ut-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=Ot*vt,D=pt*Ot,F=D-(D-Ot),Z=Ot-F,D=pt*vt,H=D-(D-vt),tt=vt-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It+bt,A=V-It,Ye[0]=It-(V-A)+(bt-A),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B+z,A=V-B,Ye[1]=B-(V-A)+(z-A),Et=J+V,A=Et-J,Ye[2]=J-(Et-A)+(V-A),Ye[3]=Et,Y=Te(4,He,4,Ye,Va),dt=p*y,D=pt*p,F=D-(D-p),Z=p-F,D=pt*y,H=D-(D-y),tt=y-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=u*v,D=pt*u,F=D-(D-u),Z=u-F,D=pt*v,H=D-(D-v),tt=v-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It-bt,A=It-V,gs[0]=It-(V+A)+(A-bt),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B-z,A=B-V,gs[1]=B-(V+A)+(A-z),Et=J+V,A=Et-J,gs[2]=J-(Et-A)+(V-A),gs[3]=Et,ot=4):(Va[0]=0,Y=1,gs[0]=0,ot=1),m!==0){const xe=it(Y,Va,m,oe);c=ve(c,Te(it(T,Vl,m,Tt),Tt,it(xe,oe,2*Vt,ee),ee,we),we);const Se=it(ot,gs,m,Ct);c=ve(c,vi(it(Se,Ct,2*Vt,Tt),Tt,it(Se,Ct,m,re),re,it(xe,oe,m,ee),ee,zn,ni),ni),v!==0&&(c=ve(c,it(it(4,Zi,m,Ct),Ct,v,Tt),Tt)),y!==0&&(c=ve(c,it(it(4,Xi,-m,Ct),Ct,y,Tt),Tt))}if(w!==0){const xe=it(Y,Va,w,oe);c=ve(c,Te(it(P,Wl,w,Tt),Tt,it(xe,oe,2*Zt,ee),ee,we),we);const Se=it(ot,gs,w,Ct);c=ve(c,vi(it(Se,Ct,2*Zt,Tt),Tt,it(Se,Ct,w,re),re,it(xe,oe,w,ee),ee,zn,ni),ni)}}if(p!==0||v!==0){if(u!==0||y!==0||m!==0||w!==0?(dt=u*Zt,D=pt*u,F=D-(D-u),Z=u-F,D=pt*Zt,H=D-(D-Zt),tt=Zt-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=Ot*w,D=pt*Ot,F=D-(D-Ot),Z=Ot-F,D=pt*w,H=D-(D-w),tt=w-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It+bt,A=V-It,He[0]=It-(V-A)+(bt-A),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B+z,A=V-B,He[1]=B-(V-A)+(z-A),Et=J+V,A=Et-J,He[2]=J-(Et-A)+(V-A),He[3]=Et,ut=-Kt,vt=-y,dt=m*ut,D=pt*m,F=D-(D-m),Z=m-F,D=pt*ut,H=D-(D-ut),tt=ut-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=Vt*vt,D=pt*Vt,F=D-(D-Vt),Z=Vt-F,D=pt*vt,H=D-(D-vt),tt=vt-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It+bt,A=V-It,Ye[0]=It-(V-A)+(bt-A),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B+z,A=V-B,Ye[1]=B-(V-A)+(z-A),Et=J+V,A=Et-J,Ye[2]=J-(Et-A)+(V-A),Ye[3]=Et,O=Te(4,He,4,Ye,ja),dt=u*w,D=pt*u,F=D-(D-u),Z=u-F,D=pt*w,H=D-(D-w),tt=w-H,It=Z*tt-(dt-F*H-Z*H-F*tt),z=m*y,D=pt*m,F=D-(D-m),Z=m-F,D=pt*y,H=D-(D-y),tt=y-H,bt=Z*tt-(z-F*H-Z*H-F*tt),V=It-bt,A=It-V,ds[0]=It-(V+A)+(A-bt),J=dt+V,A=J-dt,B=dt-(J-A)+(V-A),V=B-z,A=B-V,ds[1]=B-(V+A)+(A-z),Et=J+V,A=Et-J,ds[2]=J-(Et-A)+(V-A),ds[3]=Et,W=4):(ja[0]=0,O=1,ds[0]=0,W=1),p!==0){const xe=it(O,ja,p,oe);c=ve(c,Te(it(G,zl,p,Tt),Tt,it(xe,oe,2*Wt,ee),ee,we),we);const Se=it(W,ds,p,Ct);c=ve(c,vi(it(Se,Ct,2*Wt,Tt),Tt,it(Se,Ct,p,re),re,it(xe,oe,p,ee),ee,zn,ni),ni),y!==0&&(c=ve(c,it(it(4,Ui,p,Ct),Ct,y,Tt),Tt)),w!==0&&(c=ve(c,it(it(4,Zi,-p,Ct),Ct,w,Tt),Tt))}if(v!==0){const xe=it(O,ja,v,oe);c=ve(c,Te(it(k,Zl,v,Tt),Tt,it(xe,oe,2*Ht,ee),ee,we),we);const Se=it(W,ds,v,Ct);c=ve(c,vi(it(Se,Ct,2*Ht,Tt),Tt,it(Se,Ct,v,re),re,it(xe,oe,v,ee),ee,zn,ni),ni)}}return mr[c-1]}function oL(e,t,i,n,s,r,o,a){const h=e-o,c=i-o,u=s-o,m=t-a,p=n-a,y=r-a,w=c*y,v=u*p,I=h*h+m*m,b=u*m,T=h*y,P=c*c+p*p,G=h*p,k=c*m,O=u*u+y*y,U=I*(w-v)+P*(b-T)+O*(G-k),Y=(Math.abs(w)+Math.abs(v))*I+(Math.abs(b)+Math.abs(T))*P+(Math.abs(G)+Math.abs(k))*O,W=iL*Y;return U>W||-U>W?U:rL(e,t,i,n,s,r,o,a,Y)}function gy(e,t){var i,n,s=0,r,o,a,h,c,u,m,p=e[0],y=e[1],w=t.length;for(i=0;i<w;i++){n=0;var v=t[i],I=v.length-1;if(u=v[0],u[0]!==v[I][0]&&u[1]!==v[I][1])throw new Error("First and last coordinates in a ring must be the same");for(o=u[0]-p,a=u[1]-y,n;n<I;n++){if(m=v[n+1],h=m[0]-p,c=m[1]-y,a===0&&c===0){if(h<=0&&o>=0||o<=0&&h>=0)return 0}else if(c>=0&&a<=0||c<=0&&a>=0){if(r=sn(o,h,a,c,0,0),r===0)return 0;(r>0&&c>0&&a<=0||r<0&&c<=0&&a>0)&&s++}u=m,a=c,o=h}}return s%2!==0}const aL=!0;class hL{rbush=new jh;polygonsById=new Map;bboxesById=new Map;itemsById=new Map;addItem(t,i){this.removeItem(t);const n=Fe(i),s={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3],id:t};this.polygonsById.set(t,i),this.bboxesById.set(t,n),this.itemsById.set(t,s),this.rbush.insert(s)}removeItem(t){const i=this.itemsById.get(t);i&&(this.rbush.remove(i),this.polygonsById.delete(t),this.bboxesById.delete(t),this.itemsById.delete(t))}clear(){this.polygonsById.clear(),this.bboxesById.clear(),this.itemsById.clear(),this.rbush.clear()}search(t,i,n,s){return this.rbush.search({minX:t,minY:i,maxX:n,maxY:s})}getBbox(t){return this.bboxesById.get(t)}getPolygon(t){return this.polygonsById.get(t)}searchFromBbox(t){const[i,n,s,r]=t;return this.search(i,n,s,r).map(o=>o.id)}searchFromPoint(t,i=aL){const[n,s,r,o]=[t[0],t[1],t[0],t[1]],a=this.search(n,s,r,o);return i?a.filter(h=>{const c=this.polygonsById.get(h.id);return c?gy(t,c):!1}).map(h=>h.id):a.map(h=>h.id)}}const lL={onlyVisible:!0},cL={createRTree:!0,imageInformations:new Map};class uL extends EventTarget{warpedMapFactory;warpedMapsById;zIndices;rtree;partialWarpedMapListOptions;constructor(t,i){super(),this.warpedMapsById=new Map,this.zIndices=new Map,this.warpedMapFactory=t,this.partialWarpedMapListOptions=Jn(cL,i),this.partialWarpedMapListOptions.createRTree&&(this.rtree=new hL)}getMapIds(t){return Array.from(this.getWarpedMaps(t)).map(i=>i.mapId)}getWarpedMaps(t){const i=Ee(lL,t);let n;i.mapIds===void 0?this.rtree&&i.geoBbox?n=this.rtree.searchFromBbox(i.geoBbox):n=Array.from(this.warpedMapsById.keys()):n=i.mapIds;const s=[];if(n===void 0)return s;for(const r of n){const o=this.warpedMapsById.get(r);o&&(!i.onlyVisible||o.visible)&&s.push(o)}return s}getWarpedMap(t){return this.warpedMapsById.get(t)}getMapZIndex(t){return this.zIndices.get(t)}getMapsCenter(t){const i=this.getMapsBbox(t);if(i)return xs(i)}getMapsBbox(t){const i=this.getProjectedGeoMaskPoints(t);return Fe(i)}getMapsConvexHull(t){const i=this.getProjectedGeoMaskPoints(t);return nb(i)}setOptions(t){this.partialWarpedMapListOptions=Ee(this.partialWarpedMapListOptions,t),this.dispatchEvent(new Rt(st.OPTIONSCHANGED,this.getMapIds()))}setImageInformations(t){this.partialWarpedMapListOptions.imageInformations=t}setMapGcps(t,i){const n=this.warpedMapsById.get(i);n&&(n.setGcps(t),this.addToOrUpdateRtree(n),this.dispatchEvent(new Rt(st.GCPSCHANGED,i)))}setMapResourceMask(t,i){const n=this.warpedMapsById.get(i);n&&(n.setResourceMask(t),this.addToOrUpdateRtree(n),this.dispatchEvent(new Rt(st.RESOURCEMASKCHANGED,i)))}setMapTransformationType(t,i){this.setMapsTransformationType(t,{mapIds:[i]})}setMapsTransformationType(t,i){const n=[],s=this.getWarpedMaps(i);for(const r of s)r.transformationType!==t&&n.push(r.mapId);n.length>0&&(this.dispatchEvent(new Rt(st.PRECHANGE,n)),n.forEach(r=>{const o=this.warpedMapsById.get(r);o&&(o.setTransformationType(t),this.addToOrUpdateRtree(o))}),this.dispatchEvent(new Rt(st.TRANSFORMATIONCHANGED,n)))}setMapDistortionMeasure(t,i){this.setMapsDistortionMeasure(t,{mapIds:[i]})}setMapsDistortionMeasure(t,i){const n=[],s=this.getWarpedMaps(i);for(const r of s)r.distortionMeasure!==t&&n.push(r.mapId);n.length>0&&(this.dispatchEvent(new Rt(st.PRECHANGE,n)),n.forEach(r=>{const o=this.warpedMapsById.get(r);o&&o.setDistortionMeasure(t)}),this.dispatchEvent(new Rt(st.DISTORTIONCHANGED,n)))}setMapInternalProjection(t,i){this.setMapsInternalProjection(t,{mapIds:[i]})}setMapsInternalProjection(t,i){const n=[],s=this.getWarpedMaps(i);for(const r of s)gm(r.internalProjection,t)||n.push(r.mapId);n.length>0&&(this.dispatchEvent(new Rt(st.PRECHANGE,n)),n.forEach(r=>{const o=this.warpedMapsById.get(r);o&&(o.setInternalProjection(t),this.addToOrUpdateRtree(o))}),this.dispatchEvent(new Rt(st.INTERNALPROJECTIONCHANGED,n)))}setMapProjection(t,i){this.setMapsProjection(t,{mapIds:[i]})}setMapsProjection(t,i){const n=[],s=this.getWarpedMaps(i);for(const r of s)gm(r.projection,t)||n.push(r.mapId);n.length>0&&(this.dispatchEvent(new Rt(st.PRECHANGE,n)),n.forEach(r=>{const o=this.warpedMapsById.get(r);o&&(o.setProjection(t),this.addToOrUpdateRtree(o))}),this.dispatchEvent(new Rt(st.PROJECTIONCHANGED,n)))}removeGeoreferencedMapById(t){const i=this.warpedMapsById.get(t);i&&(this.removeGeoreferencedMap(i),this.removeFromRtree(i),this.dispatchEvent(new Rt(st.WARPEDMAPREMOVED,t)))}bringMapsToFront(t){let i=this.warpedMapsById.size;for(const n of t)this.zIndices.has(n)&&(this.zIndices.set(n,i),i++);this.removeZIndexHoles(),this.dispatchEvent(new Rt(st.ZINDICESCHANGED))}sendMapsToBack(t){let i=-Array.from(t).length;for(const n of t)this.zIndices.has(n)&&(this.zIndices.set(n,i),i++);this.removeZIndexHoles(),this.dispatchEvent(new Rt(st.ZINDICESCHANGED))}bringMapsForward(t){for(const[i,n]of this.zIndices.entries())this.zIndices.set(i,n*2);for(const i of t){const n=this.zIndices.get(i);n!==void 0&&this.zIndices.set(i,n+3)}this.removeZIndexHoles(),this.dispatchEvent(new Rt(st.ZINDICESCHANGED))}sendMapsBackward(t){for(const[i,n]of this.zIndices.entries())this.zIndices.set(i,n*2);for(const i of t){const n=this.zIndices.get(i);n!==void 0&&this.zIndices.set(i,n-3)}this.removeZIndexHoles(),this.dispatchEvent(new Rt(st.ZINDICESCHANGED))}showMaps(t){for(const i of t){const n=this.warpedMapsById.get(i);n&&(n.visible=!0)}this.dispatchEvent(new Rt(st.VISIBILITYCHANGED,t))}hideMaps(t){for(const i of t){const n=this.warpedMapsById.get(i);n&&(n.visible=!1)}this.dispatchEvent(new Rt(st.VISIBILITYCHANGED,t))}async addGeoreferencedMap(t){const i=Xg(t),n=Array.isArray(i)?i[0]:i;return this.addGeoreferencedMapInternal(n)}async removeGeoreferencedMap(t){const i=Xg(t),n=Array.isArray(i)?i[0]:i;return this.removeGeoreferencedMapInternal(n)}async addGeoreferenceAnnotation(t){const i=[],n=zc(t),s=await Promise.allSettled(n.map(r=>this.addGeoreferencedMapInternal(r)));for(const r of s)r.status==="fulfilled"?i.push(r.value):i.push(r.reason);return this.dispatchEvent(new Rt(st.GEOREFERENCEANNOTATIONADDED)),this.dispatchEvent(new Rt(st.ZINDICESCHANGED)),i}async removeGeoreferenceAnnotation(t){const i=[],n=zc(t);for(const s of n){const r=await this.removeGeoreferencedMapInternal(s);i.push(r)}return this.dispatchEvent(new Rt(st.GEOREFERENCEANNOTATIONREMOVED)),i}clear(){this.warpedMapsById=new Map,this.zIndices=new Map,this.rtree?.clear(),this.dispatchEvent(new Rt(st.CLEARED))}destroy(){for(const t of this.getWarpedMaps())this.removeEventListenersFromWarpedMap(t),t.destroy();this.clear()}async addGeoreferencedMapInternal(t){const i=await this.getOrComputeMapId(t),n=this.warpedMapFactory(i,t,this.partialWarpedMapListOptions);return this.warpedMapsById.set(i,n),this.zIndices.set(i,this.warpedMapsById.size-1),this.addToOrUpdateRtree(n),this.addEventListenersToWarpedMap(n),this.dispatchEvent(new Rt(st.WARPEDMAPADDED,i)),i}async removeGeoreferencedMapInternal(t){const i=await this.getOrComputeMapId(t),n=this.warpedMapsById.get(i);if(n)this.warpedMapsById.delete(i),this.zIndices.delete(i),this.removeFromRtree(n),this.dispatchEvent(new Rt(st.WARPEDMAPREMOVED,i)),this.removeZIndexHoles(),this.dispatchEvent(new Rt(st.ZINDICESCHANGED)),n.destroy();else throw new Error(`No map found with ID ${i}`);return i}async getOrComputeMapId(t){return t.id||await BA(t)}getProjectedGeoMaskPoints(t){const i=this.getWarpedMaps(t),n=t?.projection;if(n){const s=[];for(const o of i)s.push(...o.geoMask);return s.map(o=>pi(n.definition,o))}else{const s=[];for(const r of i)s.push(...r.projectedGeoMask);return s}}addToOrUpdateRtree(t){this.rtree&&(this.rtree.removeItem(t.mapId),this.rtree.addItem(t.mapId,[t.geoMask]))}removeFromRtree(t){this.rtree&&this.rtree.removeItem(t.mapId)}removeZIndexHoles(){const t=[...this.zIndices.entries()].sort((n,s)=>n[1]-s[1]);let i=0;for(const n of t){const s=n[0];this.zIndices.set(s,i),i++}}imageInfoLoaded(){this.dispatchEvent(new Rt(st.IMAGEINFOLOADED))}addEventListenersToWarpedMap(t){t.addEventListener(st.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}removeEventListenersFromWarpedMap(t){t.removeEventListener(st.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}}class ym{mapId;tile;imageRequest;tileUrl;tileKey;fetchableTileKey;constructor(t,i){this.mapId=i.mapId,this.tile=t;const n=i.parsedImage.getTileImageRequest(t.tileZoomLevel,t.column,t.row);this.imageRequest=n,this.tileUrl=i.parsedImage.getImageUrl(n),this.tileKey=Pc(t),this.fetchableTileKey=PA(this)}}const dL={},wm=0,fL=2,gL=4,vm=10,mL=0,pL=.4,_L=1024*1024,yL=10,wL=100;class vL extends EventTarget{partialBaseRendererOptions;warpedMapList;tileCache;mapsInPreviousViewport=new Set;mapsInViewport=new Set;mapsWithRequestedTilesForViewport=new Set;viewport;constructor(t,i,n){super(),this.partialBaseRendererOptions=Ee(dL,n),this.tileCache=new DA(t,n),this.warpedMapList=new uL(i,n)}async addGeoreferenceAnnotation(t){return this.warpedMapList.addGeoreferenceAnnotation(t)}async addGeoreferencedMap(t){return this.warpedMapList.addGeoreferencedMap(t)}setOptions(t){this.partialBaseRendererOptions=Ee(this.partialBaseRendererOptions,t),this.tileCache.setOptions(t),this.warpedMapList.setOptions(t)}loadMissingImageInfosInViewport(){return this.viewport?Array.from(this.warpedMapList.getWarpedMaps({geoBbox:this.viewport.geoRectangleBbox})).filter(t=>!t.hasImageInfo()&&!t.loadingImageInfo).map(t=>t.loadImageInfo()):[]}someImageInfosInViewport(){return this.viewport?Array.from(this.findMapsInViewport(this.shouldAnticipateInteraction()?vm:0)).map(t=>this.warpedMapList.getWarpedMap(t)).map(t=>t.hasImageInfo()).some(Boolean):!1}shouldRequestFetchableTiles(){return!0}shouldAnticipateInteraction(){return!1}assureProjection(){this.viewport&&(this.warpedMapList.partialWarpedMapListOptions.projection=this.viewport.projection,this.warpedMapList.setMapsProjection(this.viewport.projection,{onlyVisible:!1}))}requestFetchableTiles(){if(!this.shouldRequestFetchableTiles())return;const t=[],i=[],n=this.findMapsInViewport(this.shouldAnticipateInteraction()?wm:0),s=this.findMapsInViewport(this.shouldAnticipateInteraction()?fL:0),r=this.findMapsInViewport(this.shouldAnticipateInteraction()?gL:0),o=this.findMapsInViewport(this.shouldAnticipateInteraction()?vm:0);for(const a of this.warpedMapList.getWarpedMaps())a.resetForViewport();for(const a of r)t.push(...this.getMapFetchableTilesForViewport(a,n));if(this.shouldAnticipateInteraction())for(const a of o)i.push(...this.getMapOverviewFetchableTilesForViewport(a,[...t,...i],s));this.tileCache.requestFetchableTiles([...t,...i]),this.updateMapsForViewport([...t,...i]),this.pruneTileCache(o)}findMapsInViewport(t=0){if(!this.viewport)return new Set;const i=this.viewport,n=this.viewport.getProjectedGeoBufferedRectangle(t),s=Fe(n.map(r=>pi(i.projection.definition,nn.definition,r)));return new Set(Array.from(this.warpedMapList.getWarpedMaps({geoBbox:s})).sort((r,o)=>r&&o?an(xs(r.projectedGeoMaskBbox),i.projectedGeoCenter)-an(xs(o.projectedGeoMaskBbox),i.projectedGeoCenter):0).map(r=>r.mapId))}getMapFetchableTilesForViewport(t,i){if(!this.viewport)return[];const n=this.viewport,s=this.warpedMapList.getWarpedMap(t);if(!s)return[];if(!s.visible)return[];if(!s.hasImageInfo())return[];const r=_A(s.parsedImage.tileZoomLevels,s.getResourceToCanvasScale(n),mL,pL);s.setTileZoomLevelForViewport(r);const o={maxDepth:0,sourceIsGeographic:!1,destinationIsGeographic:!0},a=n.getProjectedGeoBufferedRectangle(this.shouldAnticipateInteraction()?wm:0),c=(s.transformationType==="thinPlateSpline"&&s.gcps.length>wL?s.getProjectedTransformer("polynomial"):s.projectedTransformer).transformToResource([a],o)[0];if(s.setProjectedGeoBufferedViewportRectangleForViewport(a),s.setResourceBufferedViewportRingForViewport(c),!s.resourceBufferedViewportRingBboxForViewport||!s.resourceBufferedViewportRingBboxForViewport)throw new Error("No resourceBufferedViewportRingBboxForViewport or resourceBufferedViewportRingBboxForViewport");const u=eb(s.resourceBufferedViewportRingBboxForViewport,s.resourceMaskBbox);if(s.setResourceBufferedViewportRingBboxAndResourceMaskBboxIntersectionForViewport(u),!i.has(t))return[];if(!u)return[];const m=yA(En(u),r,[s.parsedImage.width,s.parsedImage.height]),p=xs(s.resourceBufferedViewportRingBboxForViewport);m.sort((w,v)=>Ag(w,p)-Ag(v,p));const y=m.map(w=>new ym(w,s));return s.setFetchableTilesForViewport(y),y}getMapOverviewFetchableTilesForViewport(t,i,n){if(!this.viewport)return[];const s=this.warpedMapList.getWarpedMap(t);if(!s)return[];if(!s.visible)return[];if(!s.hasImageInfo())return[];const r=bA(i.map(u=>u.tile)),o=this.viewport.canvasResolution*yL;if(r>o)return[];const a=s.parsedImage.tileZoomLevels.filter(u=>AA(u)<=_L).sort((u,m)=>u.scaleFactor-m.scaleFactor).at(-1);if(s.setOverviewTileZoomLevelForViewport(a),!n.has(t))return[];if(!a||s.tileZoomLevelForViewport&&a.scaleFactor<=s.tileZoomLevelForViewport.scaleFactor)return[];const c=y_(a.scaleFactor,s.parsedImage).map(u=>new ym(u,s));return s.setOverviewFetchableTilesForViewport(c),c}updateMapsForViewport(t){this.mapsWithRequestedTilesForViewport=new Set(t.map(o=>o.mapId).filter((o,a,h)=>h.indexOf(o)===a).sort((o,a)=>{const h=this.warpedMapList.getMapZIndex(o),c=this.warpedMapList.getMapZIndex(a);return h!==void 0&&c!==void 0?h-c:0})),this.mapsInPreviousViewport=this.mapsInViewport,this.mapsInViewport=this.findMapsInViewport();const i=Array.from(this.mapsInPreviousViewport),n=Array.from(this.mapsInViewport),s=n.filter(o=>!i.includes(o)),r=i.filter(o=>!n.includes(o));for(const o of s)this.dispatchEvent(new Rt(st.WARPEDMAPENTER,o));for(const o of r)this.clearMap(o),this.dispatchEvent(new Rt(st.WARPEDMAPLEAVE,o));return{mapsEnteringViewport:s,mapsLeavingViewport:r}}pruneTileCache(t){const i=new Map;for(const n of this.warpedMapList.getWarpedMaps({mapIds:t}))i.set(n.mapId,{tileZoomLevelForViewport:n.tileZoomLevelForViewport,overviewTileZoomLevelForViewport:n.overviewTileZoomLevelForViewport,resourceViewportRingBboxForViewport:n.resourceBufferedViewportRingBboxForViewport});this.tileCache.prune(i)}destroy(){this.tileCache.destroy(),this.warpedMapList.destroy()}clearMap(t){}mapTileLoaded(t){}mapTileRemoved(t){}imageInfoLoaded(t){}warpedMapAdded(t){}warpedMapRemoved(t){}preChange(t){}optionsChanged(t){}gcpsChanged(t){}resourceMaskChanged(t){}transformationChanged(t){}distortionChanged(t){}internalProjectionChanged(t){}projectionChanged(t){}addEventListeners(){this.tileCache.addEventListener(st.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.addEventListener(st.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.addEventListener(st.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.addEventListener(st.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.addEventListener(st.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.addEventListener(st.PRECHANGE,this.preChange.bind(this)),this.warpedMapList.addEventListener(st.OPTIONSCHANGED,this.optionsChanged.bind(this)),this.warpedMapList.addEventListener(st.GCPSCHANGED,this.gcpsChanged.bind(this)),this.warpedMapList.addEventListener(st.RESOURCEMASKCHANGED,this.gcpsChanged.bind(this)),this.warpedMapList.addEventListener(st.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.addEventListener(st.DISTORTIONCHANGED,this.distortionChanged.bind(this)),this.warpedMapList.addEventListener(st.INTERNALPROJECTIONCHANGED,this.internalProjectionChanged.bind(this)),this.warpedMapList.addEventListener(st.PROJECTIONCHANGED,this.projectionChanged.bind(this))}removeEventListeners(){this.tileCache.removeEventListener(st.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.removeEventListener(st.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.removeEventListener(st.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.removeEventListener(st.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.removeEventListener(st.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.removeEventListener(st.PRECHANGE,this.preChange.bind(this)),this.warpedMapList.removeEventListener(st.OPTIONSCHANGED,this.optionsChanged.bind(this)),this.warpedMapList.removeEventListener(st.GCPSCHANGED,this.gcpsChanged.bind(this)),this.warpedMapList.removeEventListener(st.RESOURCEMASKCHANGED,this.gcpsChanged.bind(this)),this.warpedMapList.removeEventListener(st.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.removeEventListener(st.DISTORTIONCHANGED,this.distortionChanged.bind(this)),this.warpedMapList.removeEventListener(st.INTERNALPROJECTIONCHANGED,this.internalProjectionChanged.bind(this)),this.warpedMapList.removeEventListener(st.PROJECTIONCHANGED,this.projectionChanged.bind(this))}}function ML(e,t){const i=bi(e),n=Math.ceil(i/t)-1,s=AS(e);let r=e[0];const o=[r];for(let a=1;a<=n;a++)r=TS(r,t,s),o.push(r);return o}function IL(e,t){e=L0(e);let i=[];for(let n=0;n<e.length-1;n++)i=i.concat(ML([e[n],e[n+1]],t));return i}function EL(e,t){return e.map(i=>IL(i,t))}function CL(e,t){const i=[];for(let n=e[0]+t,s=0;n<=e[2];s++,n+=t)for(let r=e[1]+t,o=0;r<=e[3];o++,r+=t)i.push([n,r]);return i}function Xl(e,t){try{return gy(e,O0(t))===!0}catch(i){return console.error("Error determining if point is inside polygon:",i),!1}}const Mm=Math.pow(2,-52),Wa=new Uint32Array(512);class id{static from(t,i=TL,n=RL){const s=t.length,r=new Float64Array(s*2);for(let o=0;o<s;o++){const a=t[o];r[2*o]=i(a),r[2*o+1]=n(a)}return new id(r)}constructor(t){const i=t.length>>1;if(i>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*i-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(i)),this._hullPrev=new Uint32Array(i),this._hullNext=new Uint32Array(i),this._hullTri=new Uint32Array(i),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(i),this._dists=new Float64Array(i),this.update()}update(){const{coords:t,_hullPrev:i,_hullNext:n,_hullTri:s,_hullHash:r}=this,o=t.length>>1;let a=1/0,h=1/0,c=-1/0,u=-1/0;for(let W=0;W<o;W++){const Q=t[2*W],ot=t[2*W+1];Q<a&&(a=Q),ot<h&&(h=ot),Q>c&&(c=Q),ot>u&&(u=ot),this._ids[W]=W}const m=(a+c)/2,p=(h+u)/2;let y,w,v;for(let W=0,Q=1/0;W<o;W++){const ot=$l(m,p,t[2*W],t[2*W+1]);ot<Q&&(y=W,Q=ot)}const I=t[2*y],b=t[2*y+1];for(let W=0,Q=1/0;W<o;W++){if(W===y)continue;const ot=$l(I,b,t[2*W],t[2*W+1]);ot<Q&&ot>0&&(w=W,Q=ot)}let T=t[2*w],P=t[2*w+1],G=1/0;for(let W=0;W<o;W++){if(W===y||W===w)continue;const Q=bL(I,b,T,P,t[2*W],t[2*W+1]);Q<G&&(v=W,G=Q)}let k=t[2*v],O=t[2*v+1];if(G===1/0){for(let ot=0;ot<o;ot++)this._dists[ot]=t[2*ot]-t[0]||t[2*ot+1]-t[1];ar(this._ids,this._dists,0,o-1);const W=new Uint32Array(o);let Q=0;for(let ot=0,ut=-1/0;ot<o;ot++){const vt=this._ids[ot],A=this._dists[vt];A>ut&&(W[Q++]=vt,ut=A)}this.hull=W.subarray(0,Q),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(sn(I,b,T,P,k,O)<0){const W=w,Q=T,ot=P;w=v,T=k,P=O,v=W,k=Q,O=ot}const U=AL(I,b,T,P,k,O);this._cx=U.x,this._cy=U.y;for(let W=0;W<o;W++)this._dists[W]=$l(t[2*W],t[2*W+1],U.x,U.y);ar(this._ids,this._dists,0,o-1),this._hullStart=y;let Y=3;n[y]=i[v]=w,n[w]=i[y]=v,n[v]=i[w]=y,s[y]=0,s[w]=1,s[v]=2,r.fill(-1),r[this._hashKey(I,b)]=y,r[this._hashKey(T,P)]=w,r[this._hashKey(k,O)]=v,this.trianglesLen=0,this._addTriangle(y,w,v,-1,-1,-1);for(let W=0,Q,ot;W<this._ids.length;W++){const ut=this._ids[W],vt=t[2*ut],A=t[2*ut+1];if(W>0&&Math.abs(vt-Q)<=Mm&&Math.abs(A-ot)<=Mm||(Q=vt,ot=A,ut===y||ut===w||ut===v))continue;let D=0;for(let V=0,J=this._hashKey(vt,A);V<this._hashSize&&(D=r[(J+V)%this._hashSize],!(D!==-1&&D!==n[D]));V++);D=i[D];let F=D,Z;for(;Z=n[F],sn(vt,A,t[2*F],t[2*F+1],t[2*Z],t[2*Z+1])>=0;)if(F=Z,F===D){F=-1;break}if(F===-1)continue;let H=this._addTriangle(F,ut,n[F],-1,-1,s[F]);s[ut]=this._legalize(H+2),s[F]=H,Y++;let tt=n[F];for(;Z=n[tt],sn(vt,A,t[2*tt],t[2*tt+1],t[2*Z],t[2*Z+1])<0;)H=this._addTriangle(tt,ut,Z,s[ut],-1,s[tt]),s[ut]=this._legalize(H+2),n[tt]=tt,Y--,tt=Z;if(F===D)for(;Z=i[F],sn(vt,A,t[2*Z],t[2*Z+1],t[2*F],t[2*F+1])<0;)H=this._addTriangle(Z,ut,F,-1,s[F],s[Z]),this._legalize(H+2),s[Z]=H,n[F]=F,Y--,F=Z;this._hullStart=i[ut]=F,n[F]=i[tt]=ut,n[ut]=tt,r[this._hashKey(vt,A)]=ut,r[this._hashKey(t[2*F],t[2*F+1])]=F}this.hull=new Uint32Array(Y);for(let W=0,Q=this._hullStart;W<Y;W++)this.hull[W]=Q,Q=n[Q];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,i){return Math.floor(xL(t-this._cx,i-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:i,_halfedges:n,coords:s}=this;let r=0,o=0;for(;;){const a=n[t],h=t-t%3;if(o=h+(t+2)%3,a===-1){if(r===0)break;t=Wa[--r];continue}const c=a-a%3,u=h+(t+1)%3,m=c+(a+2)%3,p=i[o],y=i[t],w=i[u],v=i[m];if(SL(s[2*p],s[2*p+1],s[2*y],s[2*y+1],s[2*w],s[2*w+1],s[2*v],s[2*v+1])){i[t]=v,i[a]=p;const b=n[m];if(b===-1){let P=this._hullStart;do{if(this._hullTri[P]===m){this._hullTri[P]=t;break}P=this._hullPrev[P]}while(P!==this._hullStart)}this._link(t,b),this._link(a,n[o]),this._link(o,m);const T=c+(a+1)%3;r<Wa.length&&(Wa[r++]=T)}else{if(r===0)break;t=Wa[--r]}}return o}_link(t,i){this._halfedges[t]=i,i!==-1&&(this._halfedges[i]=t)}_addTriangle(t,i,n,s,r,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=i,this._triangles[a+2]=n,this._link(a,s),this._link(a+1,r),this._link(a+2,o),this.trianglesLen+=3,a}}function xL(e,t){const i=e/(Math.abs(e)+Math.abs(t));return(t>0?3-i:1+i)/4}function $l(e,t,i,n){const s=e-i,r=t-n;return s*s+r*r}function SL(e,t,i,n,s,r,o,a){const h=e-o,c=t-a,u=i-o,m=n-a,p=s-o,y=r-a,w=h*h+c*c,v=u*u+m*m,I=p*p+y*y;return h*(m*I-v*y)-c*(u*I-v*p)+w*(u*y-m*p)<0}function bL(e,t,i,n,s,r){const o=i-e,a=n-t,h=s-e,c=r-t,u=o*o+a*a,m=h*h+c*c,p=.5/(o*c-a*h),y=(c*u-a*m)*p,w=(o*m-h*u)*p;return y*y+w*w}function AL(e,t,i,n,s,r){const o=i-e,a=n-t,h=s-e,c=r-t,u=o*o+a*a,m=h*h+c*c,p=.5/(o*c-a*h),y=e+(c*u-a*m)*p,w=t+(o*m-h*u)*p;return{x:y,y:w}}function ar(e,t,i,n){if(n-i<=20)for(let s=i+1;s<=n;s++){const r=e[s],o=t[r];let a=s-1;for(;a>=i&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=r}else{const s=i+n>>1;let r=i+1,o=n;no(e,s,r),t[e[i]]>t[e[n]]&&no(e,i,n),t[e[r]]>t[e[n]]&&no(e,r,n),t[e[i]]>t[e[r]]&&no(e,i,r);const a=e[r],h=t[a];for(;;){do r++;while(t[e[r]]<h);do o--;while(t[e[o]]>h);if(o<r)break;no(e,r,o)}e[i+1]=e[o],e[o]=a,n-r+1>=o-i?(ar(e,t,r,n),ar(e,t,i,o-1)):(ar(e,t,i,o-1),ar(e,t,r,n))}}function no(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function TL(e){return e[0]}function RL(e){return e[1]}class PL{constructor(t,i){this.W=t,this.bs=i}add(t){const i=this.W,n=t/i|0,s=t%i;return this.bs[n]|=1<<s,this}delete(t){const i=this.W,n=t/i|0,s=t%i;return this.bs[n]&=~(1<<s),this}set(t,i){const n=this.W,s=t/n|0,r=t%n,o=1<<r;return this.bs[s]^=(-i^this.bs[s])&o,i}has(t){const i=this.W,n=t/i|0,s=t%i;return!!(this.bs[n]&1<<s)}forEach(t){const i=this.W,n=this.bs,s=n.length;for(let r=0;r<s;r++){let o=0;for(;n[r]&&o<i;)n[r]&1<<o&&t(r*i+o),o++}return this}}class Im extends PL{constructor(t){const n=new Uint8Array(Math.ceil(t/8)).fill(0);super(8,n)}}function ms(e){return e%3===2?e-2:e+1}function yn(e){return e%3===0?e+2:e-1}class my{constructor(t,i){if(!t||typeof t!="object"||!t.triangles||!t.halfedges||!t.coords)throw new Error("Expected an object with Delaunator output");if(t.triangles.length%3||t.halfedges.length!==t.triangles.length||t.coords.length%2)throw new Error("Delaunator output appears inconsistent");if(t.triangles.length<3)throw new Error("No edges in triangulation");this.del=t;const n=2**32-1,s=t.coords.length>>1,r=t.triangles.length;this.vertMap=new Uint32Array(s).fill(n),this.flips=new Im(r),this.consd=new Im(r);for(let o=0;o<r;o++){const a=t.triangles[o];this.vertMap[a]===n&&this.updateVert(o)}i&&this.constrainAll(i)}constrainOne(t,i){const{triangles:n,halfedges:s}=this.del,r=this.vertMap,o=this.consd,a=r[t];let h=a;do{const y=n[h],w=ms(h);if(y===i)return this.protect(h);const v=yn(h),I=n[v];if(I===i)return this.protect(w),w;if(this.intersectSegments(t,i,I,y)){h=v;break}h=s[w]}while(h!==-1&&h!==a);let c=h,u=-1;for(;h!==-1;){const y=s[h],w=yn(h),v=yn(y),I=ms(y);if(y===-1)throw new Error("Constraining edge exited the hull");if(o.has(h))throw new Error("Edge intersects already constrained edge");if(this.isCollinear(t,i,n[h])||this.isCollinear(t,i,n[y]))throw new Error("Constraining edge intersects point");if(!this.intersectSegments(n[h],n[y],n[w],n[v])){if(u===-1&&(u=h),n[v]===i){if(h===u)throw new Error("Infinite loop: non-convex quadrilateral");h=u,u=-1;continue}if(this.intersectSegments(t,i,n[v],n[y]))h=v;else if(this.intersectSegments(t,i,n[I],n[v]))h=I;else if(u===h)throw new Error("Infinite loop: no further intersect after non-convex");continue}if(this.flipDiagonal(h),this.intersectSegments(t,i,n[w],n[v])&&(u===-1&&(u=w),u===w))throw new Error("Infinite loop: flipped diagonal still intersects");n[v]===i?(c=v,h=u,u=-1):this.intersectSegments(t,i,n[I],n[v])&&(h=I)}const m=this.flips;this.protect(c);do{var p=0;m.forEach(y=>{m.delete(y);const w=s[y];w!==-1&&(m.delete(w),this.isDelaunay(y)||(this.flipDiagonal(y),p++))})}while(p>0);return this.findEdge(t,i)}delaunify(t=!1){const i=this.del.halfedges,n=this.flips,s=this.consd,r=i.length;do{var o=0;for(let a=0;a<r;a++){if(s.has(a))continue;n.delete(a);const h=i[a];h!==-1&&(n.delete(h),this.isDelaunay(a)||(this.flipDiagonal(a),o++))}}while(t&&o>0);return this}constrainAll(t){const i=t.length;for(let n=0;n<i;n++){const s=t[n];this.constrainOne(s[0],s[1])}return this}isConstrained(t){return this.consd.has(t)}findEdge(t,i){const n=this.vertMap[i],{triangles:s,halfedges:r}=this.del;let o=n,a=-1;do{if(s[o]===t)return o;a=ms(o),o=r[a]}while(o!==-1&&o!==n);return s[ms(a)]===t?-a:1/0}protect(t){const i=this.del.halfedges[t],n=this.flips,s=this.consd;return n.delete(t),s.add(t),i!==-1?(n.delete(i),s.add(i),i):-t}markFlip(t){const i=this.del.halfedges,n=this.flips;if(this.consd.has(t))return!1;const r=i[t];return r!==-1&&(n.add(t),n.add(r)),!0}flipDiagonal(t){const{triangles:i,halfedges:n}=this.del,s=this.flips,r=this.consd,o=n[t],a=yn(t),h=ms(t),c=yn(o),u=ms(o),m=n[a],p=n[c];if(r.has(t))throw new Error("Trying to flip a constrained edge");return i[t]=i[c],n[t]=p,s.set(t,s.has(c))||r.set(t,r.has(c)),p!==-1&&(n[p]=t),n[a]=c,i[o]=i[a],n[o]=m,s.set(o,s.has(a))||r.set(o,r.has(a)),m!==-1&&(n[m]=o),n[c]=a,this.markFlip(t),this.markFlip(h),this.markFlip(o),this.markFlip(u),s.add(a),r.delete(a),s.add(c),r.delete(c),this.updateVert(t),this.updateVert(h),this.updateVert(o),this.updateVert(u),a}isDelaunay(t){const{triangles:i,halfedges:n}=this.del,s=n[t];if(s===-1)return!0;const r=i[yn(t)],o=i[t],a=i[ms(t)],h=i[yn(s)];return!this.inCircle(r,o,a,h)}updateVert(t){const{triangles:i,halfedges:n}=this.del,s=this.vertMap,r=i[t];let o=yn(t),a=n[o];for(;a!==-1&&a!==t;)o=yn(a),a=n[o];return s[r]=o,o}intersectSegments(t,i,n,s){const r=this.del.coords;return t===n||t===s||i===n||i===s?!1:py(r[t*2],r[t*2+1],r[i*2],r[i*2+1],r[n*2],r[n*2+1],r[s*2],r[s*2+1])}inCircle(t,i,n,s){const r=this.del.coords;return oL(r[t*2],r[t*2+1],r[i*2],r[i*2+1],r[n*2],r[n*2+1],r[s*2],r[s*2+1])<0}isCollinear(t,i,n){const s=this.del.coords;return sn(s[t*2],s[t*2+1],s[i*2],s[i*2+1],s[n*2],s[n*2+1])===0}}my.intersectSegments=py;function py(e,t,i,n,s,r,o,a){const h=sn(e,t,s,r,o,a),c=sn(i,n,s,r,o,a);if(h>0&&c>0||h<0&&c<0)return!1;const u=sn(s,r,e,t,i,n),m=sn(o,a,e,t,i,n);return u>0&&m>0||u<0&&m<0?!1:h===0&&c===0&&u===0&&m===0?!(Math.max(s,o)<Math.min(e,i)||Math.max(e,i)<Math.min(s,o)||Math.max(r,a)<Math.min(t,n)||Math.max(t,n)<Math.min(r,a)):!0}const GL=1e-4,LL={steinerPoints:[],minimumTriangleAngle:GL};function OL(e,t,i){const n=Ee(LL,i),s=n.steinerPoints,r=n.minimumTriangleAngle;e=bu(e);let o=[],a=[],h=[],c=[];t?(o=EL(e,t),a=o.flat(),h=CL(Fe(e),t),c=h.filter(O=>Xl(O,e))):(o=e,a=e.flat());const u=s.filter(O=>Xl(O,e)),m=[...a,...c,...u],p=new id(m.flat());let y=0;const w=o.map(O=>{const U=O.map((Y,W)=>y+W);return y+=O.length,U}),v=w.map(O=>O.map(U=>[U,(U+1)%O.length])).flat(),I=new my(p);I.delaunify(!0),I.constrainAll(v);let b=[],T=[];const P=[];for(let O=0;O<I.del.triangles.length;O+=3)b.push([I.del.triangles[O],I.del.triangles[O+1],I.del.triangles[O+2]]),T.push([m[I.del.triangles[O]],m[I.del.triangles[O+1]],m[I.del.triangles[O+2]]]),P.push(I.del.triangles[O]<a.length||I.del.triangles[O+1]<a.length||I.del.triangles[O+2]<a.length);const G=T.map((O,U)=>P[U]?Xl(mh(...O),e)&&GS(O).every(Y=>Y>=r):!0);b=b.filter((O,U)=>G[U]),T=T.filter((O,U)=>G[U]);const k=[];for(let O=0;O<v.length;O+=1)k.push([m[v[O][0]],m[v[O][1]]]);return{interpolatedPolygon:o,interpolatedPolygonPoints:a,gridPoints:h,gridPointsInPolygon:c,uniquePoints:m,triangles:T,uniquePointIndexTriangles:b,uniquePointIndexInterpolatedPolygon:w,uniquePointIndexEdges:v}}const nl=/^https?:\/\/library.stanford.edu\/iiif\/image-api\/1.1\/compliance.html#level(?<level>[012])$/,_y=ct().regex(nl),FL=_y,Lh="http://library.stanford.edu/iiif/image-api/1.1/context.json",yy="http://iiif.io/api/image/1/context.json",wy=Xt(Lh),nd=wt({"@context":wy,"@id":ct().url(),profile:_y.optional(),width:Ft().int(),height:Ft().int(),scale_factors:Ft().array().optional(),tile_width:Ft().optional(),tile_height:Ft().optional()}),vy=wt({width:Ft().int(),height:Ft().int()}),My=wt({width:Ft().int(),height:Ft().int().optional(),scaleFactors:cn(Ft().int())}),NL=["ImageService1","ImageService2","ImageService3"],Iy=Nr(NL),Em=gT.date(),kr=Lt([Em,Nu()]).transform(e=>{const{success:t,data:i}=Em.safeParse(e);if(t)return i}),jr=wt({}).passthrough(),sl=/^https?:\/\/iiif.io\/api\/image\/2.*level(?<level>[012])(.json)?$/,Ey=ct().regex(sl),DL=wt({formats:ct().array().optional(),maxArea:Ft().int().optional(),maxHeight:Ft().int().optional(),maxWidth:Ft().int().optional(),qualities:ct().array().optional(),supports:ct().array().optional()}),Cm=Lt([Ey,DL]);function kL(e){return e!==void 0}const Oh=Lt([Ey,cn(Lt([Cm,Du()]).transform(e=>{const{success:t,data:i}=Cm.safeParse(e);if(t)return i}))]).transform(e=>{if(e&&Array.isArray(e)){const t=e[0];if(typeof t!="string")throw new Error("First profile must be a string");return[t,...e.slice(1).filter(kL)]}return e}),Fh="http://iiif.io/api/image/2/context.json",Cy=Lt([Xt(Fh),Xt("https://iiif.io/api/image/2/context.json"),ct().url()]),sd=wt({"@id":ct().url(),"@type":Lt([Xt("iiif:Image"),Xt("ImageService2")]).optional(),"@context":Cy,protocol:Xt("http://iiif.io/api/image"),width:Ft().int(),height:Ft().int(),profile:Oh,sizes:vy.array().optional(),tiles:My.array().optional()}),jL=["level0","level1","level2"],xy=Nr(jL),rd=wt({id:ct().url(),type:Xt("ImageService3"),protocol:Xt("http://iiif.io/api/image"),profile:xy,width:Ft().int(),height:Ft().int(),maxWidth:Ft().int().optional(),maxHeight:Ft().int().optional(),maxArea:Ft().int().optional(),sizes:vy.array().optional(),tiles:My.array().optional(),extraFeatures:ct().array().optional()}),BL=wt({"@id":ct().url(),"@type":Iy.optional(),profile:Lt([FL,Oh,xy]),width:Ft().int().optional(),height:Ft().int().optional(),"@context":Lt([wy,Xt("http://iiif.io/api/image/1/context.json"),Cy]).optional()}),VL=["level0","level1","level2"],WL=Lt([wt({id:ct().url(),type:Xt("ImageService2"),profile:Oh}),wt({"@id":ct().url(),"@type":Xt("ImageService2"),profile:Oh})]),zL=wt({id:ct().url(),type:Iy,profile:Nr(VL)}),ZL=Lt([WL,zL]),Sy=Lt([BL,ZL]),xm=ku(ct(),ct().array());wt({label:xm.optional(),value:xm.optional()});function Br(e){if(e)return Array.isArray(e)?e:[e]}function Fs(e){if(typeof e=="string")return{none:[e]};if(Array.isArray(e)){let t={};return e.forEach(i=>{if(typeof i=="string")t.none||(t.none=[]),t.none.push(i);else if(typeof i=="object")t={...t,...Fs(i)};else throw new Error("Unable to parse string")}),t}else if(e&&typeof e=="object"){const t=e["@language"]||"none",i=e["@value"]||"";return{[t]:Array.isArray(i)?i:[i]}}}function Sm(e){if(!e)return;const t={};for(const i in e)t[i]=e[i];return t}function UL(e){if(e){const t=Fs(e.label),i=Fs(e.value);if(t&&i)return{label:t,value:i}}}function XL(e){if(e){const t=Sm(e.label),i=Sm(e.value);if(t&&i)return{label:t,value:i}}}function by(e){return e!==void 0}function mF(e){if(Array.isArray(e))return e.length===0?void 0:e.map(UL).filter(by);if(e)throw new Error("Unable to parse metadata")}function pF(e){if(Array.isArray(e))return e.length===0?void 0:e.map(XL).filter(by);if(e)throw new Error("Unable to parse metadata")}function _F(e){if(e){if(typeof e=="string")return{label:{none:["Attribution"]},value:{none:[e]}};{const t=Fs(e);if(t)return{label:{none:["Attribution"]},value:t}}}}function yF(e){return e?.map(t=>typeof t=="string"?{id:t}:{id:t["@id"],type:t["@type"],format:t.format,width:t.width,height:t.height})}function wF(e){return e?.map(t=>({id:t["@id"],type:t["@type"],label:Fs(t.label),format:t.format}))}function vF(e){if(e)return typeof e=="string"?[{id:e}]:Array.isArray(e)?e.map(t=>({id:t["@id"],label:Fs(t.label),format:t.format})):[{id:e["@id"],label:Fs(e.label),format:e.format}]}const Jc=Lt([ct(),Ft(),Fu()]).transform(e=>String(e)),ea=Lt([Jc.array(),Jc]),bm=wt({"@id":ct().url(),format:ct().optional(),label:ea.optional()}),od=Lt([bm.array(),bm,Jc]),Am=Lt([ct(),wt({"@id":ct().url(),"@type":ct().optional(),format:ct().optional(),height:Ft().optional(),width:Ft().optional()})]),ad=Lt([Am.array(),Am]).transform(Br),Tm=wt({"@id":ct().url(),"@type":ct().optional(),label:ea.optional(),format:ct().optional()}),hd=Lt([Tm.array(),Tm]).transform(Br),$L=Lt([wt({"@value":ea,"@language":ct().optional()}),wt({value:ea,language:ct().optional()})]).transform(e=>"value"in e?{"@value":e.value,"@language":e.language}:e),Rm=$L,Bi=Lt([Rm.array(),Rm,ea]),ld=Lt([ct(),Bi]),Pm=wt({label:Bi.optional(),value:Bi.optional()}),HL=Lt([Pm,Nu()]).transform(e=>{const{success:t,data:i}=Pm.safeParse(e);if(t)return i}),cd=HL.array(),YL=wt({width:Ft().int().optional(),height:Ft().int().optional(),service:Sy}),KL=wt({resource:YL}),ud=wt({"@id":ct().url(),"@type":Xt("sc:Canvas"),width:Ft().int(),height:Ft().int(),images:KL.array().length(1),label:Bi.optional(),description:Bi.optional(),related:od.optional(),attribution:ld.optional(),thumbnail:ad.optional(),rendering:hd.optional(),metadata:cd.optional(),navDate:kr.optional(),navPlace:jr.optional()}),qL=wt({canvases:ud.array().nonempty()}),Ay=wt({"@id":ct().url(),"@type":Xt("sc:Manifest"),sequences:qL.array().length(1),label:Bi.optional(),description:Bi.optional(),metadata:cd.optional(),related:od.optional(),attribution:ld.optional(),rendering:hd.optional(),thumbnail:ad.optional(),navDate:kr.optional(),navPlace:jr.optional()}),Gm=ga(()=>wt({"@id":ct().url(),"@type":Xt("sc:Manifest"),label:Bi.optional()})),Nh=ga(()=>wt({"@id":ct().url(),"@type":Xt("sc:Collection"),manifests:Gm.array().optional(),collections:Nh.array().optional(),members:Lt([Gm,Nh,JL]).array().optional(),label:Bi.optional(),description:Bi.optional(),metadata:cd.optional(),related:od.optional(),attribution:ld.optional(),thumbnail:ad.optional(),rendering:hd.optional(),navDate:kr.optional(),navPlace:jr.optional()})),JL=wt({"@id":ct().url(),"@type":Xt("sc:Collection"),label:Bi.optional()}),QL=Lt([ct(),Ft(),Fu()]).transform(e=>String(e)),yi=ku(ct(),QL.array()),dd=yi,Lm=wt({id:ct().url(),type:ct().optional(),label:yi,format:ct().optional(),language:Lt([ct(),cn(ct())]).optional()}),Om=wt({id:ct().url(),type:ct().optional(),label:yi,format:ct().optional()}),fd=Lt([Om.array(),Om]).transform(Br),gd=Lt([Lm.array(),Lm]).transform(Br),Fm=wt({id:ct().url(),type:ct().optional(),format:ct().optional(),width:Ft().int().optional(),height:Ft().int().optional()}),md=Lt([Fm.array(),Fm]).transform(Br),Nm=wt({id:ct().url(),type:ct().optional(),format:ct().optional(),profile:ct().optional()}),pd=Lt([Nm.array(),Nm]).transform(Br),_d=wt({id:ct().url(),type:Xt("AnnotationPage"),items:wt({}).passthrough().array().optional()}).array(),Dm=wt({label:yi,value:yi}),Ty=Lt([Dm,Nu()]).transform(e=>{const{success:t,data:i}=Dm.safeParse(e);if(t)return i}),yd=Ty.array(),wd=Ty,Qc=wt({type:Xt("Image"),width:Ft().int().optional(),height:Ft().int().optional(),service:Sy.array()}),tO=wt({type:Xt("Choice"),items:Qc.array()}),eO=wt({type:Xt("Annotation"),body:Lt([Qc,Qc.array().length(1),tO])}),iO=wt({type:Xt("AnnotationPage"),items:eO.array().length(1)}),vd=wt({id:ct().url(),type:Xt("Canvas"),width:Ft().int(),height:Ft().int(),items:iO.array().length(1),label:yi.optional(),description:yi.optional(),metadata:yd.optional(),navDate:kr.optional(),navPlace:jr.optional(),homepage:gd.optional(),thumbnail:md.optional(),rendering:fd.optional(),seeAlso:pd.optional(),summary:dd.optional(),requiredStatement:wd.optional(),annotations:_d.optional()}),Ry=wt({id:ct().url(),type:Xt("Manifest"),items:vd.array().nonempty(),label:yi.optional(),description:yi.optional(),metadata:yd.optional(),navDate:kr.optional(),navPlace:jr.optional(),homepage:gd.optional(),thumbnail:md.optional(),rendering:fd.optional(),seeAlso:pd.optional(),summary:dd.optional(),requiredStatement:wd.optional(),annotations:_d.optional()}),nO=ga(()=>wt({id:ct().url(),type:Xt("Manifest"),label:yi.optional()})),Md=ga(()=>wt({id:ct().url(),type:Xt("Collection"),items:Lt([nO,Md,sO]).array(),label:yi.optional(),description:yi.optional(),metadata:yd.optional(),navDate:kr.optional(),navPlace:jr.optional(),homepage:gd.optional(),thumbnail:md.optional(),rendering:fd.optional(),seeAlso:pd.optional(),summary:dd.optional(),requiredStatement:wd.optional(),annotations:_d.optional()})),sO=wt({id:ct().url(),type:Xt("Collection"),label:yi.optional()}),rO=Lt([nd,sd,rd]);Lt([ud,vd]);const MF=Lt([Ay,Ry]),IF=Lt([Nh,Md]),oO=nd,aO=Lt([Nh,Ay,ud,sd]),hO=Lt([Md,Ry,vd,rd]);Lt([oO,aO,hO]);function Py({width:e,height:t},i,n,s){const r=n*i.originalWidth,o=s*i.originalHeight,a=n*i.originalWidth+i.width*i.scaleFactor>e?e-n*i.originalWidth:i.width*i.scaleFactor,h=s*i.originalHeight+i.height*i.scaleFactor>t?t-s*i.originalHeight:i.height*i.scaleFactor;let c=i.width,u=i.height;return r+i.width*i.scaleFactor>e&&(c=Math.floor((e-r+i.scaleFactor-1)/i.scaleFactor)),o+i.height*i.scaleFactor>t&&(u=Math.floor((t-o+i.scaleFactor-1)/i.scaleFactor)),{region:{x:r,y:o,width:a,height:h},size:{width:c,height:u}}}function lO({width:e,height:t},i=768){const n=Math.max(e,t)/i,s=Math.ceil(Math.log(n)/Math.log(2));return{scaleFactors:Array.from({length:s},(r,o)=>2**o),width:i}}function cO({width:e,height:t},i,n){const s=i.height||i.width,r=i.width*n,o=s*n;return{scaleFactor:n,width:i.width,height:s,originalWidth:r,originalHeight:o,columns:Math.ceil(e/r),rows:Math.ceil(t/o)}}function uO(e,t){return t.map(i=>i.scaleFactors.map(n=>cO(e,i,n))).flat()}function dO(e){return!!e.some(t=>t.width&&t.scaleFactors&&t.scaleFactors.length)}function fO(e,t,i){if(!t||!dO(t))if(i)t=[lO(e)];else throw new Error("Image does not support tiles or custom regions and sizes.");return uO(e,t)}function gO(e,t,i="cover"){if(i==="cover"||i==="contain"){const n=t.width/e.width,s=t.height/e.height,r=i==="cover"?Math.max(n,s):Math.min(n,s),o=e.width*r,a=e.height*r;return{width:o,height:a}}else throw new Error('Mode must be either "cover" or "contain"')}const mO=.8,pO=1.5;function Gy(e,t,i="cover",{sizes:n,tileZoomLevels:s,supportsAnyRegionAndSize:r,maxWidth:o,maxHeight:a,maxArea:h}){let{width:c,height:u}=gO(e,t,i);if(o&&c>o&&(u=u/c*o,c=o),a&&u>a&&(c=c/u*a,u=a),h&&c*u>h){const p=u/c,w=Math.floor(Math.sqrt(h/p))*p;c=Math.floor(w)/p,u=c*p}const m=e.width/e.height;if(c=Math.floor(c),u=Math.round(c/m),n){let p;for(const y of n){const w=y.width/c;if(w>=mO&&w<=pO){p=y;break}}if(p)return{size:p}}if(r)return{size:{width:Math.round(c),height:Math.round(u)}};if(s){const p=e.width/c,y=s.map(({scaleFactor:T},P)=>({index:P,scaleFactor:T,diff:Math.abs(T-p)})).sort((T,P)=>T.diff-P.diff),w=s[y[0].index],v=Math.ceil(e.width/(w.scaleFactor*s[0].width)),I=Math.ceil(e.height/(w.scaleFactor*s[0].height)),b=[];for(let T=0;T<I;T++){const P=[];for(let G=0;G<v;G++){const k=Py(e,w,G,T);P.push(k)}b.push(P)}return b}throw new Error("Unable to create thumbnail")}const Ly=["regionByPx","sizeByWh"];function _O(e){const t=e.match(nl);if(t&&t.groups)return parseInt(t.groups.level)}function km(e){const t=e.match(sl);if(t&&t.groups)return parseInt(t.groups.level)}function yO(e){return{maxWidth:e?.maxWidth,maxHeight:e?.maxHeight,maxArea:e?.maxArea,supportsAnyRegionAndSize:Ly.every(t=>e?.supports&&e?.supports?.includes(t))}}function wO(e){if("type"in e&&e.type==="ImageService3")return 3;if("type"in e&&e.type==="ImageService2"||"@type"in e&&e["@type"]==="ImageService2"||"@context"in e&&e["@context"]===Fh)return 2;if("@context"in e&&(e["@context"]===Lh||e["@context"]===yy))return 1;if("profile"in e){let t;return Array.isArray(e.profile)?t=e.profile[0]:t=e.profile,t.match(nl)?1:t.match(sl)?2:3}else throw new Error("Unsupported IIIF Image Service")}function tu(e){if("type"in e||"@type"in e){const t=e.profile;let i=!1;return t==="level0"||typeof t=="string"&&t.endsWith("level0.json")?"extraFeatures"in e&&(i=Ly.every(n=>e.extraFeatures&&e.extraFeatures.includes(n))):i=!0,{maxWidth:"maxWidth"in e?e.maxWidth:void 0,maxHeight:"maxHeight"in e?e.maxHeight:void 0,maxArea:"maxArea"in e?e.maxArea:void 0,supportsAnyRegionAndSize:i}}else if(Array.isArray(e.profile)){let t=!1,i=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return e.profile.forEach(r=>{if(typeof r=="string"){const o=km(r);o&&(t=t||o>=1)}else{const{maxWidth:o,maxHeight:a,maxArea:h,supportsAnyRegionAndSize:c}=yO(r);o!==void 0&&(n=Math.max(o,n)),a!==void 0&&(i=Math.max(a,i)),h!==void 0&&(s=Math.max(h,s)),t=t||c}}),{maxWidth:n>=0?n:void 0,maxHeight:i>=0?i:void 0,maxArea:s>=0?s:void 0,supportsAnyRegionAndSize:t}}else if("profile"in e&&e.profile){const t=_O(e.profile),i=km(e.profile);return t?{supportsAnyRegionAndSize:t>=1}:i?{supportsAnyRegionAndSize:i>=1}:{supportsAnyRegionAndSize:!1}}else throw new Error("Invalid Image")}const vO="image";class MO{embedded=!0;uri;type=vO;maxWidth;maxHeight;maxArea;supportsAnyRegionAndSize;width;height;majorVersion;constructor(...t){const i=t[0],n=t[1];if(t.length===2){const s=t[0];let r,o;if(Array.isArray(s.service)?s.service.forEach(a=>{try{const h=wO(a);(!o||h>o)&&(o=h,r=a)}catch{}}):r=s.service,!r)throw new Error("Unsupported IIIF Image Service");if("@id"in r)this.uri=r["@id"];else if("id"in r)this.uri=r.id;else throw new Error("Unsupported IIIF Image Service");if("type"in r&&r.type==="ImageService3")this.majorVersion=3;else if("type"in r&&r.type==="ImageService2"||"@type"in r&&r["@type"]==="ImageService2"||"@context"in r&&r["@context"]===Fh)this.majorVersion=2;else if("@context"in r&&(r["@context"]===Lh||r["@context"]===yy))this.majorVersion=1;else if("profile"in r){let a;if(Array.isArray(r.profile)&&r.profile.length>0)a=r.profile[0];else if(typeof r.profile=="string")a=r.profile;else throw new Error("Unsupported IIIF Image Service");a.match(nl)?this.majorVersion=1:a.match(sl)?this.majorVersion=2:this.majorVersion=3}else throw new Error("Unsupported IIIF Image Service");if("profile"in r){const a=tu(r);this.supportsAnyRegionAndSize=a.supportsAnyRegionAndSize,this.maxWidth=a.maxWidth,this.maxHeight=a.maxHeight,this.maxArea=a.maxArea}else this.supportsAnyRegionAndSize=!1}else{if("@id"in i)this.uri=i["@id"];else if("id"in i)this.uri=i.id;else throw new Error("Unsupported IIIF Image");if("type"in i&&i.type==="ImageService3")this.majorVersion=3;else if("@type"in i&&i["@type"]==="iiif:Image"||"@context"in i&&i["@context"]===Fh)this.majorVersion=2;else if("@context"in i&&i["@context"]===Lh)this.majorVersion=1;else throw new Error("Unsupported IIIF Image");if("profile"in i){const s=tu(i);this.supportsAnyRegionAndSize=s.supportsAnyRegionAndSize,this.maxWidth=s.maxWidth,this.maxHeight=s.maxHeight,this.maxArea=s.maxArea}else this.supportsAnyRegionAndSize=!1}if(i.width!==void 0)this.width=i.width;else if(n)this.width=n.width;else throw new Error("Width not present on either Canvas or Image Resource");if(i.height!==void 0)this.height=i.height;else if(n)this.height=n.height;else throw new Error("Height not present on either Canvas or Image Resource")}getImageUrl(t){const{region:i,size:n}=t;let s,r,o,a,h;i?(h=`${i.x},${i.y},${i.width},${i.height}`,o=i.height,a=i.width):(h="full",o=this.height,a=this.width);let c;if(n){s=Math.round(n.width),r=Math.round(n.height);const p=String(s);let y=String(r);const w=a/o,I=r*w/w;this.majorVersion<=2&&r===Math.round(I)&&(y=""),c=`${p},${y}`}else s=this.width,r=this.height,c=this.majorVersion===2?"full":"max";const u=s*r;if(this.maxWidth!==void 0&&s>this.maxWidth)throw new Error(`Width of requested image is too large: ${s} > ${this.maxWidth}`);if(this.maxHeight!==void 0&&r>this.maxHeight)throw new Error(`Height of requested image is too large: ${r} > ${this.maxHeight}`);if(this.maxArea!==void 0&&u>this.maxArea)throw new Error(`Area of requested image is too large: ${u} > ${this.maxArea}`);const m=this.majorVersion===1?"native":"default";return`${this.uri}/${h}/${c}/0/${m}.jpg`}getImageRequest(t,i="cover"){return Gy({width:this.width,height:this.height},t,i,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}}let IO=class Oy extends MO{tileZoomLevels;sizes;embedded=!1;constructor(t){super(t);const i=tu(t);let n;"tiles"in t&&(n=t.tiles),this.tileZoomLevels=fO({width:this.width,height:this.height},n,i.supportsAnyRegionAndSize),"sizes"in t&&(this.sizes=t.sizes)}static parse(t,i=null){let n;return i===1?n=nd.parse(t):i===2?n=sd.parse(t):i===3?n=rd.parse(t):n=rO.parse(t),new Oy(n)}getTileImageRequest(t,i,n){return Py({width:this.width,height:this.height},t,i,n)}getImageRequest(t,i="cover"){return Gy({width:this.width,height:this.height},t,i,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,sizes:this.sizes,tileZoomLevels:this.tileZoomLevels,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}};function mi(e,t){const i=t[0],n=t[1];return[e[0]*i+e[2]*n+e[4],e[1]*i+e[3]*n+e[5]]}function EO(){return[1,0,0,1,0,0]}function Hl(e,t){const i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=t[0],c=t[1],u=t[2],m=t[3],p=t[4],y=t[5];return[i*h+s*c,n*h+r*c,i*u+s*m,n*u+r*m,i*p+s*y+o,n*p+r*y+a]}function za(e,t,i,n,s,r,o){const a=Math.sin(s),h=Math.cos(s);return[i*h,n*a,-i*a,n*h,r*i*h-o*i*a+e,r*n*a+o*n*h+t]}function Id(e){const t=CO(e),i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5];return[r/t,-n/t,-s/t,i/t,(s*a-r*o)/t,-(i*a-n*o)/t]}function CO(e){return e[0]*e[3]-e[1]*e[2]}function so(e){const t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t}const Yl={minOffsetRatio:.01,minOffsetDistance:4,maxDepth:5,differentHandedness:!0},xO={visible:!0,applyMask:!0,transformationType:"polynomial",internalProjection:Sn,projection:Sn};class SO extends EventTarget{mapId;georeferencedMap;imageInformations;parsedImage;loadingImageInfo;fetchFn;abortController;visible;applyMask;mixed=!1;gcps;projectedGcps;resourcePoints;geoPoints;projectedGeoPoints;projectedGeoPreviousTransformedResourcePoints;projectedGeoTransformedResourcePoints;resourceMask;resourceMaskBbox;resourceMaskRectangle;resourceFullMask;resourceFullMaskBbox;resourceFullMaskRectangle;previousTransformationType;transformationType;previousInternalProjection;internalProjection;projection;projectedPreviousTransformer;projectedTransformer;projectedTransformerCache;geoMask;geoMaskBbox;geoMaskRectangle;geoFullMask;geoFullMaskBbox;geoFullMaskRectangle;projectedGeoMask;projectedGeoMaskBbox;projectedGeoMaskRectangle;projectedGeoFullMask;projectedGeoFullMaskBbox;projectedGeoFullMaskRectangle;resourceToProjectedGeoScale;previousDistortionMeasure;distortionMeasure;tileZoomLevelForViewport;overviewTileZoomLevelForViewport;projectedGeoBufferedViewportRectangleForViewport;projectedGeoBufferedViewportRectangleBboxForViewport;resourceBufferedViewportRingForViewport;resourceBufferedViewportRingBboxForViewport;resourceBufferedViewportRingBboxAndResourceMaskBboxIntersectionForViewport;fetchableTilesForViewport=[];overviewFetchableTilesForViewport=[];constructor(t,i,n){super();const s={transformationType:i.transformation?.type,internalProjection:i.resourceCrs},r=Ee(s,n),o=U0(xO,r);this.projectedTransformerCache=new Map,this.mapId=t,this.georeferencedMap=i,this.imageInformations=o.imageInformations,this.loadingImageInfo=!1,this.visible=o.visible,this.applyMask=o.applyMask,this.fetchFn=o.fetchFn,this.gcps=this.georeferencedMap.gcps,this.resourceMask=this.applyMask?this.georeferencedMap.resourceMask:this.getResourceFullMask(),this.updateResourceMaskProperties(),this.updateResourceFullMaskProperties(),this.transformationType=o.transformationType,this.previousTransformationType=this.transformationType,this.internalProjection=o.internalProjection,this.previousInternalProjection=this.internalProjection,this.projection=o.projection,this.updateProjectedTransformerProperties()}getViewportMask(t){return this.projectedGeoMask.map(i=>mi(t.projectedGeoToViewportHomogeneousTransform,i))}getViewportMaskBbox(t){return Fe(this.getViewportMask(t))}getViewportMaskRectangle(t){return this.projectedGeoMaskRectangle.map(i=>mi(t.projectedGeoToViewportHomogeneousTransform,i))}getViewportFullMask(t){return this.projectedGeoFullMask.map(i=>mi(t.projectedGeoToViewportHomogeneousTransform,i))}getViewportFullMaskBbox(t){return Fe(this.getViewportFullMask(t))}getViewportFullMaskRectangle(t){return this.projectedGeoFullMaskRectangle.map(i=>mi(t.projectedGeoToViewportHomogeneousTransform,i))}getResourceToViewportScale(t){return ag(this.resourceMaskRectangle,this.getViewportMaskRectangle(t))}getResourceToCanvasScale(t){return this.getResourceToViewportScale(t)/t.devicePixelRatio}getReferenceScale(){return this.getProjectedTransformer("helmert").getToGeoTransformation().getMeasures().scale}getProjectedTransformer(t,i){return i=Jn({projection:this.projection,internalProjection:this.internalProjection},i),i=Jn(Yl,i),W0(this.projectedTransformerCache,t,()=>new ed(this.gcps,t,i)).setProjection(this.projection)}setGcps(t){this.gcps=t,this.clearProjectedTransformerCaches(),this.updateProjectedTransformerProperties(),this.updateGcpsProperties()}setResourceMask(t){this.applyMask=!0,this.resourceMask=t,this.updateResourceMaskProperties(),this.updateResourceFullMaskProperties(),this.updateGeoMaskProperties(),this.updateProjectedGeoMaskProperties()}setTransformationType(t){this.transformationType=t,this.updateProjectedTransformerProperties()}setDistortionMeasure(t){this.distortionMeasure=t}setInternalProjection(t){this.internalProjection=t||Yl.internalProjection||Sn,this.clearProjectedTransformerCaches(),this.updateProjectedTransformerProperties()}setProjection(t){this.projection=t||Yl.projection||Sn,this.updateProjectedTransformerProperties()}setTileZoomLevelForViewport(t){this.tileZoomLevelForViewport=t}setOverviewTileZoomLevelForViewport(t){this.overviewTileZoomLevelForViewport=t}setProjectedGeoBufferedViewportRectangleForViewport(t){this.projectedGeoBufferedViewportRectangleForViewport=t,this.projectedGeoBufferedViewportRectangleBboxForViewport=t?Fe(t):void 0}setResourceBufferedViewportRingForViewport(t){this.resourceBufferedViewportRingForViewport=t,this.resourceBufferedViewportRingBboxForViewport=t?Fe(t):void 0}setResourceBufferedViewportRingBboxAndResourceMaskBboxIntersectionForViewport(t){this.resourceBufferedViewportRingBboxAndResourceMaskBboxIntersectionForViewport=t}setFetchableTilesForViewport(t){this.fetchableTilesForViewport=t}setOverviewFetchableTilesForViewport(t){this.overviewFetchableTilesForViewport=t}resetForViewport(){this.setTileZoomLevelForViewport(),this.setOverviewTileZoomLevelForViewport(),this.setProjectedGeoBufferedViewportRectangleForViewport(),this.setResourceBufferedViewportRingForViewport(),this.setFetchableTilesForViewport([]),this.setOverviewFetchableTilesForViewport([])}resetPrevious(){this.mixed=!1,this.previousTransformationType=this.transformationType,this.previousDistortionMeasure=this.distortionMeasure,this.previousInternalProjection=this.internalProjection,this.projectedPreviousTransformer=Hf(this.projectedTransformer),this.projectedGeoPreviousTransformedResourcePoints=this.projectedGeoTransformedResourcePoints}mixPreviousAndNew(t){this.mixed=!0,this.previousTransformationType=this.transformationType,this.previousDistortionMeasure=this.distortionMeasure,this.previousInternalProjection=this.internalProjection,this.projectedPreviousTransformer=Hf(this.projectedTransformer),this.projectedGeoPreviousTransformedResourcePoints=this.projectedGeoTransformedResourcePoints.map((i,n)=>Sc(i,this.projectedGeoPreviousTransformedResourcePoints[n],t))}hasImageInfo(){return this.parsedImage!==void 0}async loadImageInfo(){try{this.loadingImageInfo=!0;const t=this.georeferencedMap.resource.id;let i;if(this.imageInformations?.get(t))i=this.imageInformations.get(t);else{this.abortController=new AbortController;const n=this.abortController.signal;i=await nS(t,{signal:n},this.fetchFn),this.abortController=void 0,this.imageInformations?.set(t,i)}this.parsedImage=IO.parse(i),this.dispatchEvent(new Rt(st.IMAGEINFOLOADED))}catch(t){throw this.loadingImageInfo=!1,t}finally{this.loadingImageInfo=!1}}updateResourceMaskProperties(){this.resourceMaskBbox=Fe(this.resourceMask),this.resourceMaskRectangle=En(this.resourceMaskBbox)}getResourceFullMask(){const t=this.georeferencedMap.resource.width,i=this.georeferencedMap.resource.height;return t&&i?V0([t,i]):En(this.resourceMaskBbox)}updateResourceFullMaskProperties(){this.resourceFullMask=this.getResourceFullMask(),this.resourceFullMaskBbox=Fe(this.resourceFullMask),this.resourceFullMaskRectangle=En(this.resourceFullMaskBbox)}updateGeoMaskProperties(){this.updateGeoMask(),this.updateFullGeoMask()}updateProjectedGeoMaskProperties(){this.updateProjectedGeoMask(),this.updateProjectedFullGeoMask(),this.updateResourceToProjectedGeoScale()}updateProjectedTransformerProperties(){this.updateProjectedTransformer(),this.updateGeoMaskProperties(),this.updateProjectedGeoMaskProperties(),this.updateGcpsProperties()}updateProjectedTransformer(){this.projectedTransformer=this.getProjectedTransformer(this.transformationType),this.projectedPreviousTransformer||(this.projectedPreviousTransformer=this.projectedTransformer)}updateGeoMask(){this.geoMask=this.projectedTransformer.transformToGeo([this.resourceMask],{projection:nn})[0],this.geoMaskBbox=Fe(this.geoMask),this.geoMaskRectangle=this.projectedTransformer.transformToGeo([this.resourceMaskRectangle],{maxDepth:0,projection:nn})[0]}updateFullGeoMask(){this.geoFullMask=this.projectedTransformer.transformToGeo([this.resourceFullMask],{projection:nn})[0],this.geoFullMaskBbox=Fe(this.geoFullMask),this.geoFullMaskRectangle=this.projectedTransformer.transformToGeo([this.resourceFullMaskRectangle],{maxDepth:0,projection:nn})[0]}updateProjectedGeoMask(){this.projectedGeoMask=this.projectedTransformer.transformToGeo([this.resourceMask])[0],this.projectedGeoMaskBbox=Fe(this.projectedGeoMask),this.projectedGeoMaskRectangle=this.projectedTransformer.transformToGeo([this.resourceMaskRectangle],{maxDepth:0})[0]}updateProjectedFullGeoMask(){this.projectedGeoFullMask=this.projectedTransformer.transformToGeo([this.resourceFullMask])[0],this.projectedGeoFullMaskBbox=Fe(this.projectedGeoFullMask),this.projectedGeoFullMaskRectangle=this.projectedTransformer.transformToGeo([this.resourceFullMaskRectangle],{maxDepth:0})[0]}updateResourceToProjectedGeoScale(){this.resourceToProjectedGeoScale=ag(this.resourceMaskRectangle,this.projectedGeoMaskRectangle)}updateGcpsProperties(){this.projectedGcps=this.gcps.map(({resource:t,geo:i})=>({resource:t,geo:this.projectedTransformer.lonLatToProjection(i)})),this.resourcePoints=this.gcps.map(t=>t.resource),this.geoPoints=this.gcps.map(t=>t.geo),this.projectedGeoPoints=this.projectedGcps.map(t=>t.geo),this.projectedGeoTransformedResourcePoints=this.gcps.map(t=>this.projectedTransformer.transformToGeo(t.resource)),this.projectedGeoPreviousTransformedResourcePoints||(this.projectedGeoPreviousTransformedResourcePoints=this.projectedGeoTransformedResourcePoints)}clearProjectedTransformerCaches(){this.projectedTransformerCache=new Map}destroy(){this.abortController&&this.abortController.abort()}}const jm=["log2sigma","twoOmega"];function bO(){return{}}class AO extends SO{previousResourceResolution;resourceResolution;triangulateErrorCount=0;projectedGcpPreviousTriangulation;projectedGcpTriangulation;resourceTriangulationCache;projectedGcpTriangulationCache;resourceTrianglePoints=[];projectedGeoPreviousTrianglePoints=[];projectedGeoTrianglePoints=[];previousTrianglePointsDistortion=[];trianglePointsDistortion=[];projectedGeoPreviousTriangulationMask=[];projectedGeoTriangulationMask=[];constructor(t,i,n){n={...bO(),...n},super(t,i,n),this.resourceTriangulationCache=new Map,this.projectedGcpTriangulationCache=new Map,this.updateTriangulation()}setGcps(t){super.setGcps(t),this.clearResourceTriangulationCaches(),this.updateTriangulation()}setResourceMask(t){super.setResourceMask(t),this.clearResourceTriangulationCaches(),this.updateTriangulation()}setDistortionMeasure(t){super.setDistortionMeasure(t),this.updateTrianglePointsDistortion()}setInternalProjection(t){super.setInternalProjection(t),this.updateTriangulation()}setProjection(t){super.setProjection(t),this.clearProjectedTriangulationCaches(),this.updateTriangulation()}resetPrevious(){super.resetPrevious(),this.previousResourceResolution=this.resourceResolution,this.projectedGcpPreviousTriangulation=this.projectedGcpTriangulation,this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints,this.previousTrianglePointsDistortion=this.trianglePointsDistortion,this.projectedGeoPreviousTriangulationMask=this.projectedGeoTriangulationMask}mixPreviousAndNew(t){if(super.mixPreviousAndNew(t),this.projectedGcpPreviousTriangulation&&this.projectedGcpTriangulation){const i=this.projectedGcpPreviousTriangulation,n=this.projectedGcpTriangulation;this.previousResourceResolution=this.resourceResolution,this.projectedGcpPreviousTriangulation={resourceResolution:i.resourceResolution,gcpUniquePoints:i.gcpUniquePoints.map((s,r)=>({resource:s.resource,geo:Sc(n.gcpUniquePoints[r].geo,s.geo,t),distortions:n.gcpUniquePoints[r].distortions,distortion:xc(n.gcpUniquePoints[r].distortion||0,s.distortion||0,t)})),uniquePointIndices:i.uniquePointIndices,uniquePointIndexInterpolatedPolygon:i.uniquePointIndexInterpolatedPolygon},this.projectedGeoPreviousTrianglePoints=i.uniquePointIndices.map(s=>i.gcpUniquePoints[s].geo),this.previousTrianglePointsDistortion=i.uniquePointIndices.map(s=>i.gcpUniquePoints[s].distortion)}this.projectedGeoPreviousTriangulationMask=this.projectedGeoTriangulationMask.map((i,n)=>Sc(i,this.projectedGeoPreviousTriangulationMask[n],t))}updateTriangulation(){if(!this.resourceTriangulationCache||!this.projectedGcpTriangulationCache)return;const t=this.projectedTransformer.getToGeoTransformationResolution(this.resourceMaskBbox);let i=!1;t&&this.previousResourceResolution&&(i=this.previousResourceResolution<t,this.resourceResolution=Math.min(t,this.previousResourceResolution)),t&&!this.previousResourceResolution&&(i=!0,this.resourceResolution=t),!t&&this.previousResourceResolution?this.resourceResolution=this.previousResourceResolution:!t&&!this.previousResourceResolution&&(this.resourceResolution=void 0),this.projectedGcpTriangulation=hg(this.projectedGcpTriangulationCache,this.resourceResolution,this.transformationType,this.internalProjection,()=>{const{uniquePoints:n,uniquePointIndexTriangles:s,uniquePointIndexInterpolatedPolygon:r}=W0(this.resourceTriangulationCache,this.resourceResolution,()=>OL([this.resourceMask],this.resourceResolution,{steinerPoints:this.gcps.map(u=>u.resource)})),o=this.resourceResolution,h=n.map(u=>this.projectedTransformer.transformToGeo(u,{distortionMeasures:jm,referenceScale:this.getReferenceScale()},m=>m)),c=s.flat();return{resourceResolution:o,gcpUniquePoints:h,uniquePointIndices:c,uniquePointIndexInterpolatedPolygon:r}}),this.projectedGcpPreviousTriangulation||(this.projectedGcpPreviousTriangulation=this.projectedGcpTriangulation),i&&(this.previousResourceResolution=this.resourceResolution,this.projectedGcpPreviousTriangulation=hg(this.projectedGcpTriangulationCache,this.previousResourceResolution,this.previousTransformationType,this.previousInternalProjection,()=>{if(!this.projectedGcpTriangulation)throw new Error("No projectedGcpTriangulation");const n=this.projectedGcpTriangulation;return{resourceResolution:this.projectedGcpTriangulation.resourceResolution,gcpUniquePoints:this.projectedGcpTriangulation.gcpUniquePoints.map(s=>this.projectedPreviousTransformer.transformToGeo(s.resource,{distortionMeasures:jm,referenceScale:this.getReferenceScale()},r=>r)),uniquePointIndices:this.projectedGcpTriangulation.uniquePointIndices,uniquePointIndexInterpolatedPolygon:n.uniquePointIndexInterpolatedPolygon}},()=>!this.mixed,()=>!this.mixed)),this.updateTrianglePoints()}updateTrianglePoints(){if(!this.projectedGcpPreviousTriangulation||!this.projectedGcpTriangulation)return;const t=this.projectedGcpPreviousTriangulation,i=this.projectedGcpTriangulation;this.resourceTrianglePoints=this.projectedGcpTriangulation.uniquePointIndices.map(n=>i.gcpUniquePoints[n].resource),this.projectedGeoPreviousTrianglePoints=this.projectedGcpPreviousTriangulation.uniquePointIndices.map(n=>t.gcpUniquePoints[n].geo),this.projectedGeoTrianglePoints=this.projectedGcpTriangulation.uniquePointIndices.map(n=>i.gcpUniquePoints[n].geo),this.projectedGeoPreviousTriangulationMask=this.projectedGcpPreviousTriangulation.uniquePointIndexInterpolatedPolygon.map(n=>n.map(s=>t.gcpUniquePoints[s].geo)).flat(),this.projectedGeoTriangulationMask=this.projectedGcpTriangulation.uniquePointIndexInterpolatedPolygon.map(n=>n.map(s=>i.gcpUniquePoints[s].geo)).flat(),this.updateTrianglePointsDistortion()}updateTrianglePointsDistortion(){if(!this.projectedGcpPreviousTriangulation||!this.projectedGcpTriangulation)return;const t=this.projectedGcpPreviousTriangulation,i=this.projectedGcpTriangulation;this.previousTrianglePointsDistortion=t.uniquePointIndices.map(n=>{const s=t.gcpUniquePoints[n].distortions;return!this.previousDistortionMeasure||!s?0:s.get(this.previousDistortionMeasure)}),this.trianglePointsDistortion=i.uniquePointIndices.map(n=>{const s=i.gcpUniquePoints[n].distortions;return!this.distortionMeasure||!s?0:s.get(this.distortionMeasure)})}updateProjectedTransformerProperties(){super.updateProjectedTransformerProperties(),this.updateTriangulation()}clearProjectedTransformerCaches(){super.clearProjectedTransformerCaches(),this.clearResourceTriangulationCaches()}clearResourceTriangulationCaches(){this.resourceTriangulationCache=new Map,this.clearProjectedTriangulationCaches()}clearProjectedTriangulationCaches(){this.projectedGcpTriangulationCache=new Map}}function Mi(e,t,i){const n=e.createShader(t);if(n){if(e.shaderSource(n,i),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))return n;{const r=e.getShaderInfoLog(n);throw e.deleteShader(n),new Error("Failed to compile shader: "+r)}}else throw new Error("Failed to create shader")}function Hs(e,t,i){const n=e.createProgram();if(n){if(e.attachShader(n,t),e.attachShader(n,i),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS))return n;{const r=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error("Failed to link program: "+r)}}else throw new Error("Failed to create program")}function Ce(e,t,i,n,s){const r=e.createBuffer();if(!r)throw new Error("Failed to create buffer");e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW);const o=e.FLOAT,a=!1,h=0,c=0,u=e.getAttribLocation(t,s);return e.vertexAttribPointer(u,n,o,a,h,c),e.enableVertexAttribArray(u),r}const TO=200,RO={leading:!0,trailing:!0},Za={viewportSize:6,color:Lu,viewportBorderSize:0,borderColor:o_},Ua={viewportSize:16,color:Lu,viewportBorderSize:1,borderColor:o_},PO={renderGcps:!1,renderGcpsColor:gA,renderTransformedGcps:!1,renderTransformedGcpsColor:Sg,renderVectors:!1,renderMask:!1,renderMaskSize:8,renderMaskColor:Sg,renderFullMask:!1,renderFullMaskSize:8,renderFullMaskColor:p_},GO=1,LO=1,OO=5,FO=1;function NO(e,t,i,n){return(s,r,o)=>new DO(s,r,e,t,i,n,o)}class DO extends AO{webgl2WarpedMapOptions;gl;mapProgram;linesProgram;pointsProgram;mapVao=null;linesVao=null;pointsVao=null;lineLayers=[];pointLayers=[];cachedTilesByTileKey;cachedTilesByTileUrl;cachedTilesForTexture=[];previousCachedTilesForTexture=[];opacity=GO;saturation=LO;renderOptions={};cachedTilesTextureArray=null;cachedTilesResourceOriginPointsAndDimensionsTexture=null;cachedTilesScaleFactorsTexture=null;invertedRenderHomogeneousTransform;throttledUpdateTextures;constructor(t,i,n,s,r,o,a){super(t,i,a),this.cachedTilesByTileKey=new Map,this.cachedTilesByTileUrl=new Map,this.webgl2WarpedMapOptions=Ee(PO,a),this.gl=n,this.initializeWebGL(s,r,o),this.invertedRenderHomogeneousTransform=EO(),this.throttledUpdateTextures=vc(this.updateTextures.bind(this),TO,RO)}initializeWebGL(t,i,n){this.mapProgram=t,this.linesProgram=i,this.pointsProgram=n,this.mapVao=this.gl.createVertexArray(),this.linesVao=this.gl.createVertexArray(),this.pointsVao=this.gl.createVertexArray(),this.cachedTilesTextureArray=this.gl.createTexture(),this.cachedTilesScaleFactorsTexture=this.gl.createTexture(),this.cachedTilesResourceOriginPointsAndDimensionsTexture=this.gl.createTexture()}updateVertexBuffers(t,i){this.invertedRenderHomogeneousTransform=Id(t),i.renderMaps&&this.updateVertexBuffersMap(t),i.renderLines&&this.updateVertexBuffersLines(t),i.renderPoints&&this.updateVertexBuffersPoints(t)}clearTextures(){this.throttledUpdateTextures()}addCachedTileAndUpdateTextures(t){this.cachedTilesByTileKey.set(t.tileKey,t),this.cachedTilesByTileUrl.set(t.tileUrl,t),this.throttledUpdateTextures()}removeCachedTileAndUpdateTextures(t){const i=this.cachedTilesByTileUrl.get(t);i&&this.cachedTilesByTileKey.delete(i.tileKey),this.cachedTilesByTileUrl.delete(t),this.throttledUpdateTextures()}cancelThrottledFunctions(){this.throttledUpdateTextures.cancel()}destroy(){this.gl.deleteVertexArray(this.mapVao),this.gl.deleteVertexArray(this.linesVao),this.gl.deleteVertexArray(this.pointsVao),this.gl.deleteTexture(this.cachedTilesTextureArray),this.gl.deleteTexture(this.cachedTilesScaleFactorsTexture),this.gl.deleteTexture(this.cachedTilesResourceOriginPointsAndDimensionsTexture),this.cancelThrottledFunctions(),super.destroy()}setLineLayers(){this.lineLayers=[],this.webgl2WarpedMapOptions.renderVectors&&this.lineLayers.push({projectedGeoLines:ng(this.projectedGeoPoints,this.projectedGeoTransformedResourcePoints),projectedGeoPreviousLines:ng(this.projectedGeoPoints,this.projectedGeoPreviousTransformedResourcePoints),viewportSize:this.webgl2WarpedMapOptions.renderVectorsSize,color:this.webgl2WarpedMapOptions.renderVectorsColor,viewportBorderSize:this.webgl2WarpedMapOptions.renderVectorsBorderSize,borderColor:this.webgl2WarpedMapOptions.renderVectorsBorderColor}),this.webgl2WarpedMapOptions.renderMask&&this.lineLayers.push({projectedGeoLines:bl(this.projectedGeoTriangulationMask),projectedGeoPreviousLines:bl(this.projectedGeoPreviousTriangulationMask),viewportSize:this.webgl2WarpedMapOptions.renderMaskSize,color:this.webgl2WarpedMapOptions.renderMaskColor,viewportBorderSize:this.webgl2WarpedMapOptions.renderMaskBorderSize,borderColor:this.webgl2WarpedMapOptions.renderMaskBorderColor}),this.webgl2WarpedMapOptions.renderFullMask&&this.lineLayers.push({projectedGeoLines:bl(this.projectedGeoFullMask),viewportSize:this.webgl2WarpedMapOptions.renderFullMaskSize,color:this.webgl2WarpedMapOptions.renderFullMaskColor,viewportBorderSize:this.webgl2WarpedMapOptions.renderFullMaskBorderSize,borderColor:this.webgl2WarpedMapOptions.renderFullMaskBorderColor})}setPointLayers(){this.pointLayers=[],this.webgl2WarpedMapOptions.renderGcps&&this.pointLayers.push({projectedGeoPoints:this.projectedGeoPoints,viewportSize:this.webgl2WarpedMapOptions.renderGcpsSize,color:this.webgl2WarpedMapOptions.renderGcpsColor,viewportBorderSize:this.webgl2WarpedMapOptions.renderGcpsBorderSize,borderColor:this.webgl2WarpedMapOptions.renderGcpsBorderColor}),this.webgl2WarpedMapOptions.renderTransformedGcps&&this.pointLayers.push({projectedGeoPoints:this.projectedGeoTransformedResourcePoints,projectedGeoPreviousPoints:this.projectedGeoPreviousTransformedResourcePoints,viewportSize:this.webgl2WarpedMapOptions.renderTransformedGcpsSize,color:this.webgl2WarpedMapOptions.renderTransformedGcpsColor,viewportBorderSize:this.webgl2WarpedMapOptions.renderTransformedGcpsBorderSize,borderColor:this.webgl2WarpedMapOptions.renderTransformedGcpsBorderColor})}updateVertexBuffersMap(t){if(!this.mapVao)return;const i=this.gl,n=this.mapProgram;i.bindVertexArray(this.mapVao),Ce(i,n,new Float32Array(this.resourceTrianglePoints.flat()),2,"a_resourceTrianglePoint");const s=this.projectedGeoPreviousTrianglePoints.map(a=>mi(t,a));Ce(i,n,new Float32Array(s.flat()),2,"a_clipPreviousTrianglePoint");const r=this.projectedGeoTrianglePoints.map(a=>mi(t,a));Ce(i,n,new Float32Array(r.flat()),2,"a_clipTrianglePoint"),Ce(i,n,new Float32Array(this.previousTrianglePointsDistortion),1,"a_previousTrianglePointDistortion"),Ce(i,n,new Float32Array(this.trianglePointsDistortion),1,"a_trianglePointDistortion");const o=new Float32Array(this.resourceTrianglePoints.length).map((a,h)=>h);Ce(i,n,o,1,"a_trianglePointIndex")}updateVertexBuffersLines(t){if(!this.linesVao)return;const i=this.gl,n=this.linesProgram;i.bindVertexArray(this.linesVao),this.setLineLayers();const s=this.lineLayers.reduce((w,v)=>w.concat(v.projectedGeoLines),[]).map(w=>[w[0],w[0],w[0],w[1],w[1],w[1]]).flat().map(w=>mi(t,w));Ce(i,n,new Float32Array(s.flat()),2,"a_clipPoint");const r=this.lineLayers.reduce((w,v)=>w.concat(v.projectedGeoLines),[]).map(w=>[w[1],w[1],w[1],w[0],w[0],w[0]]).flat().map(w=>mi(t,w));Ce(i,n,new Float32Array(r.flat()),2,"a_clipOtherPoint");const o=this.lineLayers.reduce((w,v)=>w.concat(v.projectedGeoPreviousLines||v.projectedGeoLines),[]).map(w=>[w[0],w[0],w[0],w[1],w[1],w[1]]).flat().map(w=>mi(t,w));Ce(i,n,new Float32Array(o.flat()),2,"a_clipPreviousPoint");const a=this.lineLayers.reduce((w,v)=>w.concat(v.projectedGeoPreviousLines||v.projectedGeoLines),[]).map(w=>[w[1],w[1],w[1],w[0],w[0],w[0]]).flat().map(w=>mi(t,w));Ce(i,n,new Float32Array(a.flat()),2,"a_clipPreviousOtherPoint");const h=this.lineLayers.reduce((w,v)=>w.concat(v.projectedGeoLines.flatMap(I=>[0,0,1,0,0,1])),[]);Ce(i,n,new Float32Array(h),1,"a_isOtherPoint");const c=this.lineLayers.reduce((w,v)=>w.concat(v.projectedGeoLines.flatMap(I=>[1,-1,1,1,-1,1])),[]);Ce(i,n,new Float32Array(c),1,"a_normalSign");const u=this.lineLayers.reduce((w,v)=>w.concat(v.projectedGeoLines.flatMap(I=>Array(6).fill(v.viewportSize??Za.viewportSize))),[]);Ce(i,n,new Float32Array(u),1,"a_viewportSize");const m=this.lineLayers.reduce((w,v)=>w.concat(v.projectedGeoLines.flatMap(I=>Array(6).fill(Fa(v.color??Za.color)))),[]);Ce(i,n,new Float32Array(m.flat()),4,"a_color");const p=this.lineLayers.reduce((w,v)=>w.concat(v.projectedGeoLines.flatMap(I=>Array(6).fill(v.viewportBorderSize??Za.viewportBorderSize))),[]);Ce(i,n,new Float32Array(p),1,"a_viewportBorderSize");const y=this.lineLayers.reduce((w,v)=>w.concat(v.projectedGeoLines.flatMap(I=>Array(6).fill(Fa(v.borderColor??Za.borderColor)))),[]);Ce(i,n,new Float32Array(y.flat()),4,"a_borderColor")}updateVertexBuffersPoints(t){if(!this.pointsVao)return;const i=this.gl,n=this.pointsProgram;i.bindVertexArray(this.pointsVao),this.setPointLayers();const s=this.pointLayers.reduce((u,m)=>u.concat(m.projectedGeoPoints),[]).map(u=>mi(t,u));Ce(i,n,new Float32Array(s.flat()),2,"a_clipPoint");const r=this.pointLayers.reduce((u,m)=>u.concat(m.projectedGeoPreviousPoints||m.projectedGeoPoints),[]).map(u=>mi(t,u));Ce(i,n,new Float32Array(r.flat()),2,"a_clipPreviousPoint");const o=this.pointLayers.reduce((u,m)=>u.concat(m.projectedGeoPoints.map(p=>m.viewportSize??Ua.viewportSize)),[]);Ce(i,n,new Float32Array(o),1,"a_viewportSize");const a=this.pointLayers.reduce((u,m)=>u.concat(m.projectedGeoPoints.map(p=>Fa(m.color??Ua.color))),[]);Ce(i,n,new Float32Array(a.flat()),4,"a_color");const h=this.pointLayers.reduce((u,m)=>u.concat(m.projectedGeoPoints.map(p=>m.viewportBorderSize??Ua.viewportBorderSize)),[]);Ce(i,n,new Float32Array(h),1,"a_viewportBorderSize");const c=this.pointLayers.reduce((u,m)=>u.concat(m.projectedGeoPoints.map(p=>Fa(m.borderColor??Ua.borderColor))),[]);Ce(i,n,new Float32Array(c.flat()),4,"a_borderColor")}async updateTextures(){const t=this.gl;if(this.updateCachedTilesForTextures(),this.cachedTilesForTexture.length!==0&&ub(this.previousCachedTilesForTexture.map(a=>a.tileUrl),this.cachedTilesForTexture.map(a=>a.tileUrl)))return;const i=Math.max(...this.parsedImage.tileZoomLevels.map(a=>a.width)),n=Math.max(...this.parsedImage.tileZoomLevels.map(a=>a.height)),s=this.cachedTilesForTexture.length;t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.bindTexture(t.TEXTURE_2D_ARRAY,this.cachedTilesTextureArray),t.texImage3D(t.TEXTURE_2D_ARRAY,0,t.RGBA,i,n,s,0,t.RGBA,t.UNSIGNED_BYTE,null);for(let a=0;a<this.cachedTilesForTexture.length;a++){const h=this.cachedTilesForTexture[a].data,c=t.createBuffer();t.bindBuffer(t.PIXEL_UNPACK_BUFFER,c),t.bufferData(t.PIXEL_UNPACK_BUFFER,h.data,t.STATIC_DRAW),t.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,a,h.width,h.height,1,t.RGBA,t.UNSIGNED_BYTE,0),t.bindBuffer(t.PIXEL_UNPACK_BUFFER,null)}t.texParameteri(t.TEXTURE_2D_ARRAY,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D_ARRAY,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D_ARRAY,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D_ARRAY,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const r=this.cachedTilesForTexture.map(a=>{if(a&&a.imageRequest&&a.imageRequest.region)return[a.imageRequest.region.x,a.imageRequest.region.y,a.imageRequest.region.width,a.imageRequest.region.height]});t.bindTexture(t.TEXTURE_2D,this.cachedTilesResourceOriginPointsAndDimensionsTexture),t.texImage2D(t.TEXTURE_2D,0,t.R32I,1,this.cachedTilesForTexture.length*4,0,t.RED_INTEGER,t.INT,new Int32Array(r.flat())),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const o=this.cachedTilesForTexture.map(a=>a.tile.tileZoomLevel.scaleFactor);t.bindTexture(t.TEXTURE_2D,this.cachedTilesScaleFactorsTexture),t.texImage2D(t.TEXTURE_2D,0,t.R32I,1,this.cachedTilesForTexture.length,0,t.RED_INTEGER,t.INT,new Int32Array(o)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.dispatchEvent(new Rt(st.TEXTURESUPDATED))}updateCachedTilesForTextures(){const t=[],i=[],n=[];for(const o of this.fetchableTilesForViewport){const a=this.cachedTilesByTileUrl.get(o.tileUrl);if(a)t.push(a);else for(const h of this.getCachedTilesAtOtherScaleFactors(o.tile))i.push(h)}for(const o of this.overviewFetchableTilesForViewport){const a=this.cachedTilesByTileUrl.get(o.tileUrl);if(a){const h=this.tileZoomLevelForViewport?this.tileZoomLevelForViewport.rows*this.tileZoomLevelForViewport.columns:void 0;(t.length===0||h&&t.length<h)&&n.push(a)}}let s=[...t,...i,...n];const r=new Map;s.forEach(o=>r.set(o.tileUrl,o)),s=[...r.values()],this.previousCachedTilesForTexture=this.cachedTilesForTexture,this.cachedTilesForTexture=s}getCachedTilesAtOtherScaleFactors(t){if(this.cachedTilesByTileUrl.size===0)return[];if(!this.tileZoomLevelForViewport)return[];const i=[];for(t of TA(t,this.parsedImage,this.tileZoomLevelForViewport.scaleFactor,FO,OO,this.tileInCachedTiles.bind(this))){const n=this.tileToCachedTile(t);if(n)i.push(n);else throw new Error("Tile supposed to be in cache isn't.")}return i}tileToCachedTile(t){return this.cachedTilesByTileKey.get(Pc(t))}tileInCachedTiles(t){return this.cachedTilesByTileKey.has(Pc(t))}}class kO extends EventTarget{tile;imageRequest;tileUrl;tileKey;fetchFn;abortController;data;constructor(t,i){super(),this.tile=t.tile,this.imageRequest=t.imageRequest,this.tileUrl=t.tileUrl,this.tileKey=t.tileKey,this.fetchFn=i,this.abortController=new AbortController}isCachedTile(){return this.data!==void 0}abort(){this.abortController.signal.aborted||this.abortController.abort()}}class Ed extends kO{#t;constructor(t,i,n){super(t,n),this.#t=i}async fetch(){try{this.#t.getImageData(this.tileUrl,b0(()=>this.abortController.abort()),this.fetchFn,this.tile.tileZoomLevel.width,this.tile.tileZoomLevel.height).then(t=>{this.data=t,this.dispatchEvent(new Rt(st.TILEFETCHED,this.tileUrl))}).catch(t=>{t instanceof Error&&t.name==="AbortError"?console.log("Fetch aborted"):console.error(t)})}catch(t){t instanceof Error&&t.name==="AbortError"||this.dispatchEvent(new Rt(st.TILEFETCHERROR,this.tileUrl))}return this.data}static createFactory(t){return(i,n)=>new Ed(i,t,n)}}const ro={rotation:0,devicePixelRatio:1,projection:Sn},Xa={zoom:1},Kl={fit:"contain"};class ia{geoCenter;geoRectangle;geoSize;geoResolution;geoRectangleBbox;projection;projectedGeoCenter;projectedGeoRectangle;projectedGeoSize;projectedGeoResolution;projectedGeoRectangleBbox;rotation;projectedGeoPerViewportScale;viewportCenter;viewportRectangle;viewportSize;viewportResolution;viewportBbox;devicePixelRatio;canvasCenter;canvasRectangle;canvasSize;canvasResolution;canvasBbox;projectedGeoPerCanvasScale;projectedGeoToViewportHomogeneousTransform=[1,0,0,1,0,0];projectedGeoToCanvasHomogeneousTransform=[1,0,0,1,0,0];projectedGeoToClipHomogeneousTransform=[1,0,0,1,0,0];viewportToClipHomogeneousTransform=[1,0,0,1,0,0];constructor(t,i,n,s){const r=Ee(ro,s);this.projectedGeoCenter=i,this.projectedGeoPerViewportScale=n,this.rotation=r.rotation,this.viewportSize=[Math.round(t[0]),Math.round(t[1])],this.devicePixelRatio=r.devicePixelRatio,this.projection=r.projection,this.projectedGeoRectangle=this.computeProjectedGeoRectangle(this.viewportSize,this.projectedGeoPerViewportScale,this.rotation,this.projectedGeoCenter),this.projectedGeoRectangleBbox=Fe(this.projectedGeoRectangle),this.projectedGeoSize=Rl(this.viewportSize,n),this.projectedGeoResolution=mo(this.projectedGeoSize),this.geoRectangle=this.projectedGeoRectangle.map(o=>pi(this.projection.definition,nn.definition,o)),this.geoRectangleBbox=Fe(this.geoRectangle),this.geoCenter=xs(this.geoRectangleBbox),this.geoSize=Ka(this.geoRectangleBbox),this.geoResolution=mo(this.geoSize),this.viewportResolution=mo(this.viewportSize),this.viewportCenter=sb(this.viewportSize),this.viewportBbox=Tc(this.viewportSize),this.viewportRectangle=En(this.viewportBbox),this.canvasCenter=bc(this.viewportCenter,this.devicePixelRatio),this.canvasSize=Rl(this.viewportSize,this.devicePixelRatio),this.canvasResolution=mo(this.canvasSize),this.canvasBbox=Tc(this.canvasSize),this.canvasRectangle=En(this.canvasBbox),this.projectedGeoPerCanvasScale=this.projectedGeoPerViewportScale/this.devicePixelRatio,this.projectedGeoToViewportHomogeneousTransform=this.composeProjectedGeoToViewportHomogeneousTransform(),this.projectedGeoToCanvasHomogeneousTransform=this.composeProjectedGeoToCanvasHomogeneousTransform(),this.projectedGeoToClipHomogeneousTransform=this.composeProjectedGeoToClipHomogeneousTransform(),this.viewportToClipHomogeneousTransform=this.composeViewportToClipHomogeneousTransform()}static fromSizeAndMaps(t,i,n){const s=i.getMapsConvexHull(n);if(!s)throw new Error("Maps have no projected convex hull. Possibly because WarpedMapList or Array is empty.");return this.fromSizeAndProjectedGeoPolygon(t,[s],n)}static fromSizeAndGeoPolygon(t,i,n){const s=Ee({...ro,...Xa,...Kl},n),r=i.map(o=>o.map(a=>pi(s.projection.definition,a)));return this.fromSizeAndProjectedGeoPolygon(t,r,n)}static fromSizeAndProjectedGeoPolygon(t,i,n){const s=Ee({...ro,...Xa,...Kl},n),r=i[0],o=Al(r,-s.rotation),a=Fe(o),h=Ka(a),c=xs(a),u=B0(h,t,s.fit),m=ph(c,s.rotation);return new ia(t,m,u*s.zoom,s)}static fromScaleAndMaps(t,i,n){const s=i.getMapsConvexHull(n);if(!s)throw new Error("Maps have no projected convex hull. Possibly because WarpedMapList or Array is empty.");return this.fromScaleAndProjectedGeoPolygon(t,[s],n)}static fromScaleAndGeoPolygon(t,i,n){const s=Ee({...ro,...Xa,...Kl},n),r=i.map(o=>o.map(a=>pi(s.projection.definition,a)));return this.fromScaleAndProjectedGeoPolygon(t,r,n)}static fromScaleAndProjectedGeoPolygon(t,i,n){const s=Ee({...ro,...Xa},n),r=i[0],o=PS(Al(r,-s.rotation),1/t),a=Fe(o),h=Ka(a),c=xs(a),u=ph(bc(c,t),s.rotation);return new ia(h,u,t*s.zoom,s)}getProjectedGeoBufferedRectangle(t){const i=j0(this.viewportBbox,t);return En(i).map(s=>mi(Id(this.projectedGeoToViewportHomogeneousTransform),s))}composeProjectedGeoToViewportHomogeneousTransform(){return za(this.viewportCenter[0],this.viewportCenter[1],1/this.projectedGeoPerViewportScale,-1/this.projectedGeoPerViewportScale,-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}composeProjectedGeoToCanvasHomogeneousTransform(){return za(this.canvasCenter[0],this.canvasCenter[1],1/this.projectedGeoPerCanvasScale,-1/this.projectedGeoPerCanvasScale,-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}composeProjectedGeoToClipHomogeneousTransform(){return za(0,0,2/(this.projectedGeoPerViewportScale*this.viewportSize[0]),2/(this.projectedGeoPerViewportScale*this.viewportSize[1]),-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}composeViewportToClipHomogeneousTransform(){return za(0,0,2/this.viewportSize[0],-2/this.viewportSize[1],0,-this.viewportCenter[0],-this.viewportCenter[1])}computeProjectedGeoRectangle(t,i,n,s){const r=Rl(t,i),o=V0(r),a=sg(o,mh(...o),"substract"),h=Al(a,n);return sg(h,s)}}var Bm=`#version 300 es

precision highp float;

float easing(float t) {
  return t;

  
  
}

uniform mat4 u_renderHomogeneousTransform;
uniform float u_animationProgress;

in vec2 a_resourceTrianglePoint;
in vec2 a_clipPreviousTrianglePoint;
in vec2 a_clipTrianglePoint;
in float a_previousTrianglePointDistortion;
in float a_trianglePointDistortion;
in float a_trianglePointIndex;

out vec2 v_resourceTrianglePoint;
out float v_trianglePointDistortion;
out float v_trianglePointIndex;
out vec4 v_trianglePointBarycentric;

void main() {
  
  vec2 clipTrianglePoint = mix(a_clipPreviousTrianglePoint, a_clipTrianglePoint, easing(u_animationProgress));
  float trianglePointDistortion = mix(a_previousTrianglePointDistortion, a_trianglePointDistortion, easing(u_animationProgress));

  
  
  

  gl_Position = u_renderHomogeneousTransform * vec4(clipTrianglePoint, 0.0f, 1.0f);

  
  v_resourceTrianglePoint = a_resourceTrianglePoint;
  v_trianglePointDistortion = trianglePointDistortion;
  v_trianglePointIndex = a_trianglePointIndex;

  float trianglePointLocalIndex = mod(a_trianglePointIndex, 3.0f);
  if(trianglePointLocalIndex == 0.0f)
    v_trianglePointBarycentric = vec4(1.0f, 0, 0, 1.0f);
  if(trianglePointLocalIndex == 1.0f)
    v_trianglePointBarycentric = vec4(0.0f, 1.0f, 0, 1.0f);
  if(trianglePointLocalIndex == 2.0f)
    v_trianglePointBarycentric = vec4(0.0f, 0, 1.0f, 1.0f);
}`,Vm=`#version 300 es

precision highp float;
precision highp isampler2D;

float easing(float t) {
  return t;

  
  
}

uniform float u_debug;

uniform bool u_removeColor;
uniform vec3 u_removeColorOptionsColor;
uniform float u_removeColorOptionsThreshold;
uniform float u_removeColorOptionsHardness;

uniform bool u_colorize;
uniform vec3 u_colorizeOptionsColor;

uniform bool u_grid;

uniform float u_opacity;
uniform float u_saturation;

uniform bool u_distortion;
uniform int u_distortionOptionsdistortionMeasure;

uniform int u_scaleFactorForViewport;

uniform lowp sampler2DArray u_cachedTilesTextureArray;
uniform isampler2D u_cachedTilesResourceOriginPointsAndDimensionsTexture;
uniform isampler2D u_cachedTilesScaleFactorsTexture;

uniform vec4 u_colorDistortion00;
uniform vec4 u_colorDistortion01;
uniform vec4 u_colorDistortion1;
uniform vec4 u_colorDistortion2;
uniform vec4 u_colorDistortion3;
uniform vec4 u_colorGrid;

in vec2 v_resourceTrianglePoint;
in float v_trianglePointDistortion;
in float v_trianglePointIndex;
in vec4 v_trianglePointBarycentric;

out vec4 color;

void main() {
  float resourceTrianglePointX = v_resourceTrianglePoint.x;
  float resourceTrianglePointY = v_resourceTrianglePoint.y;

  
  ivec3 cachedTilesTextureSize = textureSize(u_cachedTilesTextureArray, 0);
  int cachedTilesCount = cachedTilesTextureSize.z;

  
  int smallestScaleFactor;
  bool found = false;
  int foundIndex;

  
  vec3 cachedTilesTexturePoint = vec3(0.0f, 0.0f, 0.0f);

  
  color = vec4(0.0f, 0.0f, 0.0f, 0.0f);

  
  for(int index = 0; index < cachedTilesCount; index += 1) {

    
    float cachedTileResourceOriginPointX = float(texelFetch(u_cachedTilesResourceOriginPointsAndDimensionsTexture, ivec2(0, (index * 4)), 0));
    float cachedTileResourceOriginPointY = float(texelFetch(u_cachedTilesResourceOriginPointsAndDimensionsTexture, ivec2(0, (index * 4) + 1), 0));
    float cachedTileDimensionWidth = float(texelFetch(u_cachedTilesResourceOriginPointsAndDimensionsTexture, ivec2(0, (index * 4) + 2), 0));
    float cachedTileDimensionHeight = float(texelFetch(u_cachedTilesResourceOriginPointsAndDimensionsTexture, ivec2(0, (index * 4) + 3), 0));

    int cachedTileScaleFactor = texelFetch(u_cachedTilesScaleFactorsTexture, ivec2(0, index), 0).r;

    
    if(resourceTrianglePointX >= cachedTileResourceOriginPointX &&
      resourceTrianglePointX < cachedTileResourceOriginPointX + cachedTileDimensionWidth &&
      resourceTrianglePointY >= cachedTileResourceOriginPointY &&
      resourceTrianglePointY < cachedTileResourceOriginPointY + cachedTileDimensionHeight) {

      
      
      
      
      
      if(!(smallestScaleFactor > 0) || cachedTileScaleFactor <= smallestScaleFactor) {
        smallestScaleFactor = cachedTileScaleFactor;
        found = true;
        foundIndex = index;

        float cachedTilePointX = (resourceTrianglePointX - cachedTileResourceOriginPointX) / float(cachedTileScaleFactor);
        float cachedTilePointY = (resourceTrianglePointY - cachedTileResourceOriginPointY) / float(cachedTileScaleFactor);

        float cachedTilesTexturePointX = cachedTilePointX / float(cachedTilesTextureSize.x);
        float cachedTilesTexturePointY = cachedTilePointY / float(cachedTilesTextureSize.y);

        cachedTilesTexturePoint = vec3(cachedTilesTexturePointX, cachedTilesTexturePointY, index);
      }
    }
  }

  if(found == true) {
    
    color = texture(u_cachedTilesTextureArray, cachedTilesTexturePoint);

    if(u_removeColorOptionsThreshold > 0.0f) {
  vec3 backgroundColorDiff = color.rgb - u_removeColorOptionsColor.rgb;
  float backgroundColorDistance = length(backgroundColorDiff);
  if(u_removeColor && backgroundColorDistance < u_removeColorOptionsThreshold) {
    float amount = smoothstep(u_removeColorOptionsThreshold - u_removeColorOptionsThreshold * (1.0f - u_removeColorOptionsHardness), u_removeColorOptionsThreshold, backgroundColorDistance);
    color = vec4(color.rgb * amount, amount);
  }
}

float gray = 0.21f * color.r + 0.71f * color.g + 0.07f * color.b;
color = vec4(color.rgb * (u_saturation) + (gray * (1.0f - u_saturation)), color.a);

if(u_colorize) {
  color = vec4((u_colorizeOptionsColor + color.rgb) * color.a, color.a);
}

color = vec4(color.rgb * u_opacity, color.a * u_opacity);
    if(u_distortion) {
  
  

  float trianglePointDistortion = v_trianglePointDistortion;

  
  
  trianglePointDistortion = floor(trianglePointDistortion * 10.0f) / 10.0f;

  
  float trianglePointDistortionMix = clamp(trianglePointDistortion, -1.0f, 1.0f);

  switch(u_distortionOptionsdistortionMeasure) {
    case 0:
      if(trianglePointDistortion > 0.0f) {
        color = mix(color, u_colorDistortion00, trianglePointDistortionMix);
      } else {
        color = mix(color, u_colorDistortion01, abs(trianglePointDistortionMix));
      }
      break;
    case 1:
      color = mix(color, u_colorDistortion1, trianglePointDistortionMix);
      break;
    case 2:
      color = mix(color, u_colorDistortion2, trianglePointDistortionMix);
      break;
    case 3:
      color = trianglePointDistortion == -1.0f ? u_colorDistortion3 : color;
      break;
    default:
      color = color;
  }
}

if(u_grid) {
  float gridSize = 20.0f * float(u_scaleFactorForViewport);
  float gridWidth = 2.0f * float(u_scaleFactorForViewport);
  if(mod(float(resourceTrianglePointX) + gridWidth / 2.0f, gridSize) < gridWidth || mod(float(resourceTrianglePointY) + gridWidth / 2.0f, gridSize) < gridWidth) {
    color = u_colorGrid;
  }
}
    if(bool(u_debug)) {
  float viewportWidth = 4.0;

  

  
  
  

  float barycentricTriangleDist = min(min(v_trianglePointBarycentric.x, v_trianglePointBarycentric.y), v_trianglePointBarycentric.z);
  
  
  float barycentricTriangleDistPixelSize = length(vec2(dFdx(barycentricTriangleDist), dFdy(barycentricTriangleDist)));
  
  float TriangleDistThreshold = viewportWidth * barycentricTriangleDistPixelSize / 2.0;

  if(barycentricTriangleDist < TriangleDistThreshold) {
    color = vec4(0.0, 0.0, 0.0, 1.0);
  }

  

  float resourceDist = min(cachedTilesTexturePoint.x, cachedTilesTexturePoint.y);
  
  
  float resourceDistPixelSize = length(vec2(dFdx(resourceDist), dFdy(resourceDist)));
  float resourceDistThreshold = viewportWidth * resourceDistPixelSize;

  if(resourceDist < resourceDistThreshold) {
    color = vec4(0.0, 0.0, 1.0, 1.0);
  }
}
  }
}`,Wm=`#version 300 es

precision highp float;

float easing(float t) {
  return t;

  
  
}

uniform mat4 u_renderHomogeneousTransform;
uniform mat4 u_viewportToClipHomogeneousTransform;
uniform mat4 u_clipToViewportHomogeneousTransform;
uniform float u_animationProgress;

in vec2 a_clipPoint;
in vec2 a_clipOtherPoint;
in vec2 a_clipPreviousPoint;
in vec2 a_clipPreviousOtherPoint;
in float a_isOtherPoint;
in float a_normalSign;
in float a_viewportSize;
in vec4 a_color;
in float a_viewportBorderSize;
in vec4 a_borderColor;

out float v_viewportLineLength;
out vec2 v_linePoint;
out float v_viewportSize;
out vec4 v_color;
out float v_viewportBorderSize;
out vec4 v_borderColor;
out float v_viewportFeatherSize;
out float v_viewportTotalSize;

void main() {
  vec2 clipPoint = mix(a_clipPreviousPoint, a_clipPoint, easing(u_animationProgress));
  vec2 clipOtherPoint = mix(a_clipPreviousOtherPoint, a_clipOtherPoint, easing(u_animationProgress));

  vec2 viewportPoint = (u_clipToViewportHomogeneousTransform * u_renderHomogeneousTransform * vec4(clipPoint, 0.0f, 1.0f)).xy;
  vec2 viewportOtherPoint = (u_clipToViewportHomogeneousTransform * u_renderHomogeneousTransform * vec4(clipOtherPoint, 0.0f, 1.0f)).xy;

  vec2 viewportLine = vec2(viewportOtherPoint.x-viewportPoint.x, viewportOtherPoint.y-viewportPoint.y);
  vec2 viewportNormalizedLine = normalize(viewportLine);
  vec2 viewportNormalizedLineNormal = vec2(viewportNormalizedLine.y, -viewportNormalizedLine.x);
  v_viewportLineLength = length(viewportLine);

  v_viewportFeatherSize = 1.0;

  
  
  
  float viewportSize = a_viewportSize / 2.0;
  float viewportBorderSize = a_viewportBorderSize / 2.0;
  v_viewportFeatherSize = v_viewportFeatherSize / 2.0;

  v_viewportTotalSize = viewportSize + viewportBorderSize + v_viewportFeatherSize;
  float lineX = -1.0 * v_viewportTotalSize / 2.0 + a_isOtherPoint * (v_viewportLineLength + 2.0 * (v_viewportTotalSize / 2.0));
  float lineY = a_normalSign * v_viewportTotalSize / 2.0;
  v_linePoint = vec2(lineX, lineY);
  
  
  
  
  
  

  v_viewportSize = viewportSize;
  v_color = a_color;
  v_viewportBorderSize = viewportBorderSize;
  v_borderColor = a_borderColor;

  gl_Position =  u_viewportToClipHomogeneousTransform * vec4(viewportPoint + lineX * viewportNormalizedLine + lineY * viewportNormalizedLineNormal, 0, 1);
}`,zm=`#version 300 es

precision highp float;
precision highp isampler2D;

in float v_viewportLineLength;
in vec2 v_linePoint;
in float v_viewportSize;
in vec4 v_color;
in float v_viewportBorderSize;
in vec4 v_borderColor;
in float v_viewportFeatherSize;
in float v_viewportTotalSize;

out vec4 color;

void main() {
  float distance;
  if (v_linePoint.x < 0.0) {
    distance = length(v_linePoint - vec2(0.0,0.0)) / (v_viewportTotalSize / 2.0);
  } else if (v_linePoint.x > v_viewportLineLength) {
    distance = length(v_linePoint - vec2(v_viewportLineLength,0.0)) / (v_viewportTotalSize / 2.0);
  } else {
    distance = abs(v_linePoint.y) / (v_viewportTotalSize / 2.0);
  }
  if (distance > 1.0) {
    discard;
  }
  float viewportDistance = distance * v_viewportTotalSize / 2.0;

  
  color = vec4(0, 0, 0, 0);
  if (v_viewportSize >= v_viewportFeatherSize) {
    color = v_color;
  }

  
  
  
  float borderSmoothStep;
  if(v_viewportBorderSize >= v_viewportFeatherSize) {
    borderSmoothStep = smoothstep(
      v_viewportSize / 2.0 - v_viewportBorderSize / 2.0 - v_viewportFeatherSize / 2.0,
      v_viewportSize / 2.0 - v_viewportBorderSize / 2.0 + v_viewportFeatherSize / 2.0,
      viewportDistance
    );
    color = ((1.0 - borderSmoothStep) * color) + (borderSmoothStep * v_borderColor);
  }

  
  
  
  borderSmoothStep = smoothstep(
      v_viewportSize / 2.0 + v_viewportBorderSize / 2.0 - v_viewportFeatherSize / 2.0,
      v_viewportSize / 2.0 + v_viewportBorderSize / 2.0 + v_viewportFeatherSize / 2.0,
      viewportDistance
  );
  color = ((1.0 - borderSmoothStep) * color) + (borderSmoothStep * vec4(0, 0, 0, 0));
}`,Zm=`#version 300 es

precision highp float;

float easing(float t) {
  return t;

  
  
}

uniform mat4 u_renderHomogeneousTransform;
uniform float u_animationProgress;

in float a_viewportSize;
in vec4 a_color;
in float a_viewportBorderSize;
in vec4 a_borderColor;

in vec2 a_clipPoint;
in vec2 a_clipPreviousPoint;

out float v_viewportSize;
out vec4 v_color;
out float v_viewportBorderSize;
out vec4 v_borderColor;
out float v_viewportFeatherSize;
out float v_viewportTotalSize;

void main() {
  vec2 clipPoint = mix(a_clipPreviousPoint, a_clipPoint, easing(u_animationProgress));

  gl_Position = u_renderHomogeneousTransform * vec4(clipPoint, 0.0f, 1.0f);

  v_viewportFeatherSize = 1.0;

  v_viewportTotalSize = a_viewportSize + a_viewportBorderSize + v_viewportFeatherSize;
  gl_PointSize = v_viewportTotalSize;
  
  
  
  
  
  
  

  v_viewportSize = a_viewportSize;
  v_color = a_color;
  v_viewportBorderSize = a_viewportBorderSize;
  v_borderColor = a_borderColor;
}`,Um=`#version 300 es

precision highp float;
precision highp isampler2D;

in float v_viewportSize;
in vec4 v_color;
in float v_viewportBorderSize;
in vec4 v_borderColor;
in float v_viewportFeatherSize;
in float v_viewportTotalSize;

out vec4 color;

void main() {
  
  float distance = length(2.0 * gl_PointCoord - 1.0);
  if (distance > 1.0) {
    discard;
  }
  float viewportDistance = distance * v_viewportTotalSize / 2.0;

  
  color = vec4(0, 0, 0, 0);
  if (v_viewportSize >= v_viewportFeatherSize) {
    color = v_color;
  }

  
  
  
  float borderSmoothStep;
  if(v_viewportBorderSize >= v_viewportFeatherSize) {
    borderSmoothStep = smoothstep(
      v_viewportSize / 2.0 - v_viewportBorderSize / 2.0 - v_viewportFeatherSize / 2.0,
      v_viewportSize / 2.0 - v_viewportBorderSize / 2.0 + v_viewportFeatherSize / 2.0,
      viewportDistance
    );
    color = ((1.0 - borderSmoothStep) * color) + (borderSmoothStep * v_borderColor);
  }

  
  
  
  borderSmoothStep = smoothstep(
      v_viewportSize / 2.0 + v_viewportBorderSize / 2.0 - v_viewportFeatherSize / 2.0,
      v_viewportSize / 2.0 + v_viewportBorderSize / 2.0 + v_viewportFeatherSize / 2.0,
      viewportDistance
  );
  color = ((1.0 - borderSmoothStep) * color) + (borderSmoothStep * vec4(0, 0, 0, 0));
}`;const Fy="LyoqCiAqIEBsaWNlbnNlCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMKICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjAKICovCmNvbnN0IHByb3h5TWFya2VyID0gU3ltYm9sKCJDb21saW5rLnByb3h5Iik7CmNvbnN0IGNyZWF0ZUVuZHBvaW50ID0gU3ltYm9sKCJDb21saW5rLmVuZHBvaW50Iik7CmNvbnN0IHJlbGVhc2VQcm94eSA9IFN5bWJvbCgiQ29tbGluay5yZWxlYXNlUHJveHkiKTsKY29uc3QgZmluYWxpemVyID0gU3ltYm9sKCJDb21saW5rLmZpbmFsaXplciIpOwpjb25zdCB0aHJvd01hcmtlciA9IFN5bWJvbCgiQ29tbGluay50aHJvd24iKTsKY29uc3QgaXNPYmplY3QgPSAodmFsKSA9PiB0eXBlb2YgdmFsID09PSAib2JqZWN0IiAmJiB2YWwgIT09IG51bGwgfHwgdHlwZW9mIHZhbCA9PT0gImZ1bmN0aW9uIjsKY29uc3QgcHJveHlUcmFuc2ZlckhhbmRsZXIgPSB7CiAgY2FuSGFuZGxlOiAodmFsKSA9PiBpc09iamVjdCh2YWwpICYmIHZhbFtwcm94eU1hcmtlcl0sCiAgc2VyaWFsaXplKG9iaikgewogICAgY29uc3QgeyBwb3J0MSwgcG9ydDIgfSA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpOwogICAgZXhwb3NlKG9iaiwgcG9ydDEpOwogICAgcmV0dXJuIFtwb3J0MiwgW3BvcnQyXV07CiAgfSwKICBkZXNlcmlhbGl6ZShwb3J0KSB7CiAgICBwb3J0LnN0YXJ0KCk7CiAgICByZXR1cm4gd3JhcChwb3J0KTsKICB9Cn07CmNvbnN0IHRocm93VHJhbnNmZXJIYW5kbGVyID0gewogIGNhbkhhbmRsZTogKHZhbHVlKSA9PiBpc09iamVjdCh2YWx1ZSkgJiYgdGhyb3dNYXJrZXIgaW4gdmFsdWUsCiAgc2VyaWFsaXplKHsgdmFsdWUgfSkgewogICAgbGV0IHNlcmlhbGl6ZWQ7CiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBFcnJvcikgewogICAgICBzZXJpYWxpemVkID0gewogICAgICAgIGlzRXJyb3I6IHRydWUsCiAgICAgICAgdmFsdWU6IHsKICAgICAgICAgIG1lc3NhZ2U6IHZhbHVlLm1lc3NhZ2UsCiAgICAgICAgICBuYW1lOiB2YWx1ZS5uYW1lLAogICAgICAgICAgc3RhY2s6IHZhbHVlLnN0YWNrCiAgICAgICAgfQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgc2VyaWFsaXplZCA9IHsgaXNFcnJvcjogZmFsc2UsIHZhbHVlIH07CiAgICB9CiAgICByZXR1cm4gW3NlcmlhbGl6ZWQsIFtdXTsKICB9LAogIGRlc2VyaWFsaXplKHNlcmlhbGl6ZWQpIHsKICAgIGlmIChzZXJpYWxpemVkLmlzRXJyb3IpIHsKICAgICAgdGhyb3cgT2JqZWN0LmFzc2lnbihuZXcgRXJyb3Ioc2VyaWFsaXplZC52YWx1ZS5tZXNzYWdlKSwgc2VyaWFsaXplZC52YWx1ZSk7CiAgICB9CiAgICB0aHJvdyBzZXJpYWxpemVkLnZhbHVlOwogIH0KfTsKY29uc3QgdHJhbnNmZXJIYW5kbGVycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKFsKICBbInByb3h5IiwgcHJveHlUcmFuc2ZlckhhbmRsZXJdLAogIFsidGhyb3ciLCB0aHJvd1RyYW5zZmVySGFuZGxlcl0KXSk7CmZ1bmN0aW9uIGlzQWxsb3dlZE9yaWdpbihhbGxvd2VkT3JpZ2lucywgb3JpZ2luKSB7CiAgZm9yIChjb25zdCBhbGxvd2VkT3JpZ2luIG9mIGFsbG93ZWRPcmlnaW5zKSB7CiAgICBpZiAob3JpZ2luID09PSBhbGxvd2VkT3JpZ2luIHx8IGFsbG93ZWRPcmlnaW4gPT09ICIqIikgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChhbGxvd2VkT3JpZ2luIGluc3RhbmNlb2YgUmVnRXhwICYmIGFsbG93ZWRPcmlnaW4udGVzdChvcmlnaW4pKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0KICByZXR1cm4gZmFsc2U7Cn0KZnVuY3Rpb24gZXhwb3NlKG9iaiwgZXAgPSBnbG9iYWxUaGlzLCBhbGxvd2VkT3JpZ2lucyA9IFsiKiJdKSB7CiAgZXAuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIGZ1bmN0aW9uIGNhbGxiYWNrKGV2KSB7CiAgICBpZiAoIWV2IHx8ICFldi5kYXRhKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghaXNBbGxvd2VkT3JpZ2luKGFsbG93ZWRPcmlnaW5zLCBldi5vcmlnaW4pKSB7CiAgICAgIGNvbnNvbGUud2FybihgSW52YWxpZCBvcmlnaW4gJyR7ZXYub3JpZ2lufScgZm9yIGNvbWxpbmsgcHJveHlgKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgeyBpZCwgdHlwZSwgcGF0aCB9ID0gT2JqZWN0LmFzc2lnbih7IHBhdGg6IFtdIH0sIGV2LmRhdGEpOwogICAgY29uc3QgYXJndW1lbnRMaXN0ID0gKGV2LmRhdGEuYXJndW1lbnRMaXN0IHx8IFtdKS5tYXAoZnJvbVdpcmVWYWx1ZSk7CiAgICBsZXQgcmV0dXJuVmFsdWU7CiAgICB0cnkgewogICAgICBjb25zdCBwYXJlbnQgPSBwYXRoLnNsaWNlKDAsIC0xKS5yZWR1Y2UoKG9iajIsIHByb3ApID0+IG9iajJbcHJvcF0sIG9iaik7CiAgICAgIGNvbnN0IHJhd1ZhbHVlID0gcGF0aC5yZWR1Y2UoKG9iajIsIHByb3ApID0+IG9iajJbcHJvcF0sIG9iaik7CiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgIkdFVCI6CiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVyblZhbHVlID0gcmF3VmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJTRVQiOgogICAgICAgICAgewogICAgICAgICAgICBwYXJlbnRbcGF0aC5zbGljZSgtMSlbMF1dID0gZnJvbVdpcmVWYWx1ZShldi5kYXRhLnZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiQVBQTFkiOgogICAgICAgICAgewogICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHJhd1ZhbHVlLmFwcGx5KHBhcmVudCwgYXJndW1lbnRMaXN0KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkNPTlNUUlVDVCI6CiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbmV3IHJhd1ZhbHVlKC4uLmFyZ3VtZW50TGlzdCk7CiAgICAgICAgICAgIHJldHVyblZhbHVlID0gcHJveHkodmFsdWUpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRU5EUE9JTlQiOgogICAgICAgICAgewogICAgICAgICAgICBjb25zdCB7IHBvcnQxLCBwb3J0MiB9ID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7CiAgICAgICAgICAgIGV4cG9zZShvYmosIHBvcnQyKTsKICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSB0cmFuc2Zlcihwb3J0MSwgW3BvcnQxXSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJSRUxFQVNFIjoKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSB2b2lkIDA7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9IGNhdGNoICh2YWx1ZSkgewogICAgICByZXR1cm5WYWx1ZSA9IHsgdmFsdWUsIFt0aHJvd01hcmtlcl06IDAgfTsKICAgIH0KICAgIFByb21pc2UucmVzb2x2ZShyZXR1cm5WYWx1ZSkuY2F0Y2goKHZhbHVlKSA9PiB7CiAgICAgIHJldHVybiB7IHZhbHVlLCBbdGhyb3dNYXJrZXJdOiAwIH07CiAgICB9KS50aGVuKChyZXR1cm5WYWx1ZTIpID0+IHsKICAgICAgY29uc3QgW3dpcmVWYWx1ZSwgdHJhbnNmZXJhYmxlc10gPSB0b1dpcmVWYWx1ZShyZXR1cm5WYWx1ZTIpOwogICAgICBlcC5wb3N0TWVzc2FnZShPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHdpcmVWYWx1ZSksIHsgaWQgfSksIHRyYW5zZmVyYWJsZXMpOwogICAgICBpZiAodHlwZSA9PT0gIlJFTEVBU0UiKSB7CiAgICAgICAgZXAucmVtb3ZlRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIGNhbGxiYWNrKTsKICAgICAgICBjbG9zZUVuZFBvaW50KGVwKTsKICAgICAgICBpZiAoZmluYWxpemVyIGluIG9iaiAmJiB0eXBlb2Ygb2JqW2ZpbmFsaXplcl0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIG9ialtmaW5hbGl6ZXJdKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgY29uc3QgW3dpcmVWYWx1ZSwgdHJhbnNmZXJhYmxlc10gPSB0b1dpcmVWYWx1ZSh7CiAgICAgICAgdmFsdWU6IG5ldyBUeXBlRXJyb3IoIlVuc2VyaWFsaXphYmxlIHJldHVybiB2YWx1ZSIpLAogICAgICAgIFt0aHJvd01hcmtlcl06IDAKICAgICAgfSk7CiAgICAgIGVwLnBvc3RNZXNzYWdlKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgd2lyZVZhbHVlKSwgeyBpZCB9KSwgdHJhbnNmZXJhYmxlcyk7CiAgICB9KTsKICB9KTsKICBpZiAoZXAuc3RhcnQpIHsKICAgIGVwLnN0YXJ0KCk7CiAgfQp9CmZ1bmN0aW9uIGlzTWVzc2FnZVBvcnQoZW5kcG9pbnQpIHsKICByZXR1cm4gZW5kcG9pbnQuY29uc3RydWN0b3IubmFtZSA9PT0gIk1lc3NhZ2VQb3J0IjsKfQpmdW5jdGlvbiBjbG9zZUVuZFBvaW50KGVuZHBvaW50KSB7CiAgaWYgKGlzTWVzc2FnZVBvcnQoZW5kcG9pbnQpKQogICAgZW5kcG9pbnQuY2xvc2UoKTsKfQpmdW5jdGlvbiB3cmFwKGVwLCB0YXJnZXQpIHsKICBjb25zdCBwZW5kaW5nTGlzdGVuZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICBlcC5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgZnVuY3Rpb24gaGFuZGxlTWVzc2FnZShldikgewogICAgY29uc3QgeyBkYXRhIH0gPSBldjsKICAgIGlmICghZGF0YSB8fCAhZGF0YS5pZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCByZXNvbHZlciA9IHBlbmRpbmdMaXN0ZW5lcnMuZ2V0KGRhdGEuaWQpOwogICAgaWYgKCFyZXNvbHZlcikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0cnkgewogICAgICByZXNvbHZlcihkYXRhKTsKICAgIH0gZmluYWxseSB7CiAgICAgIHBlbmRpbmdMaXN0ZW5lcnMuZGVsZXRlKGRhdGEuaWQpOwogICAgfQogIH0pOwogIHJldHVybiBjcmVhdGVQcm94eShlcCwgcGVuZGluZ0xpc3RlbmVycywgW10sIHRhcmdldCk7Cn0KZnVuY3Rpb24gdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNSZWxlYXNlZCkgewogIGlmIChpc1JlbGVhc2VkKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIlByb3h5IGhhcyBiZWVuIHJlbGVhc2VkIGFuZCBpcyBub3QgdXNlYWJsZSIpOwogIH0KfQpmdW5jdGlvbiByZWxlYXNlRW5kcG9pbnQoZXApIHsKICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwgLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSwgewogICAgdHlwZTogIlJFTEVBU0UiCiAgfSkudGhlbigoKSA9PiB7CiAgICBjbG9zZUVuZFBvaW50KGVwKTsKICB9KTsKfQpjb25zdCBwcm94eUNvdW50ZXIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFdlYWtNYXAoKTsKY29uc3QgcHJveHlGaW5hbGl6ZXJzID0gIkZpbmFsaXphdGlvblJlZ2lzdHJ5IiBpbiBnbG9iYWxUaGlzICYmIG5ldyBGaW5hbGl6YXRpb25SZWdpc3RyeSgoZXApID0+IHsKICBjb25zdCBuZXdDb3VudCA9IChwcm94eUNvdW50ZXIuZ2V0KGVwKSB8fCAwKSAtIDE7CiAgcHJveHlDb3VudGVyLnNldChlcCwgbmV3Q291bnQpOwogIGlmIChuZXdDb3VudCA9PT0gMCkgewogICAgcmVsZWFzZUVuZHBvaW50KGVwKTsKICB9Cn0pOwpmdW5jdGlvbiByZWdpc3RlclByb3h5KHByb3h5MiwgZXApIHsKICBjb25zdCBuZXdDb3VudCA9IChwcm94eUNvdW50ZXIuZ2V0KGVwKSB8fCAwKSArIDE7CiAgcHJveHlDb3VudGVyLnNldChlcCwgbmV3Q291bnQpOwogIGlmIChwcm94eUZpbmFsaXplcnMpIHsKICAgIHByb3h5RmluYWxpemVycy5yZWdpc3Rlcihwcm94eTIsIGVwLCBwcm94eTIpOwogIH0KfQpmdW5jdGlvbiB1bnJlZ2lzdGVyUHJveHkocHJveHkyKSB7CiAgaWYgKHByb3h5RmluYWxpemVycykgewogICAgcHJveHlGaW5hbGl6ZXJzLnVucmVnaXN0ZXIocHJveHkyKTsKICB9Cn0KZnVuY3Rpb24gY3JlYXRlUHJveHkoZXAsIHBlbmRpbmdMaXN0ZW5lcnMsIHBhdGggPSBbXSwgdGFyZ2V0ID0gZnVuY3Rpb24oKSB7Cn0pIHsKICBsZXQgaXNQcm94eVJlbGVhc2VkID0gZmFsc2U7CiAgY29uc3QgcHJveHkyID0gbmV3IFByb3h5KHRhcmdldCwgewogICAgZ2V0KF90YXJnZXQsIHByb3ApIHsKICAgICAgdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNQcm94eVJlbGVhc2VkKTsKICAgICAgaWYgKHByb3AgPT09IHJlbGVhc2VQcm94eSkgewogICAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgICB1bnJlZ2lzdGVyUHJveHkocHJveHkyKTsKICAgICAgICAgIHJlbGVhc2VFbmRwb2ludChlcCk7CiAgICAgICAgICBwZW5kaW5nTGlzdGVuZXJzLmNsZWFyKCk7CiAgICAgICAgICBpc1Byb3h5UmVsZWFzZWQgPSB0cnVlOwogICAgICAgIH07CiAgICAgIH0KICAgICAgaWYgKHByb3AgPT09ICJ0aGVuIikgewogICAgICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIHsgdGhlbjogKCkgPT4gcHJveHkyIH07CiAgICAgICAgfQogICAgICAgIGNvbnN0IHIgPSByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCBwZW5kaW5nTGlzdGVuZXJzLCB7CiAgICAgICAgICB0eXBlOiAiR0VUIiwKICAgICAgICAgIHBhdGg6IHBhdGgubWFwKChwKSA9PiBwLnRvU3RyaW5nKCkpCiAgICAgICAgfSkudGhlbihmcm9tV2lyZVZhbHVlKTsKICAgICAgICByZXR1cm4gci50aGVuLmJpbmQocik7CiAgICAgIH0KICAgICAgcmV0dXJuIGNyZWF0ZVByb3h5KGVwLCBwZW5kaW5nTGlzdGVuZXJzLCBbLi4ucGF0aCwgcHJvcF0pOwogICAgfSwKICAgIHNldChfdGFyZ2V0LCBwcm9wLCByYXdWYWx1ZSkgewogICAgICB0aHJvd0lmUHJveHlSZWxlYXNlZChpc1Byb3h5UmVsZWFzZWQpOwogICAgICBjb25zdCBbdmFsdWUsIHRyYW5zZmVyYWJsZXNdID0gdG9XaXJlVmFsdWUocmF3VmFsdWUpOwogICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwgcGVuZGluZ0xpc3RlbmVycywgewogICAgICAgIHR5cGU6ICJTRVQiLAogICAgICAgIHBhdGg6IFsuLi5wYXRoLCBwcm9wXS5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksCiAgICAgICAgdmFsdWUKICAgICAgfSwgdHJhbnNmZXJhYmxlcykudGhlbihmcm9tV2lyZVZhbHVlKTsKICAgIH0sCiAgICBhcHBseShfdGFyZ2V0LCBfdGhpc0FyZywgcmF3QXJndW1lbnRMaXN0KSB7CiAgICAgIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUHJveHlSZWxlYXNlZCk7CiAgICAgIGNvbnN0IGxhc3QgPSBwYXRoW3BhdGgubGVuZ3RoIC0gMV07CiAgICAgIGlmIChsYXN0ID09PSBjcmVhdGVFbmRwb2ludCkgewogICAgICAgIHJldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCBwZW5kaW5nTGlzdGVuZXJzLCB7CiAgICAgICAgICB0eXBlOiAiRU5EUE9JTlQiCiAgICAgICAgfSkudGhlbihmcm9tV2lyZVZhbHVlKTsKICAgICAgfQogICAgICBpZiAobGFzdCA9PT0gImJpbmQiKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZVByb3h5KGVwLCBwZW5kaW5nTGlzdGVuZXJzLCBwYXRoLnNsaWNlKDAsIC0xKSk7CiAgICAgIH0KICAgICAgY29uc3QgW2FyZ3VtZW50TGlzdCwgdHJhbnNmZXJhYmxlc10gPSBwcm9jZXNzQXJndW1lbnRzKHJhd0FyZ3VtZW50TGlzdCk7CiAgICAgIHJldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCBwZW5kaW5nTGlzdGVuZXJzLCB7CiAgICAgICAgdHlwZTogIkFQUExZIiwKICAgICAgICBwYXRoOiBwYXRoLm1hcCgocCkgPT4gcC50b1N0cmluZygpKSwKICAgICAgICBhcmd1bWVudExpc3QKICAgICAgfSwgdHJhbnNmZXJhYmxlcykudGhlbihmcm9tV2lyZVZhbHVlKTsKICAgIH0sCiAgICBjb25zdHJ1Y3QoX3RhcmdldCwgcmF3QXJndW1lbnRMaXN0KSB7CiAgICAgIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUHJveHlSZWxlYXNlZCk7CiAgICAgIGNvbnN0IFthcmd1bWVudExpc3QsIHRyYW5zZmVyYWJsZXNdID0gcHJvY2Vzc0FyZ3VtZW50cyhyYXdBcmd1bWVudExpc3QpOwogICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwgcGVuZGluZ0xpc3RlbmVycywgewogICAgICAgIHR5cGU6ICJDT05TVFJVQ1QiLAogICAgICAgIHBhdGg6IHBhdGgubWFwKChwKSA9PiBwLnRvU3RyaW5nKCkpLAogICAgICAgIGFyZ3VtZW50TGlzdAogICAgICB9LCB0cmFuc2ZlcmFibGVzKS50aGVuKGZyb21XaXJlVmFsdWUpOwogICAgfQogIH0pOwogIHJlZ2lzdGVyUHJveHkocHJveHkyLCBlcCk7CiAgcmV0dXJuIHByb3h5MjsKfQpmdW5jdGlvbiBteUZsYXQoYXJyKSB7CiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5jb25jYXQuYXBwbHkoW10sIGFycik7Cn0KZnVuY3Rpb24gcHJvY2Vzc0FyZ3VtZW50cyhhcmd1bWVudExpc3QpIHsKICBjb25zdCBwcm9jZXNzZWQgPSBhcmd1bWVudExpc3QubWFwKHRvV2lyZVZhbHVlKTsKICByZXR1cm4gW3Byb2Nlc3NlZC5tYXAoKHYpID0+IHZbMF0pLCBteUZsYXQocHJvY2Vzc2VkLm1hcCgodikgPT4gdlsxXSkpXTsKfQpjb25zdCB0cmFuc2ZlckNhY2hlID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CmZ1bmN0aW9uIHRyYW5zZmVyKG9iaiwgdHJhbnNmZXJzKSB7CiAgdHJhbnNmZXJDYWNoZS5zZXQob2JqLCB0cmFuc2ZlcnMpOwogIHJldHVybiBvYmo7Cn0KZnVuY3Rpb24gcHJveHkob2JqKSB7CiAgcmV0dXJuIE9iamVjdC5hc3NpZ24ob2JqLCB7IFtwcm94eU1hcmtlcl06IHRydWUgfSk7Cn0KZnVuY3Rpb24gdG9XaXJlVmFsdWUodmFsdWUpIHsKICBmb3IgKGNvbnN0IFtuYW1lLCBoYW5kbGVyXSBvZiB0cmFuc2ZlckhhbmRsZXJzKSB7CiAgICBpZiAoaGFuZGxlci5jYW5IYW5kbGUodmFsdWUpKSB7CiAgICAgIGNvbnN0IFtzZXJpYWxpemVkVmFsdWUsIHRyYW5zZmVyYWJsZXNdID0gaGFuZGxlci5zZXJpYWxpemUodmFsdWUpOwogICAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgIHR5cGU6ICJIQU5ETEVSIiwKICAgICAgICAgIG5hbWUsCiAgICAgICAgICB2YWx1ZTogc2VyaWFsaXplZFZhbHVlCiAgICAgICAgfSwKICAgICAgICB0cmFuc2ZlcmFibGVzCiAgICAgIF07CiAgICB9CiAgfQogIHJldHVybiBbCiAgICB7CiAgICAgIHR5cGU6ICJSQVciLAogICAgICB2YWx1ZQogICAgfSwKICAgIHRyYW5zZmVyQ2FjaGUuZ2V0KHZhbHVlKSB8fCBbXQogIF07Cn0KZnVuY3Rpb24gZnJvbVdpcmVWYWx1ZSh2YWx1ZSkgewogIHN3aXRjaCAodmFsdWUudHlwZSkgewogICAgY2FzZSAiSEFORExFUiI6CiAgICAgIHJldHVybiB0cmFuc2ZlckhhbmRsZXJzLmdldCh2YWx1ZS5uYW1lKS5kZXNlcmlhbGl6ZSh2YWx1ZS52YWx1ZSk7CiAgICBjYXNlICJSQVciOgogICAgICByZXR1cm4gdmFsdWUudmFsdWU7CiAgfQp9CmZ1bmN0aW9uIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHBlbmRpbmdMaXN0ZW5lcnMsIG1zZywgdHJhbnNmZXJzKSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICBjb25zdCBpZCA9IGdlbmVyYXRlVVVJRCgpOwogICAgcGVuZGluZ0xpc3RlbmVycy5zZXQoaWQsIHJlc29sdmUpOwogICAgaWYgKGVwLnN0YXJ0KSB7CiAgICAgIGVwLnN0YXJ0KCk7CiAgICB9CiAgICBlcC5wb3N0TWVzc2FnZShPYmplY3QuYXNzaWduKHsgaWQgfSwgbXNnKSwgdHJhbnNmZXJzKTsKICB9KTsKfQpmdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7CiAgcmV0dXJuIG5ldyBBcnJheSg0KS5maWxsKDApLm1hcCgoKSA9PiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikudG9TdHJpbmcoMTYpKS5qb2luKCItIik7Cn0KYXN5bmMgZnVuY3Rpb24gZmV0Y2hVcmwoaW5wdXQsIGluaXQsIGZldGNoRm4pIHsKICBsZXQgcmVzcG9uc2U7CiAgaWYgKHR5cGVvZiBmZXRjaEZuID09PSAiZnVuY3Rpb24iKSB7CiAgICByZXNwb25zZSA9IGF3YWl0IGZldGNoRm4oaW5wdXQsIGluaXQpOwogIH0gZWxzZSB7CiAgICByZXNwb25zZSA9IGF3YWl0IGZldGNoKGlucHV0LCBpbml0KTsKICB9CiAgaWYgKCFyZXNwb25zZS5vaykgewogICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgIGlmIChqc29uICYmIGpzb24uZXJyb3IpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGpzb24uZXJyb3IpOwogICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXNUZXh0KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0KTsKICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBOb3QgZm91bmQ6ICR7aW5wdXR9ICg0MDQpYCk7CiAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNTAwKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiSW50ZXJuYWwgc2VydmVyIGVycm9yICg1MDApIik7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaDogJHtpbnB1dH0gKCR7cmVzcG9uc2Uuc3RhdHVzfSlgKTsKICAgIH0KICB9CiAgcmV0dXJuIHJlc3BvbnNlOwp9CmNvbnN0IGZldGNoQW5kR2V0SW1hZ2VEYXRhV29ya2VyID0gewogIGFzeW5jIGdldEltYWdlRGF0YSh0aWxlVXJsLCBvbkFib3J0LCBmZXRjaEZuLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICBjb25zdCB3b3JrZXJBYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBvbkFib3J0KCk7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoVXJsKAogICAgICB0aWxlVXJsLAogICAgICB7CiAgICAgICAgc2lnbmFsOiB3b3JrZXJBYm9ydENvbnRyb2xsZXIuc2lnbmFsCiAgICAgIH0sCiAgICAgIGZldGNoRm4KICAgICk7CiAgICBjb25zdCBibG9iID0gYXdhaXQgcmVzcG9uc2UuYmxvYigpOwogICAgY29uc3QgaW1hZ2VCaXRtYXAgPSBhd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChibG9iLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgIGNvbnN0IGNhbnZhcyA9IG5ldyBPZmZzY3JlZW5DYW52YXMod2lkdGgsIGhlaWdodCk7CiAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICBpZiAoIWNvbnRleHQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJDb3VsZCBub3QgY3JlYXRlIE9mZnNjcmVlbkNhbnZhcyBjb250ZXh0Iik7CiAgICB9CiAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZUJpdG1hcCwgMCwgMCk7CiAgICBjb25zdCBpbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgIHJldHVybiB0cmFuc2ZlcihpbWFnZURhdGEsIFtpbWFnZURhdGEuZGF0YS5idWZmZXJdKTsKICB9Cn07CmV4cG9zZShmZXRjaEFuZEdldEltYWdlRGF0YVdvcmtlcik7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWZldGNoLWFuZC1nZXQtaW1hZ2UtZGF0YS1CQzRZc0lHNy5qcy5tYXAK",jO=e=>Uint8Array.from(atob(e),t=>t.charCodeAt(0)),Xm=typeof self<"u"&&self.Blob&&new Blob(["URL.revokeObjectURL(import.meta.url);",jO(Fy)],{type:"text/javascript;charset=utf-8"});function BO(e){let t;try{if(t=Xm&&(self.URL||self.webkitURL).createObjectURL(Xm),!t)throw"";const i=new Worker(t,{type:"module",name:e?.name});return i.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(t)}),i}catch{return new Worker("data:text/javascript;base64,"+Fy,{type:"module",name:e?.name})}}const VO=200,WO={leading:!0,trailing:!0},zO=50,ZO={leading:!0,trailing:!0},UO={debugMaps:!1,renderMaps:!0,renderLines:!0,renderPoints:!0},ql=1,Jl=1,XO=0,$O=.7,HO=100*Number.EPSILON,YO=5,$m=750;class KO extends vL{#t;gl;partialWebgl2RendererOptions;mapProgram;linesProgram;pointsProgram;previousSignificantViewport;opacity=ql;saturation=Jl;renderOptions={};lastAnimationFrameRequestId;animating=!1;transformaterTransitionStart;animationProgress=0;disableRender=!1;throttledPrepareRenderInternal;throttledChanged;constructor(t,i){const n=Mi(t,t.VERTEX_SHADER,Bm),s=Mi(t,t.FRAGMENT_SHADER,Vm),r=Mi(t,t.VERTEX_SHADER,Wm),o=Mi(t,t.FRAGMENT_SHADER,zm),a=Mi(t,t.VERTEX_SHADER,Zm),h=Mi(t,t.FRAGMENT_SHADER,Um),c=Hs(t,n,s),u=Hs(t,r,o),m=Hs(t,a,h),p=new BO,y=C0(p);super(Ed.createFactory(y),NO(t,c,u,m),i),this.#t=p,this.gl=t,this.partialWebgl2RendererOptions=Ee(UO,i),this.mapProgram=c,this.linesProgram=u,this.pointsProgram=m,t.deleteShader(n),t.deleteShader(s),t.deleteShader(n),t.deleteShader(s),t.deleteShader(n),t.deleteShader(s),t.disable(t.DEPTH_TEST),this.addEventListeners(),this.throttledPrepareRenderInternal=vc(this.prepareRenderInternal.bind(this),VO,WO),this.throttledChanged=vc(this.changed.bind(this),zO,ZO)}initializeWebGL(t){const i=Mi(t,t.VERTEX_SHADER,Bm),n=Mi(t,t.FRAGMENT_SHADER,Vm),s=Mi(t,t.VERTEX_SHADER,Wm),r=Mi(t,t.FRAGMENT_SHADER,zm),o=Mi(t,t.VERTEX_SHADER,Zm),a=Mi(t,t.FRAGMENT_SHADER,Um),h=Hs(t,i,n),c=Hs(t,s,r),u=Hs(t,o,a);this.gl=t,this.mapProgram=h,this.linesProgram=c,this.pointsProgram=u,t.disable(t.DEPTH_TEST);for(const m of this.warpedMapList.getWarpedMaps())m.initializeWebGL(h,c,u)}getOpacity(){return this.opacity}setOpacity(t){this.opacity=t}resetOpacity(){this.opacity=ql}getMapOpacity(t){const i=this.warpedMapList.getWarpedMap(t);if(i)return i.opacity}setMapOpacity(t,i){const n=this.warpedMapList.getWarpedMap(t);n&&(n.opacity=Math.min(Math.max(i,0),1))}resetMapOpacity(t){const i=this.warpedMapList.getWarpedMap(t);i&&(i.opacity=ql)}getRemoveColorOptions(){return this.renderOptions.removeColorOptions}setRemoveColorOptions(t){this.renderOptions.removeColorOptions=t}resetRemoveColorOptions(){this.renderOptions.removeColorOptions=void 0}getMapRemoveColorOptions(t){const i=this.warpedMapList.getWarpedMap(t);if(i)return i.renderOptions.removeColorOptions}setOptions(t){this.partialWebgl2RendererOptions=Ee(this.partialWebgl2RendererOptions,t),super.setOptions(t)}setMapRemoveColorOptions(t,i){const n=this.warpedMapList.getWarpedMap(t);n&&(n.renderOptions.removeColorOptions=i)}resetMapRemoveColorOptions(t){const i=this.warpedMapList.getWarpedMap(t);i&&(i.renderOptions.removeColorOptions=void 0)}getColorizeOptions(){return this.renderOptions.colorizeOptions}setColorizeOptions(t){this.renderOptions.colorizeOptions=t}resetColorizeOptions(){this.renderOptions.colorizeOptions=void 0}getMapColorizeOptions(t){const i=this.warpedMapList.getWarpedMap(t);if(i)return i.renderOptions.colorizeOptions}setMapColorizeOptions(t,i){const n=this.warpedMapList.getWarpedMap(t);n&&(n.renderOptions.colorizeOptions=i)}resetMapColorizeOptions(t){const i=this.warpedMapList.getWarpedMap(t);i&&(i.renderOptions.colorizeOptions=void 0)}getGridOptions(){return this.renderOptions.gridOptions}setGridOptions(t){this.renderOptions.gridOptions=t}resetGridOptions(){this.renderOptions.gridOptions=void 0}getMapGridOptions(t){const i=this.warpedMapList.getWarpedMap(t);if(i)return i.renderOptions.gridOptions}setMapGridOptions(t,i){const n=this.warpedMapList.getWarpedMap(t);n&&(n.renderOptions.gridOptions=i)}resetMapGridOptions(t){const i=this.warpedMapList.getWarpedMap(t);i&&(i.renderOptions.gridOptions=void 0)}getSaturation(){return this.saturation}setSaturation(t){this.saturation=t}resetSaturation(){this.saturation=Jl}getMapSaturation(t){const i=this.warpedMapList.getWarpedMap(t);if(i)return i.saturation}setMapSaturation(t,i){const n=this.warpedMapList.getWarpedMap(t);n&&(n.saturation=i)}resetMapSaturation(t){const i=this.warpedMapList.getWarpedMap(t);i&&(i.saturation=Jl)}render(t){this.disableRender||(this.viewport=t||this.viewport||ia.fromSizeAndMaps([this.gl.canvas.width,this.gl.canvas.width],this.warpedMapList),this.loadMissingImageInfosInViewport(),this.someImageInfosInViewport()&&this.throttledPrepareRenderInternal(),this.renderInternal())}clear(){this.warpedMapList.clear(),this.mapsInViewport=new Set,this.mapsWithRequestedTilesForViewport=new Set,this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT),this.tileCache.clear()}cancelThrottledFunctions(){this.throttledPrepareRenderInternal.cancel(),this.throttledChanged.cancel()}destroy(){this.cancelThrottledFunctions();for(const t of this.warpedMapList.getWarpedMaps())this.removeEventListenersFromWebGL2WarpedMap(t);this.removeEventListeners(),super.destroy(),this.gl.deleteProgram(this.mapProgram),this.gl.deleteProgram(this.linesProgram),this.gl.deleteProgram(this.pointsProgram),this.#t.terminate()}updateMapsForViewport(t){const{mapsEnteringViewport:i,mapsLeavingViewport:n}=super.updateMapsForViewport(t);return this.updateVertexBuffers(i),{mapsEnteringViewport:i,mapsLeavingViewport:n}}resetPrevious(t){const i=this.warpedMapList.getWarpedMaps({mapIds:t});for(const n of i)n.resetPrevious()}updateVertexBuffers(t){if(!this.viewport)return;const i=this.warpedMapList.getWarpedMaps({mapIds:t});for(const n of i)n.updateVertexBuffers(this.viewport.projectedGeoToClipHomogeneousTransform,this.partialWebgl2RendererOptions)}prepareRenderInternal(){this.assureProjection(),this.requestFetchableTiles()}shouldRequestFetchableTiles(){if(!this.viewport||this.animating)return!1;if(this.previousSignificantViewport){const t=[];for(let n=0;n<4;n++)t.push(an(this.previousSignificantViewport.projectedGeoRectangle[n],this.viewport.projectedGeoRectangle[n])/Math.pow(this.viewport.projectedGeoPerViewportScale,2));const i=Math.max(...t);return i<HO?!0:i>Math.pow(YO,2)?(this.previousSignificantViewport=this.viewport,!0):!1}else return this.previousSignificantViewport=this.viewport,!0}shouldAnticipateInteraction(){return!0}renderInternal(){if(!this.viewport)return;const t=this.gl;t.viewport(0,0,t.canvas.width,t.canvas.height),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.partialWebgl2RendererOptions.renderMaps&&this.renderMapsInternal(),this.partialWebgl2RendererOptions.renderLines&&this.renderLinesInternal(),this.partialWebgl2RendererOptions.renderPoints&&this.renderPointsInternal()}renderMapsInternal(){if(this.viewport){this.setMapProgramUniforms();for(const t of this.mapsWithRequestedTilesForViewport){const i=this.warpedMapList.getWarpedMap(t);if(!i)continue;this.setMapProgramRenderOptionsUniforms(this.renderOptions,i.renderOptions),this.setMapProgramMapUniforms(i);const n=i.resourceTrianglePoints.length,s=this.gl.TRIANGLES,r=0;this.gl.bindVertexArray(i.mapVao),this.gl.drawArrays(s,r,n)}}}renderLinesInternal(){this.setLinesProgramUniforms();for(const t of this.mapsInViewport){const i=this.warpedMapList.getWarpedMap(t);if(!i)continue;this.setLinesProgramMapUniforms(i);const n=i.lineLayers.reduce((o,a)=>o+a.projectedGeoLines.length,0)*6,s=this.gl.TRIANGLES,r=0;this.gl.bindVertexArray(i.linesVao),this.gl.drawArrays(s,r,n)}}renderPointsInternal(){this.setPointsProgramUniforms();for(const t of this.mapsInViewport){const i=this.warpedMapList.getWarpedMap(t);if(!i)continue;this.setPointsProgramMapUniforms(i);const n=i.pointLayers.reduce((o,a)=>o+a.projectedGeoPoints.length,0),s=this.gl.POINTS,r=0;this.gl.bindVertexArray(i.pointsVao),this.gl.drawArrays(s,r,n)}}setMapProgramUniforms(){const t=this.mapProgram,i=this.gl;i.useProgram(t);const n=i.getUniformLocation(t,"u_debug");i.uniform1f(n,this.partialWebgl2RendererOptions.debugMaps?1:0);const s=i.getUniformLocation(t,"u_animationProgress");i.uniform1f(s,this.animationProgress);const r=i.getUniformLocation(t,"u_colorDistortion00");i.uniform4f(r,...$i(bg),1);const o=i.getUniformLocation(t,"u_colorDistortion01");i.uniform4f(o,...$i(mA),1);const a=i.getUniformLocation(t,"u_colorDistortion1");i.uniform4f(a,...$i(p_),1);const h=i.getUniformLocation(t,"u_colorDistortion2");i.uniform4f(h,...$i(pA),1);const c=i.getUniformLocation(t,"u_colorDistortion3");i.uniform4f(c,...$i(bg),1);const u=i.getUniformLocation(t,"u_colorGrid");i.uniform4f(u,...$i(Lu),1)}setMapProgramRenderOptionsUniforms(t,i){const n=this.gl,s=this.mapProgram;n.useProgram(s);const r={removeColorOptions:{color:i.removeColorOptions?.color||t.removeColorOptions?.color,hardness:cg(i.removeColorOptions?.hardness,t.removeColorOptions?.hardness),threshold:cg(i.removeColorOptions?.threshold,t.removeColorOptions?.threshold)},colorizeOptions:{...t.colorizeOptions,...i.colorizeOptions},gridOptions:{...t.gridOptions,...i.gridOptions}},o=r.removeColorOptions?.color,a=n.getUniformLocation(s,"u_removeColor");if(n.uniform1f(a,o?1:0),o){const p=n.getUniformLocation(s,"u_removeColorOptionsColor");n.uniform3fv(p,o);const y=n.getUniformLocation(s,"u_removeColorOptionsThreshold");n.uniform1f(y,r.removeColorOptions?.threshold||XO);const w=n.getUniformLocation(s,"u_removeColorOptionsHardness");n.uniform1f(w,r.removeColorOptions?.hardness||$O)}const h=r.colorizeOptions?.color,c=n.getUniformLocation(s,"u_colorize");if(n.uniform1f(c,h?1:0),h){const p=n.getUniformLocation(s,"u_colorizeOptionsColor");n.uniform3fv(p,h)}const u=r.gridOptions?.enabled,m=n.getUniformLocation(s,"u_grid");n.uniform1f(m,u?1:0)}setMapProgramMapUniforms(t){if(!this.viewport)return;const i=this.gl,n=this.mapProgram;i.useProgram(n);const s=Hl(this.viewport.projectedGeoToClipHomogeneousTransform,t.invertedRenderHomogeneousTransform),r=i.getUniformLocation(n,"u_renderHomogeneousTransform");i.uniformMatrix4fv(r,!1,so(s));const o=i.getUniformLocation(n,"u_opacity");i.uniform1f(o,this.opacity*t.opacity);const a=i.getUniformLocation(n,"u_saturation");i.uniform1f(a,this.saturation*t.saturation);const h=i.getUniformLocation(n,"u_distortion");i.uniform1f(h,t.distortionMeasure?1:0);const c=i.getUniformLocation(n,"u_distortionOptionsdistortionMeasure");i.uniform1i(c,t.distortionMeasure?Rc.indexOf(t.distortionMeasure):0);const u=i.getUniformLocation(n,"u_scaleFactorForViewport"),m=t.tileZoomLevelForViewport?t.tileZoomLevelForViewport.scaleFactor:1;i.uniform1i(u,m);const p=i.getUniformLocation(n,"u_cachedTilesTextureArray");i.uniform1i(p,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D_ARRAY,t.cachedTilesTextureArray);const y=i.getUniformLocation(n,"u_cachedTilesResourceOriginPointsAndDimensionsTexture");i.uniform1i(y,1),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,t.cachedTilesResourceOriginPointsAndDimensionsTexture);const w=i.getUniformLocation(n,"u_cachedTilesScaleFactorsTexture");i.uniform1i(w,2),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,t.cachedTilesScaleFactorsTexture)}setLinesProgramUniforms(){if(!this.viewport)return;const t=this.gl,i=this.linesProgram;t.useProgram(i);const n=t.getUniformLocation(i,"u_viewportToClipHomogeneousTransform");t.uniformMatrix4fv(n,!1,so(this.viewport.viewportToClipHomogeneousTransform));const s=t.getUniformLocation(i,"u_clipToViewportHomogeneousTransform");t.uniformMatrix4fv(s,!1,so(Id(this.viewport.viewportToClipHomogeneousTransform)));const r=t.getUniformLocation(i,"u_animationProgress");t.uniform1f(r,this.animationProgress)}setLinesProgramMapUniforms(t){if(!this.viewport)return;const i=this.gl,n=this.linesProgram;i.useProgram(n);const s=Hl(this.viewport.projectedGeoToClipHomogeneousTransform,t.invertedRenderHomogeneousTransform),r=i.getUniformLocation(n,"u_renderHomogeneousTransform");i.uniformMatrix4fv(r,!1,so(s))}setPointsProgramUniforms(){if(!this.viewport)return;const t=this.gl,i=this.pointsProgram;t.useProgram(i);const n=t.getUniformLocation(i,"u_animationProgress");t.uniform1f(n,this.animationProgress)}setPointsProgramMapUniforms(t){if(!this.viewport)return;const i=this.gl,n=this.pointsProgram;i.useProgram(n);const s=Hl(this.viewport.projectedGeoToClipHomogeneousTransform,t.invertedRenderHomogeneousTransform),r=i.getUniformLocation(n,"u_renderHomogeneousTransform");i.uniformMatrix4fv(r,!1,so(s))}startTransformerTransition(t){this.updateVertexBuffers(t),this.lastAnimationFrameRequestId!==void 0&&cancelAnimationFrame(this.lastAnimationFrameRequestId),this.animating=!0,this.transformaterTransitionStart=void 0,this.lastAnimationFrameRequestId=requestAnimationFrame((i=>this.transformerTransitionFrame(i,t)).bind(this))}transformerTransitionFrame(t,i){this.transformaterTransitionStart||(this.transformaterTransitionStart=t),t-this.transformaterTransitionStart<$m?(this.animationProgress=(t-this.transformaterTransitionStart)/$m,this.changed(),this.renderInternal(),this.lastAnimationFrameRequestId=requestAnimationFrame((n=>this.transformerTransitionFrame(n,i)).bind(this))):this.finishTransformerTransition(i)}finishTransformerTransition(t){this.resetPrevious(t),this.updateVertexBuffers(t),this.animating=!1,this.animationProgress=0,this.transformaterTransitionStart=void 0,this.changed()}changed(){this.dispatchEvent(new Rt(st.CHANGED))}imageInfoLoaded(t){t instanceof Rt&&this.dispatchEvent(new Rt(st.IMAGEINFOLOADED))}clearMap(t){const i=this.warpedMapList.getWarpedMap(t);i&&i.clearTextures()}mapTileLoaded(t){if(t instanceof Rt){const{mapId:i,tileUrl:n}=t.data,s=this.tileCache.getCacheableTile(n);if(!s||!s.isCachedTile())return;const r=this.warpedMapList.getWarpedMap(i);if(!r)return;r.addCachedTileAndUpdateTextures(s)}}mapTileRemoved(t){if(t instanceof Rt){const{mapId:i,tileUrl:n}=t.data,s=this.warpedMapList.getWarpedMap(i);if(!s)return;s.removeCachedTileAndUpdateTextures(n)}}warpedMapAdded(t){if(t instanceof Rt){const i=t.data,n=this.warpedMapList.getWarpedMap(i);n&&this.addEventListenersToWebGL2WarpedMap(n)}}preChange(t){if(t instanceof Rt){const i=t.data;for(const n of this.warpedMapList.getWarpedMaps({mapIds:i}))this.animating&&n.mixPreviousAndNew(1-this.animationProgress)}}optionsChanged(t){if(t instanceof Rt){const i=t.data;this.finishTransformerTransition(i)}this.changed()}gcpsChanged(t){if(t instanceof Rt){const i=t.data;this.finishTransformerTransition(i)}this.changed()}resourceMaskChanged(t){if(t instanceof Rt){const i=t.data;this.finishTransformerTransition(i)}this.changed()}transformationChanged(t){if(t instanceof Rt){const i=t.data;this.startTransformerTransition(i)}}distortionChanged(t){if(t instanceof Rt){const i=t.data;this.startTransformerTransition(i)}}internalProjectionChanged(t){if(t instanceof Rt){const i=t.data;this.startTransformerTransition(i)}}projectionChanged(t){if(t instanceof Rt){const i=t.data;this.finishTransformerTransition(i)}this.changed()}addEventListenersToWebGL2WarpedMap(t){t.addEventListener(st.TEXTURESUPDATED,this.throttledChanged.bind(this))}removeEventListenersFromWebGL2WarpedMap(t){t.removeEventListener(st.TEXTURESUPDATED,this.throttledChanged.bind(this))}contextLost(){this.disableRender=!0,this.cancelThrottledFunctions();for(const t of this.warpedMapList.getWarpedMaps())t.cancelThrottledFunctions();this.tileCache.clear()}contextRestored(){this.initializeWebGL(this.gl),this.disableRender=!1}}class qO extends gu{data;constructor(t,i){super(t),this.data=i}}class EF extends iI{container;canvas;gl;canvasSize=[0,0];renderer;resizeObserver;constructor(t){super({});const i=document.createElement("div");this.container=i,i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.classList.add("ol-layer"),i.classList.add("allmaps-warped-map-layer");const n=document.createElement("canvas");n.style.position="absolute",n.style.left="0",n.style.width="100%",n.style.height="100%",i.appendChild(n);const s=n.getContext("webgl2",{premultipliedAlpha:!0});if(!s)throw new Error("WebGL 2 not available");this.resizeObserver=new ResizeObserver(this.resized.bind(this)),this.resizeObserver.observe(n,{box:"content-box"}),this.canvas=n,this.gl=s,this.renderer=new KO(this.gl,t),this.addEventListeners()}async addGeoreferenceAnnotation(t){const i=await this.renderer.warpedMapList.addGeoreferenceAnnotation(t);return this.changed(),i}async removeGeoreferenceAnnotation(t){const i=await this.renderer.warpedMapList.removeGeoreferenceAnnotation(t);return this.changed(),i}async addGeoreferenceAnnotationByUrl(t){const i=await fetch(t).then(s=>s.json());return this.addGeoreferenceAnnotation(i)}async removeGeoreferenceAnnotationByUrl(t){const i=await fetch(t).then(s=>s.json());return this.removeGeoreferenceAnnotation(i)}async addGeoreferencedMap(t){const i=this.renderer.warpedMapList.addGeoreferencedMap(t);return this.changed(),i}async removeGeoreferencedMap(t){const i=this.renderer.warpedMapList.removeGeoreferencedMap(t);return this.changed(),i}getWarpedMapList(){return this.renderer.warpedMapList}getWarpedMap(t){return this.renderer.warpedMapList.getWarpedMap(t)}showMap(t){this.renderer.warpedMapList.showMaps([t]),this.changed()}showMaps(t){this.renderer.warpedMapList.showMaps(t),this.changed()}hideMap(t){this.renderer.warpedMapList.hideMaps([t]),this.changed()}hideMaps(t){this.renderer.warpedMapList.hideMaps(t),this.changed()}isMapVisible(t){return this.renderer.warpedMapList.getWarpedMap(t)?.visible}setMapResourceMask(t,i){this.renderer.warpedMapList.setMapResourceMask(i,t),this.changed()}setMapGcps(t,i){this.renderer.warpedMapList.setMapGcps(i,t),this.changed()}setMapsTransformationType(t,i){this.renderer.warpedMapList.setMapsTransformationType(i,{mapIds:t}),this.changed()}setMapTransformationType(t,i){this.renderer.warpedMapList.setMapTransformationType(i,t),this.changed()}setMapsDistortionMeasure(t,i){this.renderer.warpedMapList.setMapsDistortionMeasure(i,{mapIds:t}),this.changed()}removeGeoreferencedMapById(t){this.renderer.warpedMapList.removeGeoreferencedMapById(t),this.changed()}getLonLatExtent(){return this.renderer.warpedMapList.getMapsBbox({projection:{definition:"EPSG:4326"}})}getExtent(){return this.renderer.warpedMapList.getMapsBbox()}bringMapsToFront(t){this.renderer.warpedMapList.bringMapsToFront(t),this.changed()}sendMapsToBack(t){this.renderer.warpedMapList.sendMapsToBack(t),this.changed()}bringMapsForward(t){this.renderer.warpedMapList.bringMapsForward(t),this.changed()}sendMapsBackward(t){this.renderer.warpedMapList.sendMapsBackward(t),this.changed()}getMapZIndex(t){return this.renderer.warpedMapList.getMapZIndex(t)}setImageInformations(t){this.renderer.warpedMapList.setImageInformations(t)}getContainer(){return this.container}getCanvas(){return this.canvas}setOptions(t){this.renderer.setOptions(t)}getMapOpacity(t){return this.renderer.getMapOpacity(t)}setMapOpacity(t,i){this.renderer.setMapOpacity(t,i),this.changed()}resetMapOpacity(t){this.renderer.resetMapOpacity(t),this.changed()}setSaturation(t){this.renderer.setSaturation(t),this.changed()}resetSaturation(){this.renderer.resetSaturation(),this.changed()}setMapSaturation(t,i){this.renderer.setMapSaturation(t,i),this.changed()}resetMapSaturation(t){this.renderer.resetMapSaturation(t),this.changed()}setRemoveColor(t){const i=t.hexColor?$i(t.hexColor):void 0;this.renderer.setRemoveColorOptions({color:i,threshold:t.threshold,hardness:t.hardness}),this.changed()}resetRemoveColor(){this.renderer.resetRemoveColorOptions(),this.changed()}setMapRemoveColor(t,i){const n=i.hexColor?$i(i.hexColor):void 0;this.renderer.setMapRemoveColorOptions(t,{color:n,threshold:i.threshold,hardness:i.hardness}),this.changed()}resetMapRemoveColor(t){this.renderer.resetMapRemoveColorOptions(t)}setColorize(t){const i=$i(t);i&&(this.renderer.setColorizeOptions({color:i}),this.changed())}resetColorize(){this.renderer.resetColorizeOptions(),this.changed()}setMapColorize(t,i){const n=$i(i);n&&(this.renderer.setMapColorizeOptions(t,{color:n}),this.changed())}resetMapColorize(t){this.renderer.resetMapColorizeOptions(t),this.changed()}setGrid(t){this.renderer.setGridOptions({enabled:t}),this.changed()}resetGrid(){this.renderer.resetGridOptions(),this.changed()}setMapGrid(t,i){this.renderer.setMapGridOptions(t,{enabled:i}),this.changed()}resetMapGrid(t){this.renderer.resetMapGridOptions(t),this.changed()}dispose(){this.renderer.destroy();const t=this.gl.getExtension("WEBGL_lose_context");t&&t.loseContext();const i=this.gl.canvas;i.width=1,i.height=1,this.resizeObserver.disconnect(),this.removeEventListeners(),super.disposeInternal()}clear(){this.renderer.warpedMapList.clear(),this.changed()}render(t){this.canvas&&this.resizeCanvas(this.canvas,this.canvasSize),this.renderer.setOpacity(Math.min(Math.max(this.getOpacity(),0),1));const i=new ia(t.size,t.viewState.center,t.viewState.resolution,{rotation:t.viewState.rotation,devicePixelRatio:window.devicePixelRatio,projection:{definition:t.viewState.projection.getCode()}});return this.renderer.render(i),this.container}resized(t){for(const i of t){const n=i.contentRect.width,s=i.contentRect.height,r=window.devicePixelRatio,o=Math.round(n*r),a=Math.round(s*r);this.canvasSize=[o,a]}this.changed()}resizeCanvas(t,[i,n]){const s=t.width!==i||t.height!==n;return s&&(t.width=i,t.height=n),s}contextLost(t){t.preventDefault(),this.renderer.contextLost()}contextRestored(t){t.preventDefault(),this.renderer.contextRestored()}addEventListeners(){this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this)),this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this)),this.renderer.addEventListener(st.CHANGED,this.changed.bind(this)),this.renderer.addEventListener(st.IMAGEINFOLOADED,this.changed.bind(this)),this.renderer.addEventListener(st.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.addEventListener(st.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener(st.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener(st.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(st.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(st.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(st.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(st.VISIBILITYCHANGED,this.changed.bind(this)),this.renderer.warpedMapList.addEventListener(st.CLEARED,this.changed.bind(this))}removeEventListeners(){this.canvas.removeEventListener("webglcontextlost",this.contextLost.bind(this)),this.canvas.removeEventListener("webglcontextrestored",this.contextRestored.bind(this)),this.renderer.removeEventListener(st.CHANGED,this.changed.bind(this)),this.renderer.removeEventListener(st.IMAGEINFOLOADED,this.changed.bind(this)),this.renderer.removeEventListener(st.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.removeEventListener(st.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener(st.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener(st.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(st.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(st.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(st.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(st.VISIBILITYCHANGED,this.changed.bind(this)),this.renderer.warpedMapList.removeEventListener(st.CLEARED,this.changed.bind(this))}passWarpedMapEvent(t){if(t instanceof Rt){const i=new qO(t.type,t.data);this.dispatchEvent(i)}}}export{EF as $,pF as A,Ap as B,_2 as C,Ay as D,MO as E,Pp as F,Ry as G,MF as H,Nd as I,IO as J,Nh as K,uc as L,Me as M,Md as N,IF as O,ha as P,Lh as Q,Jd as R,nd as S,sd as T,rd as U,uF as V,Oi as W,bs as X,Cs as Y,la as Z,du as _,Gp as a,dF as a0,ow as a1,nw as a2,sw as a3,rw as a4,fF as a5,hF as a6,_w as a7,Sw as a8,iF as a9,tF as aa,Aw as ab,rF as ac,jv as b,dw as c,Zn as d,nF as e,aF as f,eF as g,sF as h,lc as i,qi as j,wi as k,cF as l,ri as m,fp as n,aa as o,mw as p,Gi as q,iS as r,gw as s,Fs as t,mF as u,_F as v,yF as w,wF as x,vF as y,Sm as z};
