import"clsx";import{c as C,b as i,d as Lt,a as p,e as w,u as zt,f as ht}from"../../../chunks/index2.js";import{o as Et}from"../../../chunks/ol.js";import"ol/proj.js";import Pt from"ol/format/GeoJSON.js";import{unByKey as Tt}from"ol/Observable.js";import"@allmaps/openlayers";import"@allmaps/iiif-parser";import"@allmaps/stdlib";import{B as ct}from"../../../chunks/constants.js";import Vt from"ol/style/Style.js";import pt from"ol/style/Fill.js";import dt from"ol/style/Stroke.js";import Ft from"ol/style/Circle.js";import{w as vt}from"../../../chunks/index.js";import{V as Ht,Y as N,X as h}from"../../../chunks/context.js";new Vt({image:new Ft({radius:6,fill:new pt({color:"#06b6d4"}),stroke:new dt({color:"#0e7490",width:2})}),stroke:new dt({color:"#06b6d4",width:2}),fill:new pt({color:"rgba(6, 182, 212, 0.18)"})});const Rt=100;function Bt(g=Rt){const{subscribe:d,update:t,set:c}=vt({history:[],future:[]});return{subscribe:d,limit:g,push(o){t(u=>({history:[...u.history.slice(-g+1),o],future:[]}))},undo(){let o=null;return t(u=>u.history.length?(o=u.history[u.history.length-1],{history:u.history.slice(0,-1),future:[...u.future,o]}):u),o},redo(){let o=null;return t(u=>u.future.length?(o=u.future[u.future.length-1],{history:[...u.history,o],future:u.future.slice(0,-1)}):u),o},reset(){c({history:[],future:[]})}}}function jt(g,d){return d&&g.some(t=>t.id===d)?d:null}function Nt(){const{subscribe:g,update:d,set:t}=vt({list:[],selectedId:null});return{subscribe:g,setList(c){d(o=>({list:c,selectedId:jt(c,o.selectedId)}))},setSelected(c){d(o=>({...o,selectedId:c}))},clearSelection(){d(c=>({...c,selectedId:null}))},clearSelectionIfMatches(c){c&&d(o=>({...o,selectedId:o.selectedId===c?null:o.selectedId}))},reset(){t({list:[],selectedId:null})}}}const Ut=Symbol("annotation-context");function Wt(g){Ht(Ut,g)}function Yt(g,d){g.component(t=>{var c;let o,u,M,U,W;new Pt;const gt=100;let Y=N(d.initialMode,"explore"),K=N(d.showWelcomeOverlay,!0),r=null,X=[],O=[],D=[],L=!1,z=!1,S=!1,f=!1,_=!1,E="g-streets",bt="all",P="",m=[],G=[],q=.8,A=K,b=Y,rt=!1,y="map",J=!1,Q="annotations",yt=!1,kt=null,Z;const T=Bt(gt),V=Nt();Wt({history:T,state:V});let x=[],$=null,ft="",F=[],mt=!1,tt=[],wt=0,n=null,st=null,H=null,R=null,B=null,j=null,et=[],I="overlay",lt=null,k=null;function St(s){n&&n.getLayers().getArray().forEach(e=>{const l=e.getProperties();l.base&&e.setVisible(l.name===s)})}function xt(){return st?.getCanvas()??null}function _t(){const s=xt();if(!s||!n)return;const e=n.getSize();if(!e)return;const[l,a]=e;s.style.clipPath=""}function At(){if(!n)return;const s=n.getSize();if(!s)return;const[e,l]=s}function It(){if(!n)return;const s=n.getSize();if(!s)return;const[e,l]=s}function at(){_t(),At(),It()}function Ct(s){}function ot(){}function it(){n&&(k!==null&&cancelAnimationFrame(k),k=requestAnimationFrame(()=>{k=null,n?.updateSize(),at()}))}function nt(s){return s?"0px":"minmax(260px, 0.25fr)"}function Mt(s,e){return s&&e?"1":s||e?.75.toString():.5.toString()}function Ot(){!n||!R||(n.removeInteraction(R),R=null)}if(Et(()=>{lt?.(),lt=null,window.removeEventListener("pointermove",Ct),window.removeEventListener("pointerup",ot),window.removeEventListener("pointercancel",ot),window.removeEventListener("resize",it),et.forEach(s=>Tt(s)),et=[],Ot(),n&&B&&n.removeInteraction(B),n&&j&&n.removeInteraction(j),n?.setTarget(void 0),n=null,st=null,H=null,B=null,j=null,k!==null&&(cancelAnimationFrame(k),k=null)}),o=tt.filter(s=>!s.hidden),u=tt[wt]??null,u&&o.findIndex(s=>s.id===u.id)+1,ct.find(s=>s.key===E)?.label,M=Math.round(q*100),r=m.find(s=>s.id===P)??null,X=Array.from(new Set(m.map(s=>s.type||"Uncategorized"))).filter(s=>s&&s.trim().length).sort((s,e)=>s.localeCompare(e)),O=(()=>{const s=m.filter(l=>l.isFeatured);return(s.length?s:m).slice(0,4)})(),G=m,D=G,U=C(c??={},"$annotationHistory",T).history.length>0,W=C(c??={},"$annotationHistory",T).future.length>0,x=C(c??={},"$annotationState",V).list,$=C(c??={},"$annotationState",V).selectedId,A&&(L=!1),r||(L=!1),A&&(z=!1),b!=="create"&&(S=!1,f=!1,z=!1,_=!1),Z=b==="create"?`grid-template-columns: ${nt(S)} minmax(0, ${Mt(S,f)}fr) ${nt(f)}; gap: 1.2rem; padding: 1.4rem;`:void 0,n&&it(),St(E),at(),H&&H.setVisible(b==="create"),t.push(`<div${i("viewer svelte-1gd50sk",void 0,{mobile:rt,creator:b==="create"})}>`),A?(t.push("<!--[-->"),t.push(`<div class="welcome-overlay svelte-1gd50sk"><div class="welcome-card svelte-1gd50sk"><h1 class="svelte-1gd50sk">Welcome to the VMA studio</h1> <p class="svelte-1gd50sk">Choose how you want to start. Viewer lets you explore; Creator unlocks annotation and storytelling tools.</p> <div class="welcome-actions svelte-1gd50sk"><button type="button"${i("chip ghost svelte-1gd50sk",void 0,{active:b==="explore"})}>Viewer</button> <button type="button"${i("chip svelte-1gd50sk",void 0,{active:b==="create"})}>Creator</button></div></div></div>`)):t.push("<!--[!-->"),t.push(`<!--]--> <div class="workspace svelte-1gd50sk"${Lt(Z)}>`),b==="create"){if(t.push("<!--[-->"),S?(t.push("<!--[-->"),t.push('<button type="button" class="panel-toggle left svelte-1gd50sk">Show tools</button>')):t.push("<!--[!-->"),t.push("<!--]--> "),S)t.push("<!--[!-->");else{if(t.push("<!--[-->"),t.push(`<aside class="creator-panel left svelte-1gd50sk"><button type="button" class="panel-collapse svelte-1gd50sk" aria-expanded="true">Hide tools</button> <div class="panel-scroll custom-scrollbar svelte-1gd50sk"><section class="panel-card svelte-1gd50sk"><header class="panel-card-header svelte-1gd50sk"><h2 class="svelte-1gd50sk">View control</h2></header> <section class="panel-card-section svelte-1gd50sk"><span class="section-title svelte-1gd50sk">View mode</span> <div class="button-group wrap svelte-1gd50sk"><button type="button"${i("svelte-1gd50sk",void 0,{selected:I==="overlay"})}>Overlay</button> <button type="button"${i("svelte-1gd50sk",void 0,{selected:I==="side-x"})}>Side-X</button> <button type="button"${i("svelte-1gd50sk",void 0,{selected:I==="side-y"})}>Side-Y</button> <button type="button"${i("svelte-1gd50sk",void 0,{selected:I==="spy"})}>Glass</button></div></section> <section class="panel-card-section svelte-1gd50sk"><span class="section-title svelte-1gd50sk">Overlay opacity</span> <div class="slider svelte-1gd50sk"><input type="range" min="0" max="1" step="0.05"${p("value",q)} class="svelte-1gd50sk"/> <span>${h(M)}%</span></div></section></section> <section class="panel-card svelte-1gd50sk"><header class="panel-card-header svelte-1gd50sk"><h2 class="svelte-1gd50sk">Historical maps</h2></header> `),O.length){t.push("<!--[-->"),t.push('<section class="panel-card-section svelte-1gd50sk"><span class="section-title svelte-1gd50sk">Featured</span> <div class="history-featured svelte-1gd50sk"><!--[-->');const e=w(O);for(let l=0,a=e.length;l<a;l++){let v=e[l];t.push(`<button type="button"${i("history-featured-card svelte-1gd50sk",void 0,{selected:v.id===P})}><span class="history-title svelte-1gd50sk">${h(v.name)}</span> `),v.summary?(t.push("<!--[-->"),t.push(`<span class="history-meta svelte-1gd50sk">${h(v.summary)}</span>`)):t.push("<!--[!-->"),t.push("<!--]--></button>")}t.push("<!--]--></div></section>")}else t.push("<!--[!-->");if(t.push('<!--]--> <section class="panel-card-section svelte-1gd50sk"><label class="history-filter svelte-1gd50sk"><span>Filter by type</span> '),t.select({value:bt,class:""},e=>{e.option({value:"all"},a=>{a.push(`All maps (${h(m.length)})`)}),e.push("<!--[-->");const l=w(X);for(let a=0,v=l.length;a<v;a++){let ut=l[a];e.option({value:ut},Dt=>{Dt.push(`${h(ut)}`)})}e.push("<!--]-->")},"svelte-1gd50sk"),t.push('</label></section> <div class="history-list custom-scrollbar svelte-1gd50sk">'),D.length){t.push("<!--[-->"),t.push("<!--[-->");const e=w(D);for(let l=0,a=e.length;l<a;l++){let v=e[l];t.push(`<button type="button"${i("history-item svelte-1gd50sk",void 0,{selected:v.id===P})}><span class="history-title svelte-1gd50sk">${h(v.name)}</span> <span class="history-meta svelte-1gd50sk">${h(v.summary||v.type)}</span></button>`)}t.push("<!--]-->")}else t.push("<!--[!-->"),t.push('<p class="empty-state svelte-1gd50sk">Map catalog is loading‚Ä¶</p>');t.push('<!--]--></div></section> <section class="panel-card svelte-1gd50sk"><header class="panel-card-header svelte-1gd50sk"><h2 class="svelte-1gd50sk">Basemap</h2></header> <section class="panel-card-section svelte-1gd50sk"><div class="button-group wrap svelte-1gd50sk"><!--[-->');const s=w(ct);for(let e=0,l=s.length;e<l;e++){let a=s[e];t.push(`<button type="button"${i("svelte-1gd50sk",void 0,{selected:E===a.key})}>${h(a.label)}</button>`)}t.push("<!--]--></div></section></section></div></aside>")}t.push("<!--]-->")}else t.push("<!--[!-->");if(t.push('<!--]--> <div class="map-stage svelte-1gd50sk"><div class="map-surface svelte-1gd50sk"><div class="map svelte-1gd50sk"></div> <div class="divider vertical svelte-1gd50sk" aria-hidden="true"></div> <div class="divider horizontal svelte-1gd50sk" aria-hidden="true"></div> <button class="handle vertical svelte-1gd50sk" type="button" aria-label="Drag vertical split" title="Drag vertical split"></button> <button class="handle horizontal svelte-1gd50sk" type="button" aria-label="Drag horizontal split" title="Drag horizontal split"></button> <div class="lens svelte-1gd50sk" aria-hidden="true"></div> <button class="lens-handle svelte-1gd50sk" type="button" aria-label="Adjust spyglass radius" title="Adjust spyglass radius"></button></div> '),t.push("<!--[!-->"),t.push("<!--]--> "),b==="create"?(t.push("<!--[-->"),t.push(`<div class="creator-toolbar svelte-1gd50sk"><div class="toolbar-cluster svelte-1gd50sk"><button type="button" title="Search places" aria-label="Search places" class="svelte-1gd50sk"><span class="toolbar-icon svelte-1gd50sk">üîç</span></button></div> <div class="toolbar-cluster svelte-1gd50sk"><button type="button" title="Pan the map" aria-label="Pan the map"${i("svelte-1gd50sk",void 0,{selected:!0})}><span class="toolbar-icon svelte-1gd50sk">üñê</span></button> <div class="toolbar-group svelte-1gd50sk"><button type="button" title="Draw annotations" aria-label="Draw annotations" aria-haspopup="true"${p("aria-expanded",yt)}${i("svelte-1gd50sk",void 0,{selected:!1})}><span class="toolbar-icon svelte-1gd50sk">‚úèÔ∏è</span></button> `),t.push("<!--[!-->"),t.push(`<!--]--></div> <button type="button" title="Undo" aria-label="Undo"${p("disabled",!U,!0)} class="svelte-1gd50sk"><span class="toolbar-icon svelte-1gd50sk">‚Ü∫</span></button> <button type="button" title="Redo" aria-label="Redo"${p("disabled",!W,!0)} class="svelte-1gd50sk"><span class="toolbar-icon svelte-1gd50sk">‚Üª</span></button></div> <div class="toolbar-cluster svelte-1gd50sk"><button type="button" title="Capture current view" aria-label="Capture scene" class="svelte-1gd50sk"><span class="toolbar-icon svelte-1gd50sk">üì∑</span></button> <button type="button" title="Present story" aria-label="Present story"${p("disabled",!o.length,!0)} class="svelte-1gd50sk"><span class="toolbar-icon svelte-1gd50sk">üéû</span></button></div> <div class="toolbar-cluster svelte-1gd50sk"><div class="toolbar-group svelte-1gd50sk"><button type="button" title="Settings" aria-label="Settings" aria-haspopup="true"${p("aria-expanded",_)}${i("svelte-1gd50sk",void 0,{selected:_})}><span class="toolbar-icon svelte-1gd50sk">‚öôÔ∏è</span></button> `),_?(t.push("<!--[-->"),t.push('<div class="toolbar-menu svelte-1gd50sk"><button type="button" class="svelte-1gd50sk">Switch to Viewer</button> <button type="button" class="svelte-1gd50sk">Clear cached state</button></div>')):t.push("<!--[!-->"),t.push("<!--]--></div></div></div>")):(t.push("<!--[!-->"),A?t.push("<!--[!-->"):(t.push("<!--[-->"),t.push(`<div${i("viewer-panel svelte-1gd50sk",void 0,{collapsed:!J})}><div class="viewer-tabs svelte-1gd50sk"><button type="button"${p("aria-expanded",J)}${i("svelte-1gd50sk",void 0,{selected:y==="map"})}>Map</button> <button type="button"${p("aria-expanded",y==="control")}${i("svelte-1gd50sk",void 0,{selected:y==="control"})}>Controls</button> <button type="button"${p("aria-expanded",y==="story")}${i("svelte-1gd50sk",void 0,{selected:y==="story"})}>Story</button> <button type="button"${p("aria-expanded",y==="info")}${i("svelte-1gd50sk",void 0,{selected:y==="info"})}>Share &amp; Settings</button></div> `),t.push("<!--[!-->"),t.push("<!--]--></div>")),t.push("<!--]-->")),t.push("<!--]--></div> "),b==="create"){if(t.push("<!--[-->"),f?(t.push("<!--[-->"),t.push('<button type="button" class="panel-toggle right svelte-1gd50sk">Show panel</button>')):t.push("<!--[!-->"),t.push("<!--]--> "),f)t.push("<!--[!-->");else{t.push("<!--[-->"),t.push(`<aside class="creator-panel right svelte-1gd50sk"><header class="creator-right-header svelte-1gd50sk"><button type="button" class="panel-collapse svelte-1gd50sk"${p("aria-expanded",!f)}>Hide panel</button> <div class="creator-right-controls svelte-1gd50sk"><div class="toggle-group svelte-1gd50sk"><button type="button"${i("svelte-1gd50sk",void 0,{selected:Q==="annotations"})}>Annotations</button> <button type="button"${i("svelte-1gd50sk",void 0,{selected:Q==="story"})}>Story slides</button></div> <div class="right-actions svelte-1gd50sk"><button type="button" class="chip ghost"${p("disabled",!x.length,!0)}>Clear</button> <button type="button" class="chip ghost"${p("disabled",!x.length,!0)}>Export</button> <label class="chip ghost upload">Import <input type="file" accept="application/geo+json,.geojson,.json"/></label></div></div></header> <div class="creator-right-body custom-scrollbar svelte-1gd50sk">`);{if(t.push("<!--[-->"),t.push("<!--[!-->"),t.push("<!--]--> "),x.length){t.push("<!--[-->"),t.push("<!--[-->");const s=w(x);for(let e=0,l=s.length;e<l;e++){let a=s[e];t.push(`<div${i("list-card svelte-1gd50sk",void 0,{selected:a.id===$})}><div class="list-card-header svelte-1gd50sk"><input type="text"${p("value",a.label)} placeholder="Annotation name" class="svelte-1gd50sk"/> <div class="list-card-actions svelte-1gd50sk"><input type="color"${p("value",a.color)} title="Annotation colour" class="svelte-1gd50sk"/> <button type="button" class="chip ghost">${h(a.hidden?"Show":"Hide")}</button> <button type="button" class="chip danger">Delete</button> <button type="button" class="icon-button svelte-1gd50sk" aria-label="Annotation actions">‚ò∞</button></div></div> <textarea rows="2" placeholder="Annotation details" class="svelte-1gd50sk">`);const v=h(a.details);v&&t.push(`${v}`),t.push("</textarea> "),kt===a.id?(t.push("<!--[-->"),t.push('<div class="card-menu svelte-1gd50sk"><button type="button" class="svelte-1gd50sk">Zoom to</button> <button type="button" class="svelte-1gd50sk">Select</button></div>')):t.push("<!--[!-->"),t.push("<!--]--></div>")}t.push("<!--]-->")}else t.push("<!--[!-->"),t.push('<p class="empty-state svelte-1gd50sk">Draw or import annotations to see them here.</p>');t.push("<!--]-->")}t.push("<!--]--></div></aside>")}t.push("<!--]-->")}else t.push("<!--[!-->");if(t.push("<!--]--></div> "),L?(t.push("<!--[-->"),t.push('<div class="metadata-overlay svelte-1gd50sk" role="dialog" aria-modal="true" tabindex="0"><div class="metadata-card svelte-1gd50sk"><header class="svelte-1gd50sk"><h2 class="svelte-1gd50sk">Map metadata</h2> <button type="button" class="chip ghost svelte-1gd50sk">Close</button></header> '),r?(t.push("<!--[-->"),t.push(`<section class="metadata-section svelte-1gd50sk"><h3 class="svelte-1gd50sk">${h(r.name)}</h3> <dl class="svelte-1gd50sk"><div><dt class="svelte-1gd50sk">Type</dt> <dd class="svelte-1gd50sk">${h(r.type)}</dd></div> `),r.summary?(t.push("<!--[-->"),t.push(`<div><dt class="svelte-1gd50sk">Summary</dt> <dd class="svelte-1gd50sk">${h(r.summary)}</dd></div>`)):t.push("<!--[!-->"),t.push("<!--]--> "),r.description?(t.push("<!--[-->"),t.push(`<div><dt class="svelte-1gd50sk">Details</dt> <dd class="svelte-1gd50sk">${h(r.description)}</dd></div>`)):t.push("<!--[!-->"),t.push("<!--]--></dl></section>")):(t.push("<!--[!-->"),t.push('<p class="empty-state svelte-1gd50sk">Select a map to view its metadata.</p>')),t.push("<!--]--></div></div>")):t.push("<!--[!-->"),t.push("<!--]--> "),z){if(t.push("<!--[-->"),t.push(`<div class="search-dialog svelte-1gd50sk" role="dialog" aria-modal="true" tabindex="0"><button type="button" class="dialog-backdrop svelte-1gd50sk" aria-label="Dismiss search"></button> <div class="search-card svelte-1gd50sk"><header class="svelte-1gd50sk"><h2 class="svelte-1gd50sk">Search</h2> <button type="button" class="chip ghost">Close</button></header> <div class="search-form svelte-1gd50sk"><input type="text" placeholder="Search for a place or address"${p("value",ft)} class="svelte-1gd50sk"/> <div class="search-form-actions svelte-1gd50sk"><button type="button" class="chip ghost"${p("disabled",mt,!0)}>Locate me</button> <button type="button" class="chip ghost"${p("disabled",!F.length,!0)}>Clear</button></div></div> `),t.push("<!--[!-->"),t.push("<!--[!-->"),t.push("<!--]-->"),t.push("<!--]--> "),F.length){t.push("<!--[-->"),t.push('<div class="search-results-list custom-scrollbar svelte-1gd50sk"><!--[-->');const s=w(F);for(let e=0,l=s.length;e<l;e++){let a=s[e];t.push(`<div class="search-result-item svelte-1gd50sk"><button type="button" class="search-result-main svelte-1gd50sk"><span class="result-title svelte-1gd50sk">${h(a.display_name)}</span> `),a.type?(t.push("<!--[-->"),t.push(`<span class="result-type svelte-1gd50sk">${h(a.type)}</span>`)):t.push("<!--[!-->"),t.push("<!--]--></button> "),b==="create"?(t.push("<!--[-->"),t.push('<div class="search-result-actions svelte-1gd50sk"><button type="button" class="chip ghost">Add to annotations</button></div>')):t.push("<!--[!-->"),t.push("<!--]--></div>")}t.push("<!--]--></div>")}else t.push("<!--[!-->");t.push("<!--]--></div></div>")}else t.push("<!--[!-->");t.push("<!--]--> "),t.push("<!--[!-->"),t.push("<!--]--></div>"),c&&zt(c),ht(d,{initialMode:Y,showWelcomeOverlay:K})})}function Kt(g,d){let t=N(d.mode,"explore");Yt(g,{initialMode:t}),ht(d,{mode:t})}function cs(g){Kt(g,{})}export{cs as default};
