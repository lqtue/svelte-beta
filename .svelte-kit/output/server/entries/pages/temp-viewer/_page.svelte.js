import{c as x,b as g,d as Ct,a as v,e as y,u as Dt,f as ct,h as Lt}from"../../../chunks/index2.js";import{o as Ot}from"../../../chunks/ol.js";import"ol/proj.js";import zt from"ol/format/GeoJSON.js";import{unByKey as Et}from"ol/Observable.js";import"@allmaps/openlayers";import"@allmaps/iiif-parser";import"@allmaps/stdlib";import{B as it}from"../../../chunks/constants.js";import Tt from"ol/style/Style.js";import nt from"ol/style/Fill.js";import ut from"ol/style/Stroke.js";import Ft from"ol/style/Circle.js";import{w as pt}from"../../../chunks/index.js";import{V as Ht,Y as B,X as p}from"../../../chunks/context.js";new Tt({image:new Ft({radius:6,fill:new nt({color:"#06b6d4"}),stroke:new ut({color:"#0e7490",width:2})}),stroke:new ut({color:"#06b6d4",width:2}),fill:new nt({color:"rgba(6, 182, 212, 0.18)"})});const Pt=100;function Rt(d=Pt){const{subscribe:n,update:t,set:c}=pt({history:[],future:[]});return{subscribe:n,limit:d,push(o){t(u=>({history:[...u.history.slice(-d+1),o],future:[]}))},undo(){let o=null;return t(u=>u.history.length?(o=u.history[u.history.length-1],{history:u.history.slice(0,-1),future:[...u.future,o]}):u),o},redo(){let o=null;return t(u=>u.future.length?(o=u.future[u.future.length-1],{history:[...u.history,o],future:u.future.slice(0,-1)}):u),o},reset(){c({history:[],future:[]})}}}function Vt(d,n){return n&&d.some(t=>t.id===n)?n:null}function Bt(){const{subscribe:d,update:n,set:t}=pt({list:[],selectedId:null});return{subscribe:d,setList(c){n(o=>({list:c,selectedId:Vt(c,o.selectedId)}))},setSelected(c){n(o=>({...o,selectedId:c}))},clearSelection(){n(c=>({...c,selectedId:null}))},clearSelectionIfMatches(c){c&&n(o=>({...o,selectedId:o.selectedId===c?null:o.selectedId}))},reset(){t({list:[],selectedId:null})}}}const Nt=Symbol("annotation-context");function jt(d){Ht(Nt,d)}function Ut(d,n){d.component(t=>{var c;let o,u,I,N,j;new zt;const dt=100;let U=B(n.initialMode,"explore"),Y=B(n.showWelcomeOverlay,!0),r=null,K=[],A=[],M=[],C=!1,D=!1,k=!1,f=!1,S=!1,L="g-streets",ht="all",O="",m=[],W=[],X=.8,G=Y,z=U,vt=!1,gt=!1,rt=null,q;const E=Rt(dt),T=Bt();jt({history:E,state:T});let w=[],J=null,bt="",F=[],ft=!1,Q=[],mt=0,i=null,Z=null,H=null,P=null,R=null,V=null,$=[],_="overlay",tt=null,b=null;function yt(s){i&&i.getLayers().getArray().forEach(e=>{const l=e.getProperties();l.base&&e.setVisible(l.name===s)})}function kt(){return Z?.getCanvas()??null}function wt(){const s=kt();if(!s||!i)return;const e=i.getSize();if(!e)return;const[l,a]=e;s.style.clipPath=""}function St(){if(!i)return;const s=i.getSize();if(!s)return;const[e,l]=s}function _t(){if(!i)return;const s=i.getSize();if(!s)return;const[e,l]=s}function st(){wt(),St(),_t()}function xt(s){}function et(){}function lt(){i&&(b!==null&&cancelAnimationFrame(b),b=requestAnimationFrame(()=>{b=null,i?.updateSize(),st()}))}function at(s){return s?"0px":"minmax(260px, 0.25fr)"}function It(s,e){return s&&e?"1":s||e?.75.toString():.5.toString()}function At(){!i||!P||(i.removeInteraction(P),P=null)}Ot(()=>{tt?.(),tt=null,window.removeEventListener("pointermove",xt),window.removeEventListener("pointerup",et),window.removeEventListener("pointercancel",et),window.removeEventListener("resize",lt),$.forEach(s=>Et(s)),$=[],At(),i&&R&&i.removeInteraction(R),i&&V&&i.removeInteraction(V),i?.setTarget(void 0),i=null,Z=null,H=null,R=null,V=null,b!==null&&(cancelAnimationFrame(b),b=null)}),o=Q.filter(s=>!s.hidden),u=Q[mt]??null,u&&o.findIndex(s=>s.id===u.id)+1,it.find(s=>s.key===L)?.label,I=Math.round(X*100),r=m.find(s=>s.id===O)??null,K=Array.from(new Set(m.map(s=>s.type||"Uncategorized"))).filter(s=>s&&s.trim().length).sort((s,e)=>s.localeCompare(e)),A=(()=>{const s=m.filter(l=>l.isFeatured);return(s.length?s:m).slice(0,4)})(),W=m,M=W,N=x(c??={},"$annotationHistory",E).history.length>0,j=x(c??={},"$annotationHistory",E).future.length>0,w=x(c??={},"$annotationState",T).list,J=x(c??={},"$annotationState",T).selectedId,G&&(C=!1),r||(C=!1),G&&(D=!1),z!=="create"&&(k=!1,f=!1,D=!1,S=!1),q=z==="create"?`grid-template-columns: ${at(k)} minmax(0, ${It(k,f)}fr) ${at(f)}; gap: 1.2rem; padding: 1.4rem;`:void 0,i&&lt(),yt(L),st(),H&&H.setVisible(z==="create"),t.push(`<div${g("viewer svelte-1gd50sk",void 0,{mobile:vt,creator:!0})}><div class="workspace svelte-1gd50sk"${Ct(q)}>`);{if(t.push("<!--[-->"),k?(t.push("<!--[-->"),t.push('<button type="button" class="panel-toggle left svelte-1gd50sk">Show tools</button>')):t.push("<!--[!-->"),t.push("<!--]--> "),k)t.push("<!--[!-->");else{if(t.push("<!--[-->"),t.push(`<aside class="creator-panel left svelte-1gd50sk"><button type="button" class="panel-collapse svelte-1gd50sk" aria-expanded="true">Hide tools</button> <div class="panel-scroll custom-scrollbar svelte-1gd50sk"><section class="panel-card svelte-1gd50sk"><header class="panel-card-header svelte-1gd50sk"><h2 class="svelte-1gd50sk">View control</h2></header> <section class="panel-card-section svelte-1gd50sk"><span class="section-title svelte-1gd50sk">View mode</span> <div class="button-group wrap svelte-1gd50sk"><button type="button"${g("svelte-1gd50sk",void 0,{selected:_==="overlay"})}>Overlay</button> <button type="button"${g("svelte-1gd50sk",void 0,{selected:_==="side-x"})}>Side-X</button> <button type="button"${g("svelte-1gd50sk",void 0,{selected:_==="side-y"})}>Side-Y</button> <button type="button"${g("svelte-1gd50sk",void 0,{selected:_==="spy"})}>Glass</button></div></section> <section class="panel-card-section svelte-1gd50sk"><span class="section-title svelte-1gd50sk">Overlay opacity</span> <div class="slider svelte-1gd50sk"><input type="range" min="0" max="1" step="0.05"${v("value",X)} class="svelte-1gd50sk"/> <span>${p(I)}%</span></div></section></section> <section class="panel-card svelte-1gd50sk"><header class="panel-card-header svelte-1gd50sk"><h2 class="svelte-1gd50sk">Historical maps</h2></header> `),A.length){t.push("<!--[-->"),t.push('<section class="panel-card-section svelte-1gd50sk"><span class="section-title svelte-1gd50sk">Featured</span> <div class="history-featured svelte-1gd50sk"><!--[-->');const e=y(A);for(let l=0,a=e.length;l<a;l++){let h=e[l];t.push(`<button type="button"${g("history-featured-card svelte-1gd50sk",void 0,{selected:h.id===O})}><span class="history-title svelte-1gd50sk">${p(h.name)}</span> `),h.summary?(t.push("<!--[-->"),t.push(`<span class="history-meta svelte-1gd50sk">${p(h.summary)}</span>`)):t.push("<!--[!-->"),t.push("<!--]--></button>")}t.push("<!--]--></div></section>")}else t.push("<!--[!-->");if(t.push('<!--]--> <section class="panel-card-section svelte-1gd50sk"><label class="history-filter svelte-1gd50sk"><span>Filter by type</span> '),t.select({value:ht,class:""},e=>{e.option({value:"all"},a=>{a.push(`All maps (${p(m.length)})`)}),e.push("<!--[-->");const l=y(K);for(let a=0,h=l.length;a<h;a++){let ot=l[a];e.option({value:ot},Mt=>{Mt.push(`${p(ot)}`)})}e.push("<!--]-->")},"svelte-1gd50sk"),t.push('</label></section> <div class="history-list custom-scrollbar svelte-1gd50sk">'),M.length){t.push("<!--[-->"),t.push("<!--[-->");const e=y(M);for(let l=0,a=e.length;l<a;l++){let h=e[l];t.push(`<button type="button"${g("history-item svelte-1gd50sk",void 0,{selected:h.id===O})}><span class="history-title svelte-1gd50sk">${p(h.name)}</span> <span class="history-meta svelte-1gd50sk">${p(h.summary||h.type)}</span></button>`)}t.push("<!--]-->")}else t.push("<!--[!-->"),t.push('<p class="empty-state svelte-1gd50sk">Map catalog is loading‚Ä¶</p>');t.push('<!--]--></div></section> <section class="panel-card svelte-1gd50sk"><header class="panel-card-header svelte-1gd50sk"><h2 class="svelte-1gd50sk">Basemap</h2></header> <section class="panel-card-section svelte-1gd50sk"><div class="button-group wrap svelte-1gd50sk"><!--[-->');const s=y(it);for(let e=0,l=s.length;e<l;e++){let a=s[e];t.push(`<button type="button"${g("svelte-1gd50sk",void 0,{selected:L===a.key})}>${p(a.label)}</button>`)}t.push("<!--]--></div></section></section></div></aside>")}t.push("<!--]-->")}t.push(`<!--]--> <div class="map-stage svelte-1gd50sk"><div class="map-surface svelte-1gd50sk"><div class="map svelte-1gd50sk"></div> <div class="divider vertical svelte-1gd50sk" aria-hidden="true"></div> <div class="divider horizontal svelte-1gd50sk" aria-hidden="true"></div> <button class="handle vertical svelte-1gd50sk" type="button" aria-label="Drag vertical split" title="Drag vertical split"></button> <button class="handle horizontal svelte-1gd50sk" type="button" aria-label="Drag horizontal split" title="Drag horizontal split"></button> <div class="lens svelte-1gd50sk" aria-hidden="true"></div> <button class="lens-handle svelte-1gd50sk" type="button" aria-label="Adjust spyglass radius" title="Adjust spyglass radius"></button></div> <div class="creator-toolbar svelte-1gd50sk"><div class="toolbar-cluster svelte-1gd50sk"><button type="button" title="Search places" aria-label="Search places" class="svelte-1gd50sk"><span class="toolbar-icon svelte-1gd50sk">üîç</span></button></div> <div class="toolbar-cluster svelte-1gd50sk"><button type="button" title="Pan the map" aria-label="Pan the map"${g("svelte-1gd50sk",void 0,{selected:!0})}><span class="toolbar-icon svelte-1gd50sk">üñê</span></button> <div class="toolbar-group svelte-1gd50sk"><button type="button" title="Draw annotations" aria-label="Draw annotations" aria-haspopup="true"${v("aria-expanded",gt)}${g("svelte-1gd50sk",void 0,{selected:!1})}><span class="toolbar-icon svelte-1gd50sk">‚úèÔ∏è</span></button> `),t.push("<!--[!-->"),t.push(`<!--]--></div> <button type="button" title="Undo" aria-label="Undo"${v("disabled",!N,!0)} class="svelte-1gd50sk"><span class="toolbar-icon svelte-1gd50sk">‚Ü∫</span></button> <button type="button" title="Redo" aria-label="Redo"${v("disabled",!j,!0)} class="svelte-1gd50sk"><span class="toolbar-icon svelte-1gd50sk">‚Üª</span></button></div> <div class="toolbar-cluster svelte-1gd50sk"><div class="toolbar-group svelte-1gd50sk"><button type="button" title="Settings" aria-label="Settings" aria-haspopup="true"${v("aria-expanded",S)}${g("svelte-1gd50sk",void 0,{selected:S})}><span class="toolbar-icon svelte-1gd50sk">‚öôÔ∏è</span></button> `),S?(t.push("<!--[-->"),t.push('<div class="toolbar-menu svelte-1gd50sk"><button type="button" class="svelte-1gd50sk">Clear cached state</button></div>')):t.push("<!--[!-->"),t.push("<!--]--></div></div></div></div> ");{if(t.push("<!--[-->"),f?(t.push("<!--[-->"),t.push('<button type="button" class="panel-toggle right svelte-1gd50sk">Show panel</button>')):t.push("<!--[!-->"),t.push("<!--]--> "),f)t.push("<!--[!-->");else{if(t.push("<!--[-->"),t.push(`<aside class="creator-panel right svelte-1gd50sk"><header class="creator-right-header svelte-1gd50sk"><button type="button" class="panel-collapse svelte-1gd50sk"${v("aria-expanded",!f)}>Hide panel</button> <div class="creator-right-controls svelte-1gd50sk"><h2 class="panel-heading svelte-1gd50sk">Annotations</h2> <div class="right-actions svelte-1gd50sk"><button type="button" class="chip ghost"${v("disabled",!w.length,!0)}>Clear</button> <button type="button" class="chip ghost"${v("disabled",!w.length,!0)}>Export</button> <label class="chip ghost upload">Import <input type="file" accept="application/geo+json,.geojson,.json"/></label></div></div></header> <div class="creator-right-body custom-scrollbar svelte-1gd50sk">`),t.push("<!--[!-->"),t.push("<!--]--> "),w.length){t.push("<!--[-->"),t.push("<!--[-->");const s=y(w);for(let e=0,l=s.length;e<l;e++){let a=s[e];t.push(`<div${g("list-card svelte-1gd50sk",void 0,{selected:a.id===J})}><div class="list-card-header svelte-1gd50sk"><input type="text"${v("value",a.label)} placeholder="Annotation name" class="svelte-1gd50sk"/> <div class="list-card-actions svelte-1gd50sk"><input type="color"${v("value",a.color)} title="Annotation colour" class="svelte-1gd50sk"/> <button type="button" class="chip ghost">${p(a.hidden?"Show":"Hide")}</button> <button type="button" class="chip danger">Delete</button> <button type="button" class="icon-button svelte-1gd50sk" aria-label="Annotation actions">‚ò∞</button></div></div> <textarea rows="2" placeholder="Annotation details" class="svelte-1gd50sk">`);const h=p(a.details);h&&t.push(`${h}`),t.push("</textarea> "),rt===a.id?(t.push("<!--[-->"),t.push('<div class="card-menu svelte-1gd50sk"><button type="button" class="svelte-1gd50sk">Zoom to</button> <button type="button" class="svelte-1gd50sk">Select</button></div>')):t.push("<!--[!-->"),t.push("<!--]--></div>")}t.push("<!--]-->")}else t.push("<!--[!-->"),t.push('<p class="empty-state svelte-1gd50sk">Draw or import annotations to see them here.</p>');t.push("<!--]--></div></aside>")}t.push("<!--]-->")}if(t.push("<!--]--></div> "),C?(t.push("<!--[-->"),t.push('<div class="metadata-overlay svelte-1gd50sk" role="dialog" aria-modal="true" tabindex="0"><div class="metadata-card svelte-1gd50sk"><header class="svelte-1gd50sk"><h2 class="svelte-1gd50sk">Map metadata</h2> <button type="button" class="chip ghost svelte-1gd50sk">Close</button></header> '),r?(t.push("<!--[-->"),t.push(`<section class="metadata-section svelte-1gd50sk"><h3 class="svelte-1gd50sk">${p(r.name)}</h3> <dl class="svelte-1gd50sk"><div><dt class="svelte-1gd50sk">Type</dt> <dd class="svelte-1gd50sk">${p(r.type)}</dd></div> `),r.summary?(t.push("<!--[-->"),t.push(`<div><dt class="svelte-1gd50sk">Summary</dt> <dd class="svelte-1gd50sk">${p(r.summary)}</dd></div>`)):t.push("<!--[!-->"),t.push("<!--]--> "),r.description?(t.push("<!--[-->"),t.push(`<div><dt class="svelte-1gd50sk">Details</dt> <dd class="svelte-1gd50sk">${p(r.description)}</dd></div>`)):t.push("<!--[!-->"),t.push("<!--]--></dl></section>")):(t.push("<!--[!-->"),t.push('<p class="empty-state svelte-1gd50sk">Select a map to view its metadata.</p>')),t.push("<!--]--></div></div>")):t.push("<!--[!-->"),t.push("<!--]--> "),D){if(t.push("<!--[-->"),t.push(`<div class="search-dialog svelte-1gd50sk" role="dialog" aria-modal="true" tabindex="0"><button type="button" class="dialog-backdrop svelte-1gd50sk" aria-label="Dismiss search"></button> <div class="search-card svelte-1gd50sk"><header class="svelte-1gd50sk"><h2 class="svelte-1gd50sk">Search</h2> <button type="button" class="chip ghost">Close</button></header> <div class="search-form svelte-1gd50sk"><input type="text" placeholder="Search for a place or address"${v("value",bt)} class="svelte-1gd50sk"/> <div class="search-form-actions svelte-1gd50sk"><button type="button" class="chip ghost"${v("disabled",ft,!0)}>Locate me</button> <button type="button" class="chip ghost"${v("disabled",!F.length,!0)}>Clear</button></div></div> `),t.push("<!--[!-->"),t.push("<!--[!-->"),t.push("<!--]-->"),t.push("<!--]--> "),F.length){t.push("<!--[-->"),t.push('<div class="search-results-list custom-scrollbar svelte-1gd50sk"><!--[-->');const s=y(F);for(let e=0,l=s.length;e<l;e++){let a=s[e];t.push(`<div class="search-result-item svelte-1gd50sk"><button type="button" class="search-result-main svelte-1gd50sk"><span class="result-title">${p(a.display_name)}</span> `),a.type?(t.push("<!--[-->"),t.push(`<span class="result-type">${p(a.type)}</span>`)):t.push("<!--[!-->"),t.push('<!--]--></button> <div class="search-result-actions svelte-1gd50sk"><button type="button" class="chip ghost">Add to annotations</button></div></div>')}t.push("<!--]--></div>")}else t.push("<!--[!-->");t.push("<!--]--></div></div>")}else t.push("<!--[!-->");t.push("<!--]--></div>"),c&&Dt(c),ct(n,{initialMode:U,showWelcomeOverlay:Y})})}function Yt(d,n){let t=B(n.mode,"explore");Ut(d,{initialMode:t}),ct(n,{mode:t})}function is(d){Lt(d,n=>{n.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>')}),Yt(d,{})}export{is as default};
