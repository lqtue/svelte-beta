import"clsx";import"ol/proj.js";import"@allmaps/openlayers";import{o as R}from"../../../chunks/constants.js";import{h as k,a as w,s as h,b as C,u as T,d as b,e as O}from"../../../chunks/index2.js";import{Z as r,Y as n,V as K}from"../../../chunks/context.js";import{w as F,d as z}from"../../../chunks/index.js";import W from"ol/geom/Polygon.js";import G from"ol/Feature.js";const H="vma-trip-language-v1";function Q(){const l=(()=>{if(typeof window<"u"){const s=localStorage.getItem(H);if(s==="vi"||s==="en")return s}return"en"})(),{subscribe:i,set:t}=F(l);return{subscribe:i,setLanguage:s=>{typeof window<"u"&&localStorage.setItem(H,s),t(s)},toggleLanguage:()=>{if(typeof window<"u"){const e=(localStorage.getItem(H)||"en")==="en"?"vi":"en";localStorage.setItem(H,e),t(e)}}}}const q=Q(),U={welcome:{title:"Welcome to Historical Maps",message:"Choose your starting city to explore historical maps from different eras.",skipButton:"Skip for Now",cityIcon:"üìç"},mapSelector:{consultingAtlas:"Consulting Atlas...",mapCollection:"Map Collection",allRegions:"All Regions",searchPlaceholder:"Search by year or name",zoomButton:"üîç Zoom to Map",anno:"Anno",noMapsFound:"‚äò No maps discovered in this region",buttonOrnament:"‚ßâ"},location:{tracking:"Tracking",myLocation:"My Location"},mapHint:{icon:"üëÜ",title:"Explore Historical Maps",description:"Click here to browse our collection of vintage maps",button:"Got it!"},cityFilter:{icon:"üó∫Ô∏è",title:"Filter Map Collection?",message:"Would you like to filter the map collection to show only maps from",noShowAll:"No, Show All",yesFilter:"Yes, Filter"},cities:{hanoi:"Hanoi",hue:"Hue",hochiminh:"Ho Chi Minh City",danang:"Da Nang",haiphong:"Hai Phong",cantho:"Can Tho",nhatrang:"Nha Trang",dalat:"Da Lat",vungtau:"Vung Tau",quinhon:"Quy Nhon"},common:{loading:"Loading...",error:"Error",close:"Close",cancel:"Cancel",confirm:"Confirm",save:"Save"}},J={welcome:{title:"Ch√†o m·ª´ng ƒë·∫øn v·ªõi B·∫£n ƒë·ªì L·ªãch s·ª≠",message:"Ch·ªçn th√†nh ph·ªë b·∫Øt ƒë·∫ßu ƒë·ªÉ kh√°m ph√° b·∫£n ƒë·ªì l·ªãch s·ª≠ t·ª´ nhi·ªÅu th·ªùi k·ª≥ kh√°c nhau.",skipButton:"B·ªè qua",cityIcon:"üìç"},mapSelector:{consultingAtlas:"ƒêang t·∫£i b·∫£n ƒë·ªì...",mapCollection:"B·ªô s∆∞u t·∫≠p B·∫£n ƒë·ªì",allRegions:"T·∫•t c·∫£ V√πng",searchPlaceholder:"T√¨m ki·∫øm theo nƒÉm ho·∫∑c t√™n",zoomButton:"üîç Ph√≥ng to B·∫£n ƒë·ªì",anno:"NƒÉm",noMapsFound:"‚äò Kh√¥ng t√¨m th·∫•y b·∫£n ƒë·ªì trong khu v·ª±c n√†y",buttonOrnament:"‚ßâ"},location:{tracking:"ƒêang theo d√µi",myLocation:"V·ªã tr√≠ c·ªßa t√¥i"},mapHint:{icon:"üëÜ",title:"Kh√°m ph√° B·∫£n ƒë·ªì L·ªãch s·ª≠",description:"Nh·∫•n v√†o ƒë√¢y ƒë·ªÉ xem b·ªô s∆∞u t·∫≠p b·∫£n ƒë·ªì c·ªï c·ªßa ch√∫ng t√¥i",button:"ƒê√£ hi·ªÉu!"},cityFilter:{icon:"üó∫Ô∏è",title:"L·ªçc B·ªô s∆∞u t·∫≠p B·∫£n ƒë·ªì?",message:"B·∫°n c√≥ mu·ªën l·ªçc b·ªô s∆∞u t·∫≠p b·∫£n ƒë·ªì ƒë·ªÉ ch·ªâ hi·ªÉn th·ªã b·∫£n ƒë·ªì t·ª´",noShowAll:"Kh√¥ng, Hi·ªÉn th·ªã T·∫•t c·∫£",yesFilter:"C√≥, L·ªçc"},cities:{hanoi:"H√† N·ªôi",hue:"Hu·∫ø",hochiminh:"Th√†nh ph·ªë H·ªì Ch√≠ Minh",danang:"ƒê√† N·∫µng",haiphong:"H·∫£i Ph√≤ng",cantho:"C·∫ßn Th∆°",nhatrang:"Nha Trang",dalat:"ƒê√† L·∫°t",vungtau:"V≈©ng T√†u",quinhon:"Quy Nh∆°n"},common:{loading:"ƒêang t·∫£i...",error:"L·ªói",close:"ƒê√≥ng",cancel:"H·ªßy",confirm:"X√°c nh·∫≠n",save:"L∆∞u"}},X={en:U,vi:J},v=z(q,l=>X[l]);function Z(l,i){l.component(t=>{var s;let e,a=r(i.maps,()=>[],!0),u=r(i.selected,null),o=r(i.loading,!1),c=r(i.filterCity,null),g="",f="all",d=!1;c&&(f=c),Array.from(new Set(a.map(p=>p.type).filter(Boolean))).sort(),a.filter(p=>{if(f!=="all"&&p.type!==f)return!1;if(!g.trim())return!0;const m=g.toLowerCase();return p.name.toLowerCase().includes(m)||p.type.toLowerCase().includes(m)||p.summary?.toLowerCase().includes(m)}),e=a.find(p=>p.id===u),k(t,p=>{p.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>')}),t.push(`<div class="selector-container svelte-1twr28"><button class="selector-button svelte-1twr28"${w("disabled",o,!0)}><span class="button-ornament svelte-1twr28">${n(h(s??={},"$t",v).mapSelector.buttonOrnament)}</span> <span class="button-text svelte-1twr28">`),o?(t.push("<!--[-->"),t.push(`${n(h(s??={},"$t",v).mapSelector.consultingAtlas)}`)):(t.push("<!--[!-->"),e?(t.push("<!--[-->"),t.push(`${n(e.name)}`)):(t.push("<!--[!-->"),t.push(`${n(h(s??={},"$t",v).mapSelector.mapCollection)}`)),t.push("<!--]-->")),t.push(`<!--]--></span> <span${C("arrow svelte-1twr28",void 0,{open:d})}>‚ñº</span></button> `),t.push("<!--[!-->"),t.push("<!--]--></div>"),s&&T(s),b(i,{maps:a,selected:u,loading:o,filterCity:c})})}function $(l,i){l.component(t=>{let s=i.map,e=i.position,a=r(i.heading,0),u=r(i.fieldOfView,60),o=r(i.radius,200),c=null;function g(d,p,m,S){const M=m,y=(90-p)*Math.PI/180,B=S/2*Math.PI/180,L=[d],N=y-B,P=y+B,A=20;for(let _=0;_<=A;_++){const I=N+_/A*(P-N),E=d[0]+M*Math.cos(I),Y=d[1]+M*Math.sin(I);L.push([E,Y])}return L.push(d),new W([L])}function f(){if(!e||!s){console.log("[DirectionCone] Cannot update: position or map missing",{position:!!e,map:!!s});return}const d=e.getGeometry();if(!d){console.log("[DirectionCone] Cannot update: position geometry missing");return}const p=d.getCoordinates();if(console.log("[DirectionCone] Updating cone:",{center:p,heading:a,radius:o,fieldOfView:u,hasFeature:!!c,hasSource:!1}),c){const m=g(p,a,o,u);c.setGeometry(m),console.log("[DirectionCone] Updated cone geometry")}else{const m=g(p,a,o,u);c=new G({geometry:m}),c.setId("direction-cone"),console.log("[DirectionCone] Created new cone feature")}}R(()=>{}),s&&e&&a!==void 0&&(console.log("[DirectionCone] Reactive update triggered",{hasMap:!!s,hasPosition:!!e,heading:a,hasDirectionSource:!1}),f()),b(i,{map:s,position:e,heading:a,fieldOfView:u,radius:o})})}function tt(l,i){l.component(t=>{var s;let e=r(i.isTracking,!1),a=r(i.error,null);k(t,u=>{u.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet" class="svelte-1wnqptu"/>')}),t.push(`<div class="location-button-container svelte-1wnqptu"><button${C("location-button svelte-1wnqptu",void 0,{active:e,error:!!a})}${w("title",e?"Stop location tracking":"Start location tracking")}><span class="icon svelte-1wnqptu">`),e?(t.push("<!--[-->"),t.push('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-1wnqptu"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" stroke="#6b5d52" stroke-width="1.5" fill="#d4af37" stroke-linejoin="round" class="svelte-1wnqptu"></path></svg>')):(t.push("<!--[!-->"),t.push('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-1wnqptu"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" stroke="#6b5d52" stroke-width="1.5" fill="none" stroke-linejoin="round" class="svelte-1wnqptu"></path></svg>')),t.push(`<!--]--></span> <span class="label svelte-1wnqptu">${n(e?h(s??={},"$t",v).location.tracking:h(s??={},"$t",v).location.myLocation)}</span></button> `),a?(t.push("<!--[-->"),t.push(`<div class="error-tooltip svelte-1wnqptu">${n(a)}</div>`)):t.push("<!--[!-->"),t.push("<!--]--></div>"),s&&T(s),b(i,{isTracking:e,error:a})})}function st(l,i){l.component(t=>{let s=r(i.isOpen,!1),e="",a=[],u=!1,o=null;if(s||(e="",a=[],o=null),k(t,c=>{c.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>')}),t.push('<div class="search-container svelte-td9aje"><button class="search-toggle svelte-td9aje" title="Search location"><span class="icon svelte-td9aje"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-td9aje"><circle cx="11" cy="11" r="7" stroke="#6b5d52" stroke-width="1.5"></circle><path d="M16 16L21 21" stroke="#6b5d52" stroke-width="1.5" stroke-linecap="round"></path></svg></span> '),s?t.push("<!--[!-->"):(t.push("<!--[-->"),t.push('<span class="label svelte-td9aje">Search</span>')),t.push("<!--]--></button> "),s){if(t.push("<!--[-->"),t.push(`<div class="search-panel svelte-td9aje"><div class="search-header svelte-td9aje"><span class="header-icon svelte-td9aje">üìç</span> <span class="header-text svelte-td9aje">Search Location</span></div> <div class="search-input-container svelte-td9aje"><input type="text" class="search-input svelte-td9aje" placeholder="Enter city, address, or landmark..."${w("value",e)}${w("disabled",u,!0)}/> <button class="search-button svelte-td9aje"${w("disabled",!e.trim(),!0)}>${n("Search")}</button></div> `),o?(t.push("<!--[-->"),t.push(`<div class="error-message svelte-td9aje">${n(o)}</div>`)):t.push("<!--[!-->"),t.push("<!--]--> "),a.length>0){t.push("<!--[-->"),t.push('<div class="results-list svelte-td9aje"><!--[-->');const c=O(a);for(let g=0,f=c.length;g<f;g++){let d=c[g];t.push(`<button class="result-item svelte-td9aje"><span class="result-icon svelte-td9aje">üìå</span> <div class="result-content svelte-td9aje"><div class="result-name svelte-td9aje">${n(d.name||d.display_name.split(",")[0])}</div> <div class="result-address svelte-td9aje">${n(d.display_name)}</div></div></button>`)}t.push("<!--]--></div>")}else t.push("<!--[!-->");t.push("<!--]--></div>")}else t.push("<!--[!-->");t.push("<!--]--></div>"),b(i,{isOpen:s})})}function et(l,i){l.component(t=>{var s;let e=r(i.cityName,""),a=r(i.isOpen,!1);function u(o){const c=o.toLowerCase().replace(/\s+/g,"");return h(s??={},"$t",v).cities[c]||o}k(t,o=>{o.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>')}),a?(t.push("<!--[-->"),t.push(`<div class="dialog-overlay svelte-r8jync"><div class="dialog-container svelte-r8jync"><div class="dialog-icon svelte-r8jync">${n(h(s??={},"$t",v).cityFilter.icon)}</div> <div class="dialog-content svelte-r8jync"><h3 class="dialog-title svelte-r8jync">${n(h(s??={},"$t",v).cityFilter.title)}</h3> <p class="dialog-message svelte-r8jync">${n(h(s??={},"$t",v).cityFilter.message)} <strong class="svelte-r8jync">${n(u(e))}</strong>?</p></div> <div class="dialog-actions svelte-r8jync"><button class="dialog-button secondary svelte-r8jync">${n(h(s??={},"$t",v).cityFilter.noShowAll)}</button> <button class="dialog-button primary svelte-r8jync">${n(h(s??={},"$t",v).cityFilter.yesFilter)}</button></div></div></div>`)):t.push("<!--[!-->"),t.push("<!--]-->"),s&&T(s),b(i,{cityName:e,isOpen:a})})}function at(l,i){l.component(t=>{var s;let e=r(i.isOpen,!1),a=r(i.cities,()=>[],!0);function u(o){const c=o.toLowerCase().replace(/\s+/g,"");return h(s??={},"$t",v).cities[c]||o}if(k(t,o=>{o.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>')}),e){t.push("<!--[-->"),t.push(`<div class="dialog-overlay svelte-1vbp4hf"><div class="dialog-container svelte-1vbp4hf"><div class="dialog-header svelte-1vbp4hf"><div class="dialog-icon svelte-1vbp4hf">üó∫Ô∏è</div> <h2 class="dialog-title svelte-1vbp4hf">${n(h(s??={},"$t",v).welcome.title)}</h2> <div class="language-toggle svelte-1vbp4hf"><button${C("lang-button svelte-1vbp4hf",void 0,{active:h(s??={},"$currentLanguage",q)==="en"})}>EN</button> <span class="lang-separator svelte-1vbp4hf">|</span> <button${C("lang-button svelte-1vbp4hf",void 0,{active:h(s??={},"$currentLanguage",q)==="vi"})}>VI</button></div></div> <div class="dialog-content svelte-1vbp4hf"><p class="dialog-message svelte-1vbp4hf">${n(h(s??={},"$t",v).welcome.message)}</p> <div class="city-grid svelte-1vbp4hf"><!--[-->`);const o=O(a);for(let c=0,g=o.length;c<g;c++){let f=o[c];t.push(`<button class="city-button svelte-1vbp4hf"><span class="city-icon svelte-1vbp4hf">${n(h(s??={},"$t",v).welcome.cityIcon)}</span> <span class="city-name svelte-1vbp4hf">${n(u(f))}</span></button>`)}t.push(`<!--]--></div></div> <div class="dialog-actions svelte-1vbp4hf"><button class="dialog-button secondary svelte-1vbp4hf">${n(h(s??={},"$t",v).welcome.skipButton)}</button></div></div></div>`)}else t.push("<!--[!-->");t.push("<!--]-->"),s&&T(s),b(i,{isOpen:e,cities:a})})}function it(l,i){l.component(t=>{var s;let e=r(i.isVisible,!1);k(t,a=>{a.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet" class="svelte-1lpq58w"/>')}),e?(t.push("<!--[-->"),t.push(`<div class="hint-overlay svelte-1lpq58w"><div class="spotlight svelte-1lpq58w"></div></div> <div class="hint-popup svelte-1lpq58w"><div class="hint-content svelte-1lpq58w"><div class="hint-icon svelte-1lpq58w">${n(h(s??={},"$t",v).mapHint.icon)}</div> <div class="hint-text svelte-1lpq58w"><div class="hint-title svelte-1lpq58w">${n(h(s??={},"$t",v).mapHint.title)}</div> <div class="hint-description svelte-1lpq58w">${n(h(s??={},"$t",v).mapHint.description)}</div></div></div> <button class="hint-dismiss svelte-1lpq58w">${n(h(s??={},"$t",v).mapHint.button)}</button></div>`)):t.push("<!--[!-->"),t.push("<!--]-->"),s&&T(s),b(i,{isVisible:e})})}function lt(l,i){l.component(t=>{let s=r(i.isTracking,!1),e=r(i.error,null),a=r(i.opacity,1),u=r(i.hasMapSelected,!1),o=r(i.searchOpen,!1),c=!1,g="",f=[],d=!1,p=null;if(o||(g="",f=[],p=null),k(t,m=>{m.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet" class="svelte-ua832v"/>')}),t.push(`<div class="mobile-controls svelte-ua832v"><div class="control-bar svelte-ua832v"><button${C("control-btn svelte-ua832v",void 0,{active:s})}${w("title",s?"Stop tracking":"Start tracking")}><span class="btn-icon svelte-ua832v">`),s?(t.push("<!--[-->"),t.push('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-ua832v"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" stroke="#6b5d52" stroke-width="1.5" fill="#d4af37" stroke-linejoin="round" class="svelte-ua832v"></path></svg>')):(t.push("<!--[!-->"),t.push('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-ua832v"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" stroke="#6b5d52" stroke-width="1.5" fill="none" stroke-linejoin="round" class="svelte-ua832v"></path></svg>')),t.push(`<!--]--></span></button> <button${C("control-btn svelte-ua832v",void 0,{active:o})} title="Search location"><span class="btn-icon svelte-ua832v"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-ua832v"><circle cx="11" cy="11" r="7" stroke="#6b5d52" stroke-width="1.5" class="svelte-ua832v"></circle><path d="M16 16L21 21" stroke="#6b5d52" stroke-width="1.5" stroke-linecap="round" class="svelte-ua832v"></path></svg></span></button> `),u?(t.push("<!--[-->"),t.push(`<button${C("control-btn svelte-ua832v",void 0,{active:c})} title="Adjust opacity"><span class="btn-icon svelte-ua832v">‚óê</span></button>`)):t.push("<!--[!-->"),t.push("<!--]--></div> "),t.push("<!--[!-->"),t.push("<!--]--> "),o){if(t.push("<!--[-->"),t.push(`<div class="expansion-panel search-panel svelte-ua832v"><div class="search-header svelte-ua832v"><span class="header-icon svelte-ua832v">üìç</span> <span class="header-text svelte-ua832v">Search Location</span></div> <div class="search-input-wrapper svelte-ua832v"><input type="text" class="search-input svelte-ua832v" placeholder="Enter city, address..."${w("value",g)}${w("disabled",d,!0)}/> <button class="search-btn svelte-ua832v"${w("disabled",!g.trim(),!0)}>${n("üîç")}</button></div> `),p?(t.push("<!--[-->"),t.push(`<div class="search-error svelte-ua832v">${n(p)}</div>`)):t.push("<!--[!-->"),t.push("<!--]--> "),f.length>0){t.push("<!--[-->"),t.push('<div class="search-results svelte-ua832v"><!--[-->');const m=O(f);for(let S=0,M=m.length;S<M;S++){let y=m[S];t.push(`<button class="result-item svelte-ua832v"><span class="result-icon svelte-ua832v">üìå</span> <div class="result-content svelte-ua832v"><div class="result-name svelte-ua832v">${n(y.name||y.display_name.split(",")[0])}</div> <div class="result-address svelte-ua832v">${n(y.display_name)}</div></div></button>`)}t.push("<!--]--></div>")}else t.push("<!--[!-->");t.push("<!--]--></div>")}else t.push("<!--[!-->");t.push("<!--]--> "),e?(t.push("<!--[-->"),t.push(`<div class="error-badge svelte-ua832v">${n(e)}</div>`)):t.push("<!--[!-->"),t.push("<!--]--></div>"),b(i,{isTracking:s,error:e,opacity:a,hasMapSelected:u,searchOpen:o})})}const D="vma-trip-preferences-v1",x={hasSeenWelcome:!1,hasCompletedTutorial:!1,hasSeenMapHint:!1,autoStartLocation:!1,lastKnownPosition:null};function ot(){if(typeof window>"u")return x;try{const l=window.localStorage.getItem(D);if(l){const i=JSON.parse(l);return{...x,...i}}}catch(l){console.warn("Failed to load trip preferences:",l)}return x}function j(l){if(!(typeof window>"u"))try{window.localStorage.setItem(D,JSON.stringify(l))}catch(i){console.warn("Failed to save trip preferences:",i)}}function nt(){const{subscribe:l,set:i,update:t}=F(ot());return{subscribe:l,setHasSeenWelcome:s=>{t(e=>{const a={...e,hasSeenWelcome:s};return j(a),a})},setHasCompletedTutorial:s=>{t(e=>{const a={...e,hasCompletedTutorial:s};return j(a),a})},setHasSeenMapHint:s=>{t(e=>{const a={...e,hasSeenMapHint:s};return j(a),a})},setAutoStartLocation:s=>{t(e=>{const a={...e,autoStartLocation:s};return j(a),a})},setLastKnownPosition:s=>{t(e=>{const a={...e,lastKnownPosition:s};return j(a),a})},reset:()=>{i(x),j(x)}}}const V={currentYear:new Date().getFullYear(),availableYears:[],activeMapId:null,isTransitioning:!1};function ct(){const{subscribe:l,set:i,update:t}=F(V);return{subscribe:l,setCurrentYear:s=>{t(e=>({...e,currentYear:s}))},setAvailableYears:s=>{t(e=>{const a=[...s].sort((o,c)=>o-c),u=a.length>0?Math.max(...a):e.currentYear;return{...e,availableYears:a,currentYear:u}})},setActiveMap:s=>{t(e=>({...e,activeMapId:s}))},setIsTransitioning:s=>{t(e=>({...e,isTransitioning:s}))},reset:()=>{i(V)}}}const ut=Symbol("trip-context");function pt(l){K(ut,l)}function ht(l,i){l.component(t=>{let s,e=null,a="inactive",u=null,o=null,c=null,g=[],f=!1,d=null;const p=nt(),m=ct();pt({preferences:p,timeline:m});let S=0,M=!1,y=!1,B=!1,L=!1,N=.8;s=Array.from(new Set(g.map(P=>P.type).filter(Boolean))).sort(),t.push('<div class="trip-container svelte-1id9u82"><div class="map svelte-1id9u82"></div> '),tt(t,{isTracking:a==="active",error:o}),t.push("<!----> "),st(t,{isOpen:L}),t.push("<!----> "),$(t,{map:e,position:u,heading:S}),t.push("<!----> "),Z(t,{maps:g,selected:c,loading:f,filterCity:d}),t.push("<!----> "),et(t,{cityName:"",isOpen:M}),t.push("<!----> "),at(t,{isOpen:y,cities:s}),t.push("<!----> "),it(t,{isVisible:B}),t.push("<!----> "),t.push("<!--[!-->"),t.push("<!--]--> "),lt(t,{isTracking:a==="active",error:o,opacity:N,hasMapSelected:!1,searchOpen:L}),t.push("<!----></div>")})}function St(l){ht(l)}export{St as default};
