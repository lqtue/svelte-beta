import{g as z,j as K,k as W,f as _,l as G,m as X,n as Q,h as T,a as S,c as p,b as j,u as P,e as N}from"../../../chunks/index2.js";import{W as J,Y as v,X as n,V as U}from"../../../chunks/context.js";import"@sveltejs/kit/internal";import"../../../chunks/exports.js";import"../../../chunks/utils.js";import"clsx";import"@sveltejs/kit/internal/server";import"../../../chunks/state.svelte.js";import"ol/proj.js";import"@allmaps/openlayers";import{o as Z}from"../../../chunks/ol.js";import"../../../chunks/constants.js";import{w as R,d as $}from"../../../chunks/index.js";import tt from"ol/geom/Polygon.js";import st from"ol/Feature.js";const et=()=>{const i=J("__svelte__");return{page:{subscribe:i.page.subscribe},navigating:{subscribe:i.navigating.subscribe},updated:i.updated}},V={subscribe(i){return et().page.subscribe(i)}};function at(i,s){const t=z(s),e=K(t,["as","gap","align","justify","wrap","className","style"]);i.component(a=>{let o,u,h,c;const m={start:"flex-start",center:"center",end:"flex-end",stretch:"stretch",baseline:"baseline"},b={start:"flex-start",center:"center",end:"flex-end",between:"space-between",around:"space-around",evenly:"space-evenly"};let g=v(s.as,"div"),r=v(s.gap,"var(--space-4)"),f=v(s.align,"stretch"),k=v(s.justify,"start"),l=v(s.wrap,!1),y=v(s.className,""),x=v(s.style,void 0);const w=(C,M)=>M in C?C[M]:M;o=w(m,String(f)),u=w(b,String(k)),h=["stack",l?"stack--wrap":"",y,t.class].filter(Boolean).join(" "),c=[x,t.style,`--stack-gap:${r}`,`--stack-align:${o}`,`--stack-justify:${u}`].filter(Boolean).join(";"),W(a,g,()=>{a.push(`${X({...e,class:Q(h),style:c},"svelte-h657km")}`)},()=>{a.push("<!--[-->"),G(a,s,"default",{}),a.push("<!--]-->")}),_(s,{as:g,gap:r,align:f,justify:k,wrap:l,className:y,style:x})})}function Y(){return typeof window<"u"}function it(i,s){let t;return e=>{t!==void 0&&clearTimeout(t),t=setTimeout(()=>{i(e),t=void 0},s)}}function lt(i,s,t){if(!Y())return s;const e=t??window.localStorage;try{const a=e.getItem(i);if(a){const o=JSON.parse(a);return typeof s=="object"&&s!==null&&!Array.isArray(s)?{...s,...o}:o}}catch(a){console.warn(`[PersistedStore] Failed to load "${i}":`,a)}return s}function q(i,s,t){if(!Y())return;const e=t??window.localStorage;try{e.setItem(i,JSON.stringify(s))}catch(a){console.warn(`[PersistedStore] Failed to save "${i}":`,a)}}function D(i){const{key:s,defaultValue:t,debounceMs:e=0,storage:a}=i,o=lt(s,t,a),{subscribe:u,set:h,update:c}=R(o),m=e>0?it(f=>q(s,f,a),e):f=>q(s,f,a);function b(f){h(f),m(f)}function g(f){c(k=>{const l=f(k);return m(l),l})}function r(){b(t)}return{subscribe:u,set:b,update:g,reset:r}}const ot="vma-trip-language-v1";function nt(){const i=D({key:ot,defaultValue:"en"});return{subscribe:i.subscribe,setLanguage:s=>{i.set(s)},toggleLanguage:()=>{i.update(s=>s==="en"?"vi":"en")}}}const F=nt(),ct={welcome:{title:"Welcome to Historical Maps",message:"Choose your starting city to explore historical maps from different eras.",skipButton:"Skip for Now",cityIcon:"üìç"},mapSelector:{consultingAtlas:"Consulting Atlas...",mapCollection:"Map Collection",allRegions:"All Regions",searchPlaceholder:"Search by year or name",zoomButton:"üîç Zoom to Map",anno:"Anno",noMapsFound:"‚äò No maps discovered in this region",buttonOrnament:"‚ßâ"},location:{tracking:"Tracking",myLocation:"My Location"},mapHint:{icon:"üëÜ",title:"Explore Historical Maps",description:"Click here to browse our collection of vintage maps",button:"Got it!"},cityFilter:{icon:"üó∫Ô∏è",title:"Filter Map Collection?",message:"Would you like to filter the map collection to show only maps from",noShowAll:"No, Show All",yesFilter:"Yes, Filter"},cities:{hanoi:"Hanoi",hue:"Hue",hochiminh:"Ho Chi Minh City",danang:"Da Nang",haiphong:"Hai Phong",cantho:"Can Tho",nhatrang:"Nha Trang",dalat:"Da Lat",vungtau:"Vung Tau",quinhon:"Quy Nhon"},search:{search:"Search",searchLocation:"Search location",searchPlaceholder:"Enter location...",searching:"Searching..."},viewControls:{overlayOpacity:"Overlay Opacity",opacity:"Opacity",viewMode:"View Mode",overlay:"Overlay",sideX:"Side X",sideY:"Side Y",spyglass:"Spyglass"},loading:{preparingMap:"Preparing your map...",loadingCity:"Loading",findingMaps:"Finding historical maps...",almostReady:"Almost ready!"},common:{loading:"Loading...",error:"Error",close:"Close",cancel:"Cancel",confirm:"Confirm",save:"Save"}},ut={welcome:{title:"Ch√†o m·ª´ng ƒë·∫øn v·ªõi B·∫£n ƒë·ªì L·ªãch s·ª≠",message:"Ch·ªçn th√†nh ph·ªë b·∫Øt ƒë·∫ßu ƒë·ªÉ kh√°m ph√° b·∫£n ƒë·ªì l·ªãch s·ª≠ t·ª´ nhi·ªÅu th·ªùi k·ª≥ kh√°c nhau.",skipButton:"B·ªè qua",cityIcon:"üìç"},mapSelector:{consultingAtlas:"ƒêang t·∫£i b·∫£n ƒë·ªì...",mapCollection:"B·ªô s∆∞u t·∫≠p B·∫£n ƒë·ªì",allRegions:"T·∫•t c·∫£ V√πng",searchPlaceholder:"T√¨m ki·∫øm theo nƒÉm ho·∫∑c t√™n",zoomButton:"üîç Ph√≥ng to B·∫£n ƒë·ªì",anno:"NƒÉm",noMapsFound:"‚äò Kh√¥ng t√¨m th·∫•y b·∫£n ƒë·ªì trong khu v·ª±c n√†y",buttonOrnament:"‚ßâ"},location:{tracking:"ƒêang theo d√µi",myLocation:"V·ªã tr√≠ c·ªßa t√¥i"},mapHint:{icon:"üëÜ",title:"Kh√°m ph√° B·∫£n ƒë·ªì L·ªãch s·ª≠",description:"Nh·∫•n v√†o ƒë√¢y ƒë·ªÉ xem b·ªô s∆∞u t·∫≠p b·∫£n ƒë·ªì c·ªï c·ªßa ch√∫ng t√¥i",button:"ƒê√£ hi·ªÉu!"},cityFilter:{icon:"üó∫Ô∏è",title:"L·ªçc B·ªô s∆∞u t·∫≠p B·∫£n ƒë·ªì?",message:"B·∫°n c√≥ mu·ªën l·ªçc b·ªô s∆∞u t·∫≠p b·∫£n ƒë·ªì ƒë·ªÉ ch·ªâ hi·ªÉn th·ªã b·∫£n ƒë·ªì t·ª´",noShowAll:"Kh√¥ng, Hi·ªÉn th·ªã T·∫•t c·∫£",yesFilter:"C√≥, L·ªçc"},cities:{hanoi:"H√† N·ªôi",hue:"Hu·∫ø",hochiminh:"Th√†nh ph·ªë H·ªì Ch√≠ Minh",danang:"ƒê√† N·∫µng",haiphong:"H·∫£i Ph√≤ng",cantho:"C·∫ßn Th∆°",nhatrang:"Nha Trang",dalat:"ƒê√† L·∫°t",vungtau:"V≈©ng T√†u",quinhon:"Quy Nh∆°n"},search:{search:"T√¨m ki·∫øm",searchLocation:"T√¨m ki·∫øm v·ªã tr√≠",searchPlaceholder:"Nh·∫≠p v·ªã tr√≠...",searching:"ƒêang t√¨m..."},viewControls:{overlayOpacity:"ƒê·ªô trong su·ªët",opacity:"ƒê·ªô m·ªù",viewMode:"Ch·∫ø ƒë·ªô xem",overlay:"Ph·ªß",sideX:"Chia ngang",sideY:"Chia d·ªçc",spyglass:"K√≠nh l√∫p"},loading:{preparingMap:"ƒêang chu·∫©n b·ªã b·∫£n ƒë·ªì...",loadingCity:"ƒêang t·∫£i",findingMaps:"ƒêang t√¨m b·∫£n ƒë·ªì l·ªãch s·ª≠...",almostReady:"G·∫ßn ho√†n t·∫•t!"},common:{loading:"ƒêang t·∫£i...",error:"L·ªói",close:"ƒê√≥ng",cancel:"H·ªßy",confirm:"X√°c nh·∫≠n",save:"L∆∞u"}},pt={en:ct,vi:ut},d=$(F,i=>pt[i]);function ht(i,s){i.component(t=>{var e;let a,o,u,h=v(s.maps,()=>[],!0),c=v(s.selected,null),m=v(s.loading,!1),b=v(s.filterCity,null),g=v(s.initialOpen,!1),r="",f="all",k=g;b&&(f=b,k=!0),a=Array.from(new Set(h.map(l=>l.type).filter(Boolean))).sort(),o=h.filter(l=>{if(f!=="all"&&l.type!==f)return!1;if(!r.trim())return!0;const y=r.toLowerCase();return l.name.toLowerCase().includes(y)||l.type.toLowerCase().includes(y)||l.summary?.toLowerCase().includes(y)}),u=h.find(l=>l.id===c),T(t,l=>{l.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>')}),t.push(`<div class="selector-container svelte-1twr28"><button class="selector-button svelte-1twr28"${S("disabled",m,!0)}><span class="button-ornament svelte-1twr28">${n(p(e??={},"$t",d).mapSelector.buttonOrnament)}</span> <span class="button-text svelte-1twr28">`),m?(t.push("<!--[-->"),t.push(`${n(p(e??={},"$t",d).mapSelector.consultingAtlas)}`)):(t.push("<!--[!-->"),u?(t.push("<!--[-->"),t.push(`${n(u.name)}`)):(t.push("<!--[!-->"),t.push(`${n(p(e??={},"$t",d).mapSelector.mapCollection)}`)),t.push("<!--]-->")),t.push(`<!--]--></span> <span${j("arrow svelte-1twr28",void 0,{open:k})}>‚ñº</span></button> `),k?(t.push("<!--[-->"),t.push('<div class="selector-panel svelte-1twr28">'),at(t,{gap:"var(--space-2)",children:l=>{if(a.length>0?(l.push("<!--[-->"),l.select({class:"city-select",value:f},y=>{y.option({value:"all",class:""},w=>{w.push(`${n(p(e??={},"$t",d).mapSelector.allRegions)}`)},"svelte-1twr28"),y.push("<!--[-->");const x=N(a);for(let w=0,C=x.length;w<C;w++){let M=x[w];y.option({value:M,class:""},L=>{L.push(`${n(M)}`)},"svelte-1twr28")}y.push("<!--]-->")},"svelte-1twr28")):l.push("<!--[!-->"),l.push(`<!--]--> <input type="text" class="search-input svelte-1twr28"${S("placeholder",p(e??={},"$t",d).mapSelector.searchPlaceholder)}${S("value",r)}/> <div class="map-list svelte-1twr28">`),c&&u?.bounds?(l.push("<!--[-->"),l.push(`<button class="map-item zoom svelte-1twr28"><span class="zoom-icon svelte-1twr28">üîç</span> <span>${n(p(e??={},"$t",d).mapSelector.zoomButton.replace("üîç ",""))}</span></button>`)):l.push("<!--[!-->"),l.push("<!--]--> "),o.length===0)l.push("<!--[-->"),l.push(`<div class="empty-state svelte-1twr28"><div class="empty-icon svelte-1twr28">‚äò</div> <p class="svelte-1twr28">${n(p(e??={},"$t",d).mapSelector.noMapsFound.replace("‚äò ",""))}</p></div>`);else{l.push("<!--[!-->"),l.push("<!--[-->");const y=N(o);for(let x=0,w=y.length;x<w;x++){let C=y[x];l.push(`<button${j("map-item svelte-1twr28",void 0,{selected:C.id===c})}><div class="map-info svelte-1twr28"><div class="map-name svelte-1twr28">${n(C.name)}</div> `),C.type?(l.push("<!--[-->"),l.push(`<div class="map-type svelte-1twr28">${n(C.type)}</div>`)):l.push("<!--[!-->"),l.push("<!--]--> "),C.year?(l.push("<!--[-->"),l.push(`<div class="map-year svelte-1twr28">${n(p(e??={},"$t",d).mapSelector.anno)} ${n(C.year)}</div>`)):l.push("<!--[!-->"),l.push("<!--]--></div> "),C.id===c?(l.push("<!--[-->"),l.push('<div class="selected-mark svelte-1twr28">‚úì</div>')):l.push("<!--[!-->"),l.push("<!--]--></button>")}l.push("<!--]-->")}l.push("<!--]--></div>")},$$slots:{default:!0}}),t.push("<!----></div>")):t.push("<!--[!-->"),t.push("<!--]--></div>"),e&&P(e),_(s,{maps:h,selected:c,loading:m,filterCity:b,initialOpen:g})})}function vt(i,s){i.component(t=>{let e=s.map,a=s.position,o=v(s.heading,0),u=v(s.fieldOfView,60),h=v(s.radius,200),c=null;function m(g,r,f,k){const l=f,y=(90-r)*Math.PI/180,x=k/2*Math.PI/180,w=[g],C=y-x,M=y+x,L=20;for(let B=0;B<=L;B++){const O=C+B/L*(M-C),H=g[0]+l*Math.cos(O),A=g[1]+l*Math.sin(O);w.push([H,A])}return w.push(g),new tt([w])}function b(){if(!a||!e){console.log("[DirectionCone] Cannot update: position or map missing",{position:!!a,map:!!e});return}const g=a.getGeometry();if(!g){console.log("[DirectionCone] Cannot update: position geometry missing");return}const r=g.getCoordinates();if(console.log("[DirectionCone] Updating cone:",{center:r,heading:o,radius:h,fieldOfView:u,hasFeature:!!c,hasSource:!1}),c){const f=m(r,o,h,u);c.setGeometry(f),console.log("[DirectionCone] Updated cone geometry")}else{const f=m(r,o,h,u);c=new st({geometry:f}),c.setId("direction-cone"),console.log("[DirectionCone] Created new cone feature")}}Z(()=>{}),e&&a&&o!==void 0&&(console.log("[DirectionCone] Reactive update triggered",{hasMap:!!e,hasPosition:!!a,heading:o,hasDirectionSource:!1}),b()),_(s,{map:e,position:a,heading:o,fieldOfView:u,radius:h})})}function dt(i,s){i.component(t=>{var e;let a=v(s.isTracking,!1),o=v(s.error,null);T(t,u=>{u.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet" class="svelte-1wnqptu"/>')}),t.push(`<div class="location-button-container svelte-1wnqptu"><button${j("location-button svelte-1wnqptu",void 0,{active:a,error:!!o})}${S("title",a?"Stop location tracking":"Start location tracking")}><span class="icon svelte-1wnqptu">`),a?(t.push("<!--[-->"),t.push("‚óâ")):(t.push("<!--[!-->"),t.push("‚óé")),t.push(`<!--]--></span> <span class="label svelte-1wnqptu">${n(a?p(e??={},"$t",d).location.tracking:p(e??={},"$t",d).location.myLocation)}</span></button> `),o?(t.push("<!--[-->"),t.push(`<div class="error-tooltip svelte-1wnqptu">${n(o)}</div>`)):t.push("<!--[!-->"),t.push("<!--]--></div>"),e&&P(e),_(s,{isTracking:a,error:o})})}function gt(i,s){i.component(t=>{var e;let a=v(s.isOpen,!1),o="",u=[],h=!1,c=null;if(a||(o="",u=[],c=null),T(t,m=>{m.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>')}),t.push(`<div class="search-container svelte-td9aje"><button class="search-toggle svelte-td9aje"${S("title",p(e??={},"$t",d).search.searchLocation)}><span class="icon svelte-td9aje">‚åï</span> `),a?t.push("<!--[!-->"):(t.push("<!--[-->"),t.push(`<span class="label svelte-td9aje">${n(p(e??={},"$t",d).search.search)}</span>`)),t.push("<!--]--></button> "),a){if(t.push("<!--[-->"),t.push(`<div class="search-panel svelte-td9aje"><div class="search-header svelte-td9aje"><span class="header-icon svelte-td9aje">üìç</span> <span class="header-text svelte-td9aje">${n(p(e??={},"$t",d).search.searchLocation)}</span></div> <div class="search-input-container svelte-td9aje"><input type="text" class="search-input svelte-td9aje"${S("placeholder",p(e??={},"$t",d).search.searchPlaceholder)}${S("value",o)}${S("disabled",h,!0)}/> <button class="search-button svelte-td9aje"${S("disabled",!o.trim(),!0)}>${n(p(e??={},"$t",d).search.search)}</button></div> `),c?(t.push("<!--[-->"),t.push(`<div class="error-message svelte-td9aje">${n(c)}</div>`)):t.push("<!--[!-->"),t.push("<!--]--> "),u.length>0){t.push("<!--[-->"),t.push('<div class="results-list svelte-td9aje"><!--[-->');const m=N(u);for(let b=0,g=m.length;b<g;b++){let r=m[b];t.push(`<button class="result-item svelte-td9aje"><span class="result-icon svelte-td9aje">üìå</span> <div class="result-content svelte-td9aje"><div class="result-name svelte-td9aje">${n(r.name||r.display_name.split(",")[0])}</div> <div class="result-address svelte-td9aje">${n(r.display_name)}</div></div></button>`)}t.push("<!--]--></div>")}else t.push("<!--[!-->");t.push("<!--]--></div>")}else t.push("<!--[!-->");t.push("<!--]--></div>"),e&&P(e),_(s,{isOpen:a})})}function mt(i,s){i.component(t=>{var e;let a=v(s.cityName,""),o=v(s.isOpen,!1);function u(h){const c=h.toLowerCase().replace(/\s+/g,"");return p(e??={},"$t",d).cities[c]||h}T(t,h=>{h.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>')}),o?(t.push("<!--[-->"),t.push(`<div class="dialog-overlay svelte-r8jync"><div class="dialog-container svelte-r8jync"><div class="dialog-icon svelte-r8jync">${n(p(e??={},"$t",d).cityFilter.icon)}</div> <div class="dialog-content svelte-r8jync"><h3 class="dialog-title svelte-r8jync">${n(p(e??={},"$t",d).cityFilter.title)}</h3> <p class="dialog-message svelte-r8jync">${n(p(e??={},"$t",d).cityFilter.message)} <strong class="svelte-r8jync">${n(u(a))}</strong>?</p></div> <div class="dialog-actions svelte-r8jync"><button class="dialog-button secondary svelte-r8jync">${n(p(e??={},"$t",d).cityFilter.noShowAll)}</button> <button class="dialog-button primary svelte-r8jync">${n(p(e??={},"$t",d).cityFilter.yesFilter)}</button></div></div></div>`)):t.push("<!--[!-->"),t.push("<!--]-->"),e&&P(e),_(s,{cityName:a,isOpen:o})})}function ft(i,s){i.component(t=>{var e;let a=v(s.isOpen,!1),o=v(s.cities,()=>[],!0),u=v(s.loadingCity,null);function h(c){const m=c.toLowerCase().replace(/\s+/g,"");return p(e??={},"$t",d).cities[m]||c}if(T(t,c=>{c.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>')}),a){t.push("<!--[-->"),t.push(`<div class="dialog-overlay svelte-1vbp4hf"><div class="dialog-container svelte-1vbp4hf"><div class="dialog-header svelte-1vbp4hf"><div class="dialog-icon svelte-1vbp4hf">üó∫Ô∏è</div> <h2 class="dialog-title svelte-1vbp4hf">${n(p(e??={},"$t",d).welcome.title)}</h2> <div class="language-toggle svelte-1vbp4hf"><button${j("lang-button svelte-1vbp4hf",void 0,{active:p(e??={},"$currentLanguage",F)==="en"})}>EN</button> <span class="lang-separator svelte-1vbp4hf">|</span> <button${j("lang-button svelte-1vbp4hf",void 0,{active:p(e??={},"$currentLanguage",F)==="vi"})}>VI</button></div></div> <div class="dialog-content svelte-1vbp4hf"><p class="dialog-message svelte-1vbp4hf">${n(p(e??={},"$t",d).welcome.message)}</p> <div class="city-grid svelte-1vbp4hf"><!--[-->`);const c=N(o);for(let m=0,b=c.length;m<b;m++){let g=c[m];t.push(`<button${j("city-button svelte-1vbp4hf",void 0,{loading:u===g,disabled:u&&u!==g})}${S("disabled",!!u,!0)}>`),u===g?(t.push("<!--[-->"),t.push(`<span class="loading-spinner svelte-1vbp4hf">‚è≥</span> <span class="city-name svelte-1vbp4hf">${n(p(e??={},"$t",d).loading.loadingCity)}...</span>`)):(t.push("<!--[!-->"),t.push(`<span class="city-icon svelte-1vbp4hf">${n(p(e??={},"$t",d).welcome.cityIcon)}</span> <span class="city-name svelte-1vbp4hf">${n(h(g))}</span>`)),t.push("<!--]--></button>")}t.push(`<!--]--></div></div> <div class="dialog-actions svelte-1vbp4hf"><button class="dialog-button secondary svelte-1vbp4hf"${S("disabled",!!u,!0)}>${n(p(e??={},"$t",d).welcome.skipButton)}</button></div></div></div>`)}else t.push("<!--[!-->");t.push("<!--]-->"),e&&P(e),_(s,{isOpen:a,cities:o,loadingCity:u})})}function rt(i,s){i.component(t=>{var e;let a=v(s.isVisible,!1);T(t,o=>{o.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet" class="svelte-1lpq58w"/>')}),a?(t.push("<!--[-->"),t.push(`<div class="hint-overlay svelte-1lpq58w"><div class="spotlight svelte-1lpq58w"></div></div> <div class="hint-popup svelte-1lpq58w"><div class="hint-content svelte-1lpq58w"><div class="hint-icon svelte-1lpq58w">${n(p(e??={},"$t",d).mapHint.icon)}</div> <div class="hint-text svelte-1lpq58w"><div class="hint-title svelte-1lpq58w">${n(p(e??={},"$t",d).mapHint.title)}</div> <div class="hint-description svelte-1lpq58w">${n(p(e??={},"$t",d).mapHint.description)}</div></div></div> <button class="hint-dismiss svelte-1lpq58w">${n(p(e??={},"$t",d).mapHint.button)}</button></div>`)):t.push("<!--[!-->"),t.push("<!--]-->"),e&&P(e),_(s,{isVisible:a})})}function yt(i,s){i.component(t=>{let e=v(s.isTracking,!1),a=v(s.error,null),o=v(s.opacity,1),u=v(s.hasMapSelected,!1),h=v(s.searchOpen,!1),c=v(s.viewMode,"overlay"),m=!1,b=!1,g="",r=[],f=!1,k=null;if(h||(g="",r=[],k=null),T(t,l=>{l.push('<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700;800&amp;family=Noto+Serif:ital,wght@0,400;0,600;0,700;1,400&amp;family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet" class="svelte-ua832v"/>')}),t.push(`<div class="mobile-controls svelte-ua832v"><div class="control-bar svelte-ua832v"><button${j("control-btn svelte-ua832v",void 0,{active:e})}${S("title",e?"Stop tracking":"Start tracking")}><span class="btn-icon svelte-ua832v">`),e?(t.push("<!--[-->"),t.push('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-ua832v"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" stroke="#6b5d52" stroke-width="1.5" fill="#d4af37" stroke-linejoin="round" class="svelte-ua832v"></path></svg>')):(t.push("<!--[!-->"),t.push('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-ua832v"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" stroke="#6b5d52" stroke-width="1.5" fill="none" stroke-linejoin="round" class="svelte-ua832v"></path></svg>')),t.push(`<!--]--></span></button> <button${j("control-btn svelte-ua832v",void 0,{active:h})} title="Search location"><span class="btn-icon svelte-ua832v"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-ua832v"><circle cx="11" cy="11" r="7" stroke="#6b5d52" stroke-width="1.5" class="svelte-ua832v"></circle><path d="M16 16L21 21" stroke="#6b5d52" stroke-width="1.5" stroke-linecap="round" class="svelte-ua832v"></path></svg></span></button> `),u?(t.push("<!--[-->"),t.push(`<button${j("control-btn svelte-ua832v",void 0,{active:b})} title="View mode"><span class="btn-icon svelte-ua832v">`),c==="overlay"?(t.push("<!--[-->"),t.push('<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#6b5d52" stroke-width="1.5" class="svelte-ua832v"><rect x="3" y="3" width="18" height="18" rx="2" class="svelte-ua832v"></rect></svg>')):(t.push("<!--[!-->"),c==="side-x"?(t.push("<!--[-->"),t.push('<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#6b5d52" stroke-width="1.5" class="svelte-ua832v"><rect x="3" y="3" width="18" height="18" rx="2" class="svelte-ua832v"></rect><line x1="12" y1="3" x2="12" y2="21" class="svelte-ua832v"></line></svg>')):(t.push("<!--[!-->"),c==="side-y"?(t.push("<!--[-->"),t.push('<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#6b5d52" stroke-width="1.5" class="svelte-ua832v"><rect x="3" y="3" width="18" height="18" rx="2" class="svelte-ua832v"></rect><line x1="3" y1="12" x2="21" y2="12" class="svelte-ua832v"></line></svg>')):(t.push("<!--[!-->"),t.push('<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#6b5d52" stroke-width="1.5" class="svelte-ua832v"><rect x="3" y="3" width="18" height="18" rx="2" class="svelte-ua832v"></rect><circle cx="12" cy="12" r="5" class="svelte-ua832v"></circle></svg>')),t.push("<!--]-->")),t.push("<!--]-->")),t.push("<!--]--></span></button>")):t.push("<!--[!-->"),t.push("<!--]--> "),u?(t.push("<!--[-->"),t.push(`<button${j("control-btn svelte-ua832v",void 0,{active:m})} title="Adjust opacity"><span class="btn-icon svelte-ua832v">‚óê</span></button>`)):t.push("<!--[!-->"),t.push("<!--]--></div> "),t.push("<!--[!-->"),t.push("<!--]--> "),t.push("<!--[!-->"),t.push("<!--]--> "),h){if(t.push("<!--[-->"),t.push(`<div class="expansion-panel search-panel svelte-ua832v"><div class="search-header svelte-ua832v"><span class="header-icon svelte-ua832v">üìç</span> <span class="header-text svelte-ua832v">Search Location</span></div> <div class="search-input-wrapper svelte-ua832v"><input type="text" class="search-input svelte-ua832v" placeholder="Enter city, address..."${S("value",g)}${S("disabled",f,!0)}/> <button class="search-btn svelte-ua832v"${S("disabled",!g.trim(),!0)}>${n("üîç")}</button></div> `),k?(t.push("<!--[-->"),t.push(`<div class="search-error svelte-ua832v">${n(k)}</div>`)):t.push("<!--[!-->"),t.push("<!--]--> "),r.length>0){t.push("<!--[-->"),t.push('<div class="search-results svelte-ua832v"><!--[-->');const l=N(r);for(let y=0,x=l.length;y<x;y++){let w=l[y];t.push(`<button class="result-item svelte-ua832v"><span class="result-icon svelte-ua832v">üìå</span> <div class="result-content svelte-ua832v"><div class="result-name svelte-ua832v">${n(w.name||w.display_name.split(",")[0])}</div> <div class="result-address svelte-ua832v">${n(w.display_name)}</div></div></button>`)}t.push("<!--]--></div>")}else t.push("<!--[!-->");t.push("<!--]--></div>")}else t.push("<!--[!-->");t.push("<!--]--> "),a?(t.push("<!--[-->"),t.push(`<div class="error-badge svelte-ua832v">${n(a)}</div>`)):t.push("<!--[!-->"),t.push("<!--]--></div>"),_(s,{isTracking:e,error:a,opacity:o,hasMapSelected:u,searchOpen:h,viewMode:c})})}const bt="vma-trip-preferences-v1",wt={hasSeenWelcome:!1,hasCompletedTutorial:!1,hasSeenMapHint:!1,autoStartLocation:!1,lastKnownPosition:null};function St(){const i=D({key:bt,defaultValue:wt,debounceMs:100});return{subscribe:i.subscribe,setHasSeenWelcome:s=>{i.update(t=>({...t,hasSeenWelcome:s}))},setHasCompletedTutorial:s=>{i.update(t=>({...t,hasCompletedTutorial:s}))},setHasSeenMapHint:s=>{i.update(t=>({...t,hasSeenMapHint:s}))},setAutoStartLocation:s=>{i.update(t=>({...t,autoStartLocation:s}))},setLastKnownPosition:s=>{i.update(t=>({...t,lastKnownPosition:s}))},reset:()=>{i.reset()}}}const I={currentYear:new Date().getFullYear(),availableYears:[],activeMapId:null,isTransitioning:!1};function Ct(){const{subscribe:i,set:s,update:t}=R(I);return{subscribe:i,setCurrentYear:e=>{t(a=>({...a,currentYear:e}))},setAvailableYears:e=>{t(a=>{const o=[...e].sort((h,c)=>h-c),u=o.length>0?Math.max(...o):a.currentYear;return{...a,availableYears:o,currentYear:u}})},setActiveMap:e=>{t(a=>({...a,activeMapId:e}))},setIsTransitioning:e=>{t(a=>({...a,isTransitioning:e}))},reset:()=>{s(I)}}}const kt=Symbol("trip-context");function xt(i){U(kt,i)}function Mt(i,s){i.component(t=>{let e,a=v(s.initialMapId,null),o=v(s.initialCity,null),u=null,h="inactive",c=null,m=null,b=null,g=[],r=!1,f=null;const k=St(),l=Ct();xt({preferences:k,timeline:l});let y=0,x=!1,w=!1,C=null,M=!1,L=!1,B=.8,O="overlay",H=.5,A=150;e=Array.from(new Set(g.map(E=>E.type).filter(Boolean))).sort(),t.push(`<div class="trip-container svelte-1id9u82"><div class="map svelte-1id9u82"></div> <div class="divider divider-x svelte-1id9u82"></div> <div class="divider-handle divider-handle-x svelte-1id9u82" role="slider" aria-label="Adjust horizontal split"${S("aria-valuenow",Math.round(H*100))} tabindex="0"></div> <div class="divider divider-y svelte-1id9u82"></div> <div class="divider-handle divider-handle-y svelte-1id9u82" role="slider" aria-label="Adjust vertical split"${S("aria-valuenow",Math.round(H*100))} tabindex="0"></div> <div class="lens svelte-1id9u82"></div> <div class="lens-handle svelte-1id9u82" role="slider" aria-label="Adjust lens size"${S("aria-valuenow",A)} tabindex="0"></div> `),dt(t,{isTracking:h==="active",error:m}),t.push("<!----> "),gt(t,{isOpen:L}),t.push("<!----> "),vt(t,{map:u,position:c,heading:y}),t.push("<!----> "),ht(t,{maps:g,selected:b,loading:r,filterCity:f}),t.push("<!----> "),mt(t,{cityName:"",isOpen:x}),t.push("<!----> "),ft(t,{isOpen:w,cities:e,loadingCity:C}),t.push("<!----> "),rt(t,{isVisible:M}),t.push("<!----> "),t.push("<!--[!-->"),t.push("<!--]--> "),yt(t,{isTracking:h==="active",error:m,opacity:B,viewMode:O,hasMapSelected:!1,searchOpen:L}),t.push("<!----></div>"),_(s,{initialMapId:a,initialCity:o})})}function Yt(i,s){i.component(t=>{var e;let a,o;a=p(e??={},"$page",V).url.searchParams.get("map"),o=p(e??={},"$page",V).url.searchParams.get("city"),Mt(t,{initialMapId:a,initialCity:o}),e&&P(e)})}export{Yt as default};
